(function(){function k(a){return a.target}function l(a){return a.source}function m(a,b){try{for(var c in b)Object.defineProperty(a.prototype,c,{value:b[c],enumerable:!1})}catch(d){a.prototype=b}}function o(a){var b=-1,c=a.length,d=[];while(++b<c)d.push(a[b]);return d}function p(a){return Array.prototype.slice.call(a)}function s(){}function v(a){return a}function w(){return!0}function x(a){return typeof a=="function"?a:function(){return a}}function y(a,b,c){return function(){var d=c.apply(b,arguments);return arguments.length?a:d}}function z(a){return a!=null&&!isNaN(a)}function A(a){return a.length}function C(a){return a.trim().replace(/\s+/g," ")}function D(a){var b=1;while(a*b%1)b*=10;return b}function F(a){return a.length===1?function(b,c){a(b==null?c:null)}:a}function G(a){return a.responseText}function H(a){return JSON.parse(a.responseText)}function I(a){var b=document.createRange();return b.selectNode(document.body),b.createContextualFragment(a.responseText)}function J(a){return a.responseXML}function L(){}function M(a){function d(){var c=b,d=-1,e=c.length,f;while(++d<e)(f=c[d].on)&&f.apply(this,arguments);return a}var b=[],c=new s;return d.on=function(d,e){var f=c.get(d),g;return arguments.length<2?f&&f.on:(f&&(f.on=null,b=b.slice(0,g=b.indexOf(f)).concat(b.slice(g+1)),c.remove(d)),e&&b.push(c.set(d,{on:e})),a)},d}function P(a,b){return b-(a?1+Math.floor(Math.log(a+Math.pow(10,1+Math.floor(Math.log(a)/Math.LN10)-b))/Math.LN10):1)}function Q(a){return a+""}function U(a,b){var c=Math.pow(10,Math.abs(8-b)*3);return{scale:b>8?function(a){return a/c}:function(a){return a*c},symbol:a}}function Y(a){return function(b){return b<=0?0:b>=1?1:a(b)}}function Z(a){return function(b){return 1-a(1-b)}}function $(a){return function(b){return.5*(b<.5?a(2*b):2-a(2-2*b))}}function _(a){return a*a}function ab(a){return a*a*a}function bb(a){if(a<=0)return 0;if(a>=1)return 1;var b=a*a,c=b*a;return 4*(a<.5?c:3*(a-b)+c-.75)}function cb(a){return function(b){return Math.pow(b,a)}}function db(a){return 1-Math.cos(a*g/2)}function eb(a){return Math.pow(2,10*(a-1))}function fb(a){return 1-Math.sqrt(1-a*a)}function gb(a,b){var c;return arguments.length<2&&(b=.45),arguments.length?c=b/(2*g)*Math.asin(1/a):(a=1,c=b/4),function(d){return 1+a*Math.pow(2,10*-d)*Math.sin((d-c)*2*g/b)}}function hb(a){return a||(a=1.70158),function(b){return b*b*((a+1)*b-a)}}function ib(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375}function jb(){d3.event.stopPropagation(),d3.event.preventDefault()}function kb(){var a=d3.event,b;while(b=a.sourceEvent)a=b;return a}function lb(a){var b=new L,c=0,d=arguments.length;while(++c<d)b[arguments[c]]=M(b);return b.of=function(c,d){return function(e){try{var f=e.sourceEvent=d3.event;e.target=a,d3.event=e,b[e.type].apply(c,d)}finally{d3.event=f}}},b}function mb(a){var b=[a.a,a.b],c=[a.c,a.d],d=ob(b),e=nb(b,c),f=ob(pb(c,b,-e))||0;b[0]*c[1]<c[0]*b[1]&&(b[0]*=-1,b[1]*=-1,d*=-1,e*=-1),this.rotate=(d?Math.atan2(b[1],b[0]):Math.atan2(-c[0],c[1]))*j,this.translate=[a.e,a.f],this.scale=[d,f],this.skew=f?Math.atan2(e,f)*j:0}function nb(a,b){return a[0]*b[0]+a[1]*b[1]}function ob(a){var b=Math.sqrt(nb(a,a));return b&&(a[0]/=b,a[1]/=b),b}function pb(a,b,c){return a[0]+=c*b[0],a[1]+=c*b[1],a}function sb(a){return a=="transform"?d3.interpolateTransform:d3.interpolate}function tb(a,b){return b=b-(a=+a)?1/(b-a):0,function(c){return(c-a)*b}}function ub(a,b){return b=b-(a=+a)?1/(b-a):0,function(c){return Math.max(0,Math.min(1,(c-a)*b))}}function vb(){}function wb(a,b,c){return new xb(a,b,c)}function xb(a,b,c){this.r=a,this.g=b,this.b=c}function zb(a){return a<16?"0"+Math.max(0,a).toString(16):Math.min(255,a).toString(16)}function Ab(a,b,c){var d=0,e=0,f=0,g,h,i;g=/([a-z]+)\((.*)\)/i.exec(a);if(g){h=g[2].split(",");switch(g[1]){case"hsl":return c(parseFloat(h[0]),parseFloat(h[1])/100,parseFloat(h[2])/100);case"rgb":return b(Eb(h[0]),Eb(h[1]),Eb(h[2]))}}return(i=Fb.get(a))?b(i.r,i.g,i.b):(a!=null&&a.charAt(0)==="#"&&(a.length===4?(d=a.charAt(1),d+=d,e=a.charAt(2),e+=e,f=a.charAt(3),f+=f):a.length===7&&(d=a.substring(1,3),e=a.substring(3,5),f=a.substring(5,7)),d=parseInt(d,16),e=parseInt(e,16),f=parseInt(f,16)),b(d,e,f))}function Bb(a,b,c){var d=Math.min(a/=255,b/=255,c/=255),e=Math.max(a,b,c),f=e-d,g,h,i=(e+d)/2;return f?(h=i<.5?f/(e+d):f/(2-e-d),a==e?g=(b-c)/f+(b<c?6:0):b==e?g=(c-a)/f+2:g=(a-b)/f+4,g*=60):h=g=0,Gb(g,h,i)}function Cb(a,b,c){a=Db(a),b=Db(b),c=Db(c);var d=Yb((.4124564*a+.3575761*b+.1804375*c)/Rb),e=Yb((.2126729*a+.7151522*b+.072175*c)/Sb),f=Yb((.0193339*a+.119192*b+.9503041*c)/Tb);return Ob(116*e-16,500*(d-e),200*(e-f))}function Db(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Eb(a){var b=parseFloat(a);return a.charAt(a.length-1)==="%"?Math.round(b*2.55):b}function Gb(a,b,c){return new Hb(a,b,c)}function Hb(a,b,c){this.h=a,this.s=b,this.l=c}function Jb(a,b,c){function f(a){return a>360?a-=360:a<0&&(a+=360),a<60?d+(e-d)*a/60:a<180?e:a<240?d+(e-d)*(240-a)/60:d}function g(a){return Math.round(f(a)*255)}var d,e;return a%=360,a<0&&(a+=360),b=b<0?0:b>1?1:b,c=c<0?0:c>1?1:c,e=c<=.5?c*(1+b):c+b-c*b,d=2*c-e,wb(g(a+120),g(a),g(a-120))}function Kb(a,b,c){return new Lb(a,b,c)}function Lb(a,b,c){this.h=a,this.c=b,this.l=c}function Nb(a,b,c){return Ob(c,Math.cos(a*=i)*b,Math.sin(a)*b)}function Ob(a,b,c){return new Pb(a,b,c)}function Pb(a,b,c){this.l=a,this.a=b,this.b=c}function Vb(a,b,c){var d=(a+16)/116,e=d+b/500,f=d-c/200;return e=Xb(e)*Rb,d=Xb(d)*Sb,f=Xb(f)*Tb,wb(Zb(3.2404542*e-1.5371385*d-.4985314*f),Zb(-0.969266*e+1.8760108*d+.041556*f),Zb(.0556434*e-.2040259*d+1.0572252*f))}function Wb(a,b,c){return Kb(Math.atan2(c,b)/g*180,Math.sqrt(b*b+c*c),a)}function Xb(a){return a>.206893034?a*a*a:(a-4/29)/7.787037}function Yb(a){return a>.008856?Math.pow(a,1/3):7.787037*a+4/29}function Zb(a){return Math.round(255*(a<=.00304?12.92*a:1.055*Math.pow(a,1/2.4)-.055))}function $b(a){return r(a,ec),a}function fc(a){return function(){return _b(a,this)}}function gc(a){return function(){return ac(a,this)}}function hc(a,b){function c(){this.removeAttribute(a)}function d(){this.removeAttributeNS(a.space,a.local)}function e(){this.setAttribute(a,b)}function f(){this.setAttributeNS(a.space,a.local,b)}function g(){var c=b.apply(this,arguments);c==null?this.removeAttribute(a):this.setAttribute(a,c)}function h(){var c=b.apply(this,arguments);c==null?this.removeAttributeNS(a.space,a.local):this.setAttributeNS(a.space,a.local,c)}return a=d3.ns.qualify(a),b==null?a.local?d:c:typeof b=="function"?a.local?h:g:a.local?f:e}function ic(a){return new RegExp("(?:^|\\s+)"+d3.requote(a)+"(?:\\s+|$)","g")}function jc(a,b){function d(){var d=-1;while(++d<c)a[d](this,b)}function e(){var d=-1,e=b.apply(this,arguments);while(++d<c)a[d](this,e)}a=a.trim().split(/\s+/).map(kc);var c=a.length;return typeof b=="function"?e:d}function kc(a){var b=ic(a);return function(c,d){if(e=c.classList)return d?e.add(a):e.remove(a);var e=c.className,f=e.baseVal!=null,g=f?e.baseVal:e;d?(b.lastIndex=0,b.test(g)||(g=C(g+" "+a),f?e.baseVal=g:c.className=g)):g&&(g=C(g.replace(b," ")),f?e.baseVal=g:c.className=g)}}function lc(a,b,c){function d(){this.style.removeProperty(a)}function e(){this.style.setProperty(a,b,c)}function f(){var d=b.apply(this,arguments);d==null?this.style.removeProperty(a):this.style.setProperty(a,d,c)}return b==null?d:typeof b=="function"?f:e}function mc(a,b){function c(){delete this[a]}function d(){this[a]=b}function e(){var c=b.apply(this,arguments);c==null?delete this[a]:this[a]=c}return b==null?c:typeof b=="function"?e:d}function nc(a){return{__data__:a}}function oc(a){return function(){return dc(this,a)}}function pc(a){return arguments.length||(a=d3.ascending),function(b,c){return a(b&&b.__data__,c&&c.__data__)}}function qc(a,b,c){function f(){var b=this[d];b&&(this.removeEventListener(a,b,b.$),delete this[d])}function g(){function h(a){var c=d3.event;d3.event=a,g[0]=e.__data__;try{b.apply(e,g)}finally{d3.event=c}}var e=this,g=n(arguments);f.call(this),this.addEventListener(a,this[d]=h,h.$=c),h._=b}var d="__on"+a,e=a.indexOf(".");return e>0&&(a=a.substring(0,e)),b?g:f}function rc(a,b){for(var c=0,d=a.length;c<d;c++)for(var e=a[c],f=0,g=e.length,h;f<g;f++)(h=e[f])&&b(h,f,c);return a}function tc(a){return r(a,uc),a}function vc(a,b){return r(a,wc),a.id=b,a}function Ac(a,b,c,d){var e=a.__transition__||(a.__transition__={active:0,count:0}),f=e[c];if(!f){var g=d.time;return f=e[c]={tween:new s,event:d3.dispatch("start","end"),time:g,ease:d.ease,delay:d.delay,duration:d.duration},++e.count,d3.timer(function(d){function n(d){return e.active>c?p():(e.active=c,j.start.call(a,h,b),f.tween.forEach(function(c,d){(d=d.call(a,h,b))&&m.push(d)}),o(d)||d3.timer(o,0,g),1)}function o(d){if(e.active!==c)return p();var f=(d-k)/l,g=i(f),n=m.length;while(n>0)m[--n].call(a,g);if(f>=1)return p(),j.end.call(a,h,b),1}function p(){return--e.count?delete e[c]:delete a.__transition__,1}var h=a.__data__,i=f.ease,j=f.event,k=f.delay,l=f.duration,m=[];return k<=d?n(d):d3.timer(n,k,g),1},0,g),f}}function Bc(a){return a==null&&(a=""),function(){this.textContent=a}}function Cc(a,b,c,d){var e=a.id;return rc(a,typeof c=="function"?function(a,f,g){a.__transition__[e].tween.set(b,d(c.call(a,a.__data__,f,g)))}:(c=d(c),function(a){a.__transition__[e].tween.set(b,c)}))}function Ic(){var a,b=Date.now(),c=Fc;while(c)a=b-c.then,a>=c.delay&&(c.flush=c.callback(a)),c=c.next;var d=Jc()-b;d>24?(isFinite(d)&&(clearTimeout(Hc),Hc=setTimeout(Ic,d)),Gc=0):(Gc=1,Kc(Ic))}function Jc(){var a=null,b=Fc,c=Infinity;while(b)b.flush?(delete Ec[b.callback.id],b=a?a.next=b.next:Fc=b.next):(c=Math.min(c,b.then+b.delay),b=(a=b).next);return c}function Mc(a,b){var c=a.ownerSVGElement||a;if(c.createSVGPoint){var d=c.createSVGPoint();if(Lc<0&&(window.scrollX||window.scrollY)){c=d3.select(document.body).append("svg").style("position","absolute").style("top",0).style("left",0);var e=c[0][0].getScreenCTM();Lc=!e.f&&!e.e,c.remove()}return Lc?(d.x=b.pageX,d.y=b.pageY):(d.x=b.clientX,d.y=b.clientY),d=d.matrixTransform(a.getScreenCTM().inverse()),[d.x,d.y]}var f=a.getBoundingClientRect();return[b.clientX-f.left-a.clientLeft,b.clientY-f.top-a.clientTop]}function Nc(){}function Oc(a){var b=a[0],c=a[a.length-1];return b<c?[b,c]:[c,b]}function Pc(a){return a.rangeExtent?a.rangeExtent():Oc(a.range())}function Qc(a,b){var c=0,d=a.length-1,e=a[c],f=a[d],g;f<e&&(g=c,c=d,d=g,g=e,e=f,f=g);if(b=b(f-e))a[c]=b.floor(e),a[d]=b.ceil(f);return a}function Rc(){return Math}function Sc(a,b,c,d){function g(){var g=Math.min(a.length,b.length)>2?Zc:Yc,i=d?ub:tb;return e=g(a,b,i,c),f=g(b,a,i,d3.interpolate),h}function h(a){return e(a)}var e,f;return h.invert=function(a){return f(a)},h.domain=function(b){return arguments.length?(a=b.map(Number),g()):a},h.range=function(a){return arguments.length?(b=a,g()):b},h.rangeRound=function(a){return h.range(a).interpolate(d3.interpolateRound)},h.clamp=function(a){return arguments.length?(d=a,g()):d},h.interpolate=function(a){return arguments.length?(c=a,g()):c},h.ticks=function(b){return Wc(a,b)},h.tickFormat=function(b){return Xc(a,b)},h.nice=function(){return Qc(a,Uc),g()},h.copy=function(){return Sc(a,b,c,d)},g()}function Tc(a,b){return d3.rebind(a,b,"range","rangeRound","interpolate","clamp")}function Uc(a){return a=Math.pow(10,Math.round(Math.log(a)/Math.LN10)-1),a&&{floor:function(b){return Math.floor(b/a)*a},ceil:function(b){return Math.ceil(b/a)*a}}}function Vc(a,b){var c=Oc(a),d=c[1]-c[0],e=Math.pow(10,Math.floor(Math.log(d/b)/Math.LN10)),f=b/d*e;return f<=.15?e*=10:f<=.35?e*=5:f<=.75&&(e*=2),c[0]=Math.ceil(c[0]/e)*e,c[1]=Math.floor(c[1]/e)*e+e*.5,c[2]=e,c}function Wc(a,b){return d3.range.apply(d3,Vc(a,b))}function Xc(a,b){return d3.format(",."+Math.max(0,-Math.floor(Math.log(Vc(a,b)[2])/Math.LN10+.01))+"f")}function Yc(a,b,c,d){var e=c(a[0],a[1]),f=d(b[0],b[1]);return function(a){return f(e(a))}}function Zc(a,b,c,d){var e=[],f=[],g=0,h=Math.min(a.length,b.length)-1;a[h]<a[0]&&(a=a.slice().reverse(),b=b.slice().reverse());while(++g<=h)e.push(c(a[g-1],a[g])),f.push(d(b[g-1],b[g]));return function(b){var c=d3.bisect(a,b,1,h)-1;return f[c](e[c](b))}}function $c(a,b){function d(c){return a(b(c))}var c=b.pow;return d.invert=function(b){return c(a.invert(b))},d.domain=function(e){return arguments.length?(b=e[0]<0?bd:ad,c=b.pow,a.domain(e.map(b)),d):a.domain().map(c)},d.nice=function(){return a.domain(Qc(a.domain(),Rc)),d},d.ticks=function(){var d=Oc(a.domain()),e=[];if(d.every(isFinite)){var f=Math.floor(d[0]),g=Math.ceil(d[1]),h=c(d[0]),i=c(d[1]);if(b===bd){e.push(c(f));for(;f++<g;)for(var j=9;j>0;j--)e.push(c(f)*j)}else{for(;f<g;f++)for(var j=1;j<10;j++)e.push(c(f)*j);e.push(c(f))}for(f=0;e[f]<h;f++);for(g=e.length;e[g-1]>i;g--);e=e.slice(f,g)}return e},d.tickFormat=function(a,e){arguments.length<2&&(e=_c);if(!arguments.length)return e;var f=Math.max(.1,a/d.ticks().length),g=b===bd?(h=-1e-12,Math.floor):(h=1e-12,Math.ceil),h;return function(a){return a/c(g(b(a)+h))<=f?e(a):""}},d.copy=function(){return $c(a.copy(),b)},Tc(d,a)}function ad(a){return Math.log(a<0?0:a)/Math.LN10}function bd(a){return-Math.log(a>0?0:-a)/Math.LN10}function cd(a,b){function e(b){return a(c(b))}var c=dd(b),d=dd(1/b);return e.invert=function(b){return d(a.invert(b))},e.domain=function(b){return arguments.length?(a.domain(b.map(c)),e):a.domain().map(d)},e.ticks=function(a){return Wc(e.domain(),a)},e.tickFormat=function(a){return Xc(e.domain(),a)},e.nice=function(){return e.domain(Qc(e.domain(),Uc))},e.exponent=function(a){if(!arguments.length)return b;var f=e.domain();return c=dd(b=a),d=dd(1/b),e.domain(f)},e.copy=function(){return cd(a.copy(),b)},Tc(e,a)}function dd(a){return function(b){return b<0?-Math.pow(-b,a):Math.pow(b,a)}}function ed(a,b){function f(b){return d[((c.get(b)||c.set(b,a.push(b)))-1)%d.length]}function g(b,c){return d3.range(a.length).map(function(a){return b+c*a})}var c,d,e;return f.domain=function(d){if(!arguments.length)return a;a=[],c=new s;var e=-1,g=d.length,h;while(++e<g)c.has(h=d[e])||c.set(h,a.push(h));return f[b.t].apply(f,b.a)},f.range=function(a){return arguments.length?(d=a,e=0,b={t:"range",a:arguments},f):d},f.rangePoints=function(c,h){arguments.length<2&&(h=0);var i=c[0],j=c[1],k=(j-i)/(Math.max(1,a.length-1)+h);return d=g(a.length<2?(i+j)/2:i+k*h/2,k),e=0,b={t:"rangePoints",a:arguments},f},f.rangeBands=function(c,h,i){arguments.length<2&&(h=0),arguments.length<3&&(i=h);var j=c[1]<c[0],k=c[j-0],l=c[1-j],m=(l-k)/(a.length-h+2*i);return d=g(k+m*i,m),j&&d.reverse(),e=m*(1-h),b={t:"rangeBands",a:arguments},f},f.rangeRoundBands=function(c,h,i){arguments.length<2&&(h=0),arguments.length<3&&(i=h);var j=c[1]<c[0],k=c[j-0],l=c[1-j],m=Math.floor((l-k)/(a.length-h+2*i)),n=l-k-(a.length-h)*m;return d=g(k+Math.round(n/2),m),j&&d.reverse(),e=Math.round(m*(1-h)),b={t:"rangeRoundBands",a:arguments},f},f.rangeBand=function(){return e},f.rangeExtent=function(){return Oc(b.a[0])},f.copy=function(){return ed(a,b)},f.domain(a)}function jd(a,b){function d(){var d=0,f=b.length;c=[];while(++d<f)c[d-1]=d3.quantile(a,d/f);return e}function e(a){return isNaN(a=+a)?NaN:b[d3.bisect(c,a)]}var c;return e.domain=function(b){return arguments.length?(a=b.filter(function(a){return!isNaN(a)}).sort(d3.ascending),d()):a},e.range=function(a){return arguments.length?(b=a,d()):b},e.quantiles=function(){return c},e.copy=function(){return jd(a,b)},d()}function kd(a,b,c){function f(b){return c[Math.max(0,Math.min(e,Math.floor(d*(b-a))))]}function g(){return d=c.length/(b-a),e=c.length-1,f}var d,e;return f.domain=function(c){return arguments.length?(a=+c[0],b=+c[c.length-1],g()):[a,b]},f.range=function(a){return arguments.length?(c=a,g()):c},f.copy=function(){return kd(a,b,c)},g()}function ld(a,b){function c(c){return b[d3.bisect(a,c)]}return c.domain=function(b){return arguments.length?(a=b,c):a},c.range=function(a){return arguments.length?(b=a,c):b},c.copy=function(){return ld(a,b)},c}function md(a){function b(a){return+a}return b.invert=b,b.domain=b.range=function(c){return arguments.length?(a=c.map(b),b):a},b.ticks=function(b){return Wc(a,b)},b.tickFormat=function(b){return Xc(a,b)},b.copy=function(){return md(a)},b}function pd(a){return a.innerRadius}function qd(a){return a.outerRadius}function rd(a){return a.startAngle}function sd(a){return a.endAngle}function td(a){function h(f){function o(){h.push("M",e(a(i),g))}var h=[],i=[],j=-1,k=f.length,l,m=x(b),n=x(c);while(++j<k)d.call(this,l=f[j],j)?i.push([+m.call(this,l,j),+n.call(this,l,j)]):i.length&&(o(),i=[]);return i.length&&o(),h.length?h.join(""):null}var b=ud,c=vd,d=w,e=xd,f=e.key,g=.7;return h.x=function(a){return arguments.length?(b=a,h):b},h.y=function(a){return arguments.length?(c=a,h):c},h.defined=function(a){return arguments.length?(d=a,h):d},h.interpolate=function(a){return arguments.length?(typeof a=="function"?f=e=a:f=(e=wd.get(a)||xd).key,h):f},h.tension=function(a){return arguments.length?(g=a,h):g},h}function ud(a){return a[0]}function vd(a){return a[1]}function xd(a){return a.join("L")}function yd(a){return xd(a)+"Z"}function zd(a){var b=0,c=a.length,d=a[0],e=[d[0],",",d[1]];while(++b<c)e.push("V",(d=a[b])[1],"H",d[0]);return e.join("")}function Ad(a){var b=0,c=a.length,d=a[0],e=[d[0],",",d[1]];while(++b<c)e.push("H",(d=a[b])[0],"V",d[1]);return e.join("")}function Bd(a,b){return a.length<4?xd(a):a[1]+Ed(a.slice(1,a.length-1),Fd(a,b))}function Cd(a,b){return a.length<3?xd(a):a[0]+Ed((a.push(a[0]),a),Fd([a[a.length-2]].concat(a,[a[1]]),b))}function Dd(a,b){return a.length<3?xd(a):a[0]+Ed(a,Fd(a,b))}function Ed(a,b){if(b.length<1||a.length!=b.length&&a.length!=b.length+2)return xd(a);var c=a.length!=b.length,d="",e=a[0],f=a[1],g=b[0],h=g,i=1;c&&(d+="Q"+(f[0]-g[0]*2/3)+","+(f[1]-g[1]*2/3)+","+f[0]+","+f[1],e=a[1],i=2);if(b.length>1){h=b[1],f=a[i],i++,d+="C"+(e[0]+g[0])+","+(e[1]+g[1])+","+(f[0]-h[0])+","+(f[1]-h[1])+","+f[0]+","+f[1];for(var j=2;j<b.length;j++,i++)f=a[i],h=b[j],d+="S"+(f[0]-h[0])+","+(f[1]-h[1])+","+f[0]+","+f[1]}if(c){var k=a[i];d+="Q"+(f[0]+h[0]*2/3)+","+(f[1]+h[1]*2/3)+","+k[0]+","+k[1]}return d}function Fd(a,b){var c=[],d=(1-b)/2,e,f=a[0],g=a[1],h=1,i=a.length;while(++h<i)e=f,f=g,g=a[h],c.push([d*(g[0]-e[0]),d*(g[1]-e[1])]);return c}function Gd(a){if(a.length<3)return xd(a);var b=1,c=a.length,d=a[0],e=d[0],f=d[1],g=[e,e,e,(d=a[1])[0]],h=[f,f,f,d[1]],i=[e,",",f];Od(i,g,h);while(++b<c)d=a[b],g.shift(),g.push(d[0]),h.shift(),h.push(d[1]),Od(i,g,h);b=-1;while(++b<2)g.shift(),g.push(d[0]),h.shift(),h.push(d[1]),Od(i,g,h);return i.join("")}function Hd(a){if(a.length<4)return xd(a);var b=[],c=-1,d=a.length,e,f=[0],g=[0];while(++c<3)e=a[c],f.push(e[0]),g.push(e[1]);b.push(Kd(Nd,f)+","+Kd(Nd,g)),--c;while(++c<d)e=a[c],f.shift(),f.push(e[0]),g.shift(),g.push(e[1]),Od(b,f,g);return b.join("")}function Id(a){var b,c=-1,d=a.length,e=d+4,f,g=[],h=[];while(++c<4)f=a[c%d],g.push(f[0]),h.push(f[1]);b=[Kd(Nd,g),",",Kd(Nd,h)],--c;while(++c<e)f=a[c%d],g.shift(),g.push(f[0]),h.shift(),h.push(f[1]),Od(b,g,h);return b.join("")}function Jd(a,b){var c=a.length-1;if(c){var d=a[0][0],e=a[0][1],f=a[c][0]-d,g=a[c][1]-e,h=-1,i,j;while(++h<=c)i=a[h],j=h/c,i[0]=b*i[0]+(1-b)*(d+j*f),i[1]=b*i[1]+(1-b)*(e+j*g)}return Gd(a)}function Kd(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]}function Od(a,b,c){a.push("C",Kd(Ld,b),",",Kd(Ld,c),",",Kd(Md,b),",",Kd(Md,c),",",Kd(Nd,b),",",Kd(Nd,c))}function Pd(a,b){return(b[1]-a[1])/(b[0]-a[0])}function Qd(a){var b=0,c=a.length-1,d=[],e=a[0],f=a[1],g=d[0]=Pd(e,f);while(++b<c)d[b]=(g+(g=Pd(e=f,f=a[b+1])))/2;return d[b]=g,d}function Rd(a){var b=[],c,d,e,f,g=Qd(a),h=-1,i=a.length-1;while(++h<i)c=Pd(a[h],a[h+1]),Math.abs(c)<1e-6?g[h]=g[h+1]=0:(d=g[h]/c,e=g[h+1]/c,f=d*d+e*e,f>9&&(f=c*3/Math.sqrt(f),g[h]=f*d,g[h+1]=f*e));h=-1;while(++h<=i)f=(a[Math.min(i,h+1)][0]-a[Math.max(0,h-1)][0])/(6*(1+g[h]*g[h])),b.push([f||0,g[h]*f||0]);return b}function Sd(a){return a.length<3?xd(a):a[0]+Ed(a,Rd(a))}function Td(a){var b,c=-1,d=a.length,e,f;while(++c<d)b=a[c],e=b[0],f=b[1]+nd,b[0]=e*Math.cos(f),b[1]=e*Math.sin(f);return a}function Ud(a){function l(h){function y(){l.push("M",g(a(n),k),j,i(a(m.reverse()),k),"Z")}var l=[],m=[],n=[],o=-1,p=h.length,q,r=x(b),s=x(d),t=b===c?function(){return v}:x(c),u=d===e?function(){return w}:x(e),v,w;while(++o<p)f.call(this,q=h[o],o)?(m.push([v=+r.call(this,q,o),w=+s.call(this,q,o)]),n.push([+t.call(this,q,o),+u.call(this,q,o)])):m.length&&(y(),m=[],n=[]);return m.length&&y(),l.length?l.join(""):null}var b=ud,c=ud,d=0,e=vd,f=w,g=xd,h=g.key,i=g,j="L",k=.7;return l.x=function(a){return arguments.length?(b=c=a,l):c},l.x0=function(a){return arguments.length?(b=a,l):b},l.x1=function(a){return arguments.length?(c=a,l):c},l.y=function(a){return arguments.length?(d=e=a,l):e},l.y0=function(a){return arguments.length?(d=a,l):d},l.y1=function(a){return arguments.length?(e=a,l):e},l.defined=function(a){return arguments.length?(f=a,l):f},l.interpolate=function(a){return arguments.length?(typeof a=="function"?h=g=a:h=(g=wd.get(a)||xd).key,i=g.reverse||g,j=g.closed?"M":"L",l):h},l.tension=function(a){return arguments.length?(k=a,l):k},l}function Vd(a){return a.radius}function Wd(a){return[a.x,a.y]}function Xd(a){return function(){var b=a.apply(this,arguments),c=b[0],d=b[1]+nd;return[c*Math.cos(d),c*Math.sin(d)]}}function Yd(){return 64}function Zd(){return"circle"}function $d(a){var b=Math.sqrt(a/g);return"M0,"+b+"A"+b+","+b+" 0 1,1 0,"+ -b+"A"+b+","+b+" 0 1,1 0,"+b+"Z"}function ce(a,b){a.attr("transform",function(a){return"translate("+b(a)+",0)"})}function de(a,b){a.attr("transform",function(a){return"translate(0,"+b(a)+")"})}function ee(a,b,c){e=[];if(c&&b.length>1){var d=Oc(a.domain()),e,f=-1,g=b.length,h=(b[1]-b[0])/++c,i,j;while(++f<g)for(i=c;--i>0;)(j=+b[f]-i*h)>=d[0]&&e.push(j);for(--f,i=0;++i<c&&(j=+b[f]+i*h)<d[1];)e.push(j)}return e}function je(){he||(he=d3.select("body").append("div").style("visibility","hidden").style("top",0).style("height",0).style("width",0).style("overflow-y","scroll").append("div").style("height","2000px").node().parentNode);var a=d3.event,b;try{he.scrollTop=1e3,he.dispatchEvent(a),b=1e3-he.scrollTop}catch(c){b=a.wheelDelta||-a.detail*5}return b}function ke(a){var b=a.source,c=a.target,d=me(b,c),e=[b];while(b!==d)b=b.parent,e.push(b);var f=e.length;while(c!==d)e.splice(f,0,c),c=c.parent;return e}function le(a){var b=[],c=a.parent;while(c!=null)b.push(a),a=c,c=c.parent;return b.push(a),b}function me(a,b){if(a===b)return a;var c=le(a),d=le(b),e=c.pop(),f=d.pop(),g=null;while(e===f)g=e,e=c.pop(),f=d.pop();return g}function ne(a){a.fixed|=2}function oe(a){a.fixed&=1}function pe(a){a.fixed|=4,a.px=a.x,a.py=a.y}function qe(a){a.fixed&=3}function re(a,b,c){var d=0,e=0;a.charge=0;if(!a.leaf){var f=a.nodes,g=f.length,h=-1,i;while(++h<g){i=f[h];if(i==null)continue;re(i,b,c),a.charge+=i.charge,d+=i.charge*i.cx,e+=i.charge*i.cy}}if(a.point){a.leaf||(a.point.x+=Math.random()-.5,a.point.y+=Math.random()-.5);var j=b*c[a.point.index];a.charge+=a.pointCharge=j,d+=j*a.point.x,e+=j*a.point.y}a.cx=d/a.charge,a.cy=e/a.charge}function se(){return 20}function te(){return 1}function ve(a){return a.x}function we(a){return a.y}function xe(a,b,c){a.y0=b,a.y=c}function Ae(a){return d3.range(a.length)}function Be(a){var b=-1,c=a[0].length,d=[];while(++b<c)d[b]=0;return d}function Ce(a){var b=1,c=0,d=a[0][1],e,f=a.length;for(;b<f;++b)(e=a[b][1])>d&&(c=b,d=e);return c}function De(a){return a.reduce(Ee,0)}function Ee(a,b){return a+b[1]}function Fe(a,b){return Ge(a,Math.ceil(Math.log(b.length)/Math.LN2+1))}function Ge(a,b){var c=-1,d=+a[0],e=(a[1]-d)/b,f=[];while(++c<=b)f[c]=e*c+d;return f}function He(a){return[d3.min(a),d3.max(a)]}function Ie(a,b){return d3.rebind(a,b,"sort","children","value"),a.nodes=a,a.links=Me,a}function Je(a){return a.children}function Ke(a){return a.value}function Le(a,b){return b.value-a.value}function Me(a){return d3.merge(a.map(function(a){return(a.children||[]).map(function(b){return{source:a,target:b}})}))}function Ne(a,b){return a.value-b.value}function Oe(a,b){var c=a._pack_next;a._pack_next=b,b._pack_prev=a,b._pack_next=c,c._pack_prev=b}function Pe(a,b){a._pack_next=b,b._pack_prev=a}function Qe(a,b){var c=b.x-a.x,d=b.y-a.y,e=a.r+b.r;return e*e-c*c-d*d>.001}function Re(a){function n(a){c=Math.min(a.x-a.r,c),d=Math.max(a.x+a.r,d),e=Math.min(a.y-a.r,e),f=Math.max(a.y+a.r,f)}if(!(b=a.children)||!(m=b.length))return;var b,c=Infinity,d=-Infinity,e=Infinity,f=-Infinity,g,h,i,j,k,l,m;b.forEach(Se),g=b[0],g.x=-g.r,g.y=0,n(g);if(m>1){h=b[1],h.x=h.r,h.y=0,n(h);if(m>2){i=b[2],Ve(g,h,i),n(i),Oe(g,i),g._pack_prev=i,Oe(i,h),h=g._pack_next;for(j=3;j<m;j++){Ve(g,h,i=b[j]);var o=0,p=1,q=1;for(k=h._pack_next;k!==h;k=k._pack_next,p++)if(Qe(k,i)){o=1;break}if(o==1)for(l=g._pack_prev;l!==k._pack_prev;l=l._pack_prev,q++)if(Qe(l,i))break;o?(p<q||p==q&&h.r<g.r?Pe(g,h=k):Pe(g=l,h),j--):(Oe(g,i),h=i,n(i))}}}var r=(c+d)/2,s=(e+f)/2,t=0;for(j=0;j<m;j++)i=b[j],i.x-=r,i.y-=s,t=Math.max(t,i.r+Math.sqrt(i.x*i.x+i.y*i.y));a.r=t,b.forEach(Te)}function Se(a){a._pack_next=a._pack_prev=a}function Te(a){delete a._pack_next,delete a._pack_prev}function Ue(a,b,c,d){var e=a.children;a.x=b+=d*a.x,a.y=c+=d*a.y,a.r*=d;if(e){var f=-1,g=e.length;while(++f<g)Ue(e[f],b,c,d)}}function Ve(a,b,c){var d=a.r+c.r,e=b.x-a.x,f=b.y-a.y;if(d&&(e||f)){var g=b.r+c.r,h=e*e+f*f;g*=g,d*=d;var i=.5+(d-g)/(2*h),j=Math.sqrt(Math.max(0,2*g*(d+h)-(d-=h)*d-g*g))/(2*h);c.x=a.x+i*e+j*f,c.y=a.y+i*f-j*e}else c.x=a.x+d,c.y=a.y}function We(a){return 1+d3.max(a,function(a){return a.y})}function Xe(a){return a.reduce(function(a,b){return a+b.x},0)/a.length}function Ye(a){var b=a.children;return b&&b.length?Ye(b[0]):a}function Ze(a){var b=a.children,c;return b&&(c=b.length)?Ze(b[c-1]):a}function $e(a,b){return a.parent==b.parent?1:2}function _e(a){var b=a.children;return b&&b.length?b[0]:a._tree.thread}function af(a){var b=a.children,c;return b&&(c=b.length)?b[c-1]:a._tree.thread}function bf(a,b){var c=a.children;if(c&&(e=c.length)){var d,e,f=-1;while(++f<e)b(d=bf(c[f],b),a)>0&&(a=d)}return a}function cf(a,b){return a.x-b.x}function df(a,b){return b.x-a.x}function ef(a,b){return a.depth-b.depth}function ff(a,b){function c(a,d){var e=a.children;if(e&&(i=e.length)){var f,g=null,h=-1,i;while(++h<i)f=e[h],c(f,g),g=f}b(a,d)}c(a,null)}function gf(a){var b=0,c=0,d=a.children,e=d.length,f;while(--e>=0)f=d[e]._tree,f.prelim+=b,f.mod+=b,b+=f.shift+(c+=f.change)}function hf(a,b,c){a=a._tree,b=b._tree;var d=c/(b.number-a.number);a.change+=d,b.change-=d,b.shift+=c,b.prelim+=c,b.mod+=c}function jf(a,b,c){return a._tree.ancestor.parent==b.parent?a._tree.ancestor:c}function kf(a){return{x:a.x,y:a.y,dx:a.dx,dy:a.dy}}function lf(a,b){var c=a.x+b[3],d=a.y+b[0],e=a.dx-b[1]-b[3],f=a.dy-b[0]-b[2];return e<0&&(c+=e/2,e=0),f<0&&(d+=f/2,f=0),{x:c,y:d,dx:e,dy:f}}function mf(a,b){function e(a,c){return d3.xhr(a,b,c).response(f)}function f(a){return e.parse(a.responseText)}function g(b){return b.map(h).join(a)}function h(a){return c.test(a)?'"'+a.replace(/\"/g,'""')+'"':a}var c=new RegExp('["'+a+"\n]"),d=a.charCodeAt(0);return e.parse=function(a){var b;return e.parseRows(a,function(a){if(b)return b(a);b=new Function("d","return {"+a.map(function(a,b){return JSON.stringify(a)+": d["+b+"]"}).join(",")+"}")})},e.parseRows=function(a,b){function l(){if(h>=g)return e;if(k)return k=!1,c;var b=h;if(a.charCodeAt(b)===34){var f=b;while(f++<g)if(a.charCodeAt(f)===34){if(a.charCodeAt(f+1)!==34)break;++f}h=f+2;var i=a.charCodeAt(f+1);return i===13?(k=!0,a.charCodeAt(f+2)===10&&++h):i===10&&(k=!0),a.substring(b+1,f).replace(/""/g,'"')}while(h<g){var i=a.charCodeAt(h++),j=1;if(i===10)k=!0;else if(i===13)k=!0,a.charCodeAt(h)===10&&(++h,++j);else if(i!==d)continue;return a.substring(b,h-j)}return a.substring(b)}var c={},e={},f=[],g=a.length,h=0,i=0,j,k;while((j=l())!==e){var m=[];while(j!==c&&j!==e)m.push(j),j=l();if(b&&!(m=b(m,i++)))continue;f.push(m)}return f},e.format=function(a){return a.map(g).join("\n")},e}function nf(a,b){pf.hasOwnProperty(a.type)&&pf[a.type](a,b)}function qf(a,b,c){var d=-1,e=a.length-c,f;b.lineStart();while(++d<e)f=a[d],b.point(f[0],f[1]);b.lineEnd()}function rf(a,b){var c=-1,d=a.length;b.polygonStart();while(++c<d)qf(a[c],b,1);b.polygonEnd()}function sf(a){return[Math.atan2(a[1],a[0]),Math.asin(Math.max(-1,Math.min(1,a[2])))]}function tf(a,b){return Math.abs(a[0]-b[0])<h&&Math.abs(a[1]-b[1])<h}function uf(a){var b=a[0],c=a[1],d=Math.cos(c);return[d*Math.cos(b),d*Math.sin(b),Math.sin(c)]}function vf(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}function wf(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]}function xf(a,b){a[0]+=b[0],a[1]+=b[1],a[2]+=b[2]}function yf(a,b){return[a[0]*b,a[1]*b,a[2]*b]}function zf(a){var b=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);a[0]/=b,a[1]/=b,a[2]/=b}function Af(a){function d(b){function l(c,d){c=a(c,d),b.point(c[0],c[1])}function m(){f=NaN,k.point=n,b.lineStart()}function n(k,l){var m=uf([k,l]),n=a(k,l);e(f,g,d,h,i,j,f=n[0],g=n[1],d=k,h=m[0],i=m[1],j=m[2],c,b),b.point(f,g)}function o(){k.point=l,b.lineEnd()}function p(){var a,l,p,q,r,s,t;m(),k.point=function(b,c){n(a=b,l=c),p=f,q=g,r=h,s=i,t=j,k.point=n},k.lineEnd=function(){e(f,g,d,h,i,j,p,q,a,r,s,t,c,b),k.lineEnd=o,o()}}var d,f,g,h,i,j,k={point:l,lineStart:m,lineEnd:o,polygonStart:function(){b.polygonStart(),k.lineStart=p},polygonEnd:function(){b.polygonEnd(),k.lineStart=m}};return k}function e(c,d,f,g,i,j,k,l,m,n,o,p,q,r){var s=k-c,t=l-d,u=s*s+t*t;if(u>4*b&&q--){var v=g+n,w=i+o,x=j+p,y=Math.sqrt(v*v+w*w+x*x),z=Math.asin(x/=y),A=Math.abs(Math.abs(x)-1)<h?(f+m)/2:Math.atan2(w,v),B=a(A,z),C=B[0],D=B[1],E=C-c,F=D-d,G=t*E-s*F;if(G*G/u>b||Math.abs((s*E+t*F)/u-.5)>.3)e(c,d,f,g,i,j,C,D,A,v/=y,w/=y,x,q,r),r.point(C,D),e(C,D,A,v,w,x,k,l,m,n,o,p,q,r)}}var b=.5,c=16;return d.precision=function(a){return arguments.length?(c=(b=a*a)>0&&16,d):Math.sqrt(b)},d}function Bf(a,b){function g(a,b){var c=Math.sqrt(e-2*d*Math.sin(b))/d;return[c*Math.sin(a*=d),f-c*Math.cos(a)]}var c=Math.sin(a),d=(c+Math.sin(b))/2,e=1+c*(2*d-c),f=Math.sqrt(e)/d;return g.invert=function(a,b){var c=f-b;return[Math.atan2(a,c)/d,Math.asin((e-(a*a+c*c)*d*d)/(2*d))]},g}function Ef(a){function g(a,f){a<b&&(b=a),a>d&&(d=a),f<c&&(c=f),f>e&&(e=f)}function h(){f.point=f.lineEnd=Nc}var b,c,d,e,f={point:g,lineStart:Nc,lineEnd:Nc,polygonStart:function(){f.lineEnd=h},polygonEnd:function(){f.point=g}};return function(g){return e=d=-(b=c=Infinity),d3.geo.stream(g,a(f)),[[b,c],[d,e]]}}function Lf(a,b){if(Ff)return;++Gf,a*=i;var c=Math.cos(b*=i);Hf+=(c*Math.cos(a)-Hf)/Gf,If+=(c*Math.sin(a)-If)/Gf,Jf+=(Math.sin(b)-Jf)/Gf}function Mf(){var a,b;Ff=1,Nf(),Ff=2;var c=Kf.point;Kf.point=function(d,e){c(a=d,b=e)},Kf.lineEnd=function(){Kf.point(a,b),Of(),Kf.lineEnd=Of}}function Nf(){function d(d,e){d*=i;var f=Math.cos(e*=i),g=f*Math.cos(d),h=f*Math.sin(d),j=Math.sin(e),k=Math.atan2(Math.sqrt((k=b*j-c*h)*k+(k=c*g-a*j)*k+(k=a*h-b*g)*k),a*g+b*h+c*j);Gf+=k,Hf+=k*(a+(a=g)),If+=k*(b+(b=h)),Jf+=k*(c+(c=j))}var a,b,c;if(Ff>1)return;Ff<1&&(Ff=1,Gf=Hf=If=Jf=0),Kf.point=function(e,f){e*=i;var g=Math.cos(f*=i);a=g*Math.cos(e),b=g*Math.sin(e),c=Math.sin(f),Kf.point=d}}function Of(){Kf.point=Lf}function Pf(a,b){var c=Math.cos(a),d=Math.sin(a);return function(e,f,h,i){if(e!=null){e=Qf(c,e),f=Qf(c,f);if(h>0?e<f:e>f)e+=h*2*g}else e=a+h*2*g,f=a;var j;for(var k=h*b,l=e;h>0?l>f:l<f;l-=k)i.point((j=sf([c,-d*Math.cos(l),-d*Math.sin(l)]))[0],j[1])}}function Qf(a,b){var c=uf(b);c[0]-=a,zf(c);var d=Math.acos(Math.max(-1,Math.min(1,-c[1])));return((-c[2]<0?-d:d)+2*Math.PI-h)%(2*Math.PI)}function Rf(a,b,c){return function(d){function g(b,c){a(b,c)&&d.point(b,c)}function i(a,b){e.point(a,b)}function j(){f.point=i,e.lineStart()}function k(){f.point=g,e.lineEnd()}function s(a,b){q.point(a,b),r.push([a,b])}function t(){q.lineStart(),r=[]}function u(){s(r[0][0],r[0][1]),q.lineEnd();var a=q.clean(),b=p.buffer(),c,e=b.length;if(!e){o=!0,n+=Xf(r,-1),r=null;return}r=null;if(a&1){c=b[0],m+=Xf(c,1);var e=c.length-1,f=-1,g;d.lineStart();while(++f<e)d.point((g=c[f])[0],g[1]);d.lineEnd();return}e>1&&a&2&&b.push(b.pop().concat(b.shift())),l.push(b.filter(Vf))}var e=b(d),f={point:g,lineStart:j,lineEnd:k,polygonStart:function(){f.point=s,f.lineStart=t,f.lineEnd=u,o=!1,n=m=0,l=[],d.polygonStart()},polygonEnd:function(){f.point=g,f.lineStart=j,f.lineEnd=k,l=d3.merge(l);if(l.length)Sf(l,c,d);else if(m<-h||o&&n<-h)d.lineStart(),c(null,null,1,d),d.lineEnd();d.polygonEnd(),l=null},sphere:function(){d.polygonStart(),d.lineStart(),c(null,null,1,d),d.lineEnd(),d.polygonEnd()}},l,m,n,o,p=Wf(),q=b(p),r;return f}}function Sf(a,b,c){var d=[],e=[];a.forEach(function(a){var b=a.length;if(b<=1)return;var c=a[0],f=a[b-1],g={point:c,points:a,other:null,visited:!1,entry:!0,subject:!0},h={point:c,points:[c],other:g,visited:!1,entry:!1,subject:!1};g.other=h,d.push
(g),e.push(h),g={point:f,points:[f],other:null,visited:!1,entry:!1,subject:!0},h={point:f,points:[f],other:g,visited:!1,entry:!0,subject:!1},g.other=h,d.push(g),e.push(h)}),e.sort(Uf),Tf(d),Tf(e);if(!d.length)return;var f=d[0],g,h,i;for(;;){g=f;while(g.visited)if((g=g.next)===f)return;h=g.points,c.lineStart();do{g.visited=g.other.visited=!0;if(g.entry){if(g.subject)for(var j=0;j<h.length;j++)c.point((i=h[j])[0],i[1]);else b(g.point,g.next.point,1,c);g=g.next}else{if(g.subject){h=g.prev.points;for(var j=h.length;--j>=0;)c.point((i=h[j])[0],i[1])}else b(g.point,g.prev.point,-1,c);g=g.prev}g=g.other,h=g.points}while(!g.visited);c.lineEnd()}}function Tf(a){if(!(b=a.length))return;var b,c=0,d=a[0],e;while(++c<b)d.next=e=a[c],e.prev=d,d=e;d.next=e=a[0],e.prev=d}function Uf(a,b){return((a=a.point)[0]<0?a[1]-g/2-h:g/2-a[1])-((b=b.point)[0]<0?b[1]-g/2-h:g/2-b[1])}function Vf(a){return a.length>1}function Wf(){var a=[],b;return{lineStart:function(){a.push(b=[])},point:function(a,c){b.push([a,c])},lineEnd:Nc,buffer:function(){var c=a;return a=[],b=null,c}}}function Xf(a,b){if(!(c=a.length))return 0;var c,d=0,e=0,f=a[0],i=f[0],j=f[1],k=Math.cos(j),l=Math.atan2(b*Math.sin(i)*k,Math.sin(j)),m=1-b*Math.cos(i)*k,n=l,o,p;while(++d<c){f=a[d],k=Math.cos(j=f[1]),o=Math.atan2(b*Math.sin(i=f[0])*k,Math.sin(j)),p=1-b*Math.cos(i)*k;if(Math.abs(m-2)<h&&Math.abs(p-2)<h)continue;Math.abs(p)<h||Math.abs(m)<h||(Math.abs(Math.abs(o-l)-g)<h?p+m>2&&(e+=4*(o-l)):Math.abs(m-2)<h?e+=4*(o-n):e+=((3*g+o-l)%(2*g)-g)*(m+p)),n=l,l=o,m=p}return e}function Zf(a){var b=NaN,c=NaN,d=NaN,e;return{lineStart:function(){a.lineStart(),e=1},point:function(f,i){var j=f>0?g:-g,k=Math.abs(f-b);Math.abs(k-g)<h?(a.point(b,c=(c+i)/2>0?g/2:-g/2),a.point(d,c),a.lineEnd(),a.lineStart(),a.point(j,c),a.point(f,c),e=0):d!==j&&k>=g&&(Math.abs(b-d)<h&&(b-=d*h),Math.abs(f-j)<h&&(f-=j*h),c=$f(b,c,f,i),a.point(d,c),a.lineEnd(),a.lineStart(),a.point(j,c),e=0),a.point(b=f,c=i),d=j},lineEnd:function(){a.lineEnd(),b=c=NaN},clean:function(){return 2-e}}}function $f(a,b,c,d){var e,f,g=Math.sin(a-c);return Math.abs(g)>h?Math.atan((Math.sin(b)*(f=Math.cos(d))*Math.sin(c)-Math.sin(d)*(e=Math.cos(b))*Math.sin(a))/(e*f*g)):(b+d)/2}function _f(a,b,c,d){var e;if(a==null)e=c*g/2,d.point(-g,e),d.point(0,e),d.point(g,e),d.point(g,0),d.point(g,-e),d.point(0,-e),d.point(-g,-e),d.point(-g,0),d.point(-g,e);else if(Math.abs(a[0]-b[0])>h){var f=(a[0]<b[0]?1:-1)*g;e=c*f/2,d.point(-f,e),d.point(0,e),d.point(f,e)}else d.point(b[0],b[1])}function ag(a){function e(a,b){return Math.cos(a)*Math.cos(b)>c}function f(a){var b,c,d,f;return{lineStart:function(){d=c=!1,f=1},point:function(i,j){var k=[i,j],l,m=e(i,j);!b&&(d=c=m)&&a.lineStart();if(m!==c){l=g(b,k);if(tf(b,l)||tf(k,l))k[0]+=h,k[1]+=h,m=e(k[0],k[1])}m!==c&&(f=0,(c=m)?(a.lineStart(),l=g(k,b),a.point(l[0],l[1])):(l=g(b,k),a.point(l[0],l[1]),a.lineEnd()),b=l),m&&(!b||!tf(b,k))&&a.point(k[0],k[1]),b=k},lineEnd:function(){c&&a.lineEnd(),b=null},clean:function(){return f|(d&&c)<<1}}}function g(a,b){var d=uf(a,0),e=uf(b,0),f=[1,0,0],g=wf(d,e),h=vf(g,g),i=g[0],j=h-i*i;if(!j)return a;var k=c*h/j,l=-c*i/j,m=wf(f,g),n=yf(f,k),o=yf(g,l);xf(n,o);var p=m,q=vf(n,p),r=vf(p,p),s=Math.sqrt(q*q-r*(vf(n,n)-1)),t=yf(p,(-q-s)/r);return xf(t,n),sf(t)}var b=a*i,c=Math.cos(b),d=Pf(b,6*i);return Rf(e,f,d)}function bg(a,b){function c(c,d){return c=a(c,d),b(c[0],c[1])}return a.invert&&b.invert&&(c.invert=function(c,d){return c=b.invert(c,d),c&&a.invert(c[0],c[1])}),c}function cg(a,b){return[a,b]}function eg(a,b,c){var d=d3.range(a,b-h,c).concat(b);return function(a){return d.map(function(b){return[a,b]})}}function fg(a,b,c){var d=d3.range(a,b-h,c).concat(b);return function(a){return d.map(function(b){return[b,a]})}}function gg(a,b,c,d){function p(a){var b=Math.sin(a*=n)*o,c=Math.sin(n-a)*o,d=c*j+b*l,e=c*k+b*m,g=c*f+b*h;return[Math.atan2(e,d)/i,Math.atan2(g,Math.sqrt(d*d+e*e))/i]}var e=Math.cos(b),f=Math.sin(b),g=Math.cos(d),h=Math.sin(d),j=e*Math.cos(a),k=e*Math.sin(a),l=g*Math.cos(c),m=g*Math.sin(c),n=Math.acos(Math.max(-1,Math.min(1,f*h+e*g*Math.cos(c-a)))),o=1/Math.sin(n);return p.distance=n,p}function hg(a,b){return[a/(2*g),Math.max(-0.5,Math.min(.5,Math.log(Math.tan(g/4+b/2))/(2*g)))]}function jg(a){return"m0,"+a+"a"+a+","+a+" 0 1,1 0,"+ -2*a+"a"+a+","+a+" 0 1,1 0,"+2*a+"z"}function kg(a){var b=Af(function(b,c){return a([b*j,c*j])});return function(a){return a=b(a),{point:function(b,c){a.point(b*i,c*i)},sphere:function(){a.sphere()},lineStart:function(){a.lineStart()},lineEnd:function(){a.lineEnd()},polygonStart:function(){a.polygonStart()},polygonEnd:function(){a.polygonEnd()}}}}function lg(){function d(c,d){b.push("M",c,",",d,a)}function e(a,d){b.push("M",a,",",d),c.point=f}function f(a,c){b.push("L",a,",",c)}function g(){c.point=d}function h(){b.push("Z")}var a=jg(4.5),b=[],c={point:d,lineStart:function(){c.point=e},lineEnd:g,polygonStart:function(){c.lineEnd=h},polygonEnd:function(){c.lineEnd=g,c.point=d},pointRadius:function(b){return a=jg(b),c},result:function(){if(b.length){var a=b.join("");return b=[],a}}};return c}function mg(a){function d(c,d){a.moveTo(c,d),a.arc(c,d,b,0,2*g)}function e(b,d){a.moveTo(b,d),c.point=f}function f(b,c){a.lineTo(b,c)}function h(){c.point=d}function i(){a.closePath()}var b=4.5,c={point:d,lineStart:function(){c.point=e},lineEnd:h,polygonStart:function(){c.lineEnd=i},polygonEnd:function(){c.lineEnd=h,c.point=d},pointRadius:function(a){return b=a,c},result:Nc};return c}function qg(){function e(a,b){og+=d*a-c*b,c=a,d=b}var a,b,c,d;pg.point=function(f,g){pg.point=e,a=c=f,b=d=g},pg.lineEnd=function(){e(a,b)}}function sg(a,b){if(Ff)return;Hf+=a,If+=b,++Jf}function tg(){function c(c,d){var e=c-a,f=d-b,g=Math.sqrt(e*e+f*f);Hf+=g*(a+c)/2,If+=g*(b+d)/2,Jf+=g,a=c,b=d}var a,b;if(Ff!==1){if(!(Ff<1))return;Ff=1,Hf=If=Jf=0}rg.point=function(d,e){rg.point=c,a=d,b=e}}function ug(){rg.point=sg}function vg(){function e(a,b){var e=d*a-c*b;Hf+=e*(c+a),If+=e*(d+b),Jf+=e*3,c=a,d=b}var a,b,c,d;Ff<2&&(Ff=2,Hf=If=Jf=0),rg.point=function(f,g){rg.point=e,a=c=f,b=d=g},rg.lineEnd=function(){e(a,b)}}function zg(){function k(a,b){a*=i,b*=i;if(Math.abs(Math.abs(e)-g/2)<h&&Math.abs(Math.abs(b)-g/2)<h)return;var k=Math.cos(b),l=Math.sin(b);if(Math.abs(e-g/2)<h)xg+=(a-c)*2;else{var m=a-d,n=Math.cos(m),o=Math.atan2(Math.sqrt((o=k*Math.sin(m))*o+(o=f*l-j*k*n)*o),j*l+f*k*n),p=(o+g+e+b)/4;xg+=(m<0&&m>-g||m>g?-4:4)*Math.atan(Math.sqrt(Math.abs(Math.tan(p)*Math.tan(p-o/2)*Math.tan(p-g/4-e/2)*Math.tan(p-g/4-b/2))))}c=d,d=a,e=b,f=k,j=l}var a,b,c,d,e,f,j;yg.point=function(g,h){yg.point=k,c=d=(a=g)*i,e=(b=h)*i,f=Math.cos(e),j=Math.sin(e)},yg.lineEnd=function(){k(a,b)}}function Ag(a){return Bg(function(){return a})()}function Bg(a){function t(a){return a=d(a[0]*i,a[1]*i),[a[0]*f+p,q-a[1]*f]}function u(a){return a=d.invert((a[0]-p)/f,(q-a[1])/f),a&&[a[0]*j,a[1]*j]}function v(){d=bg(c=Dg(m,n,o),b);var a=b(k,l);return p=g-a[0]*f,q=h+a[1]*f,t}var b,c,d,e=Af(function(a,c){return a=b(a,c),[a[0]*f+p,q-a[1]*f]}),f=150,g=480,h=250,k=0,l=0,m=0,n=0,o=0,p,q,r=Yf,s=null;return t.stream=function(a){return Cg(c,r(e(a)))},t.clipAngle=function(a){return arguments.length?(r=a==null?(s=a,Yf):ag(s=+a),t):s},t.scale=function(a){return arguments.length?(f=+a,v()):f},t.translate=function(a){return arguments.length?(g=+a[0],h=+a[1],v()):[g,h]},t.center=function(a){return arguments.length?(k=a[0]%360*i,l=a[1]%360*i,v()):[k*j,l*j]},t.rotate=function(a){return arguments.length?(m=a[0]%360*i,n=a[1]%360*i,o=a.length>2?a[2]%360*i:0,v()):[m*j,n*j,o*j]},d3.rebind(t,e,"precision"),function(){return b=a.apply(this,arguments),t.invert=b.invert&&u,v()}}function Cg(a,b){return{point:function(c,d){d=a(c*i,d*i),c=d[0],b.point(c>g?c-2*g:c<-g?c+2*g:c,d[1])},sphere:function(){b.sphere()},lineStart:function(){b.lineStart()},lineEnd:function(){b.lineEnd()},polygonStart:function(){b.polygonStart()},polygonEnd:function(){b.polygonEnd()}}}function Dg(a,b,c){return a?b||c?bg(Fg(a),Gg(b,c)):Fg(a):b||c?Gg(b,c):cg}function Eg(a){return function(b,c){return b+=a,[b>g?b-2*g:b<-g?b+2*g:b,c]}}function Fg(a){var b=Eg(a);return b.invert=Eg(-a),b}function Gg(a,b){function g(a,b){var g=Math.cos(b),h=Math.cos(a)*g,i=Math.sin(a)*g,j=Math.sin(b),k=j*c+h*d;return[Math.atan2(i*e-k*f,h*c-j*d),Math.asin(Math.max(-1,Math.min(1,k*e+i*f)))]}var c=Math.cos(a),d=Math.sin(a),e=Math.cos(b),f=Math.sin(b);return g.invert=function(a,b){var g=Math.cos(b),h=Math.cos(a)*g,i=Math.sin(a)*g,j=Math.sin(b),k=j*e-i*f;return[Math.atan2(i*e+j*f,h*c+k*d),Math.asin(Math.max(-1,Math.min(1,k*c-h*d)))]},g}function Ig(a,b){function c(b,c){var d=Math.cos(b),e=Math.cos(c),f=a(d*e);return[f*e*Math.sin(b),f*Math.sin(c)]}return c.invert=function(a,c){var d=Math.sqrt(a*a+c*c),e=b(d),f=Math.sin(e),g=Math.cos(e);return[Math.atan2(a*f,d*g),Math.asin(d&&c*f/d)]},c}function Jg(a,b,c,d){var e,f,g,h,i,j,k;return e=d[a],f=e[0],g=e[1],e=d[b],h=e[0],i=e[1],e=d[c],j=e[0],k=e[1],(k-g)*(h-f)-(i-g)*(j-f)>0}function Kg(a,b,c){return(c[0]-b[0])*(a[1]-b[1])<(c[1]-b[1])*(a[0]-b[0])}function Lg(a,b,c,d){var e=a[0],f=c[0],g=b[0]-e,h=d[0]-f,i=a[1],j=c[1],k=b[1]-i,l=d[1]-j,m=(h*(i-j)-l*(e-f))/(l*g-h*k);return[e+m*g,i+m*k]}function Ng(a,b){var c={list:a.map(function(a,b){return{index:b,x:a[0],y:a[1]}}).sort(function(a,b){return a.y<b.y?-1:a.y>b.y?1:a.x<b.x?-1:a.x>b.x?1:0}),bottomSite:null},d={list:[],leftEnd:null,rightEnd:null,init:function(){d.leftEnd=d.createHalfEdge(null,"l"),d.rightEnd=d.createHalfEdge(null,"l"),d.leftEnd.r=d.rightEnd,d.rightEnd.l=d.leftEnd,d.list.unshift(d.leftEnd,d.rightEnd)},createHalfEdge:function(a,b){return{edge:a,side:b,vertex:null,l:null,r:null}},insert:function(a,b){b.l=a,b.r=a.r,a.r.l=b,a.r=b},leftBound:function(a){var b=d.leftEnd;do b=b.r;while(b!=d.rightEnd&&e.rightOf(b,a));return b=b.l,b},del:function(a){a.l.r=a.r,a.r.l=a.l,a.edge=null},right:function(a){return a.r},left:function(a){return a.l},leftRegion:function(a){return a.edge==null?c.bottomSite:a.edge.region[a.side]},rightRegion:function(a){return a.edge==null?c.bottomSite:a.edge.region[Mg[a.side]]}},e={bisect:function(a,b){var c={region:{l:a,r:b},ep:{l:null,r:null}},d=b.x-a.x,e=b.y-a.y,f=d>0?d:-d,g=e>0?e:-e;return c.c=a.x*d+a.y*e+(d*d+e*e)*.5,f>g?(c.a=1,c.b=e/d,c.c/=d):(c.b=1,c.a=d/e,c.c/=e),c},intersect:function(a,b){var c=a.edge,d=b.edge;if(!c||!d||c.region.r==d.region.r)return null;var e=c.a*d.b-c.b*d.a;if(Math.abs(e)<1e-10)return null;var f=(c.c*d.b-d.c*c.b)/e,g=(d.c*c.a-c.c*d.a)/e,h=c.region.r,i=d.region.r,j,k;h.y<i.y||h.y==i.y&&h.x<i.x?(j=a,k=c):(j=b,k=d);var l=f>=k.region.r.x;return l&&j.side==="l"||!l&&j.side==="r"?null:{x:f,y:g}},rightOf:function(a,b){var c=a.edge,d=c.region.r,e=b.x>d.x;if(e&&a.side==="l")return 1;if(!e&&a.side==="r")return 0;if(c.a===1){var f=b.y-d.y,g=b.x-d.x,h=0,i=0;!e&&c.b<0||e&&c.b>=0?i=h=f>=c.b*g:(i=b.x+b.y*c.b>c.c,c.b<0&&(i=!i),i||(h=1));if(!h){var j=d.x-c.region.l.x;i=c.b*(g*g-f*f)<j*f*(1+2*g/j+c.b*c.b),c.b<0&&(i=!i)}}else{var k=c.c-c.a*b.x,l=b.y-k,m=b.x-d.x,n=k-d.y;i=l*l>m*m+n*n}return a.side==="l"?i:!i},endPoint:function(a,c,d){a.ep[c]=d;if(!a.ep[Mg[c]])return;b(a)},distance:function(a,b){var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)}},f={list:[],insert:function(a,b,c){a.vertex=b,a.ystar=b.y+c;for(var d=0,e=f.list,g=e.length;d<g;d++){var h=e[d];if(a.ystar>h.ystar||a.ystar==h.ystar&&b.x>h.vertex.x)continue;break}e.splice(d,0,a)},del:function(a){for(var b=0,c=f.list,d=c.length;b<d&&c[b]!=a;++b);c.splice(b,1)},empty:function(){return f.list.length===0},nextEvent:function(a){for(var b=0,c=f.list,d=c.length;b<d;++b)if(c[b]==a)return c[b+1];return null},min:function(){var a=f.list[0];return{x:a.vertex.x,y:a.ystar}},extractMin:function(){return f.list.shift()}};d.init(),c.bottomSite=c.list.shift();var g=c.list.shift(),h,i,j,k,l,m,n,o,p,q,r,s,t;for(;;){f.empty()||(h=f.min());if(g&&(f.empty()||g.y<h.y||g.y==h.y&&g.x<h.x))i=d.leftBound(g),j=d.right(i),n=d.rightRegion(i),s=e.bisect(n,g),m=d.createHalfEdge(s,"l"),d.insert(i,m),q=e.intersect(i,m),q&&(f.del(i),f.insert(i,q,e.distance(q,g))),i=m,m=d.createHalfEdge(s,"r"),d.insert(i,m),q=e.intersect(m,j),q&&f.insert(m,q,e.distance(q,g)),g=c.list.shift();else{if(!!f.empty())break;i=f.extractMin(),k=d.left(i),j=d.right(i),l=d.right(j),n=d.leftRegion(i),o=d.rightRegion(j),r=i.vertex,e.endPoint(i.edge,i.side,r),e.endPoint(j.edge,j.side,r),d.del(i),f.del(j),d.del(j),t="l",n.y>o.y&&(p=n,n=o,o=p,t="r"),s=e.bisect(n,o),m=d.createHalfEdge(s,t),d.insert(k,m),e.endPoint(s,Mg[t],r),q=e.intersect(k,m),q&&(f.del(k),f.insert(k,q,e.distance(q,n))),q=e.intersect(m,l),q&&f.insert(m,q,e.distance(q,n))}}for(i=d.right(d.leftEnd);i!=d.rightEnd;i=d.right(i))b(i.edge)}function Og(){return{leaf:!0,nodes:[],point:null}}function Pg(a,b,c,d,e,f){if(!a(b,c,d,e,f)){var g=(c+e)*.5,h=(d+f)*.5,i=b.nodes;i[0]&&Pg(a,i[0],c,d,g,h),i[1]&&Pg(a,i[1],g,d,e,h),i[2]&&Pg(a,i[2],c,h,g,f),i[3]&&Pg(a,i[3],g,h,e,f)}}function Sg(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function _g(a,b,c,d){var e,f,g=0,h=b.length,i=c.length;while(g<h){if(d>=i)return-1;e=b.charCodeAt(g++);if(e===37){f=lh[b.charAt(g++)];if(!f||(d=f(a,c,d))<0)return-1}else if(e!=c.charCodeAt(d++))return-1}return d}function ah(a){return new RegExp("^(?:"+a.map(d3.requote).join("|")+")","i")}function bh(a){var b=new s,c=-1,d=a.length;while(++c<d)b.set(a[c].toLowerCase(),c);return b}function ch(a,b,c){a+="";var d=a.length;return d<c?(new Array(c-d+1)).join(b)+a:a}function mh(a,b,c){eh.lastIndex=0;var d=eh.exec(b.substring(c));return d?c+=d[0].length:-1}function nh(a,b,c){dh.lastIndex=0;var d=dh.exec(b.substring(c));return d?c+=d[0].length:-1}function oh(a,b,c){hh.lastIndex=0;var d=hh.exec(b.substring(c));return d?(a.m=ih.get(d[0].toLowerCase()),c+=d[0].length):-1}function ph(a,b,c){fh.lastIndex=0;var d=fh.exec(b.substring(c));return d?(a.m=gh.get(d[0].toLowerCase()),c+=d[0].length):-1}function qh(a,b,c){return _g(a,kh.c.toString(),b,c)}function rh(a,b,c){return _g(a,kh.x.toString(),b,c)}function sh(a,b,c){return _g(a,kh.X.toString(),b,c)}function th(a,b,c){Ch.lastIndex=0;var d=Ch.exec(b.substring(c,c+4));return d?(a.y=+d[0],c+=d[0].length):-1}function uh(a,b,c){Ch.lastIndex=0;var d=Ch.exec(b.substring(c,c+2));return d?(a.y=vh(+d[0]),c+=d[0].length):-1}function vh(a){return a+(a>68?1900:2e3)}function wh(a,b,c){Ch.lastIndex=0;var d=Ch.exec(b.substring(c,c+2));return d?(a.m=d[0]-1,c+=d[0].length):-1}function xh(a,b,c){Ch.lastIndex=0;var d=Ch.exec(b.substring(c,c+2));return d?(a.d=+d[0],c+=d[0].length):-1}function yh(a,b,c){Ch.lastIndex=0;var d=Ch.exec(b.substring(c,c+2));return d?(a.H=+d[0],c+=d[0].length):-1}function zh(a,b,c){Ch.lastIndex=0;var d=Ch.exec(b.substring(c,c+2));return d?(a.M=+d[0],c+=d[0].length):-1}function Ah(a,b,c){Ch.lastIndex=0;var d=Ch.exec(b.substring(c,c+2));return d?(a.S=+d[0],c+=d[0].length):-1}function Bh(a,b,c){Ch.lastIndex=0;var d=Ch.exec(b.substring(c,c+3));return d?(a.L=+d[0],c+=d[0].length):-1}function Dh(a,b,c){var d=Eh.get(b.substring(c,c+=2).toLowerCase());return d==null?-1:(a.p=d,c)}function Fh(a){var b=a.getTimezoneOffset(),c=b>0?"-":"+",d=~~(Math.abs(b)/60),e=Math.abs(b)%60;return c+ch(d,"0",2)+ch(e,"0",2)}function Hh(a){return a.toISOString()}function Ih(a,b,c){function d(b){var c=a(b),d=f(c,1);return b-c<d-b?c:d}function e(c){return b(c=a(new Qg(c-1)),1),c}function f(a,c){return b(a=new Qg(+a),c),a}function g(a,d,f){var g=e(a),h=[];if(f>1)while(g<d)c(g)%f||h.push(new Date(+g)),b(g,1);else while(g<d)h.push(new Date(+g)),b(g,1);return h}function h(a,b,c){try{Qg=Sg;var d=new Sg;return d._=a,g(d,b,c)}finally{Qg=Date}}a.floor=a,a.round=d,a.ceil=e,a.offset=f,a.range=g;var i=a.utc=Jh(a);return i.floor=i,i.round=Jh(d),i.ceil=Jh(e),i.offset=Jh(f),i.range=h,a}function Jh(a){return function(b,c){try{Qg=Sg;var d=new Sg;return d._=b,a(d,c)._}finally{Qg=Date}}}function Kh(a,b,c){function d(b){return a(b)}return d.invert=function(b){return Mh(a.invert(b))},d.domain=function(b){return arguments.length?(a.domain(b),d):a.domain().map(Mh)},d.nice=function(a){return d.domain(Qc(d.domain(),function(){return a}))},d.ticks=function(c,e){var f=Lh(d.domain());if(typeof c!="function"){var g=f[1]-f[0],h=g/c,i=d3.bisect(Qh,h);if(i==Qh.length)return b.year(f,c);if(!i)return a.ticks(c).map(Mh);Math.log(h/Qh[i-1])<Math.log(Qh[i]/h)&&--i,c=b[i],e=c[1],c=c[0].range}return c(f[0],new Date(+f[1]+1),e)},d.tickFormat=function(){return c},d.copy=function(){return Kh(a.copy(),b,c)},d3.rebind(d,a,"range","rangeRound","interpolate","clamp")}function Lh(a){var b=a[0],c=a[a.length-1];return b<c?[b,c]:[c,b]}function Mh(a){return new Date(a)}function Nh(a){return function(b){var c=a.length-1,d=a[c];while(!d[1](b))d=a[--c];return d[0](b)}}function Oh(a){var b=new Date(a,0,1);return b.setFullYear(a),b}function Ph(a){var b=a.getFullYear(),c=Oh(b),d=Oh(b+1);return b+(a-c)/(d-c)}function Yh(a){var b=new Date(Date.UTC(a,0,1));return b.setUTCFullYear(a),b}function Zh(a){var b=a.getUTCFullYear(),c=Yh(b),d=Yh(b+1);return b+(a-c)/(d-c)}var a=".",b=",",c=[3,3];Date.now||(Date.now=function(){return+(new Date)});try{document.createElement("div").style.setProperty("opacity",0,"")}catch(d){var e=CSSStyleDeclaration.prototype,f=e.setProperty;e.setProperty=function(a,b,c){f.call(this,a,b+"",c)}}d3={version:"3.0.5"};var g=Math.PI,h=1e-6,i=g/180,j=180/g,n=p;try{n(document.documentElement.childNodes)[0].nodeType}catch(q){n=o}var r=[].__proto__?function(a,b){a.__proto__=b}:function(a,b){for(var c in b)a[c]=b[c]};d3.map=function(a){var b=new s;for(var c in a)b.set(c,a[c]);return b},m(s,{has:function(a){return t+a in this},get:function(a){return this[t+a]},set:function(a,b){return this[t+a]=b},remove:function(a){return a=t+a,a in this&&delete this[a]},keys:function(){var a=[];return this.forEach(function(b){a.push(b)}),a},values:function(){var a=[];return this.forEach(function(b,c){a.push(c)}),a},entries:function(){var a=[];return this.forEach(function(b,c){a.push({key:b,value:c})}),a},forEach:function(a){for(var b in this)b.charCodeAt(0)===u&&a.call(this,b.substring(1),this[b])}});var t="\0",u=t.charCodeAt(0);d3.functor=x,d3.rebind=function(a,b){var c=1,d=arguments.length,e;while(++c<d)a[e=arguments[c]]=y(a,b,b[e]);return a},d3.ascending=function(a,b){return a<b?-1:a>b?1:a>=b?0:NaN},d3.descending=function(a,b){return b<a?-1:b>a?1:b>=a?0:NaN},d3.mean=function(a,b){var c=a.length,d,e=0,f=-1,g=0;if(arguments.length===1)while(++f<c)z(d=a[f])&&(e+=(d-e)/++g);else while(++f<c)z(d=b.call(a,a[f],f))&&(e+=(d-e)/++g);return g?e:undefined},d3.median=function(a,b){return arguments.length>1&&(a=a.map(b)),a=a.filter(z),a.length?d3.quantile(a.sort(d3.ascending),.5):undefined},d3.min=function(a,b){var c=-1,d=a.length,e,f;if(arguments.length===1){while(++c<d&&((e=a[c])==null||e!=e))e=undefined;while(++c<d)(f=a[c])!=null&&e>f&&(e=f)}else{while(++c<d&&((e=b.call(a,a[c],c))==null||e!=e))e=undefined;while(++c<d)(f=b.call(a,a[c],c))!=null&&e>f&&(e=f)}return e},d3.max=function(a,b){var c=-1,d=a.length,e,f;if(arguments.length===1){while(++c<d&&((e=a[c])==null||e!=e))e=undefined;while(++c<d)(f=a[c])!=null&&f>e&&(e=f)}else{while(++c<d&&((e=b.call(a,a[c],c))==null||e!=e))e=undefined;while(++c<d)(f=b.call(a,a[c],c))!=null&&f>e&&(e=f)}return e},d3.extent=function(a,b){var c=-1,d=a.length,e,f,g;if(arguments.length===1){while(++c<d&&((e=g=a[c])==null||e!=e))e=g=undefined;while(++c<d)(f=a[c])!=null&&(e>f&&(e=f),g<f&&(g=f))}else{while(++c<d&&((e=g=b.call(a,a[c],c))==null||e!=e))e=undefined;while(++c<d)(f=b.call(a,a[c],c))!=null&&(e>f&&(e=f),g<f&&(g=f))}return[e,g]},d3.random={normal:function(a,b){var c=arguments.length;return c<2&&(b=1),c<1&&(a=0),function(){var c,d,e;do c=Math.random()*2-1,d=Math.random()*2-1,e=c*c+d*d;while(!e||e>1);return a+b*c*Math.sqrt(-2*Math.log(e)/e)}},logNormal:function(a,b){var c=arguments.length;c<2&&(b=1),c<1&&(a=0);var d=d3.random.normal();return function(){return Math.exp(a+b*d())}},irwinHall:function(a){return function(){for(var b=0,c=0;c<a;c++)b+=Math.random();return b/a}}},d3.sum=function(a,b){var c=0,d=a.length,e,f=-1;if(arguments.length===1)while(++f<d)isNaN(e=+a[f])||(c+=e);else while(++f<d)isNaN(e=+b.call(a,a[f],f))||(c+=e);return c},d3.quantile=function(a,b){var c=(a.length-1)*b+1,d=Math.floor(c),e=+a[d-1],f=c-d;return f?e+f*(a[d]-e):e},d3.shuffle=function(a){var b=a.length,c,d;while(b)d=Math.random()*b--|0,c=a[b],a[b]=a[d],a[d]=c;return a},d3.transpose=function(a){return d3.zip.apply(d3,a)},d3.zip=function(){if(!(e=arguments.length))return[];for(var a=-1,b=d3.min(arguments,A),c=new Array(b);++a<b;)for(var d=-1,e,f=c[a]=new Array(e);++d<e;)f[d]=arguments[d][a];return c},d3.bisector=function(a){return{left:function(b,c,d,e){arguments.length<3&&(d=0),arguments.length<4&&(e=b.length);while(d<e){var f=d+e>>>1;a.call(b,b[f],f)<c?d=f+1:e=f}return d},right:function(b,c,d,e){arguments.length<3&&(d=0),arguments.length<4&&(e=b.length);while(d<e){var f=d+e>>>1;c<a.call(b,b[f],f)?e=f:d=f+1}return d}}};var B=d3.bisector(function(a){return a});d3.bisectLeft=B.left,d3.bisect=d3.bisectRight=B.right,d3.nest=function(){function f(c,g){if(g>=b.length)return e?e.call(a,c):d?c.sort(d):c;var h=-1,i=c.length,j=b[g++],k,l,m=new s,n,o={};while(++h<i)(n=m.get(k=j(l=c[h])))?n.push(l):m.set(k,[l]);return m.forEach(function(a,b){o[a]=f(b,g)}),o}function g(a,d){if(d>=b.length)return a;var e=[],f=c[d++],h;for(h in a)e.push({key:h,values:g(a[h],d)});return f&&e.sort(function(a,b){return f(a.key,b.key)}),e}var a={},b=[],c=[],d,e;return a.map=function(a){return f(a,0)},a.entries=function(a){return g(f(a,0),0)},a.key=function(c){return b.push(c),a},a.sortKeys=function(d){return c[b.length-1]=d,a},a.sortValues=function(b){return d=b,a},a.rollup=function(b){return e=b,a},a},d3.keys=function(a){var b=[];for(var c in a)b.push(c);return b},d3.values=function(a){var b=[];for(var c in a)b.push(a[c]);return b},d3.entries=function(a){var b=[];for(var c in a)b.push({key:c,value:a[c]});return b},d3.permute=function(a,b){var c=[],d=-1,e=b.length;while(++d<e)c[d]=a[b[d]];return c},d3.merge=function(a){return Array.prototype.concat.apply([],a)},d3.range=function(a,b,c){arguments.length<3&&(c=1,arguments.length<2&&(b=a,a=0));if((b-a)/c===Infinity)throw new Error("infinite range");var d=[],e=D(Math.abs(c)),f=-1,g;a*=e,b*=e,c*=e;if(c<0)while((g=a+c*++f)>b)d.push(g/e);else while((g=a+c*++f)<b)d.push(g/e);return d},d3.requote=function(a){return a.replace(E,"\\$&")};var E=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g;d3.round=function(a,b){return b?Math.round(a*(b=Math.pow(10,b)))/b:Math.round(a)},d3.xhr=function(a,b,c){function i(){var a=h.status;!a&&h.responseText||a>=200&&a<300||a===304?e.load.call(d,g.call(d,h)):e.error.call(d,h)}var d={},e=d3.dispatch("progress","load","error"),f={},g=v,h=new(window.XDomainRequest&&/^(http(s)?:)?\/\//.test(a)?XDomainRequest:XMLHttpRequest);return"onload"in h?h.onload=h.onerror=i:h.onreadystatechange=function(){h.readyState>3&&i()},h.onprogress=function(a){var b=d3.event;d3.event=a;try{e.progress.call(d,h)}finally{d3.event=b}},d.header=function(a,b){return a=(a+"").toLowerCase(),arguments.length<2?f[a]:(b==null?delete f[a]:f[a]=b+"",d)},d.mimeType=function(a){return arguments.length?(b=a==null?null:a+"",d):b},d.response=function(a){return g=a,d},["get","post"].forEach(function(a){d[a]=function(){return d.send.apply(d,[a].concat(n(arguments)))}}),d.send=function(c,e,g){arguments.length===2&&typeof e=="function"&&(g=e,e=null),h.open(c,a,!0),b!=null&&!("accept"in f)&&(f.accept=b+",*/*");if(h.setRequestHeader)for(var i in f)h.setRequestHeader(i,f[i]);return b!=null&&h.overrideMimeType&&h.overrideMimeType(b),g!=null&&d.on("error",g).on("load",function(a){g(null,a)}),h.send(e==null?null:e),d},d.abort=function(){return h.abort(),d},d3.rebind(d,e,"on"),arguments.length===2&&typeof b=="function"&&(c=b,b=null),c==null?d:d.get(F(c))},d3.text=function(){return d3.xhr.apply(d3,arguments).response(G)},d3.json=function(a,b){return d3.xhr(a,"application/json",b).response(H)},d3.html=function(a,b){return d3.xhr(a,"text/html",b).response(I)},d3.xml=function(){return d3.xhr.apply(d3,arguments).response(J)};var K={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};d3.ns={prefix:K,qualify:function(a){var b=a.indexOf(":"),c=a;return b>=0&&(c=a.substring(0,b),a=a.substring(b+1)),K.hasOwnProperty(c)?{space:K[c],local:a}:a}},d3.dispatch=function(){var a=new L,b=-1,c=arguments.length;while(++b<c)a[arguments[b]]=M(a);return a},L.prototype.on=function(a,b){var c=a.indexOf("."),d="";return c>0&&(d=a.substring(c+1),a=a.substring(0,c)),arguments.length<2?this[a].on(d):this[a].on(d,b)},d3.format=function(b){var c=N.exec(b),d=c[1]||" ",e=c[2]||">",f=c[3]||"",g=c[4]||"",h=c[5],i=+c[6],j=c[7],k=c[8],l=c[9],m=1,n="",o=!1;k&&(k=+k.substring(1));if(h||d==="0"&&e==="=")h=d="0",e="=",j&&(i-=Math.floor((i-1)/4));switch(l){case"n":j=!0,l="g";break;case"%":m=100,n="%",l="f";break;case"p":m=100,n="%",l="r";break;case"b":case"o":case"x":case"X":g&&(g="0"+l.toLowerCase());case"c":case"d":o=!0,k=0;break;case"s":m=-1,l="r"}g==="#"&&(g=""),l=="r"&&!k&&(l="g"),l=O.get(l)||Q;var p=h&&j;return function(b){if(o&&b%1)return"";var c=b<0||b===0&&1/b<0?(b=-b,"-"):f;if(m<0){var q=d3.formatPrefix(b,k);b=q.scale(b),n=q.symbol}else b*=m;b=l(b,k),!h&&j&&(b=R(b));var r=g.length+b.length+(p?0:c.length),s=r<i?(new Array(r=i-r+1)).join(d):"";return p&&(b=R(s+b)),a&&b.replace(".",a),c+=g,(e==="<"?c+b+s:e===">"?s+c+b:e==="^"?s.substring(0,r>>=1)+c+b+s.substring(r):c+(p?b:s+b))+n}};var N=/(?:([^{])?([<>=^]))?([+\- ])?(#)?(0)?([0-9]+)?(,)?(\.[0-9]+)?([a-zA-Z%])?/,O=d3.map({b:function(a){return a.toString(2)},c:function(a){return String.fromCharCode(a)},o:function(a){return a.toString(8)},x:function(a){return a.toString(16)},X:function(a){return a.toString(16).toUpperCase()},g:function(a,b){return a.toPrecision(b)},e:function(a,b){return a.toExponential(b)},f:function(a,b){return a.toFixed(b)},r:function(a,b){return d3.round(a,b=P(a,b)).toFixed(Math.max(0,Math.min(20,b)))}}),R=v;if(c){var S=c.length;R=function(a){var d=a.lastIndexOf("."),e=d>=0?"."+a.substring(d+1):(d=a.length,""),f=[],g=0,h=c[0];while(d>0&&h>0)f.push(a.substring(d-=h,d+h)),h=c[g=(g+1)%S];return f.reverse().join(b||"")+e}}var T=["y","z","a","f","p","n","μ","m","","k","M","G","T","P","E","Z","Y"].map(U);d3.formatPrefix=function(a,b){var c=0;return a&&(a<0&&(a*=-1),b&&(a=d3.round(a,P(a,b))),c=1+Math.floor(1e-12+Math.log(a)/Math.LN10),c=Math.max(-24,Math.min(24,Math.floor((c<=0?c+1:c-1)/3)*3))),T[8+c/3]};var V=function(){return v},W=d3.map({linear:V,poly:cb,quad:function(){return _},cubic:function(){return ab},sin:function(){return db},exp:function(){return eb},circle:function(){return fb},elastic:gb,back:hb,bounce:function(){return ib}}),X=d3.map({"in":v,out:Z,"in-out":$,"out-in":function(a){return $(Z(a))}});d3.ease=function(a){var b=a.indexOf("-"),c=b>=0?a.substring(0,b):a,d=b>=0?a.substring(b+1):"in";return c=W.get(c)||V,d=X.get(d)||v,Y(d(c.apply(null,Array.prototype.slice.call(arguments,1))))},d3.event=null,d3.transform=function(a){var b=document.createElementNS(d3.ns.prefix.svg,"g");return(d3.transform=function(a){b.setAttribute("transform",a);var c=b.transform.baseVal.consolidate();return new mb(c?c.matrix:qb)})(a)},mb.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var qb={a:1,b:0,c:0,d:1,e:0,f:0};d3.interpolate=function(a,b){var c=d3.interpolators.length,d;while(--c>=0&&!(d=d3.interpolators[c](a,b)));return d},d3.interpolateNumber=function(a,b){return b-=a,function(c){return a+b*c}},d3.interpolateRound=function(a,b){return b-=a,function(c){return Math.round(a+b*c)}},d3.interpolateString=function(a,b){var c,d,e,f=0,g=0,h=[],i=[],j,k;rb.lastIndex=0;for(d=0;c=rb.exec(b);++d)c.index&&h.push(b.substring(f,g=c.index)),i.push({i:h.length,x:c[0]}),h.push(null),f=rb.lastIndex;f<b.length&&h.push(b.substring(f));for(d=0,j=i.length;(c=rb.exec(a))&&d<j;++d){k=i[d];if(k.x==c[0]){if(k.i)if(h[k.i+1]==null){h[k.i-1]+=k.x,h.splice(k.i,1);for(e=d+1;e<j;++e)i[e].i--}else{h[k.i-1]+=k.x+h[k.i+1],h.splice(k.i,2);for(e=d+1;e<j;++e)i[e].i-=2}else if(h[k.i+1]==null)h[k.i]=k.x;else{h[k.i]=k.x+h[k.i+1],h.splice(k.i+1,1);for(e=d+1;e<j;++e)i[e].i--}i.splice(d,1),j--,d--}else k.x=d3.interpolateNumber(parseFloat(c[0]),parseFloat(k.x))}while(d<j)k=i.pop(),h[k.i+1]==null?h[k.i]=k.x:(h[k.i]=k.x+h[k.i+1],h.splice(k.i+1,1)),j--;return h.length===1?h[0]==null?i[0].x:function(){return b}:function(a){for(d=0;d<j;++d)h[(k=i[d]).i]=k.x(a);return h.join("")}},d3.interpolateTransform=function(a,b){var c=[],d=[],e,f=d3.transform(a),g=d3.transform(b),h=f.translate,i=g.translate,j=f.rotate,k=g.rotate,l=f.skew,m=g.skew,n=f.scale,o=g.scale;return h[0]!=i[0]||h[1]!=i[1]?(c.push("translate(",null,",",null,")"),d.push({i:1,x:d3.interpolateNumber(h[0],i[0])},{i:3,x:d3.interpolateNumber(h[1],i[1])})):i[0]||i[1]?c.push("translate("+i+")"):c.push(""),j!=k?(j-k>180?k+=360:k-j>180&&(j+=360),d.push({i:c.push(c.pop()+"rotate(",null,")")-2,x:d3.interpolateNumber(j,k)})):k&&c.push(c.pop()+"rotate("+k+")"),l!=m?d.push({i:c.push(c.pop()+"skewX(",null,")")-2,x:d3.interpolateNumber(l,m)}):m&&c.push(c.pop()+"skewX("+m+")"),n[0]!=o[0]||n[1]!=o[1]?(e=c.push(c.pop()+"scale(",null,",",null,")"),d.push({i:e-4,x:d3.interpolateNumber(n[0],o[0])},{i:e-2,x:d3.interpolateNumber(n[1],o[1])})):(o[0]!=1||o[1]!=1)&&c.push(c.pop()+"scale("+o+")"),e=d.length,function(a){var b=-1,f;while(++b<e)c[(f=d[b]).i]=f.x(a);return c.join("")}},d3.interpolateRgb=function(a,b){a=d3.rgb(a),b=d3.rgb(b);var c=a.r,d=a.g,e=a.b,f=b.r-c,g=b.g-d,h=b.b-e;return function(a){return"#"+zb(Math.round(c+f*a))+zb(Math.round(d+g*a))+zb(Math.round(e+h*a))}},d3.interpolateHsl=function(a,b){a=d3.hsl(a),b=d3.hsl(b);var c=a.h,d=a.s,e=a.l,f=b.h-c,g=b.s-d,h=b.l-e;return f>180?f-=360:f<-180&&(f+=360),function(a){return Jb(c+f*a,d+g*a,e+h*a)+""}},d3.interpolateLab=function(a,b){a=d3.lab(a),b=d3.lab(b);var c=a.l,d=a.a,e=a.b,f=b.l-c,g=b.a-d,h=b.b-e;return function(a){return Vb(c+f*a,d+g*a,e+h*a)+""}},d3.interpolateHcl=function(a,b){a=d3.hcl(a),b=d3.hcl(b);var c=a.h,d=a.c,e=a.l,f=b.h-c,g=b.c-d,h=b.l-e;return f>180?f-=360:f<-180&&(f+=360),function(a){return Nb(c+f*a,d+g*a,e+h*a)+""}},d3.interpolateArray=function(a,b){var c=[],d=[],e=a.length,f=b.length,g=Math.min(a.length,b.length),h;for(h=0;h<g;++h)c.push(d3.interpolate(a[h],b[h]));for(;h<e;++h)d[h]=a[h];for(;h<f;++h)d[h]=b[h];return function(a){for(h=0;h<g;++h)d[h]=c[h](a);return d}},d3.interpolateObject=function(a,b){var c={},d={},e;for(e in a)e in b?c[e]=sb(e)(a[e],b[e]):d[e]=a[e];for(e in b)e in a||(d[e]=b[e]);return function(a){for(e in c)d[e]=c[e](a);return d}};var rb=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g;d3.interpolators=[d3.interpolateObject,function(a,b){return b instanceof Array&&d3.interpolateArray(a,b)},function(a,b){return(typeof a=="string"||typeof b=="string")&&d3.interpolateString(a+"",b+"")},function(a,b){return(typeof b=="string"?Fb.has(b)||/^(#|rgb\(|hsl\()/.test(b):b instanceof vb)&&d3.interpolateRgb(a,b)},function(a,b){return!isNaN(a=+a)&&!isNaN(b=+b)&&d3.interpolateNumber(a,b)}],vb.prototype.toString=function(){return this.rgb()+""},d3.rgb=function(a,b,c){return arguments.length===1?a instanceof xb?wb(a.r,a.g,a.b):Ab(""+a,wb,Jb):wb(~~a,~~b,~~c)};var yb=xb.prototype=new vb;yb.brighter=function(a){a=Math.pow(.7,arguments.length?a:1);var b=this.r,c=this.g,d=this.b,e=30;return!b&&!c&&!d?wb(e,e,e):(b&&b<e&&(b=e),c&&c<e&&(c=e),d&&d<e&&(d=e),wb(Math.min(255,Math.floor(b/a)),Math.min(255,Math.floor(c/a)),Math.min(255,Math.floor(d/a))))},yb.darker=function(a){return a=Math.pow(.7,arguments.length?a:1),wb(Math.floor(a*this.r),Math.floor(a*this.g),Math.floor(a*this.b))},yb.hsl=function(){return Bb(this.r,this.g,this.b)},yb.toString=function(){return"#"+zb(this.r)+zb(this.g)+zb(this.b)};var Fb=d3.map({aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite
:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"});Fb.forEach(function(a,b){Fb.set(a,Ab(b,wb,Jb))}),d3.hsl=function(a,b,c){return arguments.length===1?a instanceof Hb?Gb(a.h,a.s,a.l):Ab(""+a,Bb,Gb):Gb(+a,+b,+c)};var Ib=Hb.prototype=new vb;Ib.brighter=function(a){return a=Math.pow(.7,arguments.length?a:1),Gb(this.h,this.s,this.l/a)},Ib.darker=function(a){return a=Math.pow(.7,arguments.length?a:1),Gb(this.h,this.s,a*this.l)},Ib.rgb=function(){return Jb(this.h,this.s,this.l)},d3.hcl=function(a,b,c){return arguments.length===1?a instanceof Lb?Kb(a.h,a.c,a.l):a instanceof Pb?Wb(a.l,a.a,a.b):Wb((a=Cb((a=d3.rgb(a)).r,a.g,a.b)).l,a.a,a.b):Kb(+a,+b,+c)};var Mb=Lb.prototype=new vb;Mb.brighter=function(a){return Kb(this.h,this.c,Math.min(100,this.l+Qb*(arguments.length?a:1)))},Mb.darker=function(a){return Kb(this.h,this.c,Math.max(0,this.l-Qb*(arguments.length?a:1)))},Mb.rgb=function(){return Nb(this.h,this.c,this.l).rgb()},d3.lab=function(a,b,c){return arguments.length===1?a instanceof Pb?Ob(a.l,a.a,a.b):a instanceof Lb?Nb(a.l,a.c,a.h):Cb((a=d3.rgb(a)).r,a.g,a.b):Ob(+a,+b,+c)};var Qb=18,Rb=.95047,Sb=1,Tb=1.08883,Ub=Pb.prototype=new vb;Ub.brighter=function(a){return Ob(Math.min(100,this.l+Qb*(arguments.length?a:1)),this.a,this.b)},Ub.darker=function(a){return Ob(Math.max(0,this.l-Qb*(arguments.length?a:1)),this.a,this.b)},Ub.rgb=function(){return Vb(this.l,this.a,this.b)};var _b=function(a,b){return b.querySelector(a)},ac=function(a,b){return b.querySelectorAll(a)},bc=document.documentElement,cc=bc.matchesSelector||bc.webkitMatchesSelector||bc.mozMatchesSelector||bc.msMatchesSelector||bc.oMatchesSelector,dc=function(a,b){return cc.call(a,b)};typeof Sizzle=="function"&&(_b=function(a,b){return Sizzle(a,b)[0]||null},ac=function(a,b){return Sizzle.uniqueSort(Sizzle(a,b))},dc=Sizzle.matchesSelector);var ec=[];d3.selection=function(){return sc},d3.selection.prototype=ec,ec.select=function(a){var b=[],c,d,e,f;typeof a!="function"&&(a=fc(a));for(var g=-1,h=this.length;++g<h;){b.push(c=[]),c.parentNode=(e=this[g]).parentNode;for(var i=-1,j=e.length;++i<j;)(f=e[i])?(c.push(d=a.call(f,f.__data__,i)),d&&"__data__"in f&&(d.__data__=f.__data__)):c.push(null)}return $b(b)},ec.selectAll=function(a){var b=[],c,d;typeof a!="function"&&(a=gc(a));for(var e=-1,f=this.length;++e<f;)for(var g=this[e],h=-1,i=g.length;++h<i;)if(d=g[h])b.push(c=n(a.call(d,d.__data__,h))),c.parentNode=d;return $b(b)},ec.attr=function(a,b){if(arguments.length<2){if(typeof a=="string"){var c=this.node();return a=d3.ns.qualify(a),a.local?c.getAttributeNS(a.space,a.local):c.getAttribute(a)}for(b in a)this.each(hc(b,a[b]));return this}return this.each(hc(a,b))},ec.classed=function(a,b){if(arguments.length<2){if(typeof a=="string"){var c=this.node(),d=(a=a.trim().split(/^|\s+/g)).length,e=-1;if(b=c.classList){while(++e<d)if(!b.contains(a[e]))return!1}else{b=c.className,b.baseVal!=null&&(b=b.baseVal);while(++e<d)if(!ic(a[e]).test(b))return!1}return!0}for(b in a)this.each(jc(b,a[b]));return this}return this.each(jc(a,b))},ec.style=function(a,b,c){var d=arguments.length;if(d<3){if(typeof a!="string"){d<2&&(b="");for(c in a)this.each(lc(c,a[c],b));return this}if(d<2)return getComputedStyle(this.node(),null).getPropertyValue(a);c=""}return this.each(lc(a,b,c))},ec.property=function(a,b){if(arguments.length<2){if(typeof a=="string")return this.node()[a];for(b in a)this.each(mc(b,a[b]));return this}return this.each(mc(a,b))},ec.text=function(a){return arguments.length?this.each(typeof a=="function"?function(){var b=a.apply(this,arguments);this.textContent=b==null?"":b}:a==null?function(){this.textContent=""}:function(){this.textContent=a}):this.node().textContent},ec.html=function(a){return arguments.length?this.each(typeof a=="function"?function(){var b=a.apply(this,arguments);this.innerHTML=b==null?"":b}:a==null?function(){this.innerHTML=""}:function(){this.innerHTML=a}):this.node().innerHTML},ec.append=function(a){function b(){return this.appendChild(document.createElementNS(this.namespaceURI,a))}function c(){return this.appendChild(document.createElementNS(a.space,a.local))}return a=d3.ns.qualify(a),this.select(a.local?c:b)},ec.insert=function(a,b){function c(){return this.insertBefore(document.createElementNS(this.namespaceURI,a),_b(b,this))}function d(){return this.insertBefore(document.createElementNS(a.space,a.local),_b(b,this))}return a=d3.ns.qualify(a),this.select(a.local?d:c)},ec.remove=function(){return this.each(function(){var a=this.parentNode;a&&a.removeChild(this)})},ec.data=function(a,b){function g(a,c){var d,e=a.length,f=c.length,g=Math.min(e,f),k=new Array(f),l=new Array(f),m=new Array(e),n,o;if(b){var p=new s,q=new s,r=[],t;for(d=-1;++d<e;)t=b.call(n=a[d],n.__data__,d),p.has(t)?m[d]=n:p.set(t,n),r.push(t);for(d=-1;++d<f;)t=b.call(c,o=c[d],d),(n=p.get(t))?(k[d]=n,n.__data__=o):q.has(t)||(l[d]=nc(o)),q.set(t,o),p.remove(t);for(d=-1;++d<e;)p.has(r[d])&&(m[d]=a[d])}else{for(d=-1;++d<g;)n=a[d],o=c[d],n?(n.__data__=o,k[d]=n):l[d]=nc(o);for(;d<f;++d)l[d]=nc(c[d]);for(;d<e;++d)m[d]=a[d]}l.update=k,l.parentNode=k.parentNode=m.parentNode=a.parentNode,h.push(l),i.push(k),j.push(m)}var c=-1,d=this.length,e,f;if(!arguments.length){a=new Array(d=(e=this[0]).length);while(++c<d)if(f=e[c])a[c]=f.__data__;return a}var h=tc([]),i=$b([]),j=$b([]);if(typeof a=="function")while(++c<d)g(e=this[c],a.call(e,e.parentNode.__data__,c));else while(++c<d)g(e=this[c],a);return i.enter=function(){return h},i.exit=function(){return j},i},ec.datum=function(a){return arguments.length?this.property("__data__",a):this.property("__data__")},ec.filter=function(a){var b=[],c,d,e;typeof a!="function"&&(a=oc(a));for(var f=0,g=this.length;f<g;f++){b.push(c=[]),c.parentNode=(d=this[f]).parentNode;for(var h=0,i=d.length;h<i;h++)(e=d[h])&&a.call(e,e.__data__,h)&&c.push(e)}return $b(b)},ec.order=function(){for(var a=-1,b=this.length;++a<b;)for(var c=this[a],d=c.length-1,e=c[d],f;--d>=0;)if(f=c[d])e&&e!==f.nextSibling&&e.parentNode.insertBefore(f,e),e=f;return this},ec.sort=function(a){a=pc.apply(this,arguments);for(var b=-1,c=this.length;++b<c;)this[b].sort(a);return this.order()},ec.on=function(a,b,c){var d=arguments.length;if(d<3){if(typeof a!="string"){d<2&&(b=!1);for(c in a)this.each(qc(c,a[c],b));return this}if(d<2)return(d=this.node()["__on"+a])&&d._;c=!1}return this.each(qc(a,b,c))},ec.each=function(a){return rc(this,function(b,c,d){a.call(b,b.__data__,c,d)})},ec.call=function(a){var b=n(arguments);return a.apply(b[0]=this,b),this},ec.empty=function(){return!this.node()},ec.node=function(){for(var a=0,b=this.length;a<b;a++)for(var c=this[a],d=0,e=c.length;d<e;d++){var f=c[d];if(f)return f}return null},ec.transition=function(){var a=yc||++xc,b=[],c,d,e=Object.create(zc);e.time=Date.now();for(var f=-1,g=this.length;++f<g;){b.push(c=[]);for(var h=this[f],i=-1,j=h.length;++i<j;)(d=h[i])&&Ac(d,i,a,e),c.push(d)}return vc(b,a)};var sc=$b([[document]]);sc[0].parentNode=bc,d3.select=function(a){return typeof a=="string"?sc.select(a):$b([[a]])},d3.selectAll=function(a){return typeof a=="string"?sc.selectAll(a):$b([n(a)])};var uc=[];d3.selection.enter=tc,d3.selection.enter.prototype=uc,uc.append=ec.append,uc.insert=ec.insert,uc.empty=ec.empty,uc.node=ec.node,uc.select=function(a){var b=[],c,d,e,f,g;for(var h=-1,i=this.length;++h<i;){e=(f=this[h]).update,b.push(c=[]),c.parentNode=f.parentNode;for(var j=-1,k=f.length;++j<k;)(g=f[j])?(c.push(e[j]=d=a.call(f.parentNode,g.__data__,j)),d.__data__=g.__data__):c.push(null)}return $b(b)};var wc=[],xc=0,yc,zc={ease:bb,delay:0,duration:250};wc.call=ec.call,wc.empty=ec.empty,wc.node=ec.node,d3.transition=function(a){return arguments.length?yc?a.transition():a:sc.transition()},d3.transition.prototype=wc,wc.select=function(a){var b=this.id,c=[],d,e,f;typeof a!="function"&&(a=fc(a));for(var g=-1,h=this.length;++g<h;){c.push(d=[]);for(var i=this[g],j=-1,k=i.length;++j<k;)(f=i[j])&&(e=a.call(f,f.__data__,j))?("__data__"in f&&(e.__data__=f.__data__),Ac(e,j,b,f.__transition__[b]),d.push(e)):d.push(null)}return vc(c,b)},wc.selectAll=function(a){var b=this.id,c=[],d,e,f,g,h;typeof a!="function"&&(a=gc(a));for(var i=-1,j=this.length;++i<j;)for(var k=this[i],l=-1,m=k.length;++l<m;)if(f=k[l]){h=f.__transition__[b],e=a.call(f,f.__data__,l),c.push(d=[]);for(var n=-1,o=e.length;++n<o;)Ac(g=e[n],n,b,h),d.push(g)}return vc(c,b)},wc.filter=function(a){var b=[],c,d,e;typeof a!="function"&&(a=oc(a));for(var f=0,g=this.length;f<g;f++){b.push(c=[]);for(var d=this[f],h=0,i=d.length;h<i;h++)(e=d[h])&&a.call(e,e.__data__,h)&&c.push(e)}return vc(b,this.id,this.time).ease(this.ease())},wc.attr=function(a,b){function e(){this.removeAttribute(d)}function f(){this.removeAttributeNS(d.space,d.local)}if(arguments.length<2){for(b in a)this.attr(b,a[b]);return this}var c=sb(a),d=d3.ns.qualify(a);return Cc(this,"attr."+a,b,function(a){function b(){var b=this.getAttribute(d),e;return b!==a&&(e=c(b,a),function(a){this.setAttribute(d,e(a))})}function g(){var b=this.getAttributeNS(d.space,d.local),e;return b!==a&&(e=c(b,a),function(a){this.setAttributeNS(d.space,d.local,e(a))})}return a==null?d.local?f:e:(a+="",d.local?g:b)})},wc.attrTween=function(a,b){function d(a,d){var e=b.call(this,a,d,this.getAttribute(c));return e&&function(a){this.setAttribute(c,e(a))}}function e(a,d){var e=b.call(this,a,d,this.getAttributeNS(c.space,c.local));return e&&function(a){this.setAttributeNS(c.space,c.local,e(a))}}var c=d3.ns.qualify(a);return this.tween("attr."+a,c.local?e:d)},wc.style=function(a,b,c){function f(){this.style.removeProperty(a)}var d=arguments.length;if(d<3){if(typeof a!="string"){d<2&&(b="");for(c in a)this.style(c,a[c],b);return this}c=""}var e=sb(a);return Cc(this,"style."+a,b,function(b){function d(){var d=getComputedStyle(this,null).getPropertyValue(a),f;return d!==b&&(f=e(d,b),function(b){this.style.setProperty(a,f(b),c)})}return b==null?f:(b+="",d)})},wc.styleTween=function(a,b,c){return arguments.length<3&&(c=""),this.tween("style."+a,function(d,e){var f=b.call(this,d,e,getComputedStyle(this,null).getPropertyValue(a));return f&&function(b){this.style.setProperty(a,f(b),c)}})},wc.text=function(a){return Cc(this,"text",a,Bc)},wc.remove=function(){return this.each("end.transition",function(){var a;!this.__transition__&&(a=this.parentNode)&&a.removeChild(this)})},wc.ease=function(a){var b=this.id;return arguments.length<1?this.node().__transition__[b].ease:(typeof a!="function"&&(a=d3.ease.apply(d3,arguments)),rc(this,function(c){c.__transition__[b].ease=a}))},wc.delay=function(a){var b=this.id;return rc(this,typeof a=="function"?function(c,d,e){c.__transition__[b].delay=a.call(c,c.__data__,d,e)|0}:(a|=0,function(c){c.__transition__[b].delay=a}))},wc.duration=function(a){var b=this.id;return rc(this,typeof a=="function"?function(c,d,e){c.__transition__[b].duration=Math.max(1,a.call(c,c.__data__,d,e)|0)}:(a=Math.max(1,a|0),function(c){c.__transition__[b].duration=a}))},wc.each=function(a,b){var c=this.id;if(arguments.length<2){var d=zc,e=yc;yc=c,rc(this,function(b,d,e){zc=b.__transition__[c],a.call(b,b.__data__,d,e)}),zc=d,yc=e}else rc(this,function(d){d.__transition__[c].event.on(a,b)});return this},wc.transition=function(){var a=this.id,b=++xc,c=[],d,e,f,g;for(var h=0,i=this.length;h<i;h++){c.push(d=[]);for(var e=this[h],j=0,k=e.length;j<k;j++){if(f=e[j])g=Object.create(f.__transition__[a]),g.delay+=g.duration,Ac(f,j,b,g);d.push(f)}}return vc(c,b)},wc.tween=function(a,b){var c=this.id;return arguments.length<2?this.node().__transition__[c].tween.get(a):rc(this,b==null?function(b){b.__transition__[c].tween.remove(a)}:function(d){d.__transition__[c].tween.set(a,b)})};var Dc=0,Ec={},Fc=null,Gc,Hc;d3.timer=function(a,b,c){if(arguments.length<3){if(arguments.length<2)b=0;else if(!isFinite(b))return;c=Date.now()}var d=Ec[a.id];d&&d.callback===a?(d.then=c,d.delay=b):Ec[a.id=++Dc]=Fc={callback:a,then:c,delay:b,next:Fc},Gc||(Hc=clearTimeout(Hc),Gc=1,Kc(Ic))},d3.timer.flush=function(){var a,b=Date.now(),c=Fc;while(c)a=b-c.then,c.delay||(c.flush=c.callback(a)),c=c.next;Jc()};var Kc=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){setTimeout(a,17)};d3.mouse=function(a){return Mc(a,kb())};var Lc=/WebKit/.test(navigator.userAgent)?-1:0;d3.touches=function(a,b){return arguments.length<2&&(b=kb().touches),b?n(b).map(function(b){var c=Mc(a,b);return c.identifier=b.identifier,c}):[]},d3.scale={},d3.scale.linear=function(){return Sc([0,1],[0,1],d3.interpolate,!1)},d3.scale.log=function(){return $c(d3.scale.linear(),ad)};var _c=d3.format(".0e");ad.pow=function(a){return Math.pow(10,a)},bd.pow=function(a){return-Math.pow(10,-a)},d3.scale.pow=function(){return cd(d3.scale.linear(),1)},d3.scale.sqrt=function(){return d3.scale.pow().exponent(.5)},d3.scale.ordinal=function(){return ed([],{t:"range",a:[[]]})},d3.scale.category10=function(){return d3.scale.ordinal().range(fd)},d3.scale.category20=function(){return d3.scale.ordinal().range(gd)},d3.scale.category20b=function(){return d3.scale.ordinal().range(hd)},d3.scale.category20c=function(){return d3.scale.ordinal().range(id)};var fd=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],gd=["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],hd=["#393b79","#5254a3","#6b6ecf","#9c9ede","#637939","#8ca252","#b5cf6b","#cedb9c","#8c6d31","#bd9e39","#e7ba52","#e7cb94","#843c39","#ad494a","#d6616b","#e7969c","#7b4173","#a55194","#ce6dbd","#de9ed6"],id=["#3182bd","#6baed6","#9ecae1","#c6dbef","#e6550d","#fd8d3c","#fdae6b","#fdd0a2","#31a354","#74c476","#a1d99b","#c7e9c0","#756bb1","#9e9ac8","#bcbddc","#dadaeb","#636363","#969696","#bdbdbd","#d9d9d9"];d3.scale.quantile=function(){return jd([],[])},d3.scale.quantize=function(){return kd(0,1,[0,1])},d3.scale.threshold=function(){return ld([.5],[0,1])},d3.scale.identity=function(){return md([0,1])},d3.svg={},d3.svg.arc=function(){function e(){var e=a.apply(this,arguments),f=b.apply(this,arguments),h=c.apply(this,arguments)+nd,i=d.apply(this,arguments)+nd,j=(i<h&&(j=h,h=i,i=j),i-h),k=j<g?"0":"1",l=Math.cos(h),m=Math.sin(h),n=Math.cos(i),o=Math.sin(i);return j>=od?e?"M0,"+f+"A"+f+","+f+" 0 1,1 0,"+ -f+"A"+f+","+f+" 0 1,1 0,"+f+"M0,"+e+"A"+e+","+e+" 0 1,0 0,"+ -e+"A"+e+","+e+" 0 1,0 0,"+e+"Z":"M0,"+f+"A"+f+","+f+" 0 1,1 0,"+ -f+"A"+f+","+f+" 0 1,1 0,"+f+"Z":e?"M"+f*l+","+f*m+"A"+f+","+f+" 0 "+k+",1 "+f*n+","+f*o+"L"+e*n+","+e*o+"A"+e+","+e+" 0 "+k+",0 "+e*l+","+e*m+"Z":"M"+f*l+","+f*m+"A"+f+","+f+" 0 "+k+",1 "+f*n+","+f*o+"L0,0"+"Z"}var a=pd,b=qd,c=rd,d=sd;return e.innerRadius=function(b){return arguments.length?(a=x(b),e):a},e.outerRadius=function(a){return arguments.length?(b=x(a),e):b},e.startAngle=function(a){return arguments.length?(c=x(a),e):c},e.endAngle=function(a){return arguments.length?(d=x(a),e):d},e.centroid=function(){var e=(a.apply(this,arguments)+b.apply(this,arguments))/2,f=(c.apply(this,arguments)+d.apply(this,arguments))/2+nd;return[Math.cos(f)*e,Math.sin(f)*e]},e};var nd=-g/2,od=2*g-1e-6;d3.svg.line=function(){return td(v)};var wd=d3.map({linear:xd,"linear-closed":yd,"step-before":zd,"step-after":Ad,basis:Gd,"basis-open":Hd,"basis-closed":Id,bundle:Jd,cardinal:Dd,"cardinal-open":Bd,"cardinal-closed":Cd,monotone:Sd});wd.forEach(function(a,b){b.key=a,b.closed=/-closed$/.test(a)});var Ld=[0,2/3,1/3,0],Md=[0,1/3,2/3,0],Nd=[0,1/6,2/3,1/6];d3.svg.line.radial=function(){var a=td(Td);return a.radius=a.x,delete a.x,a.angle=a.y,delete a.y,a},zd.reverse=Ad,Ad.reverse=zd,d3.svg.area=function(){return Ud(v)},d3.svg.area.radial=function(){var a=Ud(Td);return a.radius=a.x,delete a.x,a.innerRadius=a.x0,delete a.x0,a.outerRadius=a.x1,delete a.x1,a.angle=a.y,delete a.y,a.startAngle=a.y0,delete a.y0,a.endAngle=a.y1,delete a.y1,a},d3.svg.chord=function(){function f(c,d){var e=h(this,a,c,d),f=h(this,b,c,d);return"M"+e.p0+j(e.r,e.p1,e.a1-e.a0)+(i(e,f)?m(e.r,e.p1,e.r,e.p0):m(e.r,e.p1,f.r,f.p0)+j(f.r,f.p1,f.a1-f.a0)+m(f.r,f.p1,e.r,e.p0))+"Z"}function h(a,b,f,g){var h=b.call(a,f,g),i=c.call(a,h,g),j=d.call(a,h,g)+nd,k=e.call(a,h,g)+nd;return{r:i,a0:j,a1:k,p0:[i*Math.cos(j),i*Math.sin(j)],p1:[i*Math.cos(k),i*Math.sin(k)]}}function i(a,b){return a.a0==b.a0&&a.a1==b.a1}function j(a,b,c){return"A"+a+","+a+" 0 "+ +(c>g)+",1 "+b}function m(a,b,c,d){return"Q 0,0 "+d}var a=l,b=k,c=Vd,d=rd,e=sd;return f.radius=function(a){return arguments.length?(c=x(a),f):c},f.source=function(b){return arguments.length?(a=x(b),f):a},f.target=function(a){return arguments.length?(b=x(a),f):b},f.startAngle=function(a){return arguments.length?(d=x(a),f):d},f.endAngle=function(a){return arguments.length?(e=x(a),f):e},f},d3.svg.diagonal=function(){function d(d,e){var f=a.call(this,d,e),g=b.call(this,d,e),h=(f.y+g.y)/2,i=[f,{x:f.x,y:h},{x:g.x,y:h},g];return i=i.map(c),"M"+i[0]+"C"+i[1]+" "+i[2]+" "+i[3]}var a=l,b=k,c=Wd;return d.source=function(b){return arguments.length?(a=x(b),d):a},d.target=function(a){return arguments.length?(b=x(a),d):b},d.projection=function(a){return arguments.length?(c=a,d):c},d},d3.svg.diagonal.radial=function(){var a=d3.svg.diagonal(),b=Wd,c=a.projection;return a.projection=function(a){return arguments.length?c(Xd(b=a)):b},a},d3.svg.symbol=function(){function c(c,d){return(_d.get(a.call(this,c,d))||$d)(b.call(this,c,d))}var a=Zd,b=Yd;return c.type=function(b){return arguments.length?(a=x(b),c):a},c.size=function(a){return arguments.length?(b=x(a),c):b},c};var _d=d3.map({circle:$d,cross:function(a){var b=Math.sqrt(a/5)/2;return"M"+ -3*b+","+ -b+"H"+ -b+"V"+ -3*b+"H"+b+"V"+ -b+"H"+3*b+"V"+b+"H"+b+"V"+3*b+"H"+ -b+"V"+b+"H"+ -3*b+"Z"},diamond:function(a){var b=Math.sqrt(a/(2*be)),c=b*be;return"M0,"+ -b+"L"+c+",0"+" 0,"+b+" "+ -c+",0"+"Z"},square:function(a){var b=Math.sqrt(a)/2;return"M"+ -b+","+ -b+"L"+b+","+ -b+" "+b+","+b+" "+ -b+","+b+"Z"},"triangle-down":function(a){var b=Math.sqrt(a/ae),c=b*ae/2;return"M0,"+c+"L"+b+","+ -c+" "+ -b+","+ -c+"Z"},"triangle-up":function(a){var b=Math.sqrt(a/ae),c=b*ae/2;return"M0,"+ -c+"L"+b+","+c+" "+ -b+","+c+"Z"}});d3.svg.symbolTypes=_d.keys();var ae=Math.sqrt(3),be=Math.tan(30*i);d3.svg.axis=function(){function k(k){k.each(function(){var k=d3.select(this),l=h==null?a.ticks?a.ticks.apply(a,g):a.domain():h,m=i==null?a.tickFormat?a.tickFormat.apply(a,g):String:i,n=ee(a,l,j),o=k.selectAll(".minor").data(n,String),p=o.enter().insert("line","g").attr("class","tick minor").style("opacity",1e-6),q=d3.transition(o.exit()).style("opacity",1e-6).remove(),r=d3.transition(o).style("opacity",1),s=k.selectAll("g").data(l,String),t=s.enter().insert("g","path").style("opacity",1e-6),u=d3.transition(s.exit()).style("opacity",1e-6).remove(),v=d3.transition(s).style("opacity",1),w,x=Pc(a),y=k.selectAll(".domain").data([0]),z=d3.transition(y),A=a.copy(),B=this.__chart__||A;this.__chart__=A,y.enter().append("path").attr("class","domain"),t.append("line").attr("class","tick"),t.append("text");var C=t.select("line"),D=v.select("line"),E=s.select("text").text(m),F=t.select("text"),G=v.select("text");switch(b){case"bottom":w=ce,p.attr("y2",d),r.attr("x2",0).attr("y2",d),C.attr("y2",c),F.attr("y",Math.max(c,0)+f),D.attr("x2",0).attr("y2",c),G.attr("x",0).attr("y",Math.max(c,0)+f),E.attr("dy",".71em").style("text-anchor","middle"),z.attr("d","M"+x[0]+","+e+"V0H"+x[1]+"V"+e);break;case"top":w=ce,p.attr("y2",-d),r.attr("x2",0).attr("y2",-d),C.attr("y2",-c),F.attr("y",-(Math.max(c,0)+f)),D.attr("x2",0).attr("y2",-c),G.attr("x",0).attr("y",-(Math.max(c,0)+f)),E.attr("dy","0em").style("text-anchor","middle"),z.attr("d","M"+x[0]+","+ -e+"V0H"+x[1]+"V"+ -e);break;case"left":w=de,p.attr("x2",-d),r.attr("x2",-d).attr("y2",0),C.attr("x2",-c),F.attr("x",-(Math.max(c,0)+f)),D.attr("x2",-c).attr("y2",0),G.attr("x",-(Math.max(c,0)+f)).attr("y",0),E.attr("dy",".32em").style("text-anchor","end"),z.attr("d","M"+ -e+","+x[0]+"H0V"+x[1]+"H"+ -e);break;case"right":w=de,p.attr("x2",d),r.attr("x2",d).attr("y2",0),C.attr("x2",c),F.attr("x",Math.max(c,0)+f),D.attr("x2",c).attr("y2",0),G.attr("x",Math.max(c,0)+f).attr("y",0),E.attr("dy",".32em").style("text-anchor","start"),z.attr("d","M"+e+","+x[0]+"H0V"+x[1]+"H"+e)}if(a.ticks)t.call(w,B),v.call(w,A),u.call(w,A),p.call(w,B),r.call(w,A),q.call(w,A);else{var H=A.rangeBand()/2,I=function(a){return A(a)+H};t.call(w,I),v.call(w,I)}})}var a=d3.scale.linear(),b="bottom",c=6,d=6,e=6,f=3,g=[10],h=null,i,j=0;return k.scale=function(b){return arguments.length?(a=b,k):a},k.orient=function(a){return arguments.length?(b=a,k):b},k.ticks=function(){return arguments.length?(g=arguments,k):g},k.tickValues=function(a){return arguments.length?(h=a,k):h},k.tickFormat=function(a){return arguments.length?(i=a,k):i},k.tickSize=function(a,b){if(!arguments.length)return c;var f=arguments.length-1;return c=+a,d=f>1?+b:c,e=f>0?+arguments[f]:c,k},k.tickPadding=function(a){return arguments.length?(f=+a,k):f},k.tickSubdivide=function(a){return arguments.length?(j=+a,k):j},k},d3.svg.brush=function(){function g(a){a.each(function(){var a=d3.select(this),e=a.selectAll(".background").data([0]),f=a.selectAll(".extent").data([0]),l=a.selectAll(".resize").data(d,String),m;a.style("pointer-events","all").on("mousedown.brush",k).on("touchstart.brush",k),e.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),f.enter().append("rect").attr("class","extent").style("cursor","move"),l.enter().append("g").attr("class",function(a){return"resize "+a}).style("cursor",function(a){return fe[a]}).append("rect").attr("x",function(a){return/[ew]$/.test(a)?-3:null}).attr("y",function(a){return/^[ns]/.test(a)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),l.style("display",g.empty()?"none":null),l.exit().remove(),b&&(m=Pc(b),e.attr("x",m[0]).attr("width",m[1]-m[0]),i(a)),c&&(m=Pc(c),e.attr("y",m[0]).attr("height",m[1]-m[0]),j(a)),h(a)})}function h(a){a.selectAll(".resize").attr("transform",function(a){return"translate("+e[+/e$/.test(a)][0]+","+e[+/^s/.test(a)][1]+")"})}function i(a){a.select(".extent").attr("x",e[0][0]),a.selectAll(".extent,.n>rect,.s>rect").attr("width",e[1][0]-e[0][0])}function j(a){a.select(".extent").attr("y",e[0][1]),a.selectAll(".extent,.e>rect,.w>rect").attr("height",e[1][1]-e[0][1])}function k(){function x(){var a=d3.event.changedTouches;return a?d3.touches(d,a)[0]:d3.mouse(d)}function y(){d3.event.keyCode==32&&(q||(r=null,s[0]-=e[1][0],s[1]-=e[1][1],q=2),jb())}function z(){d3.event.keyCode==32&&q==2&&(s[0]+=e[1][0],s[1]+=e[1][1],q=0,jb())}function A(){var a=x(),d=!1;t&&(a[0]+=t[0],a[1]+=t[1]),q||(d3.event.altKey?(r||(r=[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2]),s[0]=e[+(a[0]<r[0])][0],s[1]=e[+(a[1]<r[1])][1]):r=null),o&&B(a,b,0)&&(i(m),d=!0),p&&B(a,c,1)&&(j(m),d=!0),d&&(h(m),l({type:"brush",mode:q?"move":"resize"}))}function B(a,b,c){var d=Pc(b),g=d[0],h=d[1],i=s[c],j=e[1][c]-e[0][c],k,l;q&&(g-=i,h-=j+i),k=Math.max(g,Math.min(h,a[c])),q?l=(k+=i)+j:(r&&(i=Math.max(g,Math.min(h,2*r[c]-k))),i<k?(l=k,k=i):l=i);if(e[0][c]!==k||e[1][c]!==l)return f=null,e[0][c]=k,e[1][c]=l,!0}function C(){A(),m.style("pointer-events","all").selectAll(".resize").style("display",g.empty()?"none":null),d3.select("body").style("cursor",null),u.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),l({type:"brushend"}),jb()}var d=this,k=d3.select(d3.event.target),l=a.of(d,arguments),m=d3.select(d),n=k.datum(),o=!/^(n|s)$/.test(n)&&b,p=!/^(e|w)$/.test(n)&&c,q=k.classed("extent"),r,s=x(),t,u=d3.select(window).on("mousemove.brush",A).on("mouseup.brush",C).on("touchmove.brush",A).on("touchend.brush",C).on("keydown.brush",y).on("keyup.brush",z);if(q)s[0]=e[0][0]-s[0],s[1]=e[0][1]-s[1];else if(n){var v=+/w$/.test(n),w=+/^n/.test(n);t=[e[1-v][0]-s[0],e[1-w][1]-s[1]],s[0]=e[v][0],s[1]=e[w][1]}else d3.event.altKey&&(r=s.slice());m.style("pointer-events","none").selectAll(".resize").style("display",null),d3.select("body").style("cursor",k.style("cursor")),l({type:"brushstart"}),A(),jb()}var a=lb(g,"brushstart","brush","brushend"),b=null,c=null,d=ge[0],e=[[0,0],[0,0]],f;return g.x=function(a){return arguments.length?(b=a,d=ge[!b<<1|!c],g):b},g.y=function(a){return arguments.length?(c=a,d=ge[!b<<1|!c],g):c},g.extent=function(a){var d,h,i,j,k;return arguments.length?(f=[[0,0],[0,0]],b&&(d=a[0],h=a[1],c&&(d=d[0],h=h[0]),f[0][0]=d,f[1][0]=h,b.invert&&(d=b(d),h=b(h)),h<d&&(k=d,d=h,h=k),e[0][0]=d|0,e[1][0]=h|0),c&&(i=a[0],j=a[1],b&&(i=i[1],j=j[1]),f[0][1]=i,f[1][1]=j,c.invert&&(i=c(i),j=c(j)),j<i&&(k=i,i=j,j=k),e[0][1]=i|0,e[1][1]=j|0),g):(a=f||e,b&&(d=a[0][0],h=a[1][0],f||(d=e[0][0],h=e[1][0],b.invert&&(d=b.invert(d),h=b.invert(h)),h<d&&(k=d,d=h,h=k))),c&&(i=a[0][1],j=a[1][1],f||(i=e[0][1],j=e[1][1],c.invert&&(i=c.invert(i),j=c.invert(j)),j<i&&(k=i,i=j,j=k))),b&&c?[[d,i],[h,j]]:b?[d,h]:c&&[i,j])},g.clear=function(){return f=null,e[0][0]=e[0][1]=e[1][0]=e[1][1]=0,g},g.empty=function(){return b&&e[0][0]===e[1][0]||c&&e[0][1]===e[1][1]},d3.rebind(g,a,"on")};var fe={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},ge=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]];d3.behavior={},d3.behavior.drag=function(){function c(){this.on("mousedown.drag",d).on("touchstart.drag",d)}function d(){function k(){var a=c.parentNode;return f!=null?d3.touches(a).filter(function(a){return a.identifier===f})[0]:d3.mouse(a)}function l(){if(!c.parentNode)return m();var a=k(),b=a[0]-h[0],e=a[1]-h[1];i|=b|e,h=a,jb(),d({type:"drag",x:a[0]+g[0],y:a[1]+g[1],dx:b,dy:e})}function m(){d({type:"dragend"}),i&&(jb(),d3.event.target===e&&j.on("click.drag",n,!0)),j.on(f!=null?"touchmove.drag-"+f:"mousemove.drag",null).on(f!=null?"touchend.drag-"+f:"mouseup.drag",null)}function n(){jb(),j.on("click.drag",null)}var c=this,d=a.of(c,arguments),e=d3.event.target,f=d3.event.touches?d3.event.changedTouches[0].identifier:null,g,h=k(),i=0,j=d3.select(window).on(f!=null?"touchmove.drag-"+f:"mousemove.drag",l).on(f!=null?"touchend.drag-"+f:"mouseup.drag",m,!0);b?(g=b.apply(c,arguments),g=[g.x-h[0],g.y-h[1]]):g=[0,0],f==null&&jb(),d({type:"dragstart"})}var a=lb(c,"drag","dragstart","dragend"),b=null;return c.origin=function(a){return arguments.length?(b=a,c):b},d3.rebind(c,a,"on")},d3.behavior.zoom=function(){function l(){this.on("mousedown.zoom",s).on("mousewheel.zoom",t).on("mousemove.zoom",u).on("DOMMouseScroll.zoom",t).on("dblclick.zoom",v).on("touchstart.zoom",w).on("touchmove.zoom",x).on("touchend.zoom",w)}function m(b){return[(b[0]-a[0])/c,(b[1]-a[1])/c]}function n(b){return[b[0]*c+a[0],b[1]*c+a[1]]}function o(a){c=Math.max(e[0],Math.min(e[1],a))}function p(b,c){c=n(c),a[0]+=b[0]-c[0],a[1]+=b[1]-c[1]}function q(){h&&h.domain(g.range().map(function(b){return(b-a[0])/c}).map(g.invert)),j&&j.domain(i.range().map(function(b){return(b-a[1])/c}).map(i.invert))}function r(b){q(),d3.event.preventDefault(),b({type:"zoom",scale:c,translate:a})}function s(){function h(){d=1,p(d3.mouse(a),g),r(b)}function i(){d&&jb(),e.on("mousemove.zoom",null).on("mouseup.zoom",null),d&&d3.event.target===c&&e.on("click.zoom",j,!0)}function j(){jb(),e.on("click.zoom",null)}var a=this,b=f.of(a,arguments),c=d3.event.target,d=0,e=d3.select(window).on("mousemove.zoom",h).on("mouseup.zoom",i),g=m(d3.mouse(a));window.focus(),jb()}function t(){b||(b=m(d3.mouse(this))),o(Math.pow(2,je()*.002)*c),p(d3.mouse(this),b),r(f.of(this,arguments))}function u(){b=null}function v(){var a=d3.mouse(this),b=m(a),d=Math.log(c)/Math.LN2;o(Math.pow(2,d3.event.shiftKey?Math.ceil(d)-1:Math.floor(d)+1)),p(a,b),r(f.of(this,arguments))}function w(){var a=d3.touches(this),e=Date.now();d=c,b={},a.forEach(function(a){b[a.identifier]=m(a)}),jb();if(a.length===1){if(e-k<500){var g=a[0],h=m(a[0]);o(c*2),p(g,h),r(f.of(this,arguments))}k=e}}function x(){var a=d3.touches(this),c=a[0],e=b[c.identifier];if(g=a[1]){var g,h=b[g.identifier];c=[(c[0]+g[0])/2,(c[1]+g[1])/2],e=[(e[0]+h[0])/2,(e[1]+h[1])/2],o(d3.event.scale*d)}p(c,e),k=null,r(f.of(this,arguments))}var a=[0,0],b,c=1,d,e=ie,f=lb(l,"zoom"),g,h,i,j,k;return l.translate=function(b){return arguments.length?(a=b.map(Number),q(),l):a},l.scale=function(a){return arguments.length?(c=+a,q(),l):c},l.scaleExtent=function(a){return arguments.length?(e=a==null?ie:a.map(Number),l):e},l.x=function(b){return arguments.length?(h=b,g=b.copy(),a=[0,0],c=1,l):h},l.y=function(b){return arguments.length?(j=b,i=b.copy(),a=[0,0],c=1,l):j},d3.rebind(l,f,"on")};var he,ie=[0,Infinity];d3.layout={},d3.layout.bundle=function(){return function(a){var b=[],c=-1,d=a.length;while(++c<d)b.push(ke(a[c]));return b}},d3.layout.chord=function(){function k(){var a={},k=[],m=d3.range(e),n=[],o,p,q,r,s;b=[],c=[],o=0,r=-1;while(++r<e){p=0,s=-1;while(++s<e)p+=d[r][s];k.push(p),n.push(d3.range(e)),o+=p}h&&m.sort(function(a,b){return h(k[a],k[b])}),i&&n.forEach(function(a,b){a.sort(function(a,c){return i(d[b][a],d[b][c])})}),o=(2*g-f*e)/o,p=0,r=-1;while(++r<e){q=p,s=-1;while(++s<e){var t=m[r],u=n[t][s],v=d[t][u],w=p,x=p+=v*o;a[t+"-"+u]={index:t,subindex:u,startAngle:w,endAngle:x,value:v}}c[t]={index:t,startAngle:q,endAngle:p,value:(p-q)/o},p+=f}r=-1;while(++r<e){s=r-1;while(++s<e){var y=a[r+"-"+s],z=a[s+"-"+r];(y.value||z.value)&&b.push(y.value<z.value?{source:z,target:y}:{source:y,target:z})}}j&&l()}function l(){b.sort(function(a,b){return j((a.source.value+a.target.value)/2,(b.source.value+b.target.value)/2)})}var a={},b,c,d,e,f=0,h,i,j;return a.matrix=function(f){return arguments.length?(e=(d=f)&&d.length,b=c=null,a):d},a.padding=function(d){return arguments.length?(f=d,b=c=null,a):f},a.sortGroups=function(d){return arguments.length?(h=d,b=c=null,a):h},a.sortSubgroups=function(c){return arguments.length?(i=c,b=null,a):i},a.sortChords=function(c){return arguments.length?(j=c,b&&l(),a):j},a.chords=function(){return b||k(),b},a.groups=function(){return c||k(),c},a},d3.layout.force=function(){function q(a){return function(b,c,d,e){if(b.point!==a){var f=b.cx-a.x,g=b.cy-a.y,h=1/Math.sqrt(f*f+g*g);if((e-c)*h<k){var i=b.charge*h*h;return a.px-=f*i,a.py-=g*i,!0}if(b.point&&isFinite(h)){var i=b.pointCharge*h*h;a.px-=f*i,a.py-=g*i}}return!b.charge}}function r(b){b.px=d3.event.x,b.py=d3.event.y,a.resume()}var a={},b=d3.dispatch("start","tick","end"),c=[1,1],d,e,f=.9,g=se,h=te,i=-30,j=.1,k=.8,l=[],m=[],n,o,p;return a.tick=function(){if((e*=.99)<.005)return b.end({type:"end",alpha:e=0}),!0;var a=l.length,d=m.length,g,h,k,r,s,t,u,v,w;for(h=0;h<d;++h){k=m[h],r=k.source,s=k.target,v=s.x-r.x,w=s.y-r.y;if(t=v*v+w*w)t=e*o[h]*((t=Math.sqrt(t))-n[h])/t,v*=t,w*=t,s.x-=v*(u=r.weight/(s.weight+r.weight)),s.y-=w*u,r.x+=v*(u=1-u),r.y+=w*u}if(u=e*j){v=c[0]/2,w=c[1]/2,h=-1;if(u)while(++h<a)k=l[h],k.x+=(v-k.x)*u,k.y+=(w-k.y)*u}if(
i){re(g=d3.geom.quadtree(l),e,p),h=-1;while(++h<a)(k=l[h]).fixed||g.visit(q(k))}h=-1;while(++h<a)k=l[h],k.fixed?(k.x=k.px,k.y=k.py):(k.x-=(k.px-(k.px=k.x))*f,k.y-=(k.py-(k.py=k.y))*f);b.tick({type:"tick",alpha:e})},a.nodes=function(b){return arguments.length?(l=b,a):l},a.links=function(b){return arguments.length?(m=b,a):m},a.size=function(b){return arguments.length?(c=b,a):c},a.linkDistance=function(b){return arguments.length?(g=x(b),a):g},a.distance=a.linkDistance,a.linkStrength=function(b){return arguments.length?(h=x(b),a):h},a.friction=function(b){return arguments.length?(f=b,a):f},a.charge=function(b){return arguments.length?(i=typeof b=="function"?b:+b,a):i},a.gravity=function(b){return arguments.length?(j=b,a):j},a.theta=function(b){return arguments.length?(k=b,a):k},a.alpha=function(c){return arguments.length?(e?c>0?e=c:e=0:c>0&&(b.start({type:"start",alpha:e=c}),d3.timer(a.tick)),a):e},a.start=function(){function s(a,c){var d=t(b),e=-1,f=d.length,g;while(++e<f)if(!isNaN(g=d[e][a]))return g;return Math.random()*c}function t(){if(!q){q=[];for(d=0;d<e;++d)q[d]=[];for(d=0;d<f;++d){var a=m[d];q[a.source.index].push(a.target),q[a.target.index].push(a.source)}}return q[b]}var b,d,e=l.length,f=m.length,j=c[0],k=c[1],q,r;for(b=0;b<e;++b)(r=l[b]).index=b,r.weight=0;n=[],o=[];for(b=0;b<f;++b)r=m[b],typeof r.source=="number"&&(r.source=l[r.source]),typeof r.target=="number"&&(r.target=l[r.target]),n[b]=g.call(this,r,b),o[b]=h.call(this,r,b),++r.source.weight,++r.target.weight;for(b=0;b<e;++b)r=l[b],isNaN(r.x)&&(r.x=s("x",j)),isNaN(r.y)&&(r.y=s("y",k)),isNaN(r.px)&&(r.px=r.x),isNaN(r.py)&&(r.py=r.y);p=[];if(typeof i=="function")for(b=0;b<e;++b)p[b]=+i.call(this,l[b],b);else for(b=0;b<e;++b)p[b]=i;return a.resume()},a.resume=function(){return a.alpha(.1)},a.stop=function(){return a.alpha(0)},a.drag=function(){d||(d=d3.behavior.drag().origin(v).on("dragstart",ne).on("drag",r).on("dragend",oe)),this.on("mouseover.force",pe).on("mouseout.force",qe).call(d)},d3.rebind(a,b,"on")},d3.layout.partition=function(){function c(a,b,d,e){var f=a.children;a.x=b,a.y=a.depth*e,a.dx=d,a.dy=e;if(f&&(h=f.length)){var g=-1,h,i,j;d=a.value?d/a.value:0;while(++g<h)c(i=f[g],b,j=i.value*d,e),b+=j}}function d(a){var b=a.children,c=0;if(b&&(f=b.length)){var e=-1,f;while(++e<f)c=Math.max(c,d(b[e]))}return 1+c}function e(e,f){var g=a.call(this,e,f);return c(g[0],0,b[0],b[1]/d(g[0])),g}var a=d3.layout.hierarchy(),b=[1,1];return e.size=function(a){return arguments.length?(b=a,e):b},Ie(e,a)},d3.layout.pie=function(){function e(f){var g=f.map(function(b,c){return+a.call(e,b,c)}),h=+(typeof c=="function"?c.apply(this,arguments):c),i=((typeof d=="function"?d.apply(this,arguments):d)-c)/d3.sum(g),j=d3.range(f.length);b!=null&&j.sort(b===ue?function(a,b){return g[b]-g[a]}:function(a,c){return b(f[a],f[c])});var k=[];return j.forEach(function(a){var b;k[a]={data:f[a],value:b=g[a],startAngle:h,endAngle:h+=b*i}}),k}var a=Number,b=ue,c=0,d=2*g;return e.value=function(b){return arguments.length?(a=b,e):a},e.sort=function(a){return arguments.length?(b=a,e):b},e.startAngle=function(a){return arguments.length?(c=a,e):c},e.endAngle=function(a){return arguments.length?(d=a,e):d},e};var ue={};d3.layout.stack=function(){function g(h,i){var j=h.map(function(b,c){return a.call(g,b,c)}),k=j.map(function(a){return a.map(function(a,b){return[e.call(g,a,b),f.call(g,a,b)]})}),l=b.call(g,k,i);j=d3.permute(j,l),k=d3.permute(k,l);var m=c.call(g,k,i),n=j.length,o=j[0].length,p,q,r;for(q=0;q<o;++q){d.call(g,j[0][q],r=m[q],k[0][q][1]);for(p=1;p<n;++p)d.call(g,j[p][q],r+=k[p-1][q][1],k[p][q][1])}return h}var a=v,b=Ae,c=Be,d=xe,e=ve,f=we;return g.values=function(b){return arguments.length?(a=b,g):a},g.order=function(a){return arguments.length?(b=typeof a=="function"?a:ye.get(a)||Ae,g):b},g.offset=function(a){return arguments.length?(c=typeof a=="function"?a:ze.get(a)||Be,g):c},g.x=function(a){return arguments.length?(e=a,g):e},g.y=function(a){return arguments.length?(f=a,g):f},g.out=function(a){return arguments.length?(d=a,g):d},g};var ye=d3.map({"inside-out":function(a){var b=a.length,c,d,e=a.map(Ce),f=a.map(De),g=d3.range(b).sort(function(a,b){return e[a]-e[b]}),h=0,i=0,j=[],k=[];for(c=0;c<b;++c)d=g[c],h<i?(h+=f[d],j.push(d)):(i+=f[d],k.push(d));return k.reverse().concat(j)},reverse:function(a){return d3.range(a.length).reverse()},"default":Ae}),ze=d3.map({silhouette:function(a){var b=a.length,c=a[0].length,d=[],e=0,f,g,h,i=[];for(g=0;g<c;++g){for(f=0,h=0;f<b;f++)h+=a[f][g][1];h>e&&(e=h),d.push(h)}for(g=0;g<c;++g)i[g]=(e-d[g])/2;return i},wiggle:function(a){var b=a.length,c=a[0],d=c.length,e,f,g,h,i,j,k,l,m,n=[];n[0]=l=m=0;for(f=1;f<d;++f){for(e=0,h=0;e<b;++e)h+=a[e][f][1];for(e=0,i=0,k=c[f][0]-c[f-1][0];e<b;++e){for(g=0,j=(a[e][f][1]-a[e][f-1][1])/(2*k);g<e;++g)j+=(a[g][f][1]-a[g][f-1][1])/k;i+=j*a[e][f][1]}n[f]=l-=h?i/h*k:0,l<m&&(m=l)}for(f=0;f<d;++f)n[f]-=m;return n},expand:function(a){var b=a.length,c=a[0].length,d=1/b,e,f,g,h=[];for(f=0;f<c;++f){for(e=0,g=0;e<b;e++)g+=a[e][f][1];if(g)for(e=0;e<b;e++)a[e][f][1]/=g;else for(e=0;e<b;e++)a[e][f][1]=d}for(f=0;f<c;++f)h[f]=0;return h},zero:Be});d3.layout.histogram=function(){function e(e,f){var g=[],h=e.map(b,this),i=c.call(this,h,f),j=d.call(this,i,h,f),k,f=-1,l=h.length,m=j.length-1,n=a?1:1/l,o;while(++f<m)k=g[f]=[],k.dx=j[f+1]-(k.x=j[f]),k.y=0;if(m>0){f=-1;while(++f<l)o=h[f],o>=i[0]&&o<=i[1]&&(k=g[d3.bisect(j,o,1,m)-1],k.y+=n,k.push(e[f]))}return g}var a=!0,b=Number,c=He,d=Fe;return e.value=function(a){return arguments.length?(b=a,e):b},e.range=function(a){return arguments.length?(c=x(a),e):c},e.bins=function(a){return arguments.length?(d=typeof a=="number"?function(b){return Ge(b,a)}:x(a),e):d},e.frequency=function(b){return arguments.length?(a=!!b,e):a},e},d3.layout.hierarchy=function(){function d(e,g,h){var i=b.call(f,e,g);e.depth=g,h.push(e);if(i&&(k=i.length)){var j=-1,k,l=e.children=[],m=0,n=g+1,o;while(++j<k)o=d(i[j],n,h),o.parent=e,l.push(o),m+=o.value;a&&l.sort(a),c&&(e.value=m)}else c&&(e.value=+c.call(f,e,g)||0);return e}function e(a,b){var d=a.children,g=0;if(d&&(i=d.length)){var h=-1,i,j=b+1;while(++h<i)g+=e(d[h],j)}else c&&(g=+c.call(f,a,b)||0);return c&&(a.value=g),g}function f(a){var b=[];return d(a,0,b),b}var a=Le,b=Je,c=Ke;return f.sort=function(b){return arguments.length?(a=b,f):a},f.children=function(a){return arguments.length?(b=a,f):b},f.value=function(a){return arguments.length?(c=a,f):c},f.revalue=function(a){return e(a,0),a},f},d3.layout.pack=function(){function d(d,e){var f=a.call(this,d,e),g=f[0];g.x=0,g.y=0,ff(g,function(a){a.r=Math.sqrt(a.value)}),ff(g,Re);var h=c[0],i=c[1],j=Math.max(2*g.r/h,2*g.r/i);if(b>0){var k=b*j/2;ff(g,function(a){a.r+=k}),ff(g,Re),ff(g,function(a){a.r-=k}),j=Math.max(2*g.r/h,2*g.r/i)}return Ue(g,h/2,i/2,1/j),f}var a=d3.layout.hierarchy().sort(Ne),b=0,c=[1,1];return d.size=function(a){return arguments.length?(c=a,d):c},d.padding=function(a){return arguments.length?(b=+a,d):b},Ie(d,a)},d3.layout.cluster=function(){function d(d,e){var f=a.call(this,d,e),g=f[0],h,i=0;ff(g,function(a){var c=a.children;c&&c.length?(a.x=Xe(c),a.y=We(c)):(a.x=h?i+=b(a,h):0,a.y=0,h=a)});var j=Ye(g),k=Ze(g),l=j.x-b(j,k)/2,m=k.x+b(k,j)/2;return ff(g,function(a){a.x=(a.x-l)/(m-l)*c[0],a.y=(1-(g.y?a.y/g.y:1))*c[1]}),f}var a=d3.layout.hierarchy().sort(null).value(null),b=$e,c=[1,1];return d.separation=function(a){return arguments.length?(b=a,d):b},d.size=function(a){return arguments.length?(c=a,d):c},Ie(d,a)},d3.layout.tree=function(){function d(d,e){function h(a,c){var d=a.children,e=a._tree;if(d&&(f=d.length)){var f,g=d[0],i,k=g,l,m=-1;while(++m<f)l=d[m],h(l,i),k=j(l,i,k),i=l;gf(a);var n=.5*(g._tree.prelim+l._tree.prelim);c?(e.prelim=c._tree.prelim+b(a,c),e.mod=e.prelim-n):e.prelim=n}else c&&(e.prelim=c._tree.prelim+b(a,c))}function i(a,b){a.x=a._tree.prelim+b;var c=a.children;if(c&&(e=c.length)){var d=-1,e;b+=a._tree.mod;while(++d<e)i(c[d],b)}}function j(a,c,d){if(c){var e=a,f=a,g=c,h=a.parent.children[0],i=e._tree.mod,j=f._tree.mod,k=g._tree.mod,l=h._tree.mod,m;while(g=af(g),e=_e(e),g&&e)h=_e(h),f=af(f),f._tree.ancestor=a,m=g._tree.prelim+k-e._tree.prelim-i+b(g,e),m>0&&(hf(jf(g,a,d),a,m),i+=m,j+=m),k+=g._tree.mod,i+=e._tree.mod,l+=h._tree.mod,j+=f._tree.mod;g&&!af(f)&&(f._tree.thread=g,f._tree.mod+=k-j),e&&!_e(h)&&(h._tree.thread=e,h._tree.mod+=i-l,d=a)}return d}var f=a.call(this,d,e),g=f[0];ff(g,function(a,b){a._tree={ancestor:a,prelim:0,mod:0,change:0,shift:0,number:b?b._tree.number+1:0}}),h(g),i(g,-g._tree.prelim);var k=bf(g,df),l=bf(g,cf),m=bf(g,ef),n=k.x-b(k,l)/2,o=l.x+b(l,k)/2,p=m.depth||1;return ff(g,function(a){a.x=(a.x-n)/(o-n)*c[0],a.y=a.depth/p*c[1],delete a._tree}),f}var a=d3.layout.hierarchy().sort(null).value(null),b=$e,c=[1,1];return d.separation=function(a){return arguments.length?(b=a,d):b},d.size=function(a){return arguments.length?(c=a,d):c},Ie(d,a)},d3.layout.treemap=function(){function j(a,b){var c=-1,d=a.length,e,f;while(++c<d)f=(e=a[c]).value*(b<0?0:b),e.area=isNaN(f)||f<=0?0:f}function k(a){var b=a.children;if(b&&b.length){var c=e(a),d=[],f=b.slice(),g,i=Infinity,l,o=h==="slice"?c.dx:h==="dice"?c.dy:h==="slice-dice"?a.depth&1?c.dy:c.dx:Math.min(c.dx,c.dy),p;j(f,c.dx*c.dy/a.value),d.area=0;while((p=f.length)>0)d.push(g=f[p-1]),d.area+=g.area,h!=="squarify"||(l=m(d,o))<=i?(f.pop(),i=l):(d.area-=d.pop().area,n(d,o,c,!1),o=Math.min(c.dx,c.dy),d.length=d.area=0,i=Infinity);d.length&&(n(d,o,c,!0),d.length=d.area=0),b.forEach(k)}}function l(a){var b=a.children;if(b&&b.length){var c=e(a),d=b.slice(),f,g=[];j(d,c.dx*c.dy/a.value),g.area=0;while(f=d.pop())g.push(f),g.area+=f.area,f.z!=null&&(n(g,f.z?c.dx:c.dy,c,!d.length),g.length=g.area=0);b.forEach(l)}}function m(a,b){var c=a.area,d,e=0,f=Infinity,g=-1,h=a.length;while(++g<h){if(!(d=a[g].area))continue;d<f&&(f=d),d>e&&(e=d)}return c*=c,b*=b,c?Math.max(b*e*i/c,c/(b*f*i)):Infinity}function n(a,c,d,e){var f=-1,g=a.length,h=d.x,i=d.y,j=c?b(a.area/c):0,k;if(c==d.dx){if(e||j>d.dy)j=d.dy;while(++f<g)k=a[f],k.x=h,k.y=i,k.dy=j,h+=k.dx=Math.min(d.x+d.dx-h,j?b(k.area/j):0);k.z=!0,k.dx+=d.x+d.dx-h,d.y+=j,d.dy-=j}else{if(e||j>d.dx)j=d.dx;while(++f<g)k=a[f],k.x=h,k.y=i,k.dx=j,i+=k.dy=Math.min(d.y+d.dy-i,j?b(k.area/j):0);k.z=!1,k.dy+=d.y+d.dy-i,d.x+=j,d.dx-=j}}function o(b){var d=g||a(b),e=d[0];return e.x=0,e.y=0,e.dx=c[0],e.dy=c[1],g&&a.revalue(e),j([e],e.dx*e.dy/e.value),(g?l:k)(e),f&&(g=d),d}var a=d3.layout.hierarchy(),b=Math.round,c=[1,1],d=null,e=kf,f=!1,g,h="squarify",i=.5*(1+Math.sqrt(5));return o.size=function(a){return arguments.length?(c=a,o):c},o.padding=function(a){function b(b){var c=a.call(o,b,b.depth);return c==null?kf(b):lf(b,typeof c=="number"?[c,c,c,c]:c)}function c(b){return lf(b,a)}if(!arguments.length)return d;var f;return e=(d=a)==null?kf:(f=typeof a)==="function"?b:f==="number"?(a=[a,a,a,a],c):c,o},o.round=function(a){return arguments.length?(b=a?Math.round:Number,o):b!=Number},o.sticky=function(a){return arguments.length?(f=a,g=null,o):f},o.ratio=function(a){return arguments.length?(i=a,o):i},o.mode=function(a){return arguments.length?(h=a+"",o):h},Ie(o,a)},d3.csv=mf(",","text/csv"),d3.tsv=mf("	","text/tab-separated-values"),d3.geo={},d3.geo.stream=function(a,b){of.hasOwnProperty(a.type)?of[a.type](a,b):nf(a,b)};var of={Feature:function(a,b){nf(a.geometry,b)},FeatureCollection:function(a,b){var c=a.features,d=-1,e=c.length;while(++d<e)nf(c[d].geometry,b)}},pf={Sphere:function(a,b){b.sphere()},Point:function(a,b){var c=a.coordinates;b.point(c[0],c[1])},MultiPoint:function(a,b){var c=a.coordinates,d=-1,e=c.length,f;while(++d<e)f=c[d],b.point(f[0],f[1])},LineString:function(a,b){qf(a.coordinates,b,0)},MultiLineString:function(a,b){var c=a.coordinates,d=-1,e=c.length;while(++d<e)qf(c[d],b,0)},Polygon:function(a,b){rf(a.coordinates,b)},MultiPolygon:function(a,b){var c=a.coordinates,d=-1,e=c.length;while(++d<e)rf(c[d],b)},GeometryCollection:function(a,b){var c=a.geometries,d=-1,e=c.length;while(++d<e)nf(c[d],b)}};d3.geo.albersUsa=function(){function e(a){return f(a)(a)}function f(e){var f=e[0],g=e[1];return g>50?b:f<-140?c:g<21?d:a}var a=d3.geo.albers(),b=d3.geo.albers().rotate([160,0]).center([0,60]).parallels([55,65]),c=d3.geo.albers().rotate([160,0]).center([0,20]).parallels([8,18]),d=d3.geo.albers().rotate([60,0]).center([0,10]).parallels([8,18]);return e.scale=function(f){return arguments.length?(a.scale(f),b.scale(f*.6),c.scale(f),d.scale(f*1.5),e.translate(a.translate())):a.scale()},e.translate=function(f){if(!arguments.length)return a.translate();var g=a.scale(),h=f[0],i=f[1];return a.translate(f),b.translate([h-.4*g,i+.17*g]),c.translate([h-.19*g,i+.2*g]),d.translate([h+.58*g,i+.43*g]),e},e.scale(a.scale())},(d3.geo.albers=function(){var a=29.5*i,b=45.5*i,c=Bg(Bf),d=c(a,b);return d.parallels=function(d){return arguments.length?c(a=d[0]*i,b=d[1]*i):[a*j,b*j]},d.rotate([98,0]).center([0,38]).scale(1e3)}).raw=Bf;var Cf=Ig(function(a){return Math.sqrt(2/(1+a))},function(a){return 2*Math.asin(a/2)});(d3.geo.azimuthalEqualArea=function(){return Ag(Cf)}).raw=Cf;var Df=Ig(function(a){var b=Math.acos(a);return b&&b/Math.sin(b)},v);(d3.geo.azimuthalEquidistant=function(){return Ag(Df)}).raw=Df,d3.geo.bounds=Ef(v),d3.geo.centroid=function(a){Ff=Gf=Hf=If=Jf=0,d3.geo.stream(a,Kf);var b;if(Gf&&Math.abs(b=Math.sqrt(Hf*Hf+If*If+Jf*Jf))>h)return[Math.atan2(If,Hf)*j,Math.asin(Math.max(-1,Math.min(1,Jf/b)))*j]};var Ff,Gf,Hf,If,Jf,Kf={sphere:function(){Ff<2&&(Ff=2,Gf=Hf=If=Jf=0)},point:Lf,lineStart:Nf,lineEnd:Of,polygonStart:function(){Ff<2&&(Ff=2,Gf=Hf=If=Jf=0),Kf.lineStart=Mf},polygonEnd:function(){Kf.lineStart=Nf}};d3.geo.circle=function(){function e(){var b=typeof a=="function"?a.apply(this,arguments):a,c=Dg(-b[0]*i,-b[1]*i,0).invert,e=[];return d(null,null,1,{point:function(a,b){e.push(a=c(a,b)),a[0]*=j,a[1]*=j}}),{type:"Polygon",coordinates:[e]}}var a=[0,0],b,c=6,d;return e.origin=function(b){return arguments.length?(a=b,e):a},e.angle=function(a){return arguments.length?(d=Pf((b=+a)*i,c*i),e):b},e.precision=function(a){return arguments.length?(d=Pf(b*i,(c=+a)*i),e):c},e.angle(90)};var Yf=Rf(w,Zf,_f);(d3.geo.equirectangular=function(){return Ag(cg).scale(250/g)}).raw=cg.invert=cg;var dg=Ig(function(a){return 1/a},Math.atan);(d3.geo.gnomonic=function(){return Ag(dg)}).raw=dg,d3.geo.graticule=function(){function k(){return{type:"MultiLineString",coordinates:l()}}function l(){return d3.range(Math.ceil(b/e)*e,a,e).map(g).concat(d3.range(Math.ceil(d/f)*f,c,f).map(i))}var a,b,c,d,e=22.5,f=e,g,i,j=2.5;return k.lines=function(){return l().map(function(a){return{type:"LineString",coordinates:a}})},k.outline=function(){return{type:"Polygon",coordinates:[g(b).concat(i(c).slice(1),g(a).reverse().slice(1),i(d).reverse().slice(1))]}},k.extent=function(e){return arguments.length?(b=+e[0][0],a=+e[1][0],d=+e[0][1],c=+e[1][1],b>a&&(e=b,b=a,a=e),d>c&&(e=d,d=c,c=e),k.precision(j)):[[b,d],[a,c]]},k.step=function(a){return arguments.length?(e=+a[0],f=+a[1],k):[e,f]},k.precision=function(e){return arguments.length?(j=+e,g=eg(d,c,j),i=fg(b,a,j),k):j},k.extent([[-180+h,-90+h],[180-h,90-h]])},d3.geo.interpolate=function(a,b){return gg(a[0]*i,a[1]*i,b[0]*i,b[1]*i)},d3.geo.greatArc=function(){function g(){var g=b||a.apply(this,arguments),h=d||c.apply(this,arguments),i=f||d3.geo.interpolate(g,h),j=0,k=e/i.distance,l=[g];while((j+=k)<1)l.push(i(j));return l.push(h),{type:"LineString",coordinates:l}}var a=l,b,c=k,d,e=6*i,f;return g.distance=function(){return(f||d3.geo.interpolate(b||a.apply(this,arguments),d||c.apply(this,arguments))).distance},g.source=function(c){return arguments.length?(a=c,b=typeof c=="function"?null:c,f=b&&d?d3.geo.interpolate(b,d):null,g):a},g.target=function(a){return arguments.length?(c=a,d=typeof a=="function"?null:a,f=b&&d?d3.geo.interpolate(b,d):null,g):c},g.precision=function(a){return arguments.length?(e=a*i,g):e/i},g},hg.invert=function(a,b){return[2*g*a,2*Math.atan(Math.exp(2*g*b))-g/2]},(d3.geo.mercator=function(){return Ag(hg).scale(500)}).raw=hg;var ig=Ig(function(){return 1},Math.asin);(d3.geo.orthographic=function(){return Ag(ig)}).raw=ig,d3.geo.path=function(){function f(b){return b&&d3.geo.stream(b,d(e.pointRadius(typeof a=="function"?+a.apply(this,arguments):a))),e.result()}var a=4.5,b,c,d,e;return f.area=function(a){return ng=0,d3.geo.stream(a,d(pg)),ng},f.centroid=function(a){return Ff=Hf=If=Jf=0,d3.geo.stream(a,d(rg)),Jf?[Hf/Jf,If/Jf]:undefined},f.bounds=function(a){return Ef(d)(a)},f.projection=function(a){return arguments.length?(d=(b=a)?a.stream||kg(a):v,f):b},f.context=function(a){return arguments.length?(e=(c=a)==null?new lg:new mg(a),f):c},f.pointRadius=function(b){return arguments.length?(a=typeof b=="function"?b:+b,f):a},f.projection(d3.geo.albersUsa()).context(null)};var ng,og,pg={point:Nc,lineStart:Nc,lineEnd:Nc,polygonStart:function(){og=0,pg.lineStart=qg},polygonEnd:function(){pg.lineStart=pg.lineEnd=pg.point=Nc,ng+=Math.abs(og/2)}},rg={point:sg,lineStart:tg,lineEnd:ug,polygonStart:function(){rg.lineStart=vg},polygonEnd:function(){rg.point=sg,rg.lineStart=tg,rg.lineEnd=ug}};d3.geo.area=function(a){return wg=0,d3.geo.stream(a,yg),wg};var wg,xg,yg={sphere:function(){wg+=4*g},point:Nc,lineStart:Nc,lineEnd:Nc,polygonStart:function(){xg=0,yg.lineStart=zg},polygonEnd:function(){wg+=xg<0?4*g+xg:xg,yg.lineStart=yg.lineEnd=yg.point=Nc}};d3.geo.projection=Ag,d3.geo.projectionMutator=Bg;var Hg=Ig(function(a){return 1/(1+a)},function(a){return 2*Math.atan(a)});(d3.geo.stereographic=function(){return Ag(Hg)}).raw=Hg,d3.geom={},d3.geom.hull=function(a){if(a.length<3)return[];var b=a.length,c=b-1,d=[],e=[],f,g,h=0,i,j,k,l,m,n,o,p;for(f=1;f<b;++f)a[f][1]<a[h][1]?h=f:a[f][1]==a[h][1]&&(h=a[f][0]<a[h][0]?f:h);for(f=0;f<b;++f){if(f===h)continue;j=a[f][1]-a[h][1],i=a[f][0]-a[h][0],d.push({angle:Math.atan2(j,i),index:f})}d.sort(function(a,b){return a.angle-b.angle}),o=d[0].angle,n=d[0].index,m=0;for(f=1;f<c;++f)g=d[f].index,o==d[f].angle?(i=a[n][0]-a[h][0],j=a[n][1]-a[h][1],k=a[g][0]-a[h][0],l=a[g][1]-a[h][1],i*i+j*j>=k*k+l*l?d[f].index=-1:(d[m].index=-1,o=d[f].angle,m=f,n=g)):(o=d[f].angle,m=f,n=g);e.push(h);for(f=0,g=0;f<2;++g)d[g].index!==-1&&(e.push(d[g].index),f++);p=e.length;for(;g<c;++g){if(d[g].index===-1)continue;while(!Jg(e[p-2],e[p-1],d[g].index,a))--p;e[p++]=d[g].index}var q=[];for(f=0;f<p;++f)q.push(a[e[f]]);return q},d3.geom.polygon=function(a){return a.area=function(){var b=0,c=a.length,d=a[c-1][1]*a[0][0]-a[c-1][0]*a[0][1];while(++b<c)d+=a[b-1][1]*a[b][0]-a[b-1][0]*a[b][1];return d*.5},a.centroid=function(b){var c=-1,d=a.length,e=0,f=0,g,h=a[d-1],i;arguments.length||(b=-1/(6*a.area()));while(++c<d)g=h,h=a[c],i=g[0]*h[1]-h[0]*g[1],e+=(g[0]+h[0])*i,f+=(g[1]+h[1])*i;return[e*b,f*b]},a.clip=function(b){var c,d=-1,e=a.length,f,g,h=a[e-1],i,j,k;while(++d<e){c=b.slice(),b.length=0,i=a[d],j=c[(g=c.length)-1],f=-1;while(++f<g)k=c[f],Kg(k,h,i)?(Kg(j,h,i)||b.push(Lg(j,k,h,i)),b.push(k)):Kg(j,h,i)&&b.push(Lg(j,k,h,i)),j=k;h=i}return b},a},d3.geom.voronoi=function(a){var b=a.map(function(){return[]}),c=1e6;return Ng(a,function(a){var d,e,f,g,h,i;a.a===1&&a.b>=0?(d=a.ep.r,e=a.ep.l):(d=a.ep.l,e=a.ep.r),a.a===1?(h=d?d.y:-c,f=a.c-a.b*h,i=e?e.y:c,g=a.c-a.b*i):(f=d?d.x:-c,h=a.c-a.a*f,g=e?e.x:c,i=a.c-a.a*g);var j=[f,h],k=[g,i];b[a.region.l.index].push(j,k),b[a.region.r.index].push(j,k)}),b=b.map(function(b,c){var d=a[c][0],e=a[c][1],f=b.map(function(a){return Math.atan2(a[0]-d,a[1]-e)});return d3.range(b.length).sort(function(a,b){return f[a]-f[b]}).filter(function(a,b,c){return!b||f[a]-f[c[b-1]]>h}).map(function(a){return b[a]})}),b.forEach(function(b,d){var e=b.length;if(!e)return b.push([-c,-c],[-c,c],[c,c],[c,-c]);if(e>2)return;var f=a[d],g=b[0],i=b[1],j=f[0],k=f[1],l=g[0],m=g[1],n=i[0],o=i[1],p=Math.abs(n-l),q=o-m;if(Math.abs(q)<h){var r=k<m?-c:c;b.push([-c,r],[c,r])}else if(p<h){var s=j<l?-c:c;b.push([s,-c],[s,c])}else{var r=(n-l)*(m-k)<(l-j)*(o-m)?c:-c,t=Math.abs(q)-p;Math.abs(t)<h?b.push([q<0?r:-r,r]):(t>0&&(r*=-1),b.push([-c,r],[c,r]))}}),b};var Mg={l:"r",r:"l"};d3.geom.delaunay=function(a){var b=a.map(function(){return[]}),c=[];return Ng(a,function(c){b[c.region.l.index].push(a[c.region.r.index])}),b.forEach(function(b,d){var e=a[d],f=e[0],g=e[1];b.forEach(function(a){a.angle=Math.atan2(a[0]-f,a[1]-g)}),b.sort(function(a,b){return a.angle-b.angle});for(var h=0,i=b.length-1;h<i;h++)c.push([e,b[h],b[h+1]])}),c},d3.geom.quadtree=function(a,b,c,d,e){function k(a,b,c,d,e,f){if(isNaN(b.x)||isNaN(b.y))return;if(a.leaf){var g=a.point;g?Math.abs(g.x-b.x)+Math.abs(g.y-b.y)<.01?l(a,b,c,d,e,f):(a.point=null,l(a,g,c,d,e,f),l(a,b,c,d,e,f)):a.point=b}else l(a,b,c,d,e,f)}function l(a,b,c,d,e,f){var g=(c+e)*.5,h=(d+f)*.5,i=b.x>=g,j=b.y>=h,l=(j<<1)+i;a.leaf=!1,a=a.nodes[l]||(a.nodes[l]=Og()),i?c=g:e=g,j?d=h:f=h,k(a,b,c,d,e,f)}var f,g=-1,h=a.length;if(arguments.length<5)if(arguments.length===3)e=c,d=b,c=b=0;else{b=c=Infinity,d=e=-Infinity;while(++g<h)f=a[g],f.x<b&&(b=f.x),f.y<c&&(c=f.y),f.x>d&&(d=f.x),f.y>e&&(e=f.y)}var i=d-b,j=e-c;i>j?e=c+i:d=b+j;var m=Og();return m.add=function(a){k(m,a,b,c,d,e)},m.visit=function(a){Pg(a,m,b,c,d,e)},a.forEach(m.add),m},d3.time={};var Qg=Date,Rg=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];Sg.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){Tg.setUTCDate.apply(this._,arguments)},setDay:function(){Tg.setUTCDay.apply(this._,arguments)},setFullYear:function(){Tg.setUTCFullYear.apply(this._,arguments)},setHours:function(){Tg.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){Tg.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){Tg.setUTCMinutes.apply(this._,arguments)},setMonth:function(){Tg.setUTCMonth.apply(this._,arguments)},setSeconds:function(){Tg.setUTCSeconds.apply(this._,arguments)},setTime:function(){Tg.setTime.apply(this._,arguments)}};var Tg=Date.prototype,Ug="%a %b %e %X %Y",Vg="%m/%d/%Y",Wg="%H:%M:%S",Xg=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Yg=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Zg=["January","February","March","April","May","June","July","August","September","October","November","December"],$g=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];d3.time.format=function(a){function c(c){var d=[],e=-1,f=0,g,h,i;while(++e<b)if(a.charCodeAt(e)===37){d.push(a.substring(f,e)),(h=jh[g=a.charAt(++e)])!=null&&(g=a.charAt(++e));if(i=kh[g])g=i(c,h==null?g==="e"?" ":"0":h);d.push(g),f=e+1}return d.push(a.substring(f,e)),d.join("")}var b=a.length;return c.parse=function(b){var c={y:1900,m:0,d:1,H:0,M:0,S:0,L:0},d=_g(c,a,b,0);if(d!=b.length)return null;"p"in c&&(c.H=c.H%12+c.p*12);var e=new Qg;return e.setFullYear(c.y,c.m,c.d),e.setHours(c.H,c.M,c.S,c.L),e},c.toString=function(){return a},c};var dh=ah(Xg),eh=ah(Yg),fh=ah(Zg),gh=bh(Zg),hh=ah($g),ih=bh($g),jh={"-":"",_:" ",0:"0"},kh={a:function(a){return Yg[a.getDay()]},A:function(a){return Xg[a.getDay()]},b:function(a){return $g[a.getMonth()]},B:function(a){return Zg[a.getMonth()]},c:d3.time.format(Ug),d:function(a,b){return ch(a.getDate(),b,2)},e:function(a,b){return ch(a.getDate(),b,2)},H:function(a,b){return ch(a.getHours(),b,2)},I:function(a,b){return ch(a.getHours()%12||12,b,2)},j:function(a,b){return ch(1+d3.time.dayOfYear(a),b,3)},L:function(a,b){return ch(a.getMilliseconds(),b,3)},m:function(a,b){return ch(a.getMonth()+1,b,2)},M:function(a,b){return ch(a.getMinutes(),b,2)},p:function(a){return a.getHours()>=12?"PM":"AM"},S:function(a,b){return ch(a.getSeconds(),b,2)},U:function(a,b){return ch(d3.time.sundayOfYear(a),b,2)},w:function(a){return a.getDay()},W:function(a,b){return ch(d3.time.mondayOfYear(a),b,2)},x:d3.time.format(Vg),X:d3.time.format(Wg),y:function(a,b){return ch(a.getFullYear()%100,b,2)},Y:function(a,b){return ch(a.getFullYear()%1e4,b,4)},Z:Fh,"%":function(){return"%"}},lh={a:mh,A:nh,b:oh,B:ph,c:qh,d:xh,e:xh,H:yh,I:yh,L:Bh,m:wh,M:zh,p:Dh,S:Ah,x:rh,X:sh,y:uh,Y:th},Ch=/^\s*\d+/,Eh=d3.map({am:0,pm:1});d3.time.format.utc=function(a){function c(a){try{Qg=Sg;var c=new Qg;return c._=a,b(c)}finally{Qg=Date}}var b=d3.time.format(a);return c.parse=function(a){try{Qg=Sg;var c=b.parse(a);return c&&c._}finally{Qg=Date}},c.toString=b.toString,c};var Gh=d3.time.format.utc("%Y-%m-%dT%H:%M:%S.%LZ");d3.time.format.iso=Date.prototype.toISOString?Hh:Gh,Hh.parse=function(a){var b=new Date(a);return isNaN(b)?null:b},Hh.toString=Gh.toString,d3.time.second=Ih(function(a){return new Qg(Math.floor(a/1e3)*1e3)},function(a,b){a.setTime(a.getTime()+Math.floor(b)*1e3)},function(a){return a.getSeconds()}),d3.time.seconds=d3.time.second.range,d3.time.seconds.utc=d3.time.second.utc.range,d3.time.minute=Ih(function(a){return new Qg(Math.floor(a/6e4)*6e4)},function(a,b){a.setTime(a.getTime()+Math.floor(b)*6e4)},function(a){return a.getMinutes()}),d3.time.minutes=d3.time.minute.range,d3.time.minutes.utc=d3.time.minute.utc.range,d3.time.hour=Ih(function(a){var b=a.getTimezoneOffset()/60;return new Qg((Math.floor(a/36e5-b)+b)*36e5)},function(a,b){a.setTime(a.getTime()+Math.floor(b)*36e5)},function(a){return a.getHours()}),d3.time.hours=d3.time.hour.range,d3.time.hours.utc=d3.time.hour.utc.range,d3.time.day=Ih(function(a){var b=new Qg(1970,0);return b.setFullYear(a.getFullYear(),a.getMonth(),a.getDate()),b},function(a,b){a.setDate(a.getDate()+b)},function(a){return a.getDate()-1}),d3.time.days=d3.time.day.range,d3.time.days.utc=d3.time.day.utc.range,d3.time.dayOfYear=function(a){var b=d3.time.year(a);return Math.floor((a-b-(a.getTimezoneOffset()-b.getTimezoneOffset())*6e4)/864e5)},Rg.forEach(function(a,b){a=a.toLowerCase(),b=7-b;var c=d3.time[a]=Ih(function(a){return(a=d3.time.day(a)).setDate(a.getDate()-(a.getDay()+b)%7),a},function(a,b){a.setDate(a.getDate()+Math.floor(b)*7)},function(a){var c=d3.time.year(a).getDay();return Math.floor((d3.time.dayOfYear(a)+(c+b)%7)/7)-(c!==b)});d3.time[a+"s"]=c.range,d3.time[a+"s"].utc=c.utc.range,d3.time[a+"OfYear"]=function(a){var c=d3.time.year(a).getDay();return Math.floor((d3.time.dayOfYear(a)+(c+b)%7)/7)}}),d3.time.week=d3.time.sunday,d3.time.weeks=d3.time.sunday.range,d3.time.weeks.utc=d3.time.sunday.utc.range,d3.time.weekOfYear=d3.time.sundayOfYear,d3.time.month=Ih(function(a){return a=d3.time.day(a),a.setDate(1),a},function(a,b){a.setMonth(a.getMonth()+b)},function(a){return a.getMonth()}),d3.time.months=d3.time.month.range,d3.time.months.utc=d3.time.month.utc.range,d3.time.year=Ih(function(a){return a=d3.time.day(a),a.setMonth(0,1),a},function(a,b){a.setFullYear(a.getFullYear()+b)},function(a){return a.getFullYear()}),d3.time.years=d3.time.year.range,d3.time.years.utc=d3.time.year.utc.range;var Qh=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],Rh=[[d3.time.second,1],[d3.time.second,5],[d3.time.second,15],[d3.time.second,30],[d3.time.minute,1],[d3.time.minute,5],[d3.time.minute,15],[d3.time.minute,30],[d3.time.hour,1],[d3.time.hour,3],[d3.time.hour,6],[d3.time.hour,12],[d3.time.day,1],[d3.time.day,2],[d3.time.week,1],[d3.time.month,1],[d3.time.month,3],[d3.time.year,1]],Sh=[[d3.time.format("%Y"),w],[d3.time.format("%B"),function(a){return a.getMonth()}],[d3.time.format("%b %d"),function(a){return a.getDate()!=1}],[d3.time.format("%a %d"),function(a){return a.getDay()&&a.getDate()!=1}],[d3.time.format("%I %p"),function(a){return a.getHours()}],[d3.time.format("%I:%M"),function(a){return a.getMinutes()}],[d3.time.format(":%S"),function(a){return a.getSeconds()}],[d3.time.format(".%L"),function(a){return a.getMilliseconds()}]],Th=d3.scale.linear(),Uh=Nh(Sh);Rh.year=function(a,b){return Th.domain(a.map(Ph)).ticks(b).map(Oh)},d3.time.scale=function(){return Kh(d3.scale.linear(),Rh,Uh)};var Vh=Rh.map(function(a){return[a[0].utc,a[1]]}),Wh=[[d3.time.format.utc("%Y"),w],[d3.time.format.utc("%B"),function(a){return a.getUTCMonth()}],[d3.time.format.utc("%b %d"),function(a){return a.getUTCDate()!=1}],[d3.time.format.utc("%a %d"),function(a){return a.getUTCDay()&&a.getUTCDate()!=1}],[d3.time.format.utc("%I %p"),function(a){return a.getUTCHours()}],[d3.time.format.utc("%I:%M"),function(a){return a.getUTCMinutes()}],[d3.time.format.utc(":%S"),function(a){return a.getUTCSeconds()}],[d3.time.format.utc(".%L"),function(a){return a.getUTCMilliseconds()}]],Xh=Nh(Wh);Vh.year=function(a,b){return Th.domain(a.map(Zh)).ticks(b).map(Yh)},d3.time.scale.utc=function(){return Kh(d3.scale.linear(),Vh,Xh)}})();
/*!
 * jQuery JavaScript Library v1.10.2
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright 2005, 2013 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2013-07-03T13:48Z
 */(function(a,b){function J(a){var b=a.length,c=u.type(a);return u.isWindow(a)?!1:a.nodeType===1&&b?!0:c==="array"||c!=="function"&&(b===0||typeof b=="number"&&b>0&&b-1 in a)}function L(a){var b=K[a]={};return u.each(a.match(w)||[],function(a,c){b[c]=!0}),b}function O(a,c,d,e){if(!u.acceptData(a))return;var f,g,h=u.expando,i=a.nodeType,j=i?u.cache:a,k=i?a[h]:a[h]&&h;if((!k||!j[k]||!e&&!j[k].data)&&d===b&&typeof c=="string")return;k||(i?k=a[h]=l.pop()||u.guid++:k=h),j[k]||(j[k]=i?{}:{toJSON:u.noop});if(typeof c=="object"||typeof c=="function")e?j[k]=u.extend(j[k],c):j[k].data=u.extend(j[k].data,c);return g=j[k],e||(g.data||(g.data={}),g=g.data),d!==b&&(g[u.camelCase(c)]=d),typeof c=="string"?(f=g[c],f==null&&(f=g[u.camelCase(c)])):f=g,f}function P(a,b,c){if(!u.acceptData(a))return;var d,e,f=a.nodeType,g=f?u.cache:a,h=f?a[u.expando]:u.expando;if(!g[h])return;if(b){d=c?g[h]:g[h].data;if(d){u.isArray(b)?b=b.concat(u.map(b,u.camelCase)):b in d?b=[b]:(b=u.camelCase(b),b in d?b=[b]:b=b.split(" ")),e=b.length;while(e--)delete d[b[e]];if(c?!R(d):!u.isEmptyObject(d))return}}if(!c){delete g[h].data;if(!R(g[h]))return}f?u.cleanData([a],!0):u.support.deleteExpando||g!=g.window?delete g[h]:g[h]=null}function Q(a,c,d){if(d===b&&a.nodeType===1){var e="data-"+c.replace(N,"-$1").toLowerCase();d=a.getAttribute(e);if(typeof d=="string"){try{d=d==="true"?!0:d==="false"?!1:d==="null"?null:+d+""===d?+d:M.test(d)?u.parseJSON(d):d}catch(f){}u.data(a,c,d)}else d=b}return d}function R(a){var b;for(b in a){if(b==="data"&&u.isEmptyObject(a[b]))continue;if(b!=="toJSON")return!1}return!0}function eb(){return!0}function fb(){return!1}function gb(){try{return g.activeElement}catch(a){}}function lb(a,b){do a=a[b];while(a&&a.nodeType!==1);return a}function mb(a,b,c){if(u.isFunction(b))return u.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return u.grep(a,function(a){return a===b!==c});if(typeof b=="string"){if(hb.test(b))return u.filter(b,a,c);b=u.filter(b,a)}return u.grep(a,function(a){return u.inArray(a,b)>=0!==c})}function nb(a){var b=ob.split("|"),c=a.createDocumentFragment();if(c.createElement)while(b.length)c.createElement(b.pop());return c}function Fb(a,b){return u.nodeName(a,"table")&&u.nodeName(b.nodeType===1?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function Gb(a){return a.type=(u.find.attr(a,"type")!==null)+"/"+a.type,a}function Hb(a){var b=Ab.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function Ib(a,b){var c,d=0;for(;(c=a[d])!=null;d++)u._data(c,"globalEval",!b||u._data(b[d],"globalEval"))}function Jb(a,b){if(b.nodeType!==1||!u.hasData(a))return;var c,d,e,f=u._data(a),g=u._data(b,f),h=f.events;if(h){delete g.handle,g.events={};for(c in h)for(d=0,e=h[c].length;d<e;d++)u.event.add(b,c,h[c][d])}g.data&&(g.data=u.extend({},g.data))}function Kb(a,b){var c,d,e;if(b.nodeType!==1)return;c=b.nodeName.toLowerCase();if(!u.support.noCloneEvent&&b[u.expando]){e=u._data(b);for(d in e.events)u.removeEvent(b,d,e.handle);b.removeAttribute(u.expando)}if(c==="script"&&b.text!==a.text)Gb(b).text=a.text,Hb(b);else if(c==="object")b.parentNode&&(b.outerHTML=a.outerHTML),u.support.html5Clone&&a.innerHTML&&!u.trim(b.innerHTML)&&(b.innerHTML=a.innerHTML);else if(c==="input"&&xb.test(a.type))b.defaultChecked=b.checked=a.checked,b.value!==a.value&&(b.value=a.value);else if(c==="option")b.defaultSelected=b.selected=a.defaultSelected;else if(c==="input"||c==="textarea")b.defaultValue=a.defaultValue}function Lb(a,c){var d,f,g=0,h=typeof a.getElementsByTagName!==e?a.getElementsByTagName(c||"*"):typeof a.querySelectorAll!==e?a.querySelectorAll(c||"*"):b;if(!h)for(h=[],d=a.childNodes||a;(f=d[g])!=null;g++)!c||u.nodeName(f,c)?h.push(f):u.merge(h,Lb(f,c));return c===b||c&&u.nodeName(a,c)?u.merge([a],h):h}function Mb(a){xb.test(a.type)&&(a.defaultChecked=a.checked)}function bc(a,b){if(b in a)return b;var c=b.charAt(0).toUpperCase()+b.slice(1),d=b,e=ac.length;while(e--){b=ac[e]+c;if(b in a)return b}return d}function cc(a,b){return a=b||a,u.css(a,"display")==="none"||!u.contains(a.ownerDocument,a)}function dc(a,b){var c,d,e,f=[],g=0,h=a.length;for(;g<h;g++){d=a[g];if(!d.style)continue;f[g]=u._data(d,"olddisplay"),c=d.style.display,b?(!f[g]&&c==="none"&&(d.style.display=""),d.style.display===""&&cc(d)&&(f[g]=u._data(d,"olddisplay",hc(d.nodeName)))):f[g]||(e=cc(d),(c&&c!=="none"||!e)&&u._data(d,"olddisplay",e?c:u.css(d,"display")))}for(g=0;g<h;g++){d=a[g];if(!d.style)continue;if(!b||d.style.display==="none"||d.style.display==="")d.style.display=b?f[g]||"":"none"}return a}function ec(a,b,c){var d=Vb.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function fc(a,b,c,d,e){var f=c===(d?"border":"content")?4:b==="width"?1:0,g=0;for(;f<4;f+=2)c==="margin"&&(g+=u.css(a,c+_b[f],!0,e)),d?(c==="content"&&(g-=u.css(a,"padding"+_b[f],!0,e)),c!=="margin"&&(g-=u.css(a,"border"+_b[f]+"Width",!0,e))):(g+=u.css(a,"padding"+_b[f],!0,e),c!=="padding"&&(g+=u.css(a,"border"+_b[f]+"Width",!0,e)));return g}function gc(a,b,c){var d=!0,e=b==="width"?a.offsetWidth:a.offsetHeight,f=Ob(a),g=u.support.boxSizing&&u.css(a,"boxSizing",!1,f)==="border-box";if(e<=0||e==null){e=Pb(a,b,f);if(e<0||e==null)e=a.style[b];if(Wb.test(e))return e;d=g&&(u.support.boxSizingReliable||e===a.style[b]),e=parseFloat(e)||0}return e+fc(a,b,c||(g?"border":"content"),d,f)+"px"}function hc(a){var b=g,c=Yb[a];if(!c){c=ic(a,b);if(c==="none"||!c)Nb=(Nb||u("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(b.documentElement),b=(Nb[0].contentWindow||Nb[0].contentDocument).document,b.write("<!doctype html><html><body>"),b.close(),c=ic(a,b),Nb.detach();Yb[a]=c}return c}function ic(a,b){var c=u(b.createElement(a)).appendTo(b.body),d=u.css(c[0],"display");return c.remove(),d}function oc(a,b,c,d){var e;if(u.isArray(b))u.each(b,function(b,e){c||kc.test(a)?d(a,e):oc(a+"["+(typeof e=="object"?b:"")+"]",e,c,d)});else if(!c&&u.type(b)==="object")for(e in b)oc(a+"["+e+"]",b[e],c,d);else d(a,b)}function Fc(a){return function(b,c){typeof b!="string"&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(w)||[];if(u.isFunction(c))while(d=f[e++])d[0]==="+"?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function Gc(a,b,c,d){function g(h){var i;return e[h]=!0,u.each(a[h]||[],function(a,h){var j=h(b,c,d);if(typeof j=="string"&&!f&&!e[j])return b.dataTypes.unshift(j),g(j),!1;if(f)return!(i=j)}),i}var e={},f=a===Cc;return g(b.dataTypes[0])||!e["*"]&&g("*")}function Hc(a,c){var d,e,f=u.ajaxSettings.flatOptions||{};for(e in c)c[e]!==b&&((f[e]?a:d||(d={}))[e]=c[e]);return d&&u.extend(!0,a,d),a}function Ic(a,c,d){var e,f,g,h,i=a.contents,j=a.dataTypes;while(j[0]==="*")j.shift(),f===b&&(f=a.mimeType||c.getResponseHeader("Content-Type"));if(f)for(h in i)if(i[h]&&i[h].test(f)){j.unshift(h);break}if(j[0]in d)g=j[0];else{for(h in d){if(!j[0]||a.converters[h+" "+j[0]]){g=h;break}e||(e=h)}g=g||e}if(g)return g!==j[0]&&j.unshift(g),d[g]}function Jc(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];f=k.shift();while(f){a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift();if(f)if(f==="*")f=i;else if(i!=="*"&&i!==f){g=j[i+" "+f]||j["* "+f];if(!g)for(e in j){h=e.split(" ");if(h[1]===f){g=j[i+" "+h[0]]||j["* "+h[0]];if(g){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}}}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}}return{state:"success",data:b}}function Qc(){try{return new a.XMLHttpRequest}catch(b){}}function Rc(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}function Zc(){return setTimeout(function(){Sc=b}),Sc=u.now()}function $c(a,b,c){var d,e=(Yc[b]||[]).concat(Yc["*"]),f=0,g=e.length;for(;f<g;f++)if(d=e[f].call(c,b,a))return d}function _c(a,b,c){var d,e,f=0,g=Xc.length,h=u.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;var b=Sc||Zc(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;for(;g<i;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),f<1&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:u.extend({},b),opts:u.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:Sc||Zc(),duration:c.duration,tweens:[],createTween:function(b,c){var d=u.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;e=!0;for(;c<d;c++)j.tweens[c].run(1);return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;ad(k,j.opts.specialEasing);for(;f<g;f++){d=Xc[f].call(j,a,k,j.opts);if(d)return d}return u.map(k,$c,j),u.isFunction(j.opts.start)&&j.opts.start.call(a,j),u.fx.timer(u.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}function ad(a,b){var c,d,e,f,g;for(c in a){d=u.camelCase(c),e=b[d],f=a[c],u.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=u.cssHooks[d];if(g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}}function bd(a,b,c){var d,e,f,g,h,i,j=this,k={},l=a.style,m=a.nodeType&&cc(a),n=u._data(a,"fxshow");c.queue||(h=u._queueHooks(a,"fx"),h.unqueued==null&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,j.always(function(){j.always(function(){h.unqueued--,u.queue(a,"fx").length||h.empty.fire()})})),a.nodeType===1&&("height"in b||"width"in b)&&(c.overflow=[l.overflow,l.overflowX,l.overflowY],u.css(a,"display")==="inline"&&u.css(a,"float")==="none"&&(!u.support.inlineBlockNeedsLayout||hc(a.nodeName)==="inline"?l.display="inline-block":l.zoom=1)),c.overflow&&(l.overflow="hidden",u.support.shrinkWrapBlocks||j.always(function(){l.overflow=c.overflow[0],l.overflowX=c.overflow[1],l.overflowY=c.overflow[2]}));for(d in b){e=b[d];if(Uc.exec(e)){delete b[d],f=f||e==="toggle";if(e===(m?"hide":"show"))continue;k[d]=n&&n[d]||u.style(a,d)}}if(!u.isEmptyObject(k)){n?"hidden"in n&&(m=n.hidden):n=u._data(a,"fxshow",{}),f&&(n.hidden=!m),m?u(a).show():j.done(function(){u(a).hide()}),j.done(function(){var b;u._removeData(a,"fxshow");for(b in k)u.style(a,b,k[b])});for(d in k)g=$c(m?n[d]:0,d,j),d in n||(n[d]=g.start,m&&(g.end=g.start,g.start=d==="width"||d==="height"?1:0))}}function cd(a,b,c,d,e){return new cd.prototype.init(a,b,c,d,e)}function dd(a,b){var c,d={height:a},e=0;b=b?1:0;for(;e<4;e+=2-b)c=_b[e],d["margin"+c]=d["padding"+c]=a;return b&&(d.opacity=d.width=a),d}function ed(a){return u.isWindow(a)?a:a.nodeType===9?a.defaultView||a.parentWindow:!1}var c,d,e=typeof b,f=a.location,g=a.document,h=g.documentElement,i=a.jQuery,j=a.$,k={},l=[],m="1.10.2",n=l.concat,o=l.push,p=l.slice,q=l.indexOf,r=k.toString,s=k.hasOwnProperty,t=m.trim,u=function(a,b){return new u.fn.init(a,b,d)},v=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,w=/\S+/g,x=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,y=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,z=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,A=/^[\],:{}\s]*$/,B=/(?:^|:|,)(?:\s*\[)+/g,C=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,D=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,E=/^-ms-/,F=/-([\da-z])/gi,G=function(a,b){return b.toUpperCase()},H=function(a){if(g.addEventListener||a.type==="load"||g.readyState==="complete")I(),u.ready()},I=function(){g.addEventListener?(g.removeEventListener("DOMContentLoaded",H,!1),a.removeEventListener("load",H,!1)):(g.detachEvent("onreadystatechange",H),a.detachEvent("onload",H))};u.fn=u.prototype={jquery:m,constructor:u,init:function(a,c,d){var e,f;if(!a)return this;if(typeof a=="string"){a.charAt(0)==="<"&&a.charAt(a.length-1)===">"&&a.length>=3?e=[null,a,null]:e=y.exec(a);if(e&&(e[1]||!c)){if(e[1]){c=c instanceof u?c[0]:c,u.merge(this,u.parseHTML(e[1],c&&c.nodeType?c.ownerDocument||c:g,!0));if(z.test(e[1])&&u.isPlainObject(c))for(e in c)u.isFunction(this[e])?this[e](c[e]):this.attr(e,c[e]);return this}f=g.getElementById(e[2]);if(f&&f.parentNode){if(f.id!==e[2])return d.find(a);this.length=1,this[0]=f}return this.context=g,this.selector=a,this}return!c||c.jquery?(c||d).find(a):this.constructor(c).find(a)}return a.nodeType?(this.context=this[0]=a,this.length=1,this):u.isFunction(a)?d.ready(a):(a.selector!==b&&(this.selector=a.selector,this.context=a.context),u.makeArray(a,this))},selector:"",length:0,toArray:function(){return p.call(this)},get:function(a){return a==null?this.toArray():a<0?this[this.length+a]:this[a]},pushStack:function(a){var b=u.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return u.each(this,a,b)},ready:function(a){return u.ready.promise().done(a),this},slice:function(){return this.pushStack(p.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(a<0?b:0);return this.pushStack(c>=0&&c<b?[this[c]]:[])},map:function(a){return this.pushStack(u.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:o,sort:[].sort,splice:[].splice},u.fn.init.prototype=u.fn,u.extend=u.fn.extend=function(){var a,c,d,e,f,g,h=arguments[0]||{},i=1,j=arguments.length,k=!1;typeof h=="boolean"&&(k=h,h=arguments[1]||{},i=2),typeof h!="object"&&!u.isFunction(h)&&(h={}),j===i&&(h=this,--i);for(;i<j;i++)if((f=arguments[i])!=null)for(e in f){a=h[e],d=f[e];if(h===d)continue;k&&d&&(u.isPlainObject(d)||(c=u.isArray(d)))?(c?(c=!1,g=a&&u.isArray(a)?a:[]):g=a&&u.isPlainObject(a)?a:{},h[e]=u.extend(k,g,d)):d!==b&&(h[e]=d)}return h},u.extend({expando:"jQuery"+(m+Math.random()).replace(/\D/g,""),noConflict:function(b){return a.$===u&&(a.$=j),b&&a.jQuery===u&&(a.jQuery=i),u},isReady:!1,readyWait:1,holdReady:function(a){a?u.readyWait++:u.ready(!0)},ready:function(a){if(a===!0?--u.readyWait:u.isReady)return;if(!g.body)return setTimeout(u.ready);u.isReady=!0;if(a!==!0&&--u.readyWait>0)return;c.resolveWith(g,[u]),u.fn.trigger&&u(g).trigger("ready").off("ready")},isFunction:function(a){return u.type(a)==="function"},isArray:Array.isArray||function(a){return u.type(a)==="array"},isWindow:function(a){return a!=null&&a==a.window},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return a==null?String(a):typeof a=="object"||typeof a=="function"?k[r.call(a)]||"object":typeof a},isPlainObject:function(a){var c;if(!a||u.type(a)!=="object"||a.nodeType||u.isWindow(a))return!1;try{if(a.constructor&&!s.call(a,"constructor")&&!s.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(d){return!1}if(u.support.ownLast)for(c in a)return s.call(a,c);for(c in a);return c===b||s.call(a,c)},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},error:function(a){throw new Error(a)},parseHTML:function(a,b,c){if(!a||typeof a!="string")return null;typeof b=="boolean"&&(c=b,b=!1),b=b||g;var d=z.exec(a),e=!c&&[];return d?[b.createElement(d[1])]:(d=u.buildFragment([a],b,e),e&&u(e).remove(),u.merge([],d.childNodes))},parseJSON:function(b){if(a.JSON&&a.JSON.parse)return a.JSON.parse(b);if(b===null)return b;if(typeof b=="string"){b=u.trim(b);if(b&&A.test(b.replace(C,"@").replace(D,"]").replace(B,"")))return(new Function("return "+b))()}u.error("Invalid JSON: "+b)},parseXML:function(c){var d,e;if(!c||typeof c!="string")return null;try{a.DOMParser?(e=new DOMParser,d=e.parseFromString(c,"text/xml")):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(c))}catch(f){d=b}return(!d||!d.documentElement||d.getElementsByTagName("parsererror").length)&&u.error("Invalid XML: "+c),d},noop:function(){},globalEval:function(b){b&&u.trim(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(E,"ms-").replace(F,G)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,c){var d,e=0,f=a.length,g=J(a);if(c)if(g)for(;e<f;e++){d=b.apply(a[e],c);if(d===!1)break}else for(e in a){d=b.apply(a[e],c);if(d===!1)break}else if(g)for(;e<f;e++){d=b.call(a[e],e,a[e]);if(d===!1)break}else for(e in a){d=b.call(a[e],e,a[e]);if(d===!1)break}return a},trim:t&&!t.call("﻿ ")?function(a){return a==null?"":t.call(a)}:function(a){return a==null?"":(a+"").replace(x,"")},makeArray:function(a,b){var c=b||[];return a!=null&&(J(Object(a))?u.merge(c,typeof a=="string"?[a]:a):o.call(c,a)),c},inArray:function(a,b,c){var d;if(b){if(q)return q.call(b,a,c);d=b.length,c=c?c<0?Math.max(0,d+c):c:0;for(;c<d;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,c){var d=c.length,e=a.length,f=0;if(typeof d=="number")for(;f<d;f++)a[e++]=c[f];else while(c[f]!==b)a[e++]=c[f++];return a.length=e,a},grep:function(a,b,c){var d,e=[],f=0,g=a.length;c=!!c;for(;f<g;f++)d=!!b(a[f],f),c!==d&&e.push(a[f]);return e},map:function(a,b,c){var d,e=0,f=a.length,g=J(a),h=[];if(g)for(;e<f;e++)d=b(a[e],e,c),d!=null&&(h[h.length]=d);else for(e in a)d=b(a[e],e,c),d!=null&&(h[h.length]=d);return n.apply([],h)},guid:1,proxy:function(a,c){var d,e,f;return typeof c=="string"&&(f=a[c],c=a,a=f),u.isFunction(a)?(d=p.call(arguments,2),e=function(){return a.apply(c||this,d.concat(p.call(arguments)))},e.guid=a.guid=a.guid||u.guid++,e):b},access:function(a,c,d,e,f,g,h){var i=0,j=a.length,k=d==null;if(u.type(d)==="object"){f=!0;for(i in d)u.access(a,c,i,d[i],!0,g,h)}else if(e!==b){f=!0,u.isFunction(e)||(h=!0),k&&(h?(c.call(a,e),c=null):(k=c,c=function(a,b,c){return k.call(u(a),c)}));if(c)for(;i<j;i++)c(a[i],d,h?e:e.call(a[i],i,c(a[i],d)))}return f?a:k?c.call(a):j?c(a[0],d):g},now:function(){return(new Date).getTime()},swap:function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e}}),u.ready.promise=function(b){if(!c){c=u.Deferred();if(g.readyState==="complete")setTimeout(u.ready);else if(g.addEventListener)g.addEventListener("DOMContentLoaded",H,!1),a.addEventListener("load",H,!1);else{g.attachEvent("onreadystatechange",H),a.attachEvent("onload",H);var d=!1;try{d=a.frameElement==null&&g.documentElement}catch(e){}d&&d.doScroll&&function f(){if(!u.isReady){try{d.doScroll("left")}catch(a){return setTimeout(f,50)}I(),u.ready()}}()}}return c.promise(b)},u.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){k["[object "+b+"]"]=b.toLowerCase()}),d=u(g),function(a,b){function gb(a,b,c,e){var f,g,h,i,j,k,n,q,r,u;(b?b.ownerDocument||b:v)!==m&&l(b),b=b||m,c=c||[];if(!a||typeof a!="string")return c;if((i=b.nodeType)!==1&&i!==9)return[];if(o&&!e){if(f=_.exec(a))if(h=f[1]){if(i===9){g=b.getElementById(h);if(!g||!g.parentNode)return c;if(g.id===h)return c.push(g),c}else if(b.ownerDocument&&(g=b.ownerDocument.getElementById(h))&&s(b,g)&&g.id===h)return c.push(g),c}else{if(f[2])return J.apply(c,b.getElementsByTagName(a)),c;if((h=f[3])&&d.getElementsByClassName&&b.getElementsByClassName)return J.apply(c,b.getElementsByClassName(h)),c}if(d.qsa&&(!p||!p.test(a))){q=n=t,r=b,u=i===9&&a;if(i===1&&b.nodeName.toLowerCase()!=="object"){k=qb(a),(n=b.getAttribute("id"))?q=n.replace(cb,"\\$&"):b.setAttribute("id",q),q="[id='"+q+"'] ",j=k.length;while(j--)k[j]=q+rb(k[j]);r=V.test(a)&&b.parentNode||b,u=k.join(",")}if(u)try{return J.apply(c,r.querySelectorAll(u)),c}catch(w){}finally{n||b.removeAttribute("id")}}}return zb(a.replace(S,"$1"),b,c,e)}function hb(){function b(c,d){return a.push(c+=" ")>f.cacheLength&&delete b[a.shift()],b[c]=d}var a=[];return b}function ib(a){return a[t]=!0,a}function jb(a){var b=m.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function kb(a,b){var c=a.split("|"),d=a.length;while(d--)f.attrHandle[c[d]]=b}function lb(a,b){var c=b&&a,d=c&&a.nodeType===1&&b.nodeType===1&&(~b.sourceIndex||E)-(~a.sourceIndex||E);if(d)return d;if(c)while(c=c.nextSibling)if(c===b)return-1;return a?1:-1}function mb(a){return function(b){var c=b.nodeName.toLowerCase();return c==="input"&&b.type===a}}function nb(a){return function(b){var c=b.nodeName.toLowerCase();return(c==="input"||c==="button")&&b.type===a}}function ob(a){return ib(function(b){return b=+b,ib(function(c,d){var e,f=a([],c.length,b),g=f.length;while(g--)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function pb(){}function qb(a,b){var c,d,e,g,h,i,j,k=z[a+" "];if(k)return b?0:k.slice(0);h=a,i=[],j=f.preFilter;while(h){if(!c||(d=T.exec(h)))d&&(h=h.slice(d[0].length)||h),i.push(e=[]);c=!1;if(d=U.exec(h))c=d.shift(),e.push({value:c,type:d[0].replace(S," ")}),h=h.slice(c.length);for(g in f.filter)(d=Z[g].exec(h))&&(!j[g]||(d=j[g](d)))&&(c=d.shift(),e.push({value:c,type:g,matches:d}),h=h.slice(c.length));if(!c)break}return b?h.length:h?gb.error(a):z(a,i).slice(0)}function rb(a){var b=0,c=a.length,d="";for(;b<c;b++)d+=a[b].value;return d}function sb(a,b,c){var d=b.dir,f=c&&d==="parentNode",g=x++;return b.first?function(b,c,e){while(b=b[d])if(b.nodeType===1||f)return a(b,c,e)}:function(b,c,h){var i,j,k,l=w+" "+g;if(h){while(b=b[d])if(b.nodeType===1||f)if(a(b,c,h))return!0}else while(b=b[d])if(b.nodeType===1||f){k=b[t]||(b[t]={});if((j=k[d])&&j[0]===l){if((i=j[1])===!0||i===e)return i===!0}else{j=k[d]=[l],j[1]=a(b,c,h)||e;if(j[1]===!0)return!0}}}}function tb(a){return a.length>1?function(b,c,d){var e=a.length;while(e--)if(!a[e](b,c,d))return!1;return!0}:a[0]}function ub(a,b,c,d,e){var f,g=[],h=0,i=a.length,j=b!=null;for(;h<i;h++)if(f=a[h])if(!c||c(f,d,e))g.push(f),j&&b.push(h);return g}function vb(a,b,c,d,e,f){return d&&!d[t]&&(d=vb(d)),e&&!e[t]&&(e=vb(e,f)),ib(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||yb(b||"*",h.nodeType?[h]:h,[]),q=a&&(f||!b)?ub(p,m,a,h,i):p,r=c?e||(f?a:o||d)?[]:g:q;c&&c(q,r,h,i);if(d){j=ub(r,n),d(j,[],h,i),k=j.length;while(k--)if(l=j[k])r[n[k]]=!(q[n[k]]=l)}if(f){if(e||a){if(e){j=[],k=r.length;while(k--)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}k=r.length;while(k--)(l=r[k])&&(j=e?L.call(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=ub(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):J.apply(g,r)})}function wb(a){var b,c,d,e=a.length,g=f.relative[a[0].type],h=g||f.relative[" "],i=g?1:0,k=sb(function(a){return a===b},h,!0),l=sb(function(a){return L.call(b,a)>-1},h,!0),m=[function(a,c,d){return!g&&(d||c!==j)||((b=c).nodeType?k(a,c,d):l(a,c,d))}];for(;i<e;i++)if(c=f.relative[a[i].type])m=[sb(tb(m),c)];else{c=f.filter[a[i].type].apply(null,a[i].matches);if(c[t]){d=++i;for(;d<e;d++)if(f.relative[a[d].type])break;return vb(i>1&&tb(m),i>1&&rb(a.slice(0,i-1).concat({value:a[i-2].type===" "?"*":""})).replace(S,"$1"),c,i<d&&wb(a.slice(i,d)),d<e&&wb(a=a.slice(d)),d<e&&rb(a))}m.push(c)}return tb(m)}function xb(a,b){var c=0,d=b.length>0,g=a.length>0,h=function(h,i,k,l,n){var o,p,q,r=[],s=0,t="0",u=h&&[],v=n!=null,x=j,y=h||g&&f.find.TAG("*",n&&i.parentNode||i),z=w+=x==null?1:Math.random()||.1;v&&(j=i!==m&&i,e=c);for(;(o=y[t])!=null;t++){if(g&&o){p=0;while(q=a[p++])if(q(o,i,k)){l.push(o);break}v&&(w=z,e=++c)}d&&((o=!q&&o)&&s--,h&&u.push(o))}s+=t;if(d&&t!==s){p=0;while(q=b[p++])q(u,r,i,k);if(h){if(s>0)while(t--)!u[t]&&!r[t]&&(r[t]=H.call(l));r=ub(r)}J.apply(l,r),v&&!h&&r.length>0&&s+b.length>1&&gb.uniqueSort(l)}return v&&(w=z,j=x),u};return d?ib(h):h}function yb(a,b,c){var d=0,e=b.length;for(;d<e;d++)gb(a,b[d],c);return c}function zb(a,b,c,e){var g,h,j,k,l,m=qb(a);if(!e&&m.length===1){h=m[0]=m[0].slice(0);if(h.length>2&&(j=h[0]).type==="ID"&&d.getById&&b.nodeType===9&&o&&f.relative[h[1].type]){b=(f.find.ID(j.matches[0].replace(db,eb),b)||[])[0];if(!b)return c;a=a.slice(h.shift().value.length)}g=Z.needsContext.test(a)?0:h.length;while(g--){j=h[g];if(f.relative[k=j.type])break;if(l=f.find[k])if(e=l(j.matches[0].replace(db,eb),V.test(h[0].type)&&b.parentNode||b)){h.splice(g,1),a=e.length&&rb(h);if(!a)return J.apply(c,e),c;break}}}return i(a,m)(e,b,!o,c,V.test(a)),c}var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t="sizzle"+ -(new Date),v=a.document,w=0,x=0,y=hb(),z=hb(),A=hb(),B=!1,C=function(a,b){return a===b?(B=!0,0):0},D=typeof b,E=1<<31,F={}.hasOwnProperty,G=[],H=G.pop,I=G.push,J=G.push,K=G.slice,L=G.indexOf||function(a){var b=0,c=this.length;for(;b<c;b++)if(this[b]===a)return b;return-1},M="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",N="[\\x20\\t\\r\\n\\f]",O="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",P=O.replace("w","w#"),Q="\\["+N+"*("+O+")"+N+"*(?:([*^$|!~]?=)"+N+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+P+")|)|)"+N+"*\\]",R=":("+O+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+Q.replace(3,8)+")*)|.*)\\)|)",S=new RegExp("^"+N+"+|((?:^|[^\\\\])(?:\\\\.)*)"+N+"+$","g"),T=new RegExp("^"+N+"*,"+N+"*"),U=new RegExp("^"+N+"*([>+~]|"+N+")"+N+"*"),V=new RegExp(N+"*[+~]"),W=new RegExp("="+N+"*([^\\]'\"]*)"+N+"*\\]","g"),X=new RegExp(R),Y=new RegExp("^"+P+"$"),Z={ID:new RegExp("^#("+O+")"),CLASS:new RegExp("^\\.("+O+")"),TAG:new RegExp("^("+O.replace("w","w*")+")"),ATTR:new RegExp("^"+Q),PSEUDO:new RegExp("^"+R),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+N+"*(even|odd|(([+-]|)(\\d*)n|)"+N+"*(?:([+-]|)"+N+"*(\\d+)|))"+N+"*\\)|)","i"),bool:new RegExp("^(?:"+M+")$","i"),needsContext:new RegExp("^"+N+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+N+"*((?:-\\d)?\\d*)"+N+"*\\)|)(?=[^-]|$)","i")},$=/^[^{]+\{\s*\[native \w/,_=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ab=/^(?:input|select|textarea|button)$/i,bb=/^h\d$/i,cb=/'|\\/g,db=new RegExp("\\\\([\\da-f]{1,6}"+N+"?|("+N+")|.)","ig"),eb=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:d<0?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,d&1023|56320)};try{J.apply(G=K.call(v.childNodes),v.childNodes),G[v.childNodes.length].nodeType}catch(fb){J={apply:G.length?function(a,b){I.apply(a,K.call(b))}:function(a,b){var c=a.length,d=0;while(a[c++]=b[d++]);a.length=c-1}}}h=gb.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?b.nodeName!=="HTML":!1},d=gb.support={},l=gb.setDocument=function(a){var b=a?a.ownerDocument||a:v,c=b.defaultView;if(b===m||b.nodeType!==9||!b.documentElement)return m;m=b,n=b.documentElement,o=!h(b),c&&c.attachEvent&&c!==c.top&&c.attachEvent("onbeforeunload",function(){l()}),d.attributes=jb(function(a){return a.className="i",!a.getAttribute("className")}),d.getElementsByTagName=jb(function(a){return a.appendChild(b.createComment("")),!a.getElementsByTagName("*").length}),d.getElementsByClassName=jb(function(a){return a.innerHTML="<div class='a'></div><div class='a i'></div>",a.firstChild.className="i",a.getElementsByClassName("i").length===2}),d.getById=jb(function(a){return n.appendChild(a).id=t,!b.getElementsByName||!b.getElementsByName(t).length}),d.getById?(f.find.ID=function(a,b){if(typeof b.getElementById!==D&&o){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},f.filter.ID=function(a){var b=a.replace(db,eb);return function(a){return a.getAttribute("id")===b}}):(delete f.find.ID,f.filter.ID=function(a){var b=a.replace(db,eb);return function(a){var c=typeof a.getAttributeNode!==D&&a.getAttributeNode("id");return c&&c.value===b}}),f.find.TAG=d.getElementsByTagName?function(a,b){if(typeof b.getElementsByTagName!==D)return b.getElementsByTagName(a)}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if(a==="*"){while(c=f[e++])c.nodeType===1&&d.push(c);return d}return f},f.find.CLASS=d.getElementsByClassName&&function(a,b){if(typeof b.getElementsByClassName!==D&&o)return b.getElementsByClassName(a)},q=[],p=[];if(d.qsa=$.test(b.querySelectorAll))jb(function(a){a.innerHTML="<select><option selected=''></option></select>",a.querySelectorAll("[selected]").length||p.push("\\["+N+"*(?:value|"+M+")"),a.querySelectorAll(":checked").length||p.push(":checked")}),jb(function(a){var c=b.createElement("input");c.setAttribute("type","hidden"),a.appendChild(c).setAttribute("t",""),a.querySelectorAll("[t^='']").length&&p.push("[*^$]="+N+"*(?:''|\"\")"),a.querySelectorAll(":enabled").length||p.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),p.push(",.*:")});return(d.matchesSelector=$.test(r=n.webkitMatchesSelector||n.mozMatchesSelector||n.oMatchesSelector||n.msMatchesSelector))&&jb(function(a){d.disconnectedMatch=r.call(a,"div"),r.call(a,"[s!='']:x"),q.push("!=",R)}),p=p.length&&new RegExp(p.join("|")),q=q.length&&new RegExp(q.join("|")),s=$.test(n.contains)||n.compareDocumentPosition?function(a,b){var c=a.nodeType===9?a.documentElement:a,d=b&&b.parentNode;return a===d||!!d&&d.nodeType===1&&!!(c.contains?c.contains(d):a.compareDocumentPosition&&a.compareDocumentPosition(d)&16)}:function(a,b){if(b)while(b=b.parentNode)if(b===a)return!0;return!1},C=n.compareDocumentPosition?function(a,c){if(a===c)return B=!0,0;var e=c.compareDocumentPosition&&a.compareDocumentPosition&&a.compareDocumentPosition(c);if(e)return e&1||!d.sortDetached&&c.compareDocumentPosition(a)===e?a===b||s(v,a)?-1:c===b||s(v,c)?1:k?L.call(k,a)-L.call(k,c):0:e&4?-1:1;return a.compareDocumentPosition?-1:1}:function(a,c){var d,e=0,f=a.parentNode,g=c.parentNode,h=[a],i=[c];if(a===c)return B=!0,0;if(!f||!g)return a===b?-1:c===b?1:f?-1:g?1:k?L.call(k,a)-L.call(k,c):0;if(f===g)return lb(a,c);d=a;while(d=d.parentNode)h.unshift(d);d=c;while(d=d.parentNode)i.unshift(d);while(h[e]===i[e])e++;return e?lb(h[e],i[e]):h[e]===v?-1:i[e]===v?1:0},b},gb.matches=function(a,b){return gb(a,null,null,b)},gb.matchesSelector=function(a,b){(a.ownerDocument||a)!==m&&l(a),b=b.replace(W,"='$1']");if(d.matchesSelector&&o&&(!q||!q.test(b))&&(!p||!p.test(b)))try{var c=r.call(a,b);if(c||d.disconnectedMatch||a.document&&a.document.nodeType!==11)return c}catch(e){}return gb(b,m,null,[a]).length>0},gb.contains=function(a,b){return(a.ownerDocument||a)!==m&&l(a),s(a,b)},gb.attr=function(a,c){(a.ownerDocument||a)!==m&&l(a);var e=f.attrHandle[c.toLowerCase()],g=e&&F.call(f.attrHandle,c.toLowerCase())?e(a,c,!o):b;return g===b?d.attributes||!o?a.getAttribute(c):(g=a.getAttributeNode(c))&&g.specified?g.value:null:g},gb.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},gb.uniqueSort=function(a){var b,c=[],e=0,f=0;B=!d.detectDuplicates,k=!d.sortStable&&a.slice(0),a.sort(C);if(B){while(b=a[f++])b===a[f]&&(e=c.push(f));while(e--)a.splice(c[e],1)}return a},g=gb.getText=function(a){var b,c="",d=0,e=a.nodeType;if(!e)for(;b=a[d];d++)c+=g(b);else if(e===1||e===9||e===11){if(typeof a.textContent=="string")return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=g(a)}else if(e===3||e===4)return a.nodeValue;return c},f=gb.selectors={cacheLength:50,createPseudo:ib,match:Z,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(db,eb),a[3]=(a[4]||a[5]||"").replace(db,eb),a[2]==="~="&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),a[1].slice(0,3)==="nth"?(a[3]||gb.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*(a[3]==="even"||a[3]==="odd")),a[5]=+(a[7]+a[8]||a[3]==="odd")):a[3]&&gb.error(a[0]),a},PSEUDO:function(a){var c,d=!a[5]&&a[2];return Z.CHILD.test(a[0])?null:(a[3]&&a[4]!==b?a[2]=a[4]:d&&X.test(d)&&(c=qb(d,!0))&&(c=d.indexOf(")",d.length-c)-d.length)&&(a[0]=a[0].slice(0,c),a[2]=d.slice(0,c)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(db,eb).toLowerCase();return a==="*"?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=y[a+" "];return b||(b=new RegExp("(^|"+N+")"+a+"("+N+"|$)"))&&y(a,function(a){return b.test(typeof a.className=="string"&&a.className||typeof a.getAttribute!==D&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=gb.attr(d,a);return e==null?b==="!=":b?(e+="",b==="="?e===c:b==="!="?e!==c:b==="^="?c&&e.indexOf(c)===0:b==="*="?c&&e.indexOf(c)>-1:b==="$="?c&&e.slice(-c.length)===c:b==="~="?(" "+e+" ").indexOf(c)>-1:b==="|="?e===c||e.slice(0,c.length+1)===c+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f=a.slice(0,3)!=="nth",g=a.slice(-4)!=="last",h=b==="of-type";return d===1&&e===0?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h;if(q){if(f){while(p){l=b;while(l=l[p])if(h?l.nodeName.toLowerCase()===r:l.nodeType===1)return!1;o=p=a==="only"&&!o&&"nextSibling"}return!0}o=[g?q.firstChild:q.lastChild];if(g&&s){k=q[t]||(q[t]={}),j=k[a]||[],n=j[0]===w&&j[1],m=j[0]===w&&j[2],l=n&&q.childNodes
[n];while(l=++n&&l&&l[p]||(m=n=0)||o.pop())if(l.nodeType===1&&++m&&l===b){k[a]=[w,n,m];break}}else if(s&&(j=(b[t]||(b[t]={}))[a])&&j[0]===w)m=j[1];else while(l=++n&&l&&l[p]||(m=n=0)||o.pop())if((h?l.nodeName.toLowerCase()===r:l.nodeType===1)&&++m){s&&((l[t]||(l[t]={}))[a]=[w,m]);if(l===b)break}return m-=e,m===d||m%d===0&&m/d>=0}}},PSEUDO:function(a,b){var c,d=f.pseudos[a]||f.setFilters[a.toLowerCase()]||gb.error("unsupported pseudo: "+a);return d[t]?d(b):d.length>1?(c=[a,a,"",b],f.setFilters.hasOwnProperty(a.toLowerCase())?ib(function(a,c){var e,f=d(a,b),g=f.length;while(g--)e=L.call(a,f[g]),a[e]=!(c[e]=f[g])}):function(a){return d(a,0,c)}):d}},pseudos:{not:ib(function(a){var b=[],c=[],d=i(a.replace(S,"$1"));return d[t]?ib(function(a,b,c,e){var f,g=d(a,null,e,[]),h=a.length;while(h--)if(f=g[h])a[h]=!(b[h]=f)}):function(a,e,f){return b[0]=a,d(b,null,f,c),!c.pop()}}),has:ib(function(a){return function(b){return gb(a,b).length>0}}),contains:ib(function(a){return function(b){return(b.textContent||b.innerText||g(b)).indexOf(a)>-1}}),lang:ib(function(a){return Y.test(a||"")||gb.error("unsupported lang: "+a),a=a.replace(db,eb).toLowerCase(),function(b){var c;do if(c=o?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||c.indexOf(a+"-")===0;while((b=b.parentNode)&&b.nodeType===1);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===n},focus:function(a){return a===m.activeElement&&(!m.hasFocus||m.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return b==="input"&&!!a.checked||b==="option"&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeName>"@"||a.nodeType===3||a.nodeType===4)return!1;return!0},parent:function(a){return!f.pseudos.empty(a)},header:function(a){return bb.test(a.nodeName)},input:function(a){return ab.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return b==="input"&&a.type==="button"||b==="button"},text:function(a){var b;return a.nodeName.toLowerCase()==="input"&&a.type==="text"&&((b=a.getAttribute("type"))==null||b.toLowerCase()===a.type)},first:ob(function(){return[0]}),last:ob(function(a,b){return[b-1]}),eq:ob(function(a,b,c){return[c<0?c+b:c]}),even:ob(function(a,b){var c=0;for(;c<b;c+=2)a.push(c);return a}),odd:ob(function(a,b){var c=1;for(;c<b;c+=2)a.push(c);return a}),lt:ob(function(a,b,c){var d=c<0?c+b:c;for(;--d>=0;)a.push(d);return a}),gt:ob(function(a,b,c){var d=c<0?c+b:c;for(;++d<b;)a.push(d);return a})}},f.pseudos.nth=f.pseudos.eq;for(c in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})f.pseudos[c]=mb(c);for(c in{submit:!0,reset:!0})f.pseudos[c]=nb(c);pb.prototype=f.filters=f.pseudos,f.setFilters=new pb,i=gb.compile=function(a,b){var c,d=[],e=[],f=A[a+" "];if(!f){b||(b=qb(a)),c=b.length;while(c--)f=wb(b[c]),f[t]?d.push(f):e.push(f);f=A(a,xb(e,d))}return f},d.sortStable=t.split("").sort(C).join("")===t,d.detectDuplicates=B,l(),d.sortDetached=jb(function(a){return a.compareDocumentPosition(m.createElement("div"))&1}),jb(function(a){return a.innerHTML="<a href='#'></a>",a.firstChild.getAttribute("href")==="#"})||kb("type|href|height|width",function(a,b,c){if(!c)return a.getAttribute(b,b.toLowerCase()==="type"?1:2)}),(!d.attributes||!jb(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),a.firstChild.getAttribute("value")===""}))&&kb("value",function(a,b,c){if(!c&&a.nodeName.toLowerCase()==="input")return a.defaultValue}),jb(function(a){return a.getAttribute("disabled")==null})||kb(M,function(a,b,c){var d;if(!c)return(d=a.getAttributeNode(b))&&d.specified?d.value:a[b]===!0?b.toLowerCase():null}),u.find=gb,u.expr=gb.selectors,u.expr[":"]=u.expr.pseudos,u.unique=gb.uniqueSort,u.text=gb.getText,u.isXMLDoc=gb.isXML,u.contains=gb.contains}(a);var K={};u.Callbacks=function(a){a=typeof a=="string"?K[a]||L(a):u.extend({},a);var c,d,e,f,g,h,i=[],j=!a.once&&[],k=function(b){d=a.memory&&b,e=!0,g=h||0,h=0,f=i.length,c=!0;for(;i&&g<f;g++)if(i[g].apply(b[0],b[1])===!1&&a.stopOnFalse){d=!1;break}c=!1,i&&(j?j.length&&k(j.shift()):d?i=[]:l.disable())},l={add:function(){if(i){var b=i.length;(function e(b){u.each(b,function(b,c){var d=u.type(c);d==="function"?(!a.unique||!l.has(c))&&i.push(c):c&&c.length&&d!=="string"&&e(c)})})(arguments),c?f=i.length:d&&(h=b,k(d))}return this},remove:function(){return i&&u.each(arguments,function(a,b){var d;while((d=u.inArray(b,i,d))>-1)i.splice(d,1),c&&(d<=f&&f--,d<=g&&g--)}),this},has:function(a){return a?u.inArray(a,i)>-1:!!i&&!!i.length},empty:function(){return i=[],f=0,this},disable:function(){return i=j=d=b,this},disabled:function(){return!i},lock:function(){return j=b,d||l.disable(),this},locked:function(){return!j},fireWith:function(a,b){return i&&(!e||j)&&(b=b||[],b=[a,b.slice?b.slice():b],c?j.push(b):k(b)),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!e}};return l},u.extend({Deferred:function(a){var b=[["resolve","done",u.Callbacks("once memory"),"resolved"],["reject","fail",u.Callbacks("once memory"),"rejected"],["notify","progress",u.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return u.Deferred(function(c){u.each(b,function(b,f){var g=f[0],h=u.isFunction(a[b])&&a[b];e[f[1]](function(){var a=h&&h.apply(this,arguments);a&&u.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[g+"With"](this===d?c.promise():this,h?[a]:arguments)})}),a=null}).promise()},promise:function(a){return a!=null?u.extend(a,d):d}},e={};return d.pipe=d.then,u.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[a^1][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b=0,c=p.call(arguments),d=c.length,e=d!==1||a&&u.isFunction(a.promise)?d:0,f=e===1?a:u.Deferred(),g=function(a,b,c){return function(d){b[a]=this,c[a]=arguments.length>1?p.call(arguments):d,c===h?f.notifyWith(b,c):--e||f.resolveWith(b,c)}},h,i,j;if(d>1){h=new Array(d),i=new Array(d),j=new Array(d);for(;b<d;b++)c[b]&&u.isFunction(c[b].promise)?c[b].promise().done(g(b,j,c)).fail(f.reject).progress(g(b,i,h)):--e}return e||f.resolveWith(j,c),f.promise()}}),u.support=function(b){var c,d,f,h,i,j,k,l,m,n=g.createElement("div");n.setAttribute("className","t"),n.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",c=n.getElementsByTagName("*")||[],d=n.getElementsByTagName("a")[0];if(!d||!d.style||!c.length)return b;h=g.createElement("select"),j=h.appendChild(g.createElement("option")),f=n.getElementsByTagName("input")[0],d.style.cssText="top:1px;float:left;opacity:.5",b.getSetAttribute=n.className!=="t",b.leadingWhitespace=n.firstChild.nodeType===3,b.tbody=!n.getElementsByTagName("tbody").length,b.htmlSerialize=!!n.getElementsByTagName("link").length,b.style=/top/.test(d.getAttribute("style")),b.hrefNormalized=d.getAttribute("href")==="/a",b.opacity=/^0.5/.test(d.style.opacity),b.cssFloat=!!d.style.cssFloat,b.checkOn=!!f.value,b.optSelected=j.selected,b.enctype=!!g.createElement("form").enctype,b.html5Clone=g.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",b.inlineBlockNeedsLayout=!1,b.shrinkWrapBlocks=!1,b.pixelPosition=!1,b.deleteExpando=!0,b.noCloneEvent=!0,b.reliableMarginRight=!0,b.boxSizingReliable=!0,f.checked=!0,b.noCloneChecked=f.cloneNode(!0).checked,h.disabled=!0,b.optDisabled=!j.disabled;try{delete n.test}catch(o){b.deleteExpando=!1}f=g.createElement("input"),f.setAttribute("value",""),b.input=f.getAttribute("value")==="",f.value="t",f.setAttribute("type","radio"),b.radioValue=f.value==="t",f.setAttribute("checked","t"),f.setAttribute("name","t"),i=g.createDocumentFragment(),i.appendChild(f),b.appendChecked=f.checked,b.checkClone=i.cloneNode(!0).cloneNode(!0).lastChild.checked,n.attachEvent&&(n.attachEvent("onclick",function(){b.noCloneEvent=!1}),n.cloneNode(!0).click());for(m in{submit:!0,change:!0,focusin:!0})n.setAttribute(k="on"+m,"t"),b[m+"Bubbles"]=k in a||n.attributes[k].expando===!1;n.style.backgroundClip="content-box",n.cloneNode(!0).style.backgroundClip="",b.clearCloneStyle=n.style.backgroundClip==="content-box";for(m in u(b))break;return b.ownLast=m!=="0",u(function(){var c,d,f,h="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",i=g.getElementsByTagName("body")[0];if(!i)return;c=g.createElement("div"),c.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",i.appendChild(c).appendChild(n),n.innerHTML="<table><tr><td></td><td>t</td></tr></table>",f=n.getElementsByTagName("td"),f[0].style.cssText="padding:0;margin:0;border:0;display:none",l=f[0].offsetHeight===0,f[0].style.display="",f[1].style.display="none",b.reliableHiddenOffsets=l&&f[0].offsetHeight===0,n.innerHTML="",n.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",u.swap(i,i.style.zoom!=null?{zoom:1}:{},function(){b.boxSizing=n.offsetWidth===4}),a.getComputedStyle&&(b.pixelPosition=(a.getComputedStyle(n,null)||{}).top!=="1%",b.boxSizingReliable=(a.getComputedStyle(n,null)||{width:"4px"}).width==="4px",d=n.appendChild(g.createElement("div")),d.style.cssText=n.style.cssText=h,d.style.marginRight=d.style.width="0",n.style.width="1px",b.reliableMarginRight=!parseFloat((a.getComputedStyle(d,null)||{}).marginRight)),typeof n.style.zoom!==e&&(n.innerHTML="",n.style.cssText=h+"width:1px;padding:1px;display:inline;zoom:1",b.inlineBlockNeedsLayout=n.offsetWidth===3,n.style.display="block",n.innerHTML="<div></div>",n.firstChild.style.width="5px",b.shrinkWrapBlocks=n.offsetWidth!==3,b.inlineBlockNeedsLayout&&(i.style.zoom=1)),i.removeChild(c),c=n=f=d=null}),c=h=i=j=d=f=null,b}({});var M=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,N=/([A-Z])/g;u.extend({cache:{},noData:{applet:!0,embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(a){return a=a.nodeType?u.cache[a[u.expando]]:a[u.expando],!!a&&!R(a)},data:function(a,b,c){return O(a,b,c)},removeData:function(a,b){return P(a,b)},_data:function(a,b,c){return O(a,b,c,!0)},_removeData:function(a,b){return P(a,b,!0)},acceptData:function(a){if(a.nodeType&&a.nodeType!==1&&a.nodeType!==9)return!1;var b=a.nodeName&&u.noData[a.nodeName.toLowerCase()];return!b||b!==!0&&a.getAttribute("classid")===b}}),u.fn.extend({data:function(a,c){var d,e,f=null,g=0,h=this[0];if(a===b){if(this.length){f=u.data(h);if(h.nodeType===1&&!u._data(h,"parsedAttrs")){d=h.attributes;for(;g<d.length;g++)e=d[g].name,e.indexOf("data-")===0&&(e=u.camelCase(e.slice(5)),Q(h,e,f[e]));u._data(h,"parsedAttrs",!0)}}return f}return typeof a=="object"?this.each(function(){u.data(this,a)}):arguments.length>1?this.each(function(){u.data(this,a,c)}):h?Q(h,a,u.data(h,a)):null},removeData:function(a){return this.each(function(){u.removeData(this,a)})}}),u.extend({queue:function(a,b,c){var d;if(a)return b=(b||"fx")+"queue",d=u._data(a,b),c&&(!d||u.isArray(c)?d=u._data(a,b,u.makeArray(c)):d.push(c)),d||[]},dequeue:function(a,b){b=b||"fx";var c=u.queue(a,b),d=c.length,e=c.shift(),f=u._queueHooks(a,b),g=function(){u.dequeue(a,b)};e==="inprogress"&&(e=c.shift(),d--),e&&(b==="fx"&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return u._data(a,c)||u._data(a,c,{empty:u.Callbacks("once memory").add(function(){u._removeData(a,b+"queue"),u._removeData(a,c)})})}}),u.fn.extend({queue:function(a,c){var d=2;return typeof a!="string"&&(c=a,a="fx",d--),arguments.length<d?u.queue(this[0],a):c===b?this:this.each(function(){var b=u.queue(this,a,c);u._queueHooks(this,a),a==="fx"&&b[0]!=="inprogress"&&u.dequeue(this,a)})},dequeue:function(a){return this.each(function(){u.dequeue(this,a)})},delay:function(a,b){return a=u.fx?u.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){var d,e=1,f=u.Deferred(),g=this,h=this.length,i=function(){--e||f.resolveWith(g,[g])};typeof a!="string"&&(c=a,a=b),a=a||"fx";while(h--)d=u._data(g[h],a+"queueHooks"),d&&d.empty&&(e++,d.empty.add(i));return i(),f.promise(c)}});var S,T,U=/[\t\r\n\f]/g,V=/\r/g,W=/^(?:input|select|textarea|button|object)$/i,X=/^(?:a|area)$/i,Y=/^(?:checked|selected)$/i,Z=u.support.getSetAttribute,$=u.support.input;u.fn.extend({attr:function(a,b){return u.access(this,u.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){u.removeAttr(this,a)})},prop:function(a,b){return u.access(this,u.prop,a,b,arguments.length>1)},removeProp:function(a){return a=u.propFix[a]||a,this.each(function(){try{this[a]=b,delete this[a]}catch(c){}})},addClass:function(a){var b,c,d,e,f,g=0,h=this.length,i=typeof a=="string"&&a;if(u.isFunction(a))return this.each(function(b){u(this).addClass(a.call(this,b,this.className))});if(i){b=(a||"").match(w)||[];for(;g<h;g++){c=this[g],d=c.nodeType===1&&(c.className?(" "+c.className+" ").replace(U," "):" ");if(d){f=0;while(e=b[f++])d.indexOf(" "+e+" ")<0&&(d+=e+" ");c.className=u.trim(d)}}}return this},removeClass:function(a){var b,c,d,e,f,g=0,h=this.length,i=arguments.length===0||typeof a=="string"&&a;if(u.isFunction(a))return this.each(function(b){u(this).removeClass(a.call(this,b,this.className))});if(i){b=(a||"").match(w)||[];for(;g<h;g++){c=this[g],d=c.nodeType===1&&(c.className?(" "+c.className+" ").replace(U," "):"");if(d){f=0;while(e=b[f++])while(d.indexOf(" "+e+" ")>=0)d=d.replace(" "+e+" "," ");c.className=a?u.trim(d):""}}}return this},toggleClass:function(a,b){var c=typeof a;return typeof b=="boolean"&&c==="string"?b?this.addClass(a):this.removeClass(a):u.isFunction(a)?this.each(function(c){u(this).toggleClass(a.call(this,c,this.className,b),b)}):this.each(function(){if(c==="string"){var b,d=0,f=u(this),g=a.match(w)||[];while(b=g[d++])f.hasClass(b)?f.removeClass(b):f.addClass(b)}else if(c===e||c==="boolean")this.className&&u._data(this,"__className__",this.className),this.className=this.className||a===!1?"":u._data(this,"__className__")||""})},hasClass:function(a){var b=" "+a+" ",c=0,d=this.length;for(;c<d;c++)if(this[c].nodeType===1&&(" "+this[c].className+" ").replace(U," ").indexOf(b)>=0)return!0;return!1},val:function(a){var c,d,e,f=this[0];if(!arguments.length){if(f)return d=u.valHooks[f.type]||u.valHooks[f.nodeName.toLowerCase()],d&&"get"in d&&(c=d.get(f,"value"))!==b?c:(c=f.value,typeof c=="string"?c.replace(V,""):c==null?"":c);return}return e=u.isFunction(a),this.each(function(c){var f;if(this.nodeType!==1)return;e?f=a.call(this,c,u(this).val()):f=a,f==null?f="":typeof f=="number"?f+="":u.isArray(f)&&(f=u.map(f,function(a){return a==null?"":a+""})),d=u.valHooks[this.type]||u.valHooks[this.nodeName.toLowerCase()];if(!d||!("set"in d)||d.set(this,f,"value")===b)this.value=f})}}),u.extend({valHooks:{option:{get:function(a){var b=u.find.attr(a,"value");return b!=null?b:a.text}},select:{get:function(a){var b,c,d=a.options,e=a.selectedIndex,f=a.type==="select-one"||e<0,g=f?null:[],h=f?e+1:d.length,i=e<0?h:f?e:0;for(;i<h;i++){c=d[i];if((c.selected||i===e)&&(u.support.optDisabled?!c.disabled:c.getAttribute("disabled")===null)&&(!c.parentNode.disabled||!u.nodeName(c.parentNode,"optgroup"))){b=u(c).val();if(f)return b;g.push(b)}}return g},set:function(a,b){var c,d,e=a.options,f=u.makeArray(b),g=e.length;while(g--){d=e[g];if(d.selected=u.inArray(u(d).val(),f)>=0)c=!0}return c||(a.selectedIndex=-1),f}}},attr:function(a,c,d){var f,g,h=a.nodeType;if(!a||h===3||h===8||h===2)return;if(typeof a.getAttribute===e)return u.prop(a,c,d);if(h!==1||!u.isXMLDoc(a))c=c.toLowerCase(),f=u.attrHooks[c]||(u.expr.match.bool.test(c)?T:S);if(d===b)return f&&"get"in f&&(g=f.get(a,c))!==null?g:(g=u.find.attr(a,c),g==null?b:g);if(d!==null)return f&&"set"in f&&(g=f.set(a,d,c))!==b?g:(a.setAttribute(c,d+""),d);u.removeAttr(a,c)},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(w);if(f&&a.nodeType===1)while(c=f[e++])d=u.propFix[c]||c,u.expr.match.bool.test(c)?$&&Z||!Y.test(c)?a[d]=!1:a[u.camelCase("default-"+c)]=a[d]=!1:u.attr(a,c,""),a.removeAttribute(Z?c:d)},attrHooks:{type:{set:function(a,b){if(!u.support.radioValue&&b==="radio"&&u.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(a,c,d){var e,f,g,h=a.nodeType;if(!a||h===3||h===8||h===2)return;return g=h!==1||!u.isXMLDoc(a),g&&(c=u.propFix[c]||c,f=u.propHooks[c]),d!==b?f&&"set"in f&&(e=f.set(a,d,c))!==b?e:a[c]=d:f&&"get"in f&&(e=f.get(a,c))!==null?e:a[c]},propHooks:{tabIndex:{get:function(a){var b=u.find.attr(a,"tabindex");return b?parseInt(b,10):W.test(a.nodeName)||X.test(a.nodeName)&&a.href?0:-1}}}}),T={set:function(a,b,c){return b===!1?u.removeAttr(a,c):$&&Z||!Y.test(c)?a.setAttribute(!Z&&u.propFix[c]||c,c):a[u.camelCase("default-"+c)]=a[c]=!0,c}},u.each(u.expr.match.bool.source.match(/\w+/g),function(a,c){var d=u.expr.attrHandle[c]||u.find.attr;u.expr.attrHandle[c]=$&&Z||!Y.test(c)?function(a,c,e){var f=u.expr.attrHandle[c],g=e?b:(u.expr.attrHandle[c]=b)!=d(a,c,e)?c.toLowerCase():null;return u.expr.attrHandle[c]=f,g}:function(a,c,d){return d?b:a[u.camelCase("default-"+c)]?c.toLowerCase():null}});if(!$||!Z)u.attrHooks.value={set:function(a,b,c){if(!u.nodeName(a,"input"))return S&&S.set(a,b,c);a.defaultValue=b}};Z||(S={set:function(a,c,d){var e=a.getAttributeNode(d);return e||a.setAttributeNode(e=a.ownerDocument.createAttribute(d)),e.value=c+="",d==="value"||c===a.getAttribute(d)?c:b}},u.expr.attrHandle.id=u.expr.attrHandle.name=u.expr.attrHandle.coords=function(a,c,d){var e;return d?b:(e=a.getAttributeNode(c))&&e.value!==""?e.value:null},u.valHooks.button={get:function(a,c){var d=a.getAttributeNode(c);return d&&d.specified?d.value:b},set:S.set},u.attrHooks.contenteditable={set:function(a,b,c){S.set(a,b===""?!1:b,c)}},u.each(["width","height"],function(a,b){u.attrHooks[b]={set:function(a,c){if(c==="")return a.setAttribute(b,"auto"),c}}})),u.support.hrefNormalized||u.each(["href","src"],function(a,b){u.propHooks[b]={get:function(a){return a.getAttribute(b,4)}}}),u.support.style||(u.attrHooks.style={get:function(a){return a.style.cssText||b},set:function(a,b){return a.style.cssText=b+""}}),u.support.optSelected||(u.propHooks.selected={get:function(a){var b=a.parentNode;return b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex),null}}),u.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){u.propFix[this.toLowerCase()]=this}),u.support.enctype||(u.propFix.enctype="encoding"),u.each(["radio","checkbox"],function(){u.valHooks[this]={set:function(a,b){if(u.isArray(b))return a.checked=u.inArray(u(a).val(),b)>=0}},u.support.checkOn||(u.valHooks[this].get=function(a){return a.getAttribute("value")===null?"on":a.value})});var _=/^(?:input|select|textarea)$/i,ab=/^key/,bb=/^(?:mouse|contextmenu)|click/,cb=/^(?:focusinfocus|focusoutblur)$/,db=/^([^.]*)(?:\.(.+)|)$/;u.event={global:{},add:function(a,c,d,f,g){var h,i,j,k,l,m,n,o,p,q,r,s=u._data(a);if(!s)return;d.handler&&(k=d,d=k.handler,g=k.selector),d.guid||(d.guid=u.guid++),(i=s.events)||(i=s.events={}),(m=s.handle)||(m=s.handle=function(a){return typeof u===e||!!a&&u.event.triggered===a.type?b:u.event.dispatch.apply(m.elem,arguments)},m.elem=a),c=(c||"").match(w)||[""],j=c.length;while(j--){h=db.exec(c[j])||[],p=r=h[1],q=(h[2]||"").split(".").sort();if(!p)continue;l=u.event.special[p]||{},p=(g?l.delegateType:l.bindType)||p,l=u.event.special[p]||{},n=u.extend({type:p,origType:r,data:f,handler:d,guid:d.guid,selector:g,needsContext:g&&u.expr.match.needsContext.test(g),namespace:q.join(".")},k);if(!(o=i[p])){o=i[p]=[],o.delegateCount=0;if(!l.setup||l.setup.call(a,f,q,m)===!1)a.addEventListener?a.addEventListener(p,m,!1):a.attachEvent&&a.attachEvent("on"+p,m)}l.add&&(l.add.call(a,n),n.handler.guid||(n.handler.guid=d.guid)),g?o.splice(o.delegateCount++,0,n):o.push(n),u.event.global[p]=!0}a=null},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=u.hasData(a)&&u._data(a);if(!q||!(k=q.events))return;b=(b||"").match(w)||[""],j=b.length;while(j--){h=db.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort();if(!n){for(n in k)u.event.remove(a,n+b[j],c,d,!0);continue}l=u.event.special[n]||{},n=(d?l.delegateType:l.bindType)||n,m=k[n]||[],h=h[2]&&new RegExp("(^|\\.)"+o.join("\\.(?:.*\\.|)")+"(\\.|$)"),i=f=m.length;while(f--)g=m[f],(e||p===g.origType)&&(!c||c.guid===g.guid)&&(!h||h.test(g.namespace))&&(!d||d===g.selector||d==="**"&&g.selector)&&(m.splice(f,1),g.selector&&m.delegateCount--,l.remove&&l.remove.call(a,g));i&&!m.length&&((!l.teardown||l.teardown.call(a,o,q.handle)===!1)&&u.removeEvent(a,n,q.handle),delete k[n])}u.isEmptyObject(k)&&(delete q.handle,u._removeData(a,"events"))},trigger:function(c,d,e,f){var h,i,j,k,l,m,n,o=[e||g],p=s.call(c,"type")?c.type:c,q=s.call(c,"namespace")?c.namespace.split("."):[];j=m=e=e||g;if(e.nodeType===3||e.nodeType===8)return;if(cb.test(p+u.event.triggered))return;p.indexOf(".")>=0&&(q=p.split("."),p=q.shift(),q.sort()),i=p.indexOf(":")<0&&"on"+p,c=c[u.expando]?c:new u.Event(p,typeof c=="object"&&c),c.isTrigger=f?2:3,c.namespace=q.join("."),c.namespace_re=c.namespace?new RegExp("(^|\\.)"+q.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,c.result=b,c.target||(c.target=e),d=d==null?[c]:u.makeArray(d,[c]),l=u.event.special[p]||{};if(!f&&l.trigger&&l.trigger.apply(e,d)===!1)return;if(!f&&!l.noBubble&&!u.isWindow(e)){k=l.delegateType||p,cb.test(k+p)||(j=j.parentNode);for(;j;j=j.parentNode)o.push(j),m=j;m===(e.ownerDocument||g)&&o.push(m.defaultView||m.parentWindow||a)}n=0;while((j=o[n++])&&!c.isPropagationStopped())c.type=n>1?k:l.bindType||p,h=(u._data(j,"events")||{})[c.type]&&u._data(j,"handle"),h&&h.apply(j,d),h=i&&j[i],h&&u.acceptData(j)&&h.apply&&h.apply(j,d)===!1&&c.preventDefault();c.type=p;if(!f&&!c.isDefaultPrevented()&&(!l._default||l._default.apply(o.pop(),d)===!1)&&u.acceptData(e)&&i&&e[p]&&!u.isWindow(e)){m=e[i],m&&(e[i]=null),u.event.triggered=p;try{e[p]()}catch(r){}u.event.triggered=b,m&&(e[i]=m)}return c.result},dispatch:function(a){a=u.event.fix(a);var c,d,e,f,g,h=[],i=p.call(arguments),j=(u._data(this,"events")||{})[a.type]||[],k=u.event.special[a.type]||{};i[0]=a,a.delegateTarget=this;if(k.preDispatch&&k.preDispatch.call(this,a)===!1)return;h=u.event.handlers.call(this,a,j),c=0;while((f=h[c++])&&!a.isPropagationStopped()){a.currentTarget=f.elem,g=0;while((e=f.handlers[g++])&&!a.isImmediatePropagationStopped())if(!a.namespace_re||a.namespace_re.test(e.namespace))a.handleObj=e,a.data=e.data,d=((u.event.special[e.origType]||{}).handle||e.handler).apply(f.elem,i),d!==b&&(a.result=d)===!1&&(a.preventDefault(),a.stopPropagation())}return k.postDispatch&&k.postDispatch.call(this,a),a.result},handlers:function(a,c){var d,e,f,g,h=[],i=c.delegateCount,j=a.target;if(i&&j.nodeType&&(!a.button||a.type!=="click"))for(;j!=this;j=j.parentNode||this)if(j.nodeType===1&&(j.disabled!==!0||a.type!=="click")){f=[];for(g=0;g<i;g++)e=c[g],d=e.selector+" ",f[d]===b&&(f[d]=e.needsContext?u(d,this).index(j)>=0:u.find(d,this,null,[j]).length),f[d]&&f.push(e);f.length&&h.push({elem:j,handlers:f})}return i<c.length&&h.push({elem:this,handlers:c.slice(i)}),h},fix:function(a){if(a[u.expando])return a;var b,c,d,e=a.type,f=a,h=this.fixHooks[e];h||(this.fixHooks[e]=h=bb.test(e)?this.mouseHooks:ab.test(e)?this.keyHooks:{}),d=h.props?this.props.concat(h.props):this.props,a=new u.Event(f),b=d.length;while(b--)c=d[b],a[c]=f[c];return a.target||(a.target=f.srcElement||g),a.target.nodeType===3&&(a.target=a.target.parentNode),a.metaKey=!!a.metaKey,h.filter?h.filter(a,f):a},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return a.which==null&&(a.which=b.charCode!=null?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,c){var d,e,f,h=c.button,i=c.fromElement;return a.pageX==null&&c.clientX!=null&&(e=a.target.ownerDocument||g,f=e.documentElement,d=e.body,a.pageX=c.clientX+(f&&f.scrollLeft||d&&d.scrollLeft||0)-(f&&f.clientLeft||d&&d.clientLeft||0),a.pageY=c.clientY+(f&&f.scrollTop||d&&d.scrollTop||0)-(f&&f.clientTop||d&&d.clientTop||0)),!a.relatedTarget&&i&&(a.relatedTarget=i===a.target?c.toElement:i),!a.which&&h!==b&&(a.which=h&1?1:h&2?3:h&4?2:0),a}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==gb()&&this.focus)try{return this.focus(),!1}catch(a){}},delegateType:"focusin"},blur:{trigger:function(){if(this===gb()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if(u.nodeName(this,"input")&&this.type==="checkbox"&&this.click)return this.click(),!1},_default:function(a){return u.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){a.result!==b&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c,d){var e=u.extend(new u.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?u.event.trigger(e,null,b):u.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},u.removeEvent=g.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){var d="on"+b;a.detachEvent&&(typeof a[d]===e&&(a[d]=null),a.detachEvent(d,c))},u.Event=function(a,b){if(!(this instanceof u.Event))return new u.Event(a,b);a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault()?eb:fb):this.type=a,b&&u.extend(this,b),this.timeStamp=a&&a.timeStamp||u.now(),this[u.expando]=!0},u.Event.prototype={isDefaultPrevented:fb,isPropagationStopped:fb,isImmediatePropagationStopped:fb,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=eb;if(!a)return;a.preventDefault?a.preventDefault():a.returnValue=!1},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=eb;if(!a)return;a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=eb,this.stopPropagation()}},u.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){u.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;if(!e||e!==d&&!u.contains(d,e))a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b;return c}}}),u.support.submitBubbles||(u.event.special.submit={setup:function(){if(u.nodeName(this,"form"))return!1;u.event.add(this,"click._submit keypress._submit",function(a){var c=a.target,d=u.nodeName(c,"input")||u.nodeName(c,"button")?c.form:b;d&&!u._data(d,"submitBubbles")&&(u.event.add(d,"submit._submit",function(a){a._submit_bubble=!0}),u._data(d,"submitBubbles",!0))})},postDispatch:function(a){a._submit_bubble&&(delete a._submit_bubble,this.parentNode&&!a.isTrigger&&u.event.simulate("submit",this.parentNode,a,!0))},teardown:function(){if(u.nodeName(this,"form"))return!1;u.event.remove(this,"._submit")}}),u.support.changeBubbles||(u.event.special.change={setup:function(){if(_.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")u.event.add(this,"propertychange._change",function(a){a.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),u.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1),u.event.simulate("change",this,a,!0)});return!1}u.event.add(this,"beforeactivate._change",function(a){var b=a.target;_.test(b.nodeName)&&!u._data(b,"changeBubbles")&&(u.event.add(b,"change._change",function(a){this.parentNode&&!a.isSimulated&&!a.isTrigger&&u.event.simulate("change",this.parentNode,a,!0)}),u._data(b,"changeBubbles",!0))})},handle:function(a){var b=a.target;if(this!==b||a.isSimulated||a.isTrigger||b.type!=="radio"&&b.type!=="checkbox")return a.handleObj.handler.apply(this,arguments)},teardown:function(){return u.event.remove(this,"._change"),!_.test(this.nodeName)}}),u.support.focusinBubbles||u.each({focus:"focusin",blur:"focusout"},function(a,b){var c=0,d=function(a){u.event.simulate(b,a.target,u.event.fix(a),!0)};u.event.special[b]={setup:function(){c++===0&&g.addEventListener(a,d,!0)},teardown:function(){--c===0&&g.removeEventListener(a,d,!0)}}}),u.fn.extend({on:function(a,c,d,e,f){var g,h;if(typeof a=="object"){typeof c!="string"&&(d=d||c,c=b);for(g in a)this.on(g,c,d,a[g],f);return this}d==null&&e==null?(e=c,d=c=b):e==null&&(typeof c=="string"?(e=d,d=b):(e=d,d=c,c=b));if(e===!1)e=fb;else if(!e)return this;return f===1&&(h=e,e=function(a){return u().off(a),h.apply(this,arguments)},e.guid=h.guid||(h.guid=u.guid++)),this.each(function(){u.event.add(this,a,e,d,c)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,c,d){var e,f;if(a&&a.preventDefault&&a.handleObj)return e=a.handleObj,u(a.delegateTarget).off(e.namespace?e.origType+"."+e.namespace:e.origType,e.selector,e.handler),this;if(typeof a=="object"){for(f in a)this.off(f,c,a[f]);return this}if(c===!1||typeof c=="function")d=c,c=b;return d===!1&&(d=fb),this.each(function(){u.event.remove(this,a,d,c)})},trigger:function(a,b){return this.each(function(){u.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];if(c)return u.event.trigger(a,b,c,!0)}});var hb=/^.[^:#\[\.,]*$/,ib=/^(?:parents|prev(?:Until|All))/,jb=u.expr.match.needsContext,kb={children:!0,contents:!0,next:!0,prev:!0};u.fn.extend({find:function(a){var b,c=[],d=this,e=d.length;if(typeof a!="string")return this.pushStack(u(a).filter(function(){for(b=0;b<e;b++)if(u.contains(d[b],this))return!0}));for(b=0;b<e;b++)u.find(a,d[b],c);return c=this.pushStack(e>1?u.unique(c):c),c.selector=this.selector?this.selector+" "+a:a,c},has:function(a){var b,c=u(a,this),d=c.length;return this.filter(function(){for(b=0;b<d;b++)if(u.contains(this,c[b]))return!0})},not:function(a){return this.pushStack(mb(this,a||[],!0))},filter:function(a){return this.pushStack(mb(this,a||[],!1))},is:function(a){return!!mb(this,typeof a=="string"&&jb.test(a)?u(a):a||[],!1).length},closest:function(a,b){var c,d=0,e=this.length,f=[],g=jb.test(a)||typeof a!="string"?u(a,b||this.context):0;for(;d<e;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:c.nodeType===1&&u.find.matchesSelector(c,a))){c=f.push(c);break}return this.pushStack(f.length>1?u.unique(f):f)},index:function(a){return a?typeof a=="string"?u.inArray(this[0],u(a)):u.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){var c=typeof a=="string"?u(a,b):u.makeArray(a&&a.nodeType?[a]:a),d=u.merge(this.get(),c);return this.pushStack(u.unique(d))},addBack:function(a){return this.add(a==null?this.prevObject:this.prevObject.filter(a))}}),u.each({parent:function(a){var b=a.parentNode;return b&&b.nodeType!==11?b:null},parents:function(a){return u.dir(a,"parentNode")},parentsUntil:function(a,b,c){return u.dir(a,"parentNode",c)},next:function(a){return lb(a,"nextSibling")},prev:function(a){return lb(a,"previousSibling")},nextAll:function(a){return u.dir(a,"nextSibling")},prevAll:function(a){return u.dir(a,"previousSibling")},nextUntil:function(a,b,c){return u.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return u.dir(a,"previousSibling",c)},siblings:function(a){return u.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return u.sibling(a.firstChild)},contents:function(a){return u.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:u.merge([],a.childNodes)}},function(a,b){u.fn[a]=function(c,d){var e=u.map(this,b,c);return a.slice(-5)!=="Until"&&(d=c),d&&typeof d=="string"&&(e=u.filter(d,e)),this.length>1&&(kb[a]||(e=u.unique(e)),ib.test(a)&&(e=e.reverse())),this.pushStack(e)}}),u.extend({filter:function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),b.length===1&&d.nodeType===1?u.find.matchesSelector(d,a)?[d]:[]:u.find.matches(a,u.grep(b,function(a){return a.nodeType===1}))},dir:function(a,c,d){var e=[],f=a[c];while(f&&f.nodeType!==9&&(d===b||f.nodeType!==1||!u(f).is(d)))f.nodeType===1&&e.push(f),f=f[c];return e},sibling:function(a,b){var c=[];for(;a;a=a.nextSibling)a.nodeType===1&&
a!==b&&c.push(a);return c}});var ob="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",pb=/ jQuery\d+="(?:null|\d+)"/g,qb=new RegExp("<(?:"+ob+")[\\s/>]","i"),rb=/^\s+/,sb=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,tb=/<([\w:]+)/,ub=/<tbody/i,vb=/<|&#?\w+;/,wb=/<(?:script|style|link)/i,xb=/^(?:checkbox|radio)$/i,yb=/checked\s*(?:[^=]|=\s*.checked.)/i,zb=/^$|\/(?:java|ecma)script/i,Ab=/^true\/(.*)/,Bb=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Cb={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:u.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},Db=nb(g),Eb=Db.appendChild(g.createElement("div"));Cb.optgroup=Cb.option,Cb.tbody=Cb.tfoot=Cb.colgroup=Cb.caption=Cb.thead,Cb.th=Cb.td,u.fn.extend({text:function(a){return u.access(this,function(a){return a===b?u.text(this):this.empty().append((this[0]&&this[0].ownerDocument||g).createTextNode(a))},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var b=Fb(this,a);b.appendChild(a)}})},prepend:function(){return this.domManip(arguments,function(a){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var b=Fb(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){var c,d=a?u.filter(a,this):this,e=0;for(;(c=d[e])!=null;e++)!b&&c.nodeType===1&&u.cleanData(Lb(c)),c.parentNode&&(b&&u.contains(c.ownerDocument,c)&&Ib(Lb(c,"script")),c.parentNode.removeChild(c));return this},empty:function(){var a,b=0;for(;(a=this[b])!=null;b++){a.nodeType===1&&u.cleanData(Lb(a,!1));while(a.firstChild)a.removeChild(a.firstChild);a.options&&u.nodeName(a,"select")&&(a.options.length=0)}return this},clone:function(a,b){return a=a==null?!1:a,b=b==null?a:b,this.map(function(){return u.clone(this,a,b)})},html:function(a){return u.access(this,function(a){var c=this[0]||{},d=0,e=this.length;if(a===b)return c.nodeType===1?c.innerHTML.replace(pb,""):b;if(typeof a=="string"&&!wb.test(a)&&(u.support.htmlSerialize||!qb.test(a))&&(u.support.leadingWhitespace||!rb.test(a))&&!Cb[(tb.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(sb,"<$1></$2>");try{for(;d<e;d++)c=this[d]||{},c.nodeType===1&&(u.cleanData(Lb(c,!1)),c.innerHTML=a);c=0}catch(f){}}c&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=u.map(this,function(a){return[a.nextSibling,a.parentNode]}),b=0;return this.domManip(arguments,function(c){var d=a[b++],e=a[b++];e&&(d&&d.parentNode!==e&&(d=this.nextSibling),u(this).remove(),e.insertBefore(c,d))},!0),b?this:this.remove()},detach:function(a){return this.remove(a,!0)},domManip:function(a,b,c){a=n.apply([],a);var d,e,f,g,h,i,j=0,k=this.length,l=this,m=k-1,o=a[0],p=u.isFunction(o);if(p||!(k<=1||typeof o!="string"||u.support.checkClone||!yb.test(o)))return this.each(function(d){var e=l.eq(d);p&&(a[0]=o.call(this,d,e.html())),e.domManip(a,b,c)});if(k){i=u.buildFragment(a,this[0].ownerDocument,!1,!c&&this),d=i.firstChild,i.childNodes.length===1&&(i=d);if(d){g=u.map(Lb(i,"script"),Gb),f=g.length;for(;j<k;j++)e=i,j!==m&&(e=u.clone(e,!0,!0),f&&u.merge(g,Lb(e,"script"))),b.call(this[j],e,j);if(f){h=g[g.length-1].ownerDocument,u.map(g,Hb);for(j=0;j<f;j++)e=g[j],zb.test(e.type||"")&&!u._data(e,"globalEval")&&u.contains(h,e)&&(e.src?u._evalUrl(e.src):u.globalEval((e.text||e.textContent||e.innerHTML||"").replace(Bb,"")))}i=d=null}}return this}}),u.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){u.fn[a]=function(a){var c,d=0,e=[],f=u(a),g=f.length-1;for(;d<=g;d++)c=d===g?this:this.clone(!0),u(f[d])[b](c),o.apply(e,c.get());return this.pushStack(e)}}),u.extend({clone:function(a,b,c){var d,e,f,g,h,i=u.contains(a.ownerDocument,a);u.support.html5Clone||u.isXMLDoc(a)||!qb.test("<"+a.nodeName+">")?f=a.cloneNode(!0):(Eb.innerHTML=a.outerHTML,Eb.removeChild(f=Eb.firstChild));if((!u.support.noCloneEvent||!u.support.noCloneChecked)&&(a.nodeType===1||a.nodeType===11)&&!u.isXMLDoc(a)){d=Lb(f),h=Lb(a);for(g=0;(e=h[g])!=null;++g)d[g]&&Kb(e,d[g])}if(b)if(c){h=h||Lb(a),d=d||Lb(f);for(g=0;(e=h[g])!=null;g++)Jb(e,d[g])}else Jb(a,f);return d=Lb(f,"script"),d.length>0&&Ib(d,!i&&Lb(a,"script")),d=h=e=null,f},buildFragment:function(a,b,c,d){var e,f,g,h,i,j,k,l=a.length,m=nb(b),n=[],o=0;for(;o<l;o++){f=a[o];if(f||f===0)if(u.type(f)==="object")u.merge(n,f.nodeType?[f]:f);else if(!vb.test(f))n.push(b.createTextNode(f));else{h=h||m.appendChild(b.createElement("div")),i=(tb.exec(f)||["",""])[1].toLowerCase(),k=Cb[i]||Cb._default,h.innerHTML=k[1]+f.replace(sb,"<$1></$2>")+k[2],e=k[0];while(e--)h=h.lastChild;!u.support.leadingWhitespace&&rb.test(f)&&n.push(b.createTextNode(rb.exec(f)[0]));if(!u.support.tbody){f=i==="table"&&!ub.test(f)?h.firstChild:k[1]==="<table>"&&!ub.test(f)?h:0,e=f&&f.childNodes.length;while(e--)u.nodeName(j=f.childNodes[e],"tbody")&&!j.childNodes.length&&f.removeChild(j)}u.merge(n,h.childNodes),h.textContent="";while(h.firstChild)h.removeChild(h.firstChild);h=m.lastChild}}h&&m.removeChild(h),u.support.appendChecked||u.grep(Lb(n,"input"),Mb),o=0;while(f=n[o++]){if(d&&u.inArray(f,d)!==-1)continue;g=u.contains(f.ownerDocument,f),h=Lb(m.appendChild(f),"script"),g&&Ib(h);if(c){e=0;while(f=h[e++])zb.test(f.type||"")&&c.push(f)}}return h=null,m},cleanData:function(a,b){var c,d,f,g,h=0,i=u.expando,j=u.cache,k=u.support.deleteExpando,m=u.event.special;for(;(c=a[h])!=null;h++)if(b||u.acceptData(c)){f=c[i],g=f&&j[f];if(g){if(g.events)for(d in g.events)m[d]?u.event.remove(c,d):u.removeEvent(c,d,g.handle);j[f]&&(delete j[f],k?delete c[i]:typeof c.removeAttribute!==e?c.removeAttribute(i):c[i]=null,l.push(f))}}},_evalUrl:function(a){return u.ajax({url:a,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})}}),u.fn.extend({wrapAll:function(a){if(u.isFunction(a))return this.each(function(b){u(this).wrapAll(a.call(this,b))});if(this[0]){var b=u(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&a.firstChild.nodeType===1)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){return u.isFunction(a)?this.each(function(b){u(this).wrapInner(a.call(this,b))}):this.each(function(){var b=u(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=u.isFunction(a);return this.each(function(c){u(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){u.nodeName(this,"body")||u(this).replaceWith(this.childNodes)}).end()}});var Nb,Ob,Pb,Qb=/alpha\([^)]*\)/i,Rb=/opacity\s*=\s*([^)]*)/,Sb=/^(top|right|bottom|left)$/,Tb=/^(none|table(?!-c[ea]).+)/,Ub=/^margin/,Vb=new RegExp("^("+v+")(.*)$","i"),Wb=new RegExp("^("+v+")(?!px)[a-z%]+$","i"),Xb=new RegExp("^([+-])=("+v+")","i"),Yb={BODY:"block"},Zb={position:"absolute",visibility:"hidden",display:"block"},$b={letterSpacing:0,fontWeight:400},_b=["Top","Right","Bottom","Left"],ac=["Webkit","O","Moz","ms"];u.fn.extend({css:function(a,c){return u.access(this,function(a,c,d){var e,f,g={},h=0;if(u.isArray(c)){f=Ob(a),e=c.length;for(;h<e;h++)g[c[h]]=u.css(a,c[h],!1,f);return g}return d!==b?u.style(a,c,d):u.css(a,c)},a,c,arguments.length>1)},show:function(){return dc(this,!0)},hide:function(){return dc(this)},toggle:function(a){return typeof a=="boolean"?a?this.show():this.hide():this.each(function(){cc(this)?u(this).show():u(this).hide()})}}),u.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=Pb(a,"opacity");return c===""?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":u.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,c,d,e){if(!a||a.nodeType===3||a.nodeType===8||!a.style)return;var f,g,h,i=u.camelCase(c),j=a.style;c=u.cssProps[i]||(u.cssProps[i]=bc(j,i)),h=u.cssHooks[c]||u.cssHooks[i];if(d===b)return h&&"get"in h&&(f=h.get(a,!1,e))!==b?f:j[c];g=typeof d,g==="string"&&(f=Xb.exec(d))&&(d=(f[1]+1)*f[2]+parseFloat(u.css(a,c)),g="number");if(d==null||g==="number"&&isNaN(d))return;g==="number"&&!u.cssNumber[i]&&(d+="px"),!u.support.clearCloneStyle&&d===""&&c.indexOf("background")===0&&(j[c]="inherit");if(!h||!("set"in h)||(d=h.set(a,d,e))!==b)try{j[c]=d}catch(k){}},css:function(a,c,d,e){var f,g,h,i=u.camelCase(c);return c=u.cssProps[i]||(u.cssProps[i]=bc(a.style,i)),h=u.cssHooks[c]||u.cssHooks[i],h&&"get"in h&&(g=h.get(a,!0,d)),g===b&&(g=Pb(a,c,e)),g==="normal"&&c in $b&&(g=$b[c]),d===""||d?(f=parseFloat(g),d===!0||u.isNumeric(f)?f||0:g):g}}),a.getComputedStyle?(Ob=function(b){return a.getComputedStyle(b,null)},Pb=function(a,c,d){var e,f,g,h=d||Ob(a),i=h?h.getPropertyValue(c)||h[c]:b,j=a.style;return h&&(i===""&&!u.contains(a.ownerDocument,a)&&(i=u.style(a,c)),Wb.test(i)&&Ub.test(c)&&(e=j.width,f=j.minWidth,g=j.maxWidth,j.minWidth=j.maxWidth=j.width=i,i=h.width,j.width=e,j.minWidth=f,j.maxWidth=g)),i}):g.documentElement.currentStyle&&(Ob=function(a){return a.currentStyle},Pb=function(a,c,d){var e,f,g,h=d||Ob(a),i=h?h[c]:b,j=a.style;return i==null&&j&&j[c]&&(i=j[c]),Wb.test(i)&&!Sb.test(c)&&(e=j.left,f=a.runtimeStyle,g=f&&f.left,g&&(f.left=a.currentStyle.left),j.left=c==="fontSize"?"1em":i,i=j.pixelLeft+"px",j.left=e,g&&(f.left=g)),i===""?"auto":i}),u.each(["height","width"],function(a,b){u.cssHooks[b]={get:function(a,c,d){if(c)return a.offsetWidth===0&&Tb.test(u.css(a,"display"))?u.swap(a,Zb,function(){return gc(a,b,d)}):gc(a,b,d)},set:function(a,c,d){var e=d&&Ob(a);return ec(a,c,d?fc(a,b,d,u.support.boxSizing&&u.css(a,"boxSizing",!1,e)==="border-box",e):0)}}}),u.support.opacity||(u.cssHooks.opacity={get:function(a,b){return Rb.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=u.isNumeric(b)?"alpha(opacity="+b*100+")":"",f=d&&d.filter||c.filter||"";c.zoom=1;if((b>=1||b==="")&&u.trim(f.replace(Qb,""))===""&&c.removeAttribute){c.removeAttribute("filter");if(b===""||d&&!d.filter)return}c.filter=Qb.test(f)?f.replace(Qb,e):f+" "+e}}),u(function(){u.support.reliableMarginRight||(u.cssHooks.marginRight={get:function(a,b){if(b)return u.swap(a,{display:"inline-block"},Pb,[a,"marginRight"])}}),!u.support.pixelPosition&&u.fn.position&&u.each(["top","left"],function(a,b){u.cssHooks[b]={get:function(a,c){if(c)return c=Pb(a,b),Wb.test(c)?u(a).position()[b]+"px":c}}})}),u.expr&&u.expr.filters&&(u.expr.filters.hidden=function(a){return a.offsetWidth<=0&&a.offsetHeight<=0||!u.support.reliableHiddenOffsets&&(a.style&&a.style.display||u.css(a,"display"))==="none"},u.expr.filters.visible=function(a){return!u.expr.filters.hidden(a)}),u.each({margin:"",padding:"",border:"Width"},function(a,b){u.cssHooks[a+b]={expand:function(c){var d=0,e={},f=typeof c=="string"?c.split(" "):[c];for(;d<4;d++)e[a+_b[d]+b]=f[d]||f[d-2]||f[0];return e}},Ub.test(a)||(u.cssHooks[a+b].set=ec)});var jc=/%20/g,kc=/\[\]$/,lc=/\r?\n/g,mc=/^(?:submit|button|image|reset|file)$/i,nc=/^(?:input|select|textarea|keygen)/i;u.fn.extend({serialize:function(){return u.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=u.prop(this,"elements");return a?u.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!u(this).is(":disabled")&&nc.test(this.nodeName)&&!mc.test(a)&&(this.checked||!xb.test(a))}).map(function(a,b){var c=u(this).val();return c==null?null:u.isArray(c)?u.map(c,function(a){return{name:b.name,value:a.replace(lc,"\r\n")}}):{name:b.name,value:c.replace(lc,"\r\n")}}).get()}}),u.param=function(a,c){var d,e=[],f=function(a,b){b=u.isFunction(b)?b():b==null?"":b,e[e.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};c===b&&(c=u.ajaxSettings&&u.ajaxSettings.traditional);if(u.isArray(a)||a.jquery&&!u.isPlainObject(a))u.each(a,function(){f(this.name,this.value)});else for(d in a)oc(d,a[d],c,f);return e.join("&").replace(jc,"+")},u.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){u.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),u.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return arguments.length===1?this.off(a,"**"):this.off(b,a||"**",c)}});var pc,qc,rc=u.now(),sc=/\?/,tc=/#.*$/,uc=/([?&])_=[^&]*/,vc=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,wc=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,xc=/^(?:GET|HEAD)$/,yc=/^\/\//,zc=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Ac=u.fn.load,Bc={},Cc={},Dc="*/".concat("*");try{qc=f.href}catch(Ec){qc=g.createElement("a"),qc.href="",qc=qc.href}pc=zc.exec(qc.toLowerCase())||[],u.fn.load=function(a,c,d){if(typeof a!="string"&&Ac)return Ac.apply(this,arguments);var e,f,g,h=this,i=a.indexOf(" ");return i>=0&&(e=a.slice(i,a.length),a=a.slice(0,i)),u.isFunction(c)?(d=c,c=b):c&&typeof c=="object"&&(g="POST"),h.length>0&&u.ajax({url:a,type:g,dataType:"html",data:c}).done(function(a){f=arguments,h.html(e?u("<div>").append(u.parseHTML(a)).find(e):a)}).complete(d&&function(a,b){h.each(d,f||[a.responseText,b,a])}),this},u.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){u.fn[b]=function(a){return this.on(b,a)}}),u.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:qc,type:"GET",isLocal:wc.test(pc[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Dc,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":u.parseJSON,"text xml":u.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?Hc(Hc(a,u.ajaxSettings),b):Hc(u.ajaxSettings,a)},ajaxPrefilter:Fc(Bc),ajaxTransport:Fc(Cc),ajax:function(a,c){function z(a,c,d,e){var k,r,s,v,w,y=c;if(t===2)return;t=2,h&&clearTimeout(h),j=b,g=e||"",x.readyState=a>0?4:0,k=a>=200&&a<300||a===304,d&&(v=Ic(l,x,d)),v=Jc(l,v,x,k);if(k)l.ifModified&&(w=x.getResponseHeader("Last-Modified"),w&&(u.lastModified[f]=w),w=x.getResponseHeader("etag"),w&&(u.etag[f]=w)),a===204||l.type==="HEAD"?y="nocontent":a===304?y="notmodified":(y=v.state,r=v.data,s=v.error,k=!s);else{s=y;if(a||!y)y="error",a<0&&(a=0)}x.status=a,x.statusText=(c||y)+"",k?o.resolveWith(m,[r,y,x]):o.rejectWith(m,[x,y,s]),x.statusCode(q),q=b,i&&n.trigger(k?"ajaxSuccess":"ajaxError",[x,l,k?r:s]),p.fireWith(m,[x,y]),i&&(n.trigger("ajaxComplete",[x,l]),--u.active||u.event.trigger("ajaxStop"))}typeof a=="object"&&(c=a,a=b),c=c||{};var d,e,f,g,h,i,j,k,l=u.ajaxSetup({},c),m=l.context||l,n=l.context&&(m.nodeType||m.jquery)?u(m):u.event,o=u.Deferred(),p=u.Callbacks("once memory"),q=l.statusCode||{},r={},s={},t=0,v="canceled",x={readyState:0,getResponseHeader:function(a){var b;if(t===2){if(!k){k={};while(b=vc.exec(g))k[b[1].toLowerCase()]=b[2]}b=k[a.toLowerCase()]}return b==null?null:b},getAllResponseHeaders:function(){return t===2?g:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return t||(a=s[c]=s[c]||a,r[a]=b),this},overrideMimeType:function(a){return t||(l.mimeType=a),this},statusCode:function(a){var b;if(a)if(t<2)for(b in a)q[b]=[q[b],a[b]];else x.always(a[x.status]);return this},abort:function(a){var b=a||v;return j&&j.abort(b),z(0,b),this}};o.promise(x).complete=p.add,x.success=x.done,x.error=x.fail,l.url=((a||l.url||qc)+"").replace(tc,"").replace(yc,pc[1]+"//"),l.type=c.method||c.type||l.method||l.type,l.dataTypes=u.trim(l.dataType||"*").toLowerCase().match(w)||[""],l.crossDomain==null&&(d=zc.exec(l.url.toLowerCase()),l.crossDomain=!(!d||d[1]===pc[1]&&d[2]===pc[2]&&(d[3]||(d[1]==="http:"?"80":"443"))===(pc[3]||(pc[1]==="http:"?"80":"443")))),l.data&&l.processData&&typeof l.data!="string"&&(l.data=u.param(l.data,l.traditional)),Gc(Bc,l,c,x);if(t===2)return x;i=l.global,i&&u.active++===0&&u.event.trigger("ajaxStart"),l.type=l.type.toUpperCase(),l.hasContent=!xc.test(l.type),f=l.url,l.hasContent||(l.data&&(f=l.url+=(sc.test(f)?"&":"?")+l.data,delete l.data),l.cache===!1&&(l.url=uc.test(f)?f.replace(uc,"$1_="+rc++):f+(sc.test(f)?"&":"?")+"_="+rc++)),l.ifModified&&(u.lastModified[f]&&x.setRequestHeader("If-Modified-Since",u.lastModified[f]),u.etag[f]&&x.setRequestHeader("If-None-Match",u.etag[f])),(l.data&&l.hasContent&&l.contentType!==!1||c.contentType)&&x.setRequestHeader("Content-Type",l.contentType),x.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+(l.dataTypes[0]!=="*"?", "+Dc+"; q=0.01":""):l.accepts["*"]);for(e in l.headers)x.setRequestHeader(e,l.headers[e]);if(!l.beforeSend||l.beforeSend.call(m,x,l)!==!1&&t!==2){v="abort";for(e in{success:1,error:1,complete:1})x[e](l[e]);j=Gc(Cc,l,c,x);if(!j)z(-1,"No Transport");else{x.readyState=1,i&&n.trigger("ajaxSend",[x,l]),l.async&&l.timeout>0&&(h=setTimeout(function(){x.abort("timeout")},l.timeout));try{t=1,j.send(r,z)}catch(y){if(!(t<2))throw y;z(-1,y)}}return x}return x.abort()},getJSON:function(a,b,c){return u.get(a,b,c,"json")},getScript:function(a,c){return u.get(a,b,c,"script")}}),u.each(["get","post"],function(a,c){u[c]=function(a,d,e,f){return u.isFunction(d)&&(f=f||e,e=d,d=b),u.ajax({url:a,type:c,dataType:f,data:d,success:e})}}),u.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){return u.globalEval(a),a}}}),u.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),u.ajaxTransport("script",function(a){if(a.crossDomain){var c,d=g.head||u("head")[0]||g.documentElement;return{send:function(b,e){c=g.createElement("script"),c.async=!0,a.scriptCharset&&(c.charset=a.scriptCharset),c.src=a.url,c.onload=c.onreadystatechange=function(a,b){if(b||!c.readyState||/loaded|complete/.test(c.readyState))c.onload=c.onreadystatechange=null,c.parentNode&&c.parentNode.removeChild(c),c=null,b||e(200,"success")},d.insertBefore(c,d.firstChild)},abort:function(){c&&c.onload(b,!0)}}}});var Kc=[],Lc=/(=)\?(?=&|$)|\?\?/;u.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Kc.pop()||u.expando+"_"+rc++;return this[a]=!0,a}}),u.ajaxPrefilter("json jsonp",function(c,d,e){var f,g,h,i=c.jsonp!==!1&&(Lc.test(c.url)?"url":typeof c.data=="string"&&!(c.contentType||"").indexOf("application/x-www-form-urlencoded")&&Lc.test(c.data)&&"data");if(i||c.dataTypes[0]==="jsonp")return f=c.jsonpCallback=u.isFunction(c.jsonpCallback)?c.jsonpCallback():c.jsonpCallback,i?c[i]=c[i].replace(Lc,"$1"+f):c.jsonp!==!1&&(c.url+=(sc.test(c.url)?"&":"?")+c.jsonp+"="+f),c.converters["script json"]=function(){return h||u.error(f+" was not called"),h[0]},c.dataTypes[0]="json",g=a[f],a[f]=function(){h=arguments},e.always(function(){a[f]=g,c[f]&&(c.jsonpCallback=d.jsonpCallback,Kc.push(f)),h&&u.isFunction(g)&&g(h[0]),h=g=b}),"script"});var Mc,Nc,Oc=0,Pc=a.ActiveXObject&&function(){var a;for(a in Mc)Mc[a](b,!0)};u.ajaxSettings.xhr=a.ActiveXObject?function(){return!this.isLocal&&Qc()||Rc()}:Qc,Nc=u.ajaxSettings.xhr(),u.support.cors=!!Nc&&"withCredentials"in Nc,Nc=u.support.ajax=!!Nc,Nc&&u.ajaxTransport(function(c){if(!c.crossDomain||u.support.cors){var d;return{send:function(e,f){var g,h,i=c.xhr();c.username?i.open(c.type,c.url,c.async,c.username,c.password):i.open(c.type,c.url,c.async);if(c.xhrFields)for(h in c.xhrFields)i[h]=c.xhrFields[h];c.mimeType&&i.overrideMimeType&&i.overrideMimeType(c.mimeType),!c.crossDomain&&!e["X-Requested-With"]&&(e["X-Requested-With"]="XMLHttpRequest");try{for(h in e)i.setRequestHeader(h,e[h])}catch(j){}i.send(c.hasContent&&c.data||null),d=function(a,e){var h,j,k,l;try{if(d&&(e||i.readyState===4)){d=b,g&&(i.onreadystatechange=u.noop,Pc&&delete Mc[g]);if(e)i.readyState!==4&&i.abort();else{l={},h=i.status,j=i.getAllResponseHeaders(),typeof i.responseText=="string"&&(l.text=i.responseText);try{k=i.statusText}catch(m){k=""}!h&&c.isLocal&&!c.crossDomain?h=l.text?200:404:h===1223&&(h=204)}}}catch(n){e||f(-1,n)}l&&f(h,k,l,j)},c.async?i.readyState===4?setTimeout(d):(g=++Oc,Pc&&(Mc||(Mc={},u(a).unload(Pc)),Mc[g]=d),i.onreadystatechange=d):d()},abort:function(){d&&d(b,!0)}}}});var Sc,Tc,Uc=/^(?:toggle|show|hide)$/,Vc=new RegExp("^(?:([+-])=|)("+v+")([a-z%]*)$","i"),Wc=/queueHooks$/,Xc=[bd],Yc={"*":[function(a,b){var c=this.createTween(a,b),d=c.cur(),e=Vc.exec(b),f=e&&e[3]||(u.cssNumber[a]?"":"px"),g=(u.cssNumber[a]||f!=="px"&&+d)&&Vc.exec(u.css(c.elem,a)),h=1,i=20;if(g&&g[3]!==f){f=f||g[3],e=e||[],g=+d||1;do h=h||".5",g/=h,u.style(c.elem,a,g+f);while(h!==(h=c.cur()/d)&&h!==1&&--i)}return e&&(g=c.start=+g||+d||0,c.unit=f,c.end=e[1]?g+(e[1]+1)*e[2]:+e[2]),c}]};u.Animation=u.extend(_c,{tweener:function(a,b){u.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");var c,d=0,e=a.length;for(;d<e;d++)c=a[d],Yc[c]=Yc[c]||[],Yc[c].unshift(b)},prefilter:function(a,b){b?Xc.unshift(a):Xc.push(a)}}),u.Tween=cd,cd.prototype={constructor:cd,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(u.cssNumber[c]?"":"px")},cur:function(){var a=cd.propHooks[this.prop];return a&&a.get?a.get(this):cd.propHooks._default.get(this)},run:function(a){var b,c=cd.propHooks[this.prop];return this.options.duration?this.pos=b=u.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=b=a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):cd.propHooks._default.set(this),this}},cd.prototype.init.prototype=cd.prototype,cd.propHooks={_default:{get:function(a){var b;return a.elem[a.prop]==null||!!a.elem.style&&a.elem.style[a.prop]!=null?(b=u.css(a.elem,a.prop,""),!b||b==="auto"?0:b):a.elem[a.prop]},set:function(a){u.fx.step[a.prop]?u.fx.step[a.prop](a):a.elem.style&&(a.elem.style[u.cssProps[a.prop]]!=null||u.cssHooks[a.prop])?u.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},cd.propHooks.scrollTop=cd.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},u.each(["toggle","show","hide"],function(a,b){var c=u.fn[b];u.fn[b]=function(a,d,e){return a==null||typeof a=="boolean"?c.apply(this,arguments):this.animate(dd(b,!0),a,d,e)}}),u.fn.extend({fadeTo:function(a,b,c,d){return this.filter(cc).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=u.isEmptyObject(a),f=u.speed(b,c,d),g=function(){var b=_c(this,u.extend({},a),f);(e||u._data(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,c,d){var e=function(a){var b=a.stop;delete a.stop,b(d)};return typeof a!="string"&&(d=c,c=a,a=b),c&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,c=a!=null&&a+"queueHooks",f=u.timers,g=u._data(this);if(c)g[c]&&g[c].stop&&e(g[c]);else for(c in g)g[c]&&g[c].stop&&Wc.test(c)&&e(g[c]);for(c=f.length;c--;)f[c].elem===this&&(a==null||f[c].queue===a)&&(f[c].anim.stop(d),b=!1,f.splice(c,1));(b||!d)&&u.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=u._data(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=u.timers,g=d?d.length:0;c.finish=!0,u.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0);for(b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;b<g;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),u.each({slideDown:dd("show"),slideUp:dd("hide"),slideToggle:dd("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){u.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),u.speed=function(a,b,c){var d=a&&typeof a=="object"?u.extend({},a):{complete:c||!c&&b||u.isFunction(a)&&a,duration:a,easing:c&&b||b&&!u.isFunction(b)&&b};d.duration=u.fx.off?0:typeof d.duration=="number"?d.duration:d.duration in u.fx.speeds?u.fx.speeds[d.duration]:u.fx.speeds._default;if(d.queue==null||d.queue===!0)d.queue="fx";return d.old=d.complete,d.complete=function(){u.isFunction(d.old)&&d.old.call(this),d.queue&&u.dequeue(this,d.queue)},d},u.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},u.timers=[],u.fx=cd.prototype.init,u.fx.tick=function(){var a,c=u.timers,d=0;Sc=u.now();for(;d<c.length;d++)a=c[d],!a()&&c[d]===a&&c.splice(d--,1);c.length||u.fx.stop(),Sc=b},u.fx.timer=function(a){a()&&u.timers.push(a)&&u.fx.start()},u.fx.interval=13,u.fx.start=function(){Tc||(Tc=setInterval(u.fx.tick,u.fx.interval))},u.fx.stop=function(){clearInterval(Tc),Tc=null},u.fx.speeds={slow:600,fast:200,_default:400},u.fx.step={},u.expr&&u.expr.filters&&(u.expr.filters.animated=function(a){return u.grep(u.timers,function(b){return a===b.elem}).length}),u.fn.offset=function(a){if(arguments.length)return a===b?this:this.each(function(b){u.offset.setOffset(this,a,b)});var c,d,f={top:0,left:0},g=this[0],h=g&&g.ownerDocument;if(!h)return;return c=h.documentElement,u.contains(c,g)?(typeof g.getBoundingClientRect!==e&&(f=g.getBoundingClientRect()),d=ed(h),{top:f.top+(d.pageYOffset||c.scrollTop)-(c.clientTop||0),left:f.left+(d.pageXOffset||c.scrollLeft)-(c.clientLeft||0)}):f},u.offset={setOffset:function(a,b,c){var d=u.css(a,"position");d==="static"&&(a.style.position="relative");var e=u(a),f=e.offset(),g=u.css(a,"top"),h=u.css(a,"left"),i=(d==="absolute"||d==="fixed")&&u.inArray("auto",[g,h])>-1,j={},k={},l,m;i?(k=e.position(),l=k.top,m=k.left):(l=parseFloat(g)||0,m=parseFloat(h)||0),u.isFunction(b)&&(b=b.call(a,c,f)),b.top!=null&&(j.top=b.top-f.top+l),b.left!=null&&(j.left=b.left-f.left+m),"using"in b?b.using.call(a,j):e.css(j)}},u.fn.extend({position:function(){if(!this[0])return;var a,b,c={top:0,left:0},d=this[0];return u.css(d,"position")==="fixed"?b=d.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),u.nodeName(a[0],"html")||(c=a.offset()),c.top+=u.css(a[0],"borderTopWidth",!0),c.left+=u.css(a[0],"borderLeftWidth",!0)),{top:b.top-c.top-u.css(d,"marginTop",!0),left:b.left-c.left-u.css(d,"marginLeft",!0)}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||h;while(a&&!u.nodeName(a,"html")&&u.css(a,"position")==="static")a=a.offsetParent;return a||h})}}),u.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,c){var d=/Y/.test(c);u.fn[a]=function(e){return u.access(this,function(a,e,f){var g=ed(a);if(f===b)return g?c in g?g[c]:g.document.documentElement[e]:a[e];g?g.scrollTo(d?u(g).scrollLeft():f,d?f:u(g).scrollTop()):a[e]=f},a,e,arguments.length,null)}}),u.each({Height:"height",Width:"width"},function(a,c){u.each({padding:"inner"+a,content:c,"":"outer"+a},function(d,e){u.fn[e]=function(e,f){var g=arguments.length&&(d||typeof e!="boolean"),h=d||(e===!0||f===!0?"margin":"border");return u.access(this,function(c,d,e){var f;return u.isWindow(c)?c.document.documentElement["client"+a]:c.nodeType===9?(f=c.documentElement,Math.max(c.body["scroll"+a],f["scroll"+a],c.body["offset"+a],f["offset"+a],f["client"+a])):e===b?u.css(c,d,h):u.style(c,d,e,h)},c,g?e:b,g,null)}})}),u.fn.size=function(){return this.length},u.fn.andSelf=u.fn.addBack,typeof module=="object"&&module&&typeof module.exports=="object"?module.exports=u:(a.jQuery=a.$=u,typeof define=="function"&&define.amd&&define("jquery",[],function(){return u}))})(window);
/*!
 * jQuery scrollintoview() plugin and :scrollable selector filter
 *
 * Version 1.8 (14 Jul 2011)
 * Requires jQuery 1.4 or newer
 *
 * Copyright (c) 2011 Robert Koritnik
 * Licensed under the terms of the MIT license
 * http://www.opensource.org/licenses/mit-license.php
 */(function(a){var b={vertical:{x:!1,y:!0},horizontal:{x:!0,y:!1},both:{x:!0,y:!0},x:{x:!0,y:!1},y:{x:!1,y:!0}},c={duration:"fast",direction:"both"},d=/^(?:html)$/i,e=function(b,c){c=c||(document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(b,null):b.currentStyle);var d=document.defaultView&&document.defaultView.getComputedStyle?!0:!1,e={top:parseFloat(d?c.borderTopWidth:a.css(b,"borderTopWidth"))||0,left:parseFloat(d?c.borderLeftWidth:a.css(b,"borderLeftWidth"))||0,bottom:parseFloat(d?c.borderBottomWidth:a.css(b,"borderBottomWidth"))||0,right:parseFloat(d?c.borderRightWidth:a.css(b,"borderRightWidth"))||0};return{top:e.top,left:e.left,bottom:e.bottom,right:e.right,vertical:e.top+e.bottom,horizontal:e.left+e.right}},f=function(b){var c=a(window),f=d.test(b[0].nodeName);return{border:f?{top:0,left:0,bottom:0,right:0}:e(b[0]),scroll:{top:(f?c:b).scrollTop(),left:(f?c:b).scrollLeft()},scrollbar:{right:f?0:b.innerWidth()-b[0].clientWidth,bottom:f?0:b.innerHeight()-b[0].clientHeight},rect:function(){var a=b[0].getBoundingClientRect();return{top:f?0:a.top,left:f?0:a.left,bottom:f?b[0].clientHeight:a.bottom,right:f?b[0].clientWidth:a.right}}()}};a.fn.extend({scrollintoview:function(e){e=a.extend({},c,e),e.direction=b[typeof e.direction=="string"&&e.direction.toLowerCase()]||b.both;var g="";e.direction.x===!0&&(g="horizontal"),e.direction.y===!0&&(g=g?"both":"vertical");var h=this.eq(0),i=h.closest(":scrollable("+g+")");if(i.length>0){i=i.eq(0);var j={e:f(h),s:f(i)},k={top:j.e.rect.top-(j.s.rect.top+j.s.border.top),bottom:j.s.rect.bottom-j.s.border.bottom-j.s.scrollbar.bottom-j.e.rect.bottom,left:j.e.rect.left-(j.s.rect.left+j.s.border.left),right:j.s.rect.right-j.s.border.right-j.s.scrollbar.right-j.e.rect.right},l={};e.direction.y===!0&&(k.top<0?l.scrollTop=j.s.scroll.top+k.top:k.top>0&&k.bottom<0&&(l.scrollTop=j.s.scroll.top+Math.min(k.top,-k.bottom))),e.direction.x===!0&&(k.left<0?l.scrollLeft=j.s.scroll.left+k.left:k.left>0&&k.right<0&&(l.scrollLeft=j.s.scroll.left+Math.min(k.left,-k.right))),a.isEmptyObject(l)?a.isFunction(e.complete)&&e.complete.call(i[0]):(d.test(i[0].nodeName)&&(i=a("html,body")),i.animate(l,e.duration).eq(0).queue(function(b){a.isFunction(e.complete)&&e.complete.call(i[0]),b()}))}return this}});var g={auto:!0,scroll:!0,visible:!1,hidden:!1};a.extend(a.expr[":"],{scrollable:function(a,c,e,f){var h=b[typeof e[3]=="string"&&e[3].toLowerCase()]||b.both,i=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(a,null):a.currentStyle,j={x:g[i.overflowX.toLowerCase()]||!1,y:g[i.overflowY.toLowerCase()]||!1,isRoot:d.test(a.nodeName)};if(!j.x&&!j.y&&!j.isRoot)return!1;var k={height:{scroll:a.scrollHeight,client:a.clientHeight},width:{scroll:a.scrollWidth,client:a.clientWidth},scrollableX:function(){return(j.x||j.isRoot)&&this.width.scroll>this.width.client},scrollableY:function(){return(j.y||j.isRoot)&&this.height.scroll>this.height.client}};return h.y&&k.scrollableY()||h.x&&k.scrollableX()}})})(jQuery);
/*
 * js_channel is a very lightweight abstraction on top of
 * postMessage which defines message formats and semantics
 * to support interactions more rich than just message passing
 * js_channel supports:
 *  + query/response - traditional rpc
 *  + query/update/response - incremental async return of results
 *    to a query
 *  + notifications - fire and forget
 *  + error handling
 *
 * js_channel is based heavily on json-rpc, but is focused at the
 * problem of inter-iframe RPC.
 *
 * Message types:
 *  There are 5 types of messages that can flow over this channel,
 *  and you may determine what type of message an object is by
 *  examining its parameters:
 *  1. Requests
 *    + integer id
 *    + string method
 *    + (optional) any params
 *  2. Callback Invocations (or just "Callbacks")
 *    + integer id
 *    + string callback
 *    + (optional) params
 *  3. Error Responses (or just "Errors)
 *    + integer id
 *    + string error
 *    + (optional) string message
 *  4. Responses
 *    + integer id
 *    + (optional) any result
 *  5. Notifications
 *    + string method
 *    + (optional) any params
 */var Channel=function(){function c(a,c,d,e){function f(b){for(var c=0;c<b.length;c++)if(b[c].win===a)return!0;return!1}var g=!1;if(c==="*")for(var h in b){if(!b.hasOwnProperty(h))continue;if(h==="*")continue;if(typeof b[h][d]=="object"){g=f(b[h][d]);if(g)break}}else b["*"]&&b["*"][d]&&(g=f(b["*"][d])),!g&&b[c]&&b[c][d]&&(g=f(b[c][d]));if(g)throw"A channel is already bound to the same window which overlaps with origin '"+c+"' and has scope '"+d+"'";typeof b[c]!="object"&&(b[c]={}),typeof b[c][d]!="object"&&(b[c][d]=[]),b[c][d].push({win:a,handler:e})}function d(a,c,d){var e=b[c][d];for(var f=0;f<e.length;f++)e[f].win===a&&e.splice(f,1);b[c][d].length===0&&delete b[c][d]}function e(a){return Array.isArray?Array.isArray(a):a.constructor.toString().indexOf("Array")!=-1}"use strict";var a=Math.floor(Math.random()*1000001),b={},f={},g=function(a){try{var c=JSON.parse(a.data);if(typeof c!="object"||c===null)throw"malformed"}catch(a){return}var d=a.source,e=a.origin,g,h,i;if(typeof c.method=="string"){var j=c.method.split("::");j.length==2?(g=j[0],i=j[1]):i=c.method}typeof c.id!="undefined"&&(h=c.id);if(typeof i=="string"){var k=!1;if(b[e]&&b[e][g])for(var l=0;l<b[e][g].length;l++)if(b[e][g][l].win===d){b[e][g][l].handler(e,i,c),k=!0;break}if(!k&&b["*"]&&b["*"][g])for(var l=0;l<b["*"][g].length;l++)if(b["*"][g][l].win===d){b["*"][g][l].handler(e,i,c);break}}else typeof h!="undefined"&&f[h]&&f[h](e,i,c)};return window.addEventListener?window.addEventListener("message",g,!1):window.attachEvent&&window.attachEvent("onmessage",g),{build:function(b){var g=function(a){if(b.debugOutput&&window.console&&window.console.log){try{typeof a!="string"&&(a=JSON.stringify(a))}catch(c){}console.log("["+k+"] "+a)}};if(!window.postMessage)throw"jschannel cannot run this browser, no postMessage";if(!window.JSON||!window.JSON.stringify||!window.JSON.parse)throw"jschannel cannot run this browser, no JSON parsing/serialization";if(window.Prototype){console.log("patching Prototype's faulty Array.toJSON");var h=window.JSON.stringify;window.JSON.stringify=function(a){var b=Array.prototype.toJSON;delete Array.prototype.toJSON;var c=h(a);return Array.prototype.toJSON=b,c}}if(typeof b!="object")throw"Channel build invoked without a proper object argument";if(!b.window||!b.window.postMessage)throw"Channel.build() called without a valid window argument";if(window===b.window)throw"target window is same as present window -- not allowed";var i=!1;if(typeof b.origin=="string"){var j;b.origin==="*"?i=!0:null!==(j=b.origin.match(/^https?:\/\/(?:[-a-zA-Z0-9_\.])+(?::\d+)?/))?(b.origin=j[0].toLowerCase(),i=!0):b.origin=="resource://pdf.js"&&(i=!0)}if(!i)throw"Channel.build() called with an invalid origin";if(typeof b.scope!="undefined"){if(typeof b.scope!="string")throw"scope, when specified, must be a string";if(b.scope.split("::").length>1)throw"scope may not contain double colons: '::'"}var k=function(){var a="",b="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";for(var c=0;c<5;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a}(),l={},m={},n={},o=!1,p=[],q=function(a,b,c){var d=!1,e=!1;return{origin:b,invoke:function(b,d){if(!n[a])throw"attempting to invoke a callback of a nonexistent transaction: "+a;var e=!1;for(var f=0;f<c.length;f++)if(b===c[f]){e=!0;break}if(!e)throw"request supports no such callback '"+b+"'";u({id:a,callback:b,params:d})},error:function(b,c){e=!0;if(!n[a])throw"error called for nonexistent message: "+a;delete n[a],u({id:a,error:b,message:c})},complete:function(b){e=!0;if(!n[a])throw"complete called for nonexistent message: "+a;delete n[a],u({id:a,result:b})},delayReturn:function(a){return typeof a=="boolean"&&(d=a===!0),d},completed:function(){return e}}},r=function(a,b,c){return window.setTimeout(function(){if(m[a]){var d="timeout ("+b+"ms) exceeded on method '"+c+"'";(1,m[a].error)("timeout_error",d),delete m[a],delete f[a]}},b)},s=function(a,c,d){if(typeof b.gotMessageObserver=="function")try{b.gotMessageObserver(a,d)}catch(h){g("gotMessageObserver() raised an exception: "+h.toString())}if(d.id&&c){if(l[c]){var i=q(d.id,a,d.callbacks?d.callbacks:[]);n[d.id]={};try{if(d.callbacks&&e(d.callbacks)&&d.callbacks.length>0)for(var j=0;j<d.callbacks.length;j++){var k=d.callbacks[j],o=d.params,p=k.split("/");for(var r=0;r<p.length-1;r++){var s=p[r];typeof o[s]!="object"&&(o[s]={}),o=o[s]}o[p[p.length-1]]=function(){var a=k;return function(b){return i.invoke(a,b)}}()}var t=l[c](i,d.params);!i.delayReturn()&&!i.completed()&&i.complete(t)}catch(h){var u="runtime_error",v=null;typeof h=="string"?v=h:typeof h=="object"&&(h&&e(h)&&h.length==2?(u=h[0],v=h[1]):typeof h.error=="string"&&(u=h.error,h.message?typeof h.message=="string"?v=h.message:h=h.message:v=""));if(v===null)try{v=JSON.stringify(h),typeof v=="undefined"&&(v=h.toString())}catch(w){v=h.toString()}i.error(u,v)}}}else d.id&&d.callback?!m[d.id]||!m[d.id].callbacks||!m[d.id].callbacks[d.callback]?g("ignoring invalid callback, id:"+d.id+" ("+d.callback+")"):m[d.id].callbacks[d.callback](d.params):d.id?m[d.id]?(d.error?(1,m[d.id].error)(d.error,d.message):d.result!==undefined?(1,m[d.id].success)(d.result):(1,m[d.id].success)(),delete m[d.id],delete f[d.id]):g("ignoring invalid response: "+d.id):c&&l[c]&&l[c]({origin:a},d.params)};c(b.window,b.origin,typeof b.scope=="string"?b.scope:"",s);var t=function(a){return typeof b.scope=="string"&&b.scope.length&&(a=[b.scope,a].join("::")),a},u=function(a,c){if(!a)throw"postMessage called with null message";var d=o?"post  ":"queue ";g(d+" message: "+JSON.stringify(a));if(!c&&!o)p.push(a);else{if(typeof b.postMessageObserver=="function")try{b.postMessageObserver(b.origin,a)}catch(e){g("postMessageObserver() raised an exception: "+e.toString())}b.window.postMessage(JSON.stringify(a),b.origin)}},v=function(a,c){g("ready msg received");if(o)throw"received ready message while in ready state.  help!";c==="ping"?k+="-R":k+="-L",w.unbind("__ready"),o=!0,g("ready msg accepted."),c==="ping"&&w.notify({method:"__ready",params:"pong"});while(p.length)u(p.pop());typeof b.onReady=="function"&&b.onReady(w)},w={unbind:function(a){if(l[a]){if(delete l[a])return!0;throw"can't delete method: "+a}return!1},bind:function(a,b){if(!a||typeof a!="string")throw"'method' argument to bind must be string";if(!b||typeof b!="function")throw"callback missing from bind params";if(l[a])throw"method '"+a+"' is already bound!";return l[a]=b,this},call:function(b){if(!b)throw"missing arguments to call function";if(!b.method||typeof b.method!="string")throw"'method' argument to call must be string";if(!b.success||typeof b.success!="function")throw"'success' callback missing from call";var c={},d=[],e=[],g=function(a,b){if(e.indexOf(b)>=0)throw"params cannot be a recursive data structure";e.push(b);if(typeof b=="object")for(var f in b){if(!b.hasOwnProperty(f))continue;var h=a+(a.length?"/":"")+f;typeof b[f]=="function"?(c[h]=b[f],d.push(h),delete b[f]):typeof b[f]=="object"&&g(h,b[f])}};g("",b.params);var h={id:a,method:t(b.method),params:b.params};d.length&&(h.callbacks=d),b.timeout&&r(a,b.timeout,t(b.method)),m[a]={callbacks:c,error:b.error,success:b.success},f[a]=s,a++,u(h)},notify:function(a){if(!a)throw"missing arguments to notify function";if(!a.method||typeof a.method!="string")throw"'method' argument to notify must be string";u({method:t(a.method),params:a.params})},destroy:function(){d(b.window,b.origin,typeof b.scope=="string"?b.scope:""),window.removeEventListener?window.removeEventListener("message",s,!1):window.detachEvent&&window.detachEvent("onmessage",s),o=!1,l={},n={},m={},b.origin=null,p=[],g("channel destroyed"),k=""}};return w.bind("__ready",v),setTimeout(function(){u({method:t("__ready"),params:"ping"},!0)},0),w}}}();
/*
Pure Javascript implementation of Uniforum message translation.
Copyright (C) 2008 Joshua I. Miller <unrtst@cpan.org>, all rights reserved

This program is free software; you can redistribute it and/or modify it
under the terms of the GNU Library General Public License as published
by the Free Software Foundation; either version 2, or (at your option)
any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
Library General Public License for more details.

You should have received a copy of the GNU Library General Public
License along with this program; if not, write to the Free Software
Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307,
USA.

=head1 NAME

Javascript Gettext - Javascript implemenation of GNU Gettext API.

=head1 SYNOPSIS

 // //////////////////////////////////////////////////////////
 // Optimum caching way
 <script language="javascript" src="/path/LC_MESSAGES/myDomain.json"></script>
 <script language="javascript" src="/path/Gettext.js'></script>

 // assuming myDomain.json defines variable json_locale_data
 var params = {  "domain" : "myDomain",
                 "locale_data" : json_locale_data
              };
 var gt = new Gettext(params);
 // create a shortcut if you'd like
 function _ (msgid) { return gt.gettext(msgid); }
 alert(_("some string"));
 // or use fully named method
 alert(gt.gettext("some string"));
 // change to use a different "domain"
 gt.textdomain("anotherDomain");
 alert(gt.gettext("some string"));


 // //////////////////////////////////////////////////////////
 // The other way to load the language lookup is a "link" tag
 // Downside is that not all browsers cache XMLHttpRequests the
 // same way, so caching of the language data isn't guarenteed
 // across page loads.
 // Upside is that it's easy to specify multiple files
 <link rel="gettext" href="/path/LC_MESSAGES/myDomain.json" />
 <script language="javascript" src="/path/Gettext.js'></script>

 var gt = new Gettext({ "domain" : "myDomain" });
 // rest is the same


 // //////////////////////////////////////////////////////////
 // The reson the shortcuts aren't exported by default is because they'd be
 // glued to the single domain you created. So, if you're adding i18n support
 // to some js library, you should use it as so:

 if (typeof(MyNamespace) == 'undefined') MyNamespace = {};
 MyNamespace.MyClass = function () {
     var gtParms = { "domain" : 'MyNamespace_MyClass' };
     this.gt = new Gettext(gtParams);
     return this;
 };
 MyNamespace.MyClass.prototype._ = function (msgid) {
     return this.gt.gettext(msgid);
 };
 MyNamespace.MyClass.prototype.something = function () {
     var myString = this._("this will get translated");
 };

 // //////////////////////////////////////////////////////////
 // Adding the shortcuts to a global scope is easier. If that's
 // ok in your app, this is certainly easier.
 var myGettext = new Gettext({ 'domain' : 'myDomain' });
 function _ (msgid) {
     return myGettext.gettext(msgid);
 }
 alert( _("text") );

 // //////////////////////////////////////////////////////////
 // Data structure of the json data
 // NOTE: if you're loading via the <script> tag, you can only
 // load one file, but it can contain multiple domains.
 var json_locale_data = {
     "MyDomain" : {
         "" : {
             "header_key" : "header value",
             "header_key" : "header value",
         "msgid" : [ "msgid_plural", "msgstr", "msgstr_plural", "msgstr_pluralN" ],
         "msgctxt\004msgid" : [ null, "msgstr" ],
         },
     "AnotherDomain" : {
         },
     }

=head1 DESCRIPTION

This is a javascript implementation of GNU Gettext, providing internationalization support for javascript. It differs from existing javascript implementations in that it will support all current Gettext features (ex. plural and context support), and will also support loading language catalogs from .mo, .po, or preprocessed json files (converter included).

The locale initialization differs from that of GNU Gettext / POSIX. Rather than setting the category, domain, and paths, and letting the libs find the right file, you must explicitly load the file at some point. The "domain" will still be honored. Future versions may be expanded to include support for set_locale like features.


=head1 INSTALL

To install this module, simply copy the file lib/Gettext.js to a web accessable location, and reference it from your application.


=head1 CONFIGURATION

Configure in one of two ways:

=over

=item 1. Optimal. Load language definition from statically defined json data.

    <script language="javascript" src="/path/locale/domain.json"></script>

    // in domain.json
    json_locale_data = {
        "mydomain" : {
            // po header fields
            "" : {
                "plural-forms" : "...",
                "lang" : "en",
                },
            // all the msgid strings and translations
            "msgid" : [ "msgid_plural", "translation", "plural_translation" ],
        },
    };
    // please see the included bin/po2json script for the details on this format

This method also allows you to use unsupported file formats, so long as you can parse them into the above format.

=item 2. Use AJAX to load language file.

Use XMLHttpRequest (actually, SJAX - syncronous) to load an external resource.

Supported external formats are:

=over

=item * Javascript Object Notation (.json)

(see bin/po2json)

    type=application/json

=item * Uniforum Portable Object (.po)

(see GNU Gettext's xgettext)

    type=application/x-po

=item * Machine Object (compiled .po) (.mo)

NOTE: .mo format isn't actually supported just yet, but support is planned.

(see GNU Gettext's msgfmt)

    type=application/x-mo

=back

=back

=head1 METHODS

The following methods are implemented:

  new Gettext(args)
  textdomain  (domain)
  gettext     (msgid)
  dgettext    (domainname, msgid)
  dcgettext   (domainname, msgid, LC_MESSAGES)
  ngettext    (msgid, msgid_plural, count)
  dngettext   (domainname, msgid, msgid_plural, count)
  dcngettext  (domainname, msgid, msgid_plural, count, LC_MESSAGES)
  pgettext    (msgctxt, msgid)
  dpgettext   (domainname, msgctxt, msgid)
  dcpgettext  (domainname, msgctxt, msgid, LC_MESSAGES)
  npgettext   (msgctxt, msgid, msgid_plural, count)
  dnpgettext  (domainname, msgctxt, msgid, msgid_plural, count)
  dcnpgettext (domainname, msgctxt, msgid, msgid_plural, count, LC_MESSAGES)
  strargs     (string, args_array)


=head2 new Gettext (args)

Several methods of loading locale data are included. You may specify a plugin or alternative method of loading data by passing the data in as the "locale_data" option. For example:

    var get_locale_data = function () {
        // plugin does whatever to populate locale_data
        return locale_data;
    };
    var gt = new Gettext( 'domain' : 'messages',
                          'locale_data' : get_locale_data() );

The above can also be used if locale data is specified in a statically included <SCRIPT> tag. Just specify the variable name in the call to new. Ex:

    var gt = new Gettext( 'domain' : 'messages',
                          'locale_data' : json_locale_data_variable );

Finally, you may load the locale data by referencing it in a <LINK> tag. Simply exclude the 'locale_data' option, and all <LINK rel="gettext" ...> items will be tried. The <LINK> should be specified as:

    <link rel="gettext" type="application/json" href="/path/to/file.json">
    <link rel="gettext" type="text/javascript"  href="/path/to/file.json">
    <link rel="gettext" type="application/x-po" href="/path/to/file.po">
    <link rel="gettext" type="application/x-mo" href="/path/to/file.mo">

args:

=over

=item domain

The Gettext domain, not www.whatev.com. It's usually your applications basename. If the .po file was "myapp.po", this would be "myapp".

=item locale_data

Raw locale data (in json structure). If specified, from_link data will be ignored.

=back

=cut

*/Gettext=function(a){this.domain="messages",this.locale_data=undefined;var b=["domain","locale_data"];if(this.isValidObject(a))for(var c in a)for(var d=0;d<b.length;d++)c==b[d]&&this.isValidObject(a[c])&&(this[c]=a[c]);return this.try_load_lang(),this},Gettext.context_glue="",Gettext._locale_data={},Gettext.prototype.try_load_lang=function(){if(typeof this.locale_data!="undefined"){var a=this.locale_data;this.locale_data=undefined,this.parse_locale_data(a);if(typeof Gettext._locale_data[this.domain]=="undefined")throw new Error("Error: Gettext 'locale_data' does not contain the domain '"+this.domain+"'")}var b=this.get_lang_refs();if(typeof b=="object"&&b.length>0)for(var c=0;c<b.length;c++){var d=b[c];if(d.type=="application/json"){if(!this.try_load_lang_json(d.href))throw new Error("Error: Gettext 'try_load_lang_json' failed. Unable to exec xmlhttprequest for link ["+d.href+"]")}else{if(d.type!="application/x-po")throw new Error("TODO: link type ["+d.type+"] found, and support is planned, but not implemented at this time.");if(!this.try_load_lang_po(d.href))throw new Error("Error: Gettext 'try_load_lang_po' failed. Unable to exec xmlhttprequest for link ["+d.href+"]")}}},Gettext.prototype.parse_locale_data=function(a){typeof Gettext._locale_data=="undefined"&&(Gettext._locale_data={});for(var b in a){if(!a.hasOwnProperty(b)||!this.isValidObject(a[b]))continue;var c=!1;for(var d in a[b]){c=!0;break}if(!c)continue;var e=a[b];b==""&&(b="messages"),this.isValidObject(Gettext._locale_data[b])||(Gettext._locale_data[b]={}),this.isValidObject(Gettext._locale_data[b].head)||(Gettext._locale_data[b].head={}),this.isValidObject(Gettext._locale_data[b].msgs)||(Gettext._locale_data[b].msgs={});for(var f in e)if(f==""){var g=e[f];for(var h in g){var i=h.toLowerCase();Gettext._locale_data[b].head[i]=g[h]}}else Gettext._locale_data[b].msgs[f]=e[f]}for(var b in Gettext._locale_data)if(this.isValidObject(Gettext._locale_data[b].head["plural-forms"])&&typeof Gettext._locale_data[b].head.plural_func=="undefined"){var j=Gettext._locale_data[b].head["plural-forms"],k=new RegExp("^(\\s*nplurals\\s*=\\s*[0-9]+\\s*;\\s*plural\\s*=\\s*(?:\\s|[-\\?\\|&=!<>+*/%:;a-zA-Z0-9_()])+)","m");if(!k.test(j))throw new Error("Syntax error in language file. Plural-Forms header is invalid ["+j+"]");var l=Gettext._locale_data[b].head["plural-forms"];/;\s*$/.test(l)||(l=l.concat(";"));var m="var plural; var nplurals; "+l+' return { "nplural" : nplurals, "plural" : (plural === true ? 1 : plural ? plural : 0) };';Gettext._locale_data[b].head.plural_func=new Function("n",m)}else typeof Gettext._locale_data[b].head.plural_func=="undefined"&&(Gettext._locale_data[b].head.plural_func=function(a){var b=a!=1?1:0;return{nplural:2,plural:b}});return},Gettext.prototype.try_load_lang_po=function(a){var b=this.sjax(a);if(!b)return;var c=this.uri_basename(a),d=this.parse_po(b),e={};return d&&(d[""]||(d[""]={}),d[""].domain||(d[""].domain=c),c=d[""].domain,e[c]=d,this.parse_locale_data(e)),1},Gettext.prototype.uri_basename=function(a){var b;if(b=a.match(/^(.*\/)?(.*)/)){var c;return(c=b[2].match(/^(.*)\..+$/))?c[1]:b[2]}return""},Gettext.prototype.parse_po=function(a){var b={},c={},d="",e=[],f=a.split("\n");for(var g=0;g<f.length;g++){f[g]=f[g].replace(/(\n|\r)+$/,"");var h;if(/^$/.test(f[g])){if(typeof c["msgid"]!="undefined"){var i=typeof c["msgctxt"]!="undefined"&&c.msgctxt.length?c.msgctxt+Gettext.context_glue+c.msgid:c.msgid,j=typeof c["msgid_plural"]!="undefined"&&c.msgid_plural.length?c.msgid_plural:null,k=[];for(var l in c){var h;if(h=l.match(/^msgstr_(\d+)/))k[parseInt(h[1])]=c[l]}k.unshift(j),k.length>1&&(b[i]=k),c={},d=""}}else{if(/^#/.test(f[g]))continue;(h=f[g].match(/^msgctxt\s+(.*)/))?(d="msgctxt",c[d]=this.parse_po_dequote(h[1])):(h=f[g].match(/^msgid\s+(.*)/))?(d="msgid",c[d]=this.parse_po_dequote(h[1])):(h=f[g].match(/^msgid_plural\s+(.*)/))?(d="msgid_plural",c[d]=this.parse_po_dequote(h[1])):(h=f[g].match(/^msgstr\s+(.*)/))?(d="msgstr_0",c[d]=this.parse_po_dequote(h[1])):(h=f[g].match(/^msgstr\[0\]\s+(.*)/))?(d="msgstr_0",c[d]=this.parse_po_dequote(h[1])):(h=f[g].match(/^msgstr\[(\d+)\]\s+(.*)/))?(d="msgstr_"+h[1],c[d]=this.parse_po_dequote(h[2])):/^"/.test(f[g])?c[d]+=this.parse_po_dequote(f[g]):e.push("Strange line ["+g+"] : "+f[g])}}if(typeof c["msgid"]!="undefined"){var i=typeof c["msgctxt"]!="undefined"&&c.msgctxt.length?c.msgctxt+Gettext.context_glue+c.msgid:c.msgid,j=typeof c["msgid_plural"]!="undefined"&&c.msgid_plural.length?c.msgid_plural:null,k=[];for(var l in c){var h;if(h=l.match(/^msgstr_(\d+)/))k[parseInt(h[1])]=c[l]}k.unshift(j),k.length>1&&(b[i]=k),c={},d=""}if(b[""]&&b[""][1]){var m={},n=b[""][1].split(/\\n/);for(var g=0;g<n.length;g++){if(!n.length)continue;var o=n[g].indexOf(":",0);if(o!=-1){var p=n[g].substring(0,o),q=n[g].substring(o+1),r=p.toLowerCase();m[r]&&m[r].length?e.push("SKIPPING DUPLICATE HEADER LINE: "+n[g]):/#-#-#-#-#/.test(r)?e.push("SKIPPING ERROR MARKER IN HEADER: "+n[g]):(q=q.replace(/^\s+/,""),m[r]=q)}else e.push("PROBLEM LINE IN HEADER: "+n[g]),m[n[g]]=""}b[""]=m}else b[""]={};return b},Gettext.prototype.parse_po_dequote=function(a){var b;if(b=a.match(/^"(.*)"/))a=b[1];return a=a.replace(/\\"/g,'"'),a},Gettext.prototype.try_load_lang_json=function(a){var b=this.sjax(a);if(!b)return;var c=this.JSON(b);return this.parse_locale_data(c),1},Gettext.prototype.get_lang_refs=function(){var a=new Array,b=document.getElementsByTagName("link");for(var c=0;c<b.length;c++)if(b[c].rel=="gettext"&&b[c].href){if(typeof b[c].type=="undefined"||b[c].type=="")if(/\.json$/i.test(b[c].href))b[c].type="application/json";else if(/\.js$/i.test(b[c].href))b[c].type="application/json";else if(/\.po$/i.test(b[c].href))b[c].type="application/x-po";else{if(!/\.mo$/i.test(b[c].href))throw new Error("LINK tag with rel=gettext found, but the type and extension are unrecognized.");b[c].type="application/x-mo"}b[c].type=b[c].type.toLowerCase();if(b[c].type=="application/json")b[c].type="application/json";else if(b[c].type=="text/javascript")b[c].type="application/json";else if(b[c].type=="application/x-po")b[c].type="application/x-po";else{if(b[c].type!="application/x-mo")throw new Error("LINK tag with rel=gettext found, but the type attribute ["+b[c].type+"] is unrecognized.");b[c].type="application/x-mo"}a.push(b[c])}return a},Gettext.prototype.textdomain=function(a){return a&&a.length&&(this.domain=a),this.domain},Gettext.prototype.gettext=function(a){var b,c,d,e;return this.dcnpgettext(null,b,a,c,d,e)},Gettext.prototype.dgettext=function(a,b){var c,d,e,f;return this.dcnpgettext(a,c,b,d,e,f)},Gettext.prototype.dcgettext=function(a,b,c){var d,e,f;return this.dcnpgettext(a,d,b,e,f,c)},Gettext.prototype.ngettext=function(a,b,c){var d,e;return this.dcnpgettext(null,d,a,b,c,e)},Gettext.prototype.dngettext=function(a,b,c,d){var e,f;return this.dcnpgettext(a,e,b,c,d,f)},Gettext.prototype.dcngettext=function(a,b,c,d,e){var f;return this.dcnpgettext(a,f,b,c,d,e,e)},Gettext.prototype.pgettext=function(a,b){var c,d,e;return this.dcnpgettext(null,a,b,c,d,e)},Gettext.prototype.dpgettext=function(a,b,c){var d,e,f;return this.dcnpgettext(a,b,c,d,e,f)},Gettext.prototype.dcpgettext=function(a,b,c,d){var e,f;return this.dcnpgettext(a,b,c,e,f,d)},Gettext.prototype.npgettext=function(a,b,c,d){var e;return this.dcnpgettext(null,a,b,c,d,e)},Gettext.prototype.dnpgettext=function(a,b,c,d,e){var f;return this.dcnpgettext(a,b,c,d,e,f)},Gettext.prototype.dcnpgettext=function(a,b,c,d,e,f){if(!this.isValidObject(c))return"";var g=this.isValidObject(d),h=this.isValidObject(b)?b+Gettext.context_glue+c:c,i=this.isValidObject(a)?a:this.isValidObject(this.domain)?this.domain:"messages",j="LC_MESSAGES",f=5,k=new Array;if(typeof Gettext._locale_data!="undefined"&&this.isValidObject(Gettext._locale_data[i]))k.push(Gettext._locale_data[i]);else if(typeof Gettext._locale_data!="undefined")for(var l in Gettext._locale_data)k.push(Gettext._locale_data[l]);var m=[],n=!1,o;if(k.length)for(var p=0;p<k.length;p++){var q=k[p];if(this.isValidObject(q.msgs[h])){for(var r=0;r<q.msgs[h].length;r++)m[r]=q.msgs[h][r];m.shift(),o=q,n=!0;if(m.length>0&&m[0].length!=0)break}}if(m.length==0||m[0].length==0)m=[c,d];var s=m[0];if(g){var t;if(n&&this.isValidObject(o.head.plural_func)){var u=o.head.plural_func(e);u.plural||(u.plural=0),u.nplural||(u.nplural=0),u.nplural<=u.plural&&(u.plural=0),t=u.plural}else t=e!=1?1:0;this.isValidObject(m[t])&&(s=m[t])}return s},Gettext.strargs=function(a,b){null==b||"undefined"==typeof b?b=[]:b.constructor!=Array&&(b=[b]);var c="";for(;;){var d=a.indexOf("%"),e;if(d==-1){c+=a;break}c+=a.substr(0,d);if(a.substr(d,2)=="%%")c+="%",a=a.substr(d+2);else if(e=a.substr(d).match(/^%(\d+)/)){var f=parseInt(e[1]),g=e[1].length;f>0&&b[f-1]!=null&&typeof b[f-1]!="undefined"&&(c+=b[f-1]),a=a.substr(d+1+g)}else c+="%",a=a.substr(d+1)}return c},Gettext.prototype.strargs=function(a,b){return Gettext.strargs(a,b)},Gettext.prototype.isArray=function(a){return this.isValidObject(a)&&a.constructor==Array},Gettext.prototype.isValidObject=function(a){return null==a?!1:"undefined"==typeof a?!1:!0},Gettext.prototype.sjax=function(a){var b;window.XMLHttpRequest?b=new XMLHttpRequest:navigator.userAgent.toLowerCase().indexOf("msie 5")!=-1?b=new ActiveXObject("Microsoft.XMLHTTP"):b=new ActiveXObject("Msxml2.XMLHTTP");if(!b)throw new Error("Your browser doesn't do Ajax. Unable to support external language files.");b.open("GET",a,!1);try{b.send(null)}catch(c){return}var d=b.status;if(d==200||d==0)return b.responseText;var e=b.statusText+" (Error "+b.status+")";b.responseText.length&&(e+="\n"+b.responseText),alert(e);return},Gettext.prototype.JSON=function(data){return eval("("+data+")")};
// Generated by CoffeeScript 1.6.3
/*
** Annotator 1.2.6-dev-5c36e53
** https://github.com/okfn/annotator/
**
** Copyright 2012 Aron Carroll, Rufus Pollock, and Nick Stenning.
** Dual licensed under the MIT and GPLv3 licenses.
** https://github.com/okfn/annotator/blob/master/LICENSE
**
** Built at: 2014-06-17 21:12:58Z
*//*
//
*/// Generated by CoffeeScript 1.6.3
(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B=[].slice,C={}.hasOwnProperty,D=function(a,b){function d(){this.constructor=a}for(var c in b)C.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},E=function(a,b){return function(){return a.apply(b,arguments)}};q=function(b){var c;return c=this.map(function(){var c,d,e,f;e="",c=this;while((c!=null?c.nodeType:void 0)===Node.ELEMENT_NODE&&c!==b)f=c.tagName.replace(":","\\:"),d=a(c.parentNode).children(f).index(c)+1,d="["+d+"]",e="/"+c.tagName.toLowerCase()+d+e,c=c.parentNode;return e}),c.get()},r=function(a){var b,c,d,e;return b=function(a){var b,c;return b=n(a),c=o(a),""+b+"["+c+"]"},e=a,c=function(a){var c;c="";while(a!==e){if(a==null)throw new Error("Called getPathTo on a node which was not a descendant of @rootNode. "+e);c=b(a)+"/"+c,a=a.parentNode}return c="/"+c,c=c.replace(/\/$/,""),c},d=this.map(function(){var a;return a=c(this),a}),d.get()},j=function(a,b,c){var d,e,f,g,h,i;if(!a.hasChildNodes())throw new Error("XPath error: node has no children!");e=a.childNodes,f=0;for(h=0,i=e.length;h<i;h++){d=e[h],g=n(d);if(g===b){f+=1;if(f===c)return d}}throw new Error("XPath error: wanted child not found.")},n=function(a){var b;b=a.nodeName.toLowerCase();switch(b){case"#text":return"text()";case"#comment":return"comment()";case"#cdata-section":return"cdata-section()";default:return b}},o=function(a){var b,c;b=0,c=a;while(c)c.nodeName===a.nodeName&&b++,c=c.previousSibling;return b},p=null,typeof Gettext!="undefined"&&Gettext!==null?(u=new Gettext({domain:"annotator"}),p=function(a){return u.gettext(a)}):p=function(a){return a},A=function(a){return p(a)},(typeof jQuery!="undefined"&&jQuery!==null?(z=jQuery.fn)!=null?z.jquery:void 0:void 0)||console.error(A("Annotator requires jQuery: have you included lib/vendor/jquery.js?")),JSON&&JSON.parse&&JSON.stringify||console.error(A("Annotator requires a JSON implementation: have you included lib/vendor/json2.js?")),a=jQuery,i={},i.flatten=function(b){var c;return c=function(b){var d,e,f,g;e=[];for(f=0,g=b.length;f<g;f++)d=b[f],e=e.concat(d&&a.isArray(d)?c(d):d);return e},c(b)},i.getTextNodes=function(a){var b;return b=function(a){var c;if(a&&a.nodeType!==Node.TEXT_NODE){c=[];if(a.nodeType!==Node.COMMENT_NODE){a=a.lastChild;while(a)c.push(b(a)),a=a.previousSibling}return c.reverse()}return a},a.map(function(){return i.flatten(b(this))})},i.getLastTextNodeUpTo=function(a){var b;switch(a.nodeType){case Node.TEXT_NODE:return a;case Node.ELEMENT_NODE:if(a.lastChild!=null){b=i.getLastTextNodeUpTo(a.lastChild);if(b!=null)return b}}return a=a.previousSibling,a!=null?i.getLastTextNodeUpTo(a):null},i.getFirstTextNodeNotBefore=function(a){var b;switch(a.nodeType){case Node.TEXT_NODE:return a;case Node.ELEMENT_NODE:if(a.firstChild!=null){b=i.getFirstTextNodeNotBefore(a.firstChild);if(b!=null)return b}}return a=a.nextSibling,a!=null?i.getFirstTextNodeNotBefore(a):null},i.xpathFromNode=function(a,b){var c,d;try{d=q.call(a,b)}catch(e){c=e,console.log("jQuery-based XPath construction failed! Falling back to manual."),d=r.call(a,b)}return d},i.nodeFromXPath=function(a,b){var c,d,e,f,g,h,i,k;g=a.substring(1).split("/"),e=b;for(h=0,i=g.length;h<i;h++)f=g[h],k=f.split("["),d=k[0],c=k[1],c=c!=null?parseInt((c!=null?c.split("]"):void 0)[0]):1,e=j(e,d.toLowerCase(),c);return e},i.escape=function(a){return a.replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},l=["log","debug","info","warn","exception","assert","dir","dirxml","trace","group","groupEnd","groupCollapsed","time","timeEnd","profile","profileEnd","count","clear","table","error","notifyFirebug","firebug","userObjects"];if(typeof console!="undefined"&&console!==null){console.group==null&&(console.group=function(a){return console.log("GROUP: ",a)}),console.groupCollapsed==null&&(console.groupCollapsed=console.group);for(v=0,x=l.length;v<x;v++)k=l[v],console[k]==null&&(console[k]=function(){return console.log(A("Not implemented:")+(" console."+name))})}else{this.console={};for(w=0,y=l.length;w<y;w++)k=l[w],this.console[k]=function(){};this.console.error=function(){var a;return a=1<=arguments.length?B.call(arguments,0):[],alert("ERROR: "+a.join(", "))},this.console.warn=function(){var a;return a=1<=arguments.length?B.call(arguments,0):[],alert("WARNING: "+a.join(", "))}}d=function(){function b(b,c){this.options=a.extend(!0,{},this.options,c),this.element=a(b),this._closures={},this.on=this.subscribe,this.addEvents()}return b.prototype.events={},b.prototype.options={},b.prototype.element=null,b.prototype.addEvents=function(){var a,c,d,e,f;e=b._parseEvents(this.events),f=[];for(c=0,d=e.length;c<d;c++)a=e[c],f.push(this._addEvent(a.selector,a.event,a.functionName));return f},b.prototype.removeEvents=function(){var a,c,d,e,f;e=b._parseEvents(this.events),f=[];for(c=0,d=e.length;c<d;c++)a=e[c],f.push(this._removeEvent(a.selector,a.event,a.functionName));return f},b.prototype._addEvent=function(a,c,d){var e,f,g=this;return f=typeof d=="string"?this[d]:d,e=function(){return f.apply(g,arguments)},a===""&&b._isCustomEvent(c)?this.subscribe(c,e):this.element.delegate(a,c,e),this._closures[""+a+"/"+c+"/"+d]=e,this},b.prototype._removeEvent=function(a,c,d){var e;return e=this._closures[""+a+"/"+c+"/"+d],a===""&&b._isCustomEvent(c)?this.unsubscribe(c,e):this.element.undelegate(a,c,e),delete this._closures[""+a+"/"+c+"/"+d],this},b.prototype.publish=function(){return this.element.triggerHandler.apply(this.element,arguments),this},b.prototype.subscribe=function(b,c){var d;return d=function(){return c.apply(this,[].slice.call(arguments,1))},d.guid=c.guid=a.guid+=1,this.element.bind(b,d),this},b.prototype.unsubscribe=function(){return this.element.unbind.apply(this.element,arguments),this},b}(),d._parseEvents=function(a){var b,c,d,e,f,g,h;c=[];for(e in a)d=a[e],h=e.split(" "),f=2<=h.length?B.call(h,0,g=h.length-1):(g=0,[]),b=h[g++],c.push({selector:f.join(" "),event:b,functionName:d});return c},d.natives=function(){var a,b,c;return b=function(){var b,d;b=jQuery.event.special,d=[];for(a in b){if(!C.call(b,a))continue;c=b[a],d.push(a)}return d}(),"blur focus focusin focusout load resize scroll unload click dblclick\nmousedown mouseup mousemove mouseover mouseout mouseenter mouseleave\nchange select submit keydown keypress keyup error".split(/[^a-z]+/).concat(b)}(),d._isCustomEvent=function(b){return b=b.split(".")[0],a.inArray(b,d.natives)===-1},h={},h.sniff=function(a){return a.commonAncestorContainer!=null?new h.BrowserRange(a):typeof a.start=="string"?new h.SerializedRange({startContainer:a.start,startOffset:a.startOffset,endContainer:a.end,endOffset:a.endOffset}):typeof a.startContainer=="string"?new h.SerializedRange(a):a.start&&typeof a.start=="object"?new h.NormalizedRange(a):(console.error(A("Could not sniff range type")),!1)},h.nodeFromXPath=function(b,c){var d,e,f,g,h;return c==null&&(c=document),e=function(a,b){var d;b==null&&(b=null);try{return document.evaluate("."+a,c,b,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}catch(e){return d=e,console.log("XPath evaluation failed."),console.log("Trying fallback..."),i.nodeFromXPath(a,c)}},a.isXMLDoc(document.documentElement)?(d=document.createNSResolver(document.ownerDocument===null?document.documentElement:document.ownerDocument.documentElement),g=e(b,d),g||(b=function(){var a,c,d,e;d=b.split("/"),e=[];for(a=0,c=d.length;a<c;a++)h=d[a],h&&h.indexOf(":")===-1?e.push(h.replace(/^([a-z]+)/,"xhtml:$1")):e.push(h);return e}().join("/"),f=document.lookupNamespaceURI(null),d=function(a){return a==="xhtml"?f:document.documentElement.getAttribute("xmlns:"+a)},g=e(b,d)),g):e(b)},h.RangeError=function(a){function b(a,c,d){this.type=a,this.message=c,this.parent=d!=null?d:null,b.__super__.constructor.call(this,this.message)}return D(b,a),b}(Error),h.BrowserRange=function(){function a(a){this.commonAncestorContainer=a.commonAncestorContainer,this.startContainer=a.startContainer,this.startOffset=a.startOffset,this.endContainer=a.endContainer,this.endOffset=a.endOffset}return a.prototype.normalize=function(a){var b,c,d,e,f,g,j;if(this.tainted)return console.error(A("You may only call normalize() once on a BrowserRange!")),!1;this.tainted=!0,j={},this.startContainer.nodeType===Node.ELEMENT_NODE?(j.start=i.getFirstTextNodeNotBefore(this.startContainer.childNodes[this.startOffset]),j.startOffset=0):(j.start=this.startContainer,j.startOffset=this.startOffset);if(this.endContainer.nodeType===Node.ELEMENT_NODE){e=this.endContainer.childNodes[this.endOffset];if(e!=null){d=e;while(d!=null&&d.nodeType!==Node.TEXT_NODE)d=d.firstChild;d!=null&&(g=d.previousSibling,g!=null&&g.nodeType===Node.TEXT_NODE?(j.end=g,j.endOffset=g.nodeValue.length):(j.end=d,j.endOffset=0))}j.end==null&&(this.endOffset?e=this.endContainer.childNodes[this.endOffset-1]:e=this.endContainer.previousSibling,j.end=i.getLastTextNodeUpTo(e),j.endOffset=j.end.nodeValue.length)}else j.end=this.endContainer,j.endOffset=this.endOffset;f={},b=!1,j.startOffset>0?j.start.nodeValue.length>j.startOffset?(f.start=j.start.splitText(j.startOffset),b=!0):f.start=j.start.nextSibling:f.start=j.start,j.start===j.end?(f.start.nodeValue.length>j.endOffset-j.startOffset&&(f.start.splitText(j.endOffset-j.startOffset),b=!0),f.end=f.start):(j.end.nodeValue.length>j.endOffset&&(j.end.splitText(j.endOffset),b=!0),f.end=j.end),f.commonAncestor=this.commonAncestorContainer;while(f.commonAncestor.nodeType!==Node.ELEMENT_NODE)f.commonAncestor=f.commonAncestor.parentNode;return b&&(c=document.createEvent("UIEvents"),c.initUIEvent("domChange",!0,!1,window,0),c.reason="range normalization",c.data=f,f.commonAncestor.dispatchEvent(c)),new h.NormalizedRange(f)},a.prototype.serialize=function(a,b){return this.normalize(a).serialize(a,b)},a}(),h.NormalizedRange=function(){function b(a){this.commonAncestor=a.commonAncestor,this.start=a.start,this.end=a.end}return b.prototype.normalize=function(a){return this},b.prototype.limit=function(b){var c,d,e,f,g,h;c=a.grep(this.textNodes(),function(c){return c.parentNode===b||a.contains(b,c.parentNode)});if(!c.length)return null;this.start=c[0],this.end=c[c.length-1],e=a(this.start).parents(),h=a(this.end).parents();for(f=0,g=h.length;f<g;f++){d=h[f];if(e.index(d)!==-1){this.commonAncestor=d;break}}return this},b.prototype.serialize=function(b,c){var d,e,f;return e=function(d,e){var f,g,h,j,k,l,m,n;c?j=a(d).parents(":not("+c+")").eq(0):j=a(d).parent(),l=i.xpathFromNode(j,b)[0],k=i.getTextNodes(j),g=k.slice(0,k.index(d)),h=0;for(m=0,n=g.length;m<n;m++)f=g[m],h+=f.nodeValue.length;return e?[l,h+d.nodeValue.length]:[l,h]},f=e(this.start),d=e(this.end,!0),new h.SerializedRange({startContainer:f[0],endContainer:d[0],startOffset:f[1],endOffset:d[1]})},b.prototype.text=function(){var a;return function(){var b,c,d,e;d=this.textNodes(),e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(a.nodeValue);return e}.call(this).join("")},b.prototype.textNodes=function(){var b,c,d,e;return d=i.getTextNodes(a(this.commonAncestor)),e=[d.index(this.start),d.index(this.end)],c=e[0],b=e[1],a.makeArray(d.slice(c,+b+1||9e9))},b.prototype.toRange=function(){var a;return a=document.createRange(),a.setStartBefore(this.start),a.setEndAfter(this.end),a},b.prototype.getEndCoords=function(){var b,c,d;return b=a(this.end),d=a("<span></span>"),d.insertAfter(b),c=d.offset(),d.remove(),{x:c.left,y:c.top}},b}(),h.SerializedRange=function(){function b(a){this.startContainer=a.startContainer,this.startOffset=a.startOffset,this.endContainer=a.endContainer,this.endOffset=a.endOffset}return b.prototype.normalize=function(b){var c,d,e,f,g,j,k,l,m,n,o,p,q,r,s;j={},r=["start","end"];for(n=0,p=r.length;n<p;n++){g=r[n],m=this[g+"Container"];try{f=h.nodeFromXPath(m,b)}catch(t){throw d=t,new h.RangeError(g,"Error while finding "+g+" node: "+m+": "+d,d)}if(!f)throw new h.RangeError(g,"Couldn't find "+g+" node: "+m);e=0,k=this[g+"Offset"],g==="end"&&k--,s=i.getTextNodes(a(f));for(o=0,q=s.length;o<q;o++){l=s[o];if(e+l.nodeValue.length>k){j[g+"Container"]=l,j[g+"Offset"]=this[g+"Offset"]-e;break}e+=l.nodeValue.length}if(j[g+"Offset"]==null)throw new h.RangeError(g,""+g+"offset","Couldn't find offset "+this[g+"Offset"]+" in element "+this[g])}return c=document.compareDocumentPosition==null?function(a,b){return a.contains(b)}:function(a,b){return a.compareDocumentPosition(b)&16},a(j.startContainer).parents().each(function(){if(c(this,j.endContainer))return j.commonAncestorContainer=this,!1}),(new h.BrowserRange(j)).normalize(b)},b.prototype.serialize=function(a,b){return this.normalize(a).serialize(a,b)},b.prototype.toObject=function(){return{startContainer:this.startContainer,startOffset:this.startOffset,endContainer:this.endContainer,endOffset:this.endOffset}},b}(),b=function(){function a(a,b,c,d,e,f,g,h){this.annotator=a,this.annotation=b,this.target=c,this.startPage=d,this.endPage=e,this.quote=f,this.diffHTML=g,this.diffCaseOnly=h,this.virtualize=E(this.virtualize,this),this.realize=E(this.realize,this);if(this.annotator==null)throw"annotator is required!";if(this.annotation==null)throw"annotation is required!";if(this.target==null)throw"target is required!";this.startPage==null&&"startPage is required!";if(this.endPage==null)throw"endPage is required!";if(this.quote==null)throw"quote is required!";this.highlight={}}return a.prototype._createHighlight=function(a){throw"Function not implemented"},a.prototype.realize=function(){var a,b,c,d,e,f,g,h,i=this;if(this.fullyRealized)return;d=function(){h=[];for(var a=f=this.startPage,b=this.endPage;f<=b?a<=b:a>=b;f<=b?a++:a--)h.push(a);return h}.apply(this).filter(function(a){return i.annotator.domMapper.isPageMapped(a)}),c=d.filter(function(a){return i.highlight[a]==null});if(!c.length)return;return a=function(){var a,d,e;e=[];for(a=0,d=c.length;a<d;a++)b=c[a],e.push(this.highlight[b]=this._createHighlight(b));return e}.call(this),this.fullyRealized=d.length===this.endPage-this.startPage+1,this.annotator.publish("highlightsCreated",a)},a.prototype.virtualize=function(a){var b;b=this.highlight[a];if(b==null)return;return b.removeFromDocument(),delete this.highlight[a],this.fullyRealized=!1,this.annotator.publish("highlightRemoved",b)},a.prototype.remove=function(){var a,b,c,d,e,f,g,h;h=[];for(c=d=e=this.startPage,f=this.endPage;e<=f?d<=f:d>=f;c=e<=f?++d:--d)this.virtualize(c),a=this.annotator.anchors[c],b=a.indexOf(this),[].splice.apply(a,[b,b-b+1].concat(g=[])),g,a.length?h.push(void 0):h.push(delete this.annotator.anchors[c]);return h},a.prototype.annotationUpdated=function(){var a,b,c,d,e,f;f=[];for(a=b=c=this.startPage,d=this.endPage;c<=d?b<=d:b>=d;a=c<=d?++b:--b)f.push((e=this.highlight[a])!=null?e.annotationUpdated():void 0);return f},a}(),f=function(){function b(a,b){this.anchor=a,this.pageIndex=b,this.annotator=this.anchor.annotator,this.annotation=this.anchor.annotation}return b.prototype.setTemporary=function(a){throw"Operation not implemented."},b.prototype.isTemporary=function(){throw"Operation not implemented."},b.prototype.setActive=function(a,b){throw b==null&&(b=!1),"Operation not implemented."},b.prototype.setFocused=function(a,b){throw b==null&&(b=!1),"Operation not implemented."},b.prototype.annotationUpdated=function(){},b.prototype.removeFromDocument=function(){throw"Operation not implemented."},b.prototype._getDOMElements=function(){throw"Operation not implemented."},b.prototype.getTop=function(){return a(this._getDOMElements()).offset().top},b.prototype.getHeight=function(){return a(this._getDOMElements()).outerHeight(!0)},b.prototype.getBottom=function(){return this.getTop()+this.getBottom()},b.prototype.scrollTo=function(){return a(this._getDOMElements()).scrollintoview()},b.prototype.paddedScrollTo=function(b){var c,d,e,f,g;if(b==null)throw"Direction is required";return d=b==="up"?-1:1,f=a(this._getDOMElements()),g=this.annotator.wrapper,c=g[0].ownerDocument.defaultView,e=c.innerHeight*.2,f.scrollintoview({complete:function(){var b,c,f;return c=this.parentNode===this.ownerDocument?a(this.ownerDocument.body):a(this),f=c.scrollTop(),b=e*d,c.stop().animate({scrollTop:f+b},300)}})},b.prototype.paddedScrollUpTo=function(){return this.paddedScrollTo("up")},b.prototype.paddedScrollDownTo=function(){return this.paddedScrollTo("down")},b}(),s={uuid:function(){var a;return a=0,function(){return a++}}(),getGlobal:function(){return function(){return this}()},maxZIndex:function(b){var c,d;return c=function(){var c,e,f;f=[];for(c=0,e=b.length;c<e;c++)d=b[c],a(d).css("position")==="static"?f.push(-1):f.push(parseFloat(a(d).css("z-index"),10)||-1);return f}(),Math.max.apply(Math,c)},mousePosition:function(b,c){var d,e;return(e=a(c).css("position"))!=="absolute"&&e!=="fixed"&&e!=="relative"&&(c=a(c).offsetParent()[0]),d=a(c).offset(),{top:b.pageY-d.top,left:b.pageX-d.left}},preventEventDefault:function(a){return a!=null?typeof a.preventDefault=="function"?a.preventDefault():void 0:void 0}},t=this.Annotator,e=function(){function a(){}return a.applicable=function(){return!0},a.prototype.getPageIndex=function(){return 0},a.prototype.getPageCount=function(){return 1},a.prototype.getPageIndexForPos=function(){return 0},a.prototype.isPageMapped=function(){return!0},a.prototype.scan=function(){},a}(),c=function(b){function c(b,d){this.onDeleteAnnotation=E(this.onDeleteAnnotation,this),this.onEditAnnotation=E(this.onEditAnnotation,this),this.onAdderClick=E(this.onAdderClick,this),this.onAdderMousedown=E(this.onAdderMousedown,this),this._getTargetFromSelection=E(this._getTargetFromSelection,this),this.checkForStartSelection=E(this.checkForStartSelection,this),this.clearViewerHideTimer=E(this.clearViewerHideTimer,this),this.startViewerHideTimer=E(this.startViewerHideTimer,this),this.showViewer=E(this.showViewer,this),this.onEditorSubmit=E(this.onEditorSubmit,this),this.onEditorHide=E(this.onEditorHide,this),this.showEditor=E(this.showEditor,this),this.getHref=E(this.getHref,this),c.__super__.constructor.apply(this,arguments),this.plugins={},this.selectorCreators=[],this.anchoringStrategies=[];if(!c.supported())return this;this.options.readOnly||this._setupDocumentEvents(),this._setupAnchorEvents(),this._setupWrapper(),this._setupDocumentAccessStrategies(),this._setupViewer()._setupEditor(),this._setupDynamicStyle(),this.options.noScan||this._scan(),this.adder=a(this.html.adder).appendTo(this.wrapper).hide()}return D(c,b),c.prototype.events={".annotator-adder button click":"onAdderClick",".annotator-adder button mousedown":"onAdderMousedown"},c.prototype.html={adder:'<div class="annotator-adder"><button>'+A("Annotate")+"</button></div>",wrapper:'<div class="annotator-wrapper"></div>'},c.prototype.options={readOnly:!1},c.prototype.plugins={},c.prototype.editor=null,c.prototype.viewer=null,c.prototype.selectedTargets=null,c.prototype.mouseIsDown=!1,c.prototype.inAdderClick=!1,c.prototype.canAnnotate=!1,c.prototype.viewerHideTimer=null,c.prototype._setupDocumentAccessStrategies=function(){return this.documentAccessStrategies=[{name:"Dummy",mapper:e}],this},c.prototype._chooseAccessPolicy=function(){var a,b,c,d,e=this;if(this.domMapper!=null)return;d=this.documentAccessStrategies;for(b=0,c=d.length;b<c;b++){a=d[b];if(a.mapper.applicable())return this.documentAccessStrategy=a,console.log("Selected document access strategy: "+a.name),this.domMapper=new a.mapper,this.anchors={},addEventListener("docPageMapped",function(a){return e._realizePage(a.pageIndex)}),addEventListener("docPageUnmapped",function(a){return e._virtualizePage(a.pageIndex)}),typeof a.init=="function"&&a.init(),this}},c.prototype._scan=function(){var a=this;return this.domMapper||this._chooseAccessPolicy(),this.pendingScan=this.domMapper.scan(),this.pendingScan!=null?this.pendingScan.then(function(){return a.enableAnnotating()}):this.enableAnnotating()},c.prototype._setupWrapper=function(){return this.wrapper=a(this.html.wrapper),this.element.find("script").remove(),this.element.wrapInner(this.wrapper),this.wrapper=this.element.find(".annotator-wrapper"),this},c.prototype._setupViewer=function(){var b=this;return this.viewer=new c.Viewer({readOnly:this.options.readOnly}),this.viewer.hide().on("edit",this.onEditAnnotation).on("delete",this.onDeleteAnnotation).addField({load:function(c,d){return d.text?a(c).html(i.escape(d.text)):a(c).html("<i>"+A("No Comment")+"</i>"),b.publish("annotationViewerTextField",[c,d])}}).element.appendTo(this.wrapper).bind({mouseover:this.clearViewerHideTimer,mouseout:this.startViewerHideTimer}),this},c.prototype._setupEditor=function(){return this.editor=new c.Editor,this.editor.hide().on("hide",this.onEditorHide).on("save",this.onEditorSubmit).addField({type:"textarea",label:A("Comments")+"…",load:function(b,c){return a(b).find("textarea").val(c.text||"")},submit:function(b,c){return c.text=a(b).find("textarea").val()}}),this.editor.element.appendTo(this.wrapper),this},c.prototype._setupDocumentEvents=function(){return a(document).bind({mousedown:this.checkForStartSelection}),this},c.prototype._setupAnchorEvents=function(){var a=this;return this.on("annotationUpdated",function(a){var b,c,d,e,f;e=a.anchors||[],f=[];for(c=0,d=e.length;c<d;c++)b=e[c],f.push(b.annotationUpdated());return f})},c.prototype._setupDynamicStyle=function(){var b,c,d,e;return d=a("#annotator-dynamic-style"),d.length||(d=a('<style id="annotator-dynamic-style"></style>').appendTo(document.head)),c="*"+function(){var a,b,c,d;c=["adder","outer","notice","filter"],d=[];for(a=0,b=c.length;a<b;a++)e=c[a],d.push(":not(.annotator-"+e+")");return d}().join(""),b=s.maxZIndex(a(document.body).find(c)),b=Math.max(b,1e3),d.text([".annotator-adder, .annotator-outer, .annotator-notice {","  z-index: "+(b+20)+";","}",".annotator-filter {","  z-index: "+(b+10)+";","}"].join("\n")),this},c.prototype.destroy=function(){var b,c,d;a(document).unbind({mouseup:this.checkForEndSelection,mousedown:this.checkForStartSelection}),a("#annotator-dynamic-style").remove(),this.adder.remove(),this.viewer.destroy(),this.editor.destroy(),this.wrapper.find(".annotator-hl").each(function(){return a(this).contents().insertBefore(this),a(this).remove()}),this.wrapper.contents().insertBefore(this.wrapper),this.wrapper.remove(),this.element.data("annotator",null),d=this.plugins;for(b in d)c=d[b],this.plugins[b].destroy();return this.removeEvents()},c.prototype.enableAnnotating=function(a,b){a==null&&(a=!0),b==null&&(b=!0);if(a===this.canAnnotate)return;this.canAnnotate=a,this.publish("enableAnnotating",a);if(!a&&!b)return this.adder.hide()},c.prototype.disableAnnotating=function(a){return a==null&&(a=!0),this.enableAnnotating(!1,a)},c.prototype.getHref=function(){var b;return b=decodeURIComponent(document.location.href),document.location.hash&&(b=b.slice(0,-1*location.hash.length)),a('meta[property^="og:url"]').each(function(){return b=decodeURIComponent(this.content)}),a('link[rel^="canonical"]').each(function(){return b=decodeURIComponent(this.href)}),b},c.prototype.createAnnotation=function(){var a;return a={},this.publish("beforeAnnotationCreated",[a]),a},c.prototype.normalizeString=function(a){return a.replace(/\s{2,}/g," ")},c.prototype.findSelector=function(a,b){var c,d,e;for(d=0,e=a.length;d<e;d++){c=a[d];if(c.type===b)return c}return null},c.prototype.createAnchor=function(a,b){var c,d,e,f,g,h,i,j;if(b==null)throw new Error("Trying to find anchor for null target!");e=null,d=null,i=this.anchoringStrategies;for(g=0,h=i.length;g<h;g++){f=i[g];try{c=f.code.call(this,a,b);if(c)return{result:c}}catch(k){e=k,console.log("Strategy '"+f.name+"' has thrown an error.",(j=e.stack)!=null?j:e)}}return{error:"No strategies worked."}},c.prototype.setupAnnotation=function(a){var b,c,d,e,f,g,i,j,k,l,m,n,o;a.target==null&&(a.target=this.selectedTargets),this.selectedTargets=[];if(a.target==null)throw new Error("Can not run setupAnnotation(). No target or selection available.");a.quote=[],a.anchors=[],l=a.target;for(i=0,k=l.length;i<k;i++){f=l[i];try{e=this.createAnchor(a,f),b=e.result,(e.error!=null)instanceof h.RangeError&&this.publish("rangeNormalizeFail",[a,e.error.range,e.error]);if(b!=null){a.quote.push(f.quote=b.quote),f.diffHTML=b.diffHTML,f.diffCaseOnly=b.diffCaseOnly,a.anchors.push(b);for(d=j=m=b.startPage,n=b.endPage;m<=n?j<=n:j>=n;d=m<=n?++j:--j)(g=this.anchors)[d]==null&&(g[d]=[]),this.anchors[d].push(b);b.realize()}else console.log("Could not create anchor for annotation '",a.id,"'.")}catch(p){c=p,console.log("Error in setupAnnotation for",a.id,":",(o=c.stack)!=null?o:c)}}return a.quote=a.quote.join(" / "),a},c.prototype.updateAnnotation=function(a){return this.publish("beforeAnnotationUpdated",[a]),this.publish("annotationUpdated",[a]),a},c.prototype.deleteAnnotation=function(a){var b,c,d,e;if(a.anchors!=null){e=a.anchors;for(c=0,d=e.length;c<d;c++)b=e[c],b.remove()}return this.publish("annotationDeleted",[a]),a},c.prototype.loadAnnotations=function(a){var b,c,d=this;return a==null&&(a=[]),c=function(a){var e,f,g,h;a==null&&(a=[]),f=a.splice(0,10);for(g=0,h=f.length;g<h;g++)e=f[g],d.setupAnnotation(e);return a.length>0?setTimeout(function(){return c(a)},10):d.publish("annotationsLoaded",[b])},b=a.slice(),a.length&&(this.domMapper||this._scan(),this.pendingScan!=null?this.pendingScan.then(function(){return setTimeout(function(){return c(a)})}):c(a)),this},c.prototype.dumpAnnotations=function(){return this.plugins.Store?this.plugins.Store.dumpAnnotations():(console.warn(A("Can't dump annotations without Store plugin.")),!1)},c.prototype.addPlugin=function(a,b){var d,e;return this.plugins[a]?console.error(A("You cannot have more than one instance of any plugin.")):(d=c.Plugin[a],typeof d=="function"?(this.plugins[a]=new d(this.element[0],b),this.plugins[a].annotator=this,typeof (e=this.plugins[a]).pluginInit=="function"&&e.pluginInit()):console.error(A("Could not load ")+a+A(" plugin. Have you included the appropriate <script> tag?"))),this},c.prototype.showEditor=function(a,b){return this.editor.element.css(b),this.editor.load(a),this.publish("annotationEditorShown",[this.editor,a]),this},c.prototype.onEditorHide=function(){return this.publish("annotationEditorHidden",[this.editor]),this.enableAnnotating()},c.prototype.onEditorSubmit=function(a){return this.publish("annotationEditorSubmit",[this.editor,a])},c.prototype.showViewer=function(a,b){return this.viewer.element.css(b),this.viewer.load(a),this.publish("annotationViewerShown",[this.viewer,a])},c.prototype.startViewerHideTimer=function(){if(!this.viewerHideTimer)return this.viewerHideTimer=setTimeout(this.viewer.hide,250)},c.prototype.clearViewerHideTimer=function(){return clearTimeout(this.viewerHideTimer),this.viewerHideTimer=!1},c.prototype.checkForStartSelection=function(a){return(!a||!this.isAnnotator(a.target))&&this.startViewerHideTimer(),this.mouseIsDown=!0},c.prototype._getTargetFromSelection=function(a){var b,c,d,e,f,g,h,i,j;e=[],j=this.selectorCreators;for(f=0,h=j.length;f<h;f++){b=j[f],c=b.describe(a);for(g=0,i=c.length;g<i;g++)d=c[g],e.push(d)}return{source:this.getHref(),selector:e}},c.prototype.onSuccessfulSelection=function(a,b){var c;b==null&&(b=!1);if(a==null)throw"Called onSuccessfulSelection without an event!";if(a.segments==null)throw"Called onSuccessulSelection with an event with missing segments!";return this.canAnnotate?(this.selectedTargets=function(){var b,d,e,f;e=a.segments,f=[];for(b=0,d=e.length;b<d;b++)c=e[b],f.push(this._getTargetFromSelection(c));return f}.call(this),b?this.onAdderClick(a):this.adder.css(s.mousePosition(a,this.wrapper[0])).show(),!0):!1},c.prototype.onFailedSelection=function(a){return this.adder.hide(),this.selectedTargets=[]},c.prototype.isAnnotator=function(b){return!!a(b).parents().andSelf().filter("[class^=annotator-]").not(this.wrapper).length},c.prototype.onAdderMousedown=function(a){return a!=null&&a.preventDefault(),this.disableAnnotating(),this.inAdderClick=!0},c.prototype.onAdderClick=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n=this;a!=null&&typeof a.preventDefault=="function"&&a.preventDefault(),h=this.adder.position(),this.adder.hide(),this.inAdderClick=!1,c=this.createAnnotation(),c=this.setupAnnotation(c),l=c.anchors;for(j=0,k=l.length;j<k;j++){b=l[j],m=b.highlight;for(g in m)f=m[g],f.setTemporary(!0)}return i=function(){var a,d,h,i;e(),h=c.anchors;for(a=0,d=h.length;a<d;a++){b=h[a],i=b.highlight;for(g in i)f=i[g],f.setTemporary(!1)}return n.publish("annotationCreated",[c])},d=function(){return e(),n.deleteAnnotation(c)},e=function(){return n.unsubscribe("annotationEditorHidden",d),n.unsubscribe("annotationEditorSubmit",i)},this.subscribe("annotationEditorHidden",d),this.subscribe("annotationEditorSubmit",i),this.showEditor(c,h)},c.prototype.onEditAnnotation=function(a){var b,c,d,e=this;return c=this.viewer.element.position(),d=function(){return b(),e.updateAnnotation(a)},b=function(){return e.unsubscribe("annotationEditorHidden",b),e.unsubscribe("annotationEditorSubmit",d)},this.subscribe("annotationEditorHidden",b),this.subscribe("annotationEditorSubmit",d),this.viewer.hide(),this.showEditor(a,c)},c.prototype.onDeleteAnnotation=function(a){return this.viewer.hide(),this.deleteAnnotation(a)},c.prototype.getHighlights=function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o;h=[];if(b!=null)for(i=0,k=b.length;i<k;i++){e=b[i],m=e.anchors;for(j=0,l=m.length;j<l;j++){c=m[j],n=c.highlight;for(g in n)f=n[g],h.push(f)}}else{o=this.anchors;for(g in o)d=o[g],a.merge(h,function(){var a,b,e;e=[];for(b=0,a=d.length;b<a;b++)c=d[b],c.highlight[g]!=null&&e.push(c.highlight[g]);return e}())}return h},c.prototype._realizePage=function(a){var b,c,d,e,f,g;if(!this.domMapper.isPageMapped(a))return;f=(e=this.anchors[a])!=null?e:[],g=[];for(c=0,d=f.length;c<d;c++)b=f[c],g.push(b.realize());return g},c.prototype._virtualizePage=function(a){var b,c,d,e,f,g;f=(e=this.anchors[a])!=null?e:[],g=[];for(c=0,d=f.length;c<d;c++)b=f[c],g.push(b.virtualize(a));return g},c.prototype.onAnchorMouseover=function(a){return this.clearViewerHideTimer(),this.mouseIsDown||this.viewer.isShown()?!1:this.showViewer(a.data.getAnnotations(a),s.mousePosition(a,this.wrapper[0]))},c.prototype.onAnchorMouseout=function(a){return this.startViewerHideTimer()},c.prototype.onAnchorMousedown=function(a){},c.prototype.onAnchorClick=function(a){},c}(d),c.Plugin=function(a){function b(a,c){b.__super__.constructor.apply(this,arguments)}return D(b,a),b.prototype.pluginInit=function(){},b.prototype.destroy=function(){return this.removeEvents()},b}(d),m=s.getGlobal(),m.wgxpath!=null&&m.wgxpath.install(),m.getSelection==null&&a.getScript("http://assets.annotateit.org/vendor/ierange.min.js"),m.JSON==null&&a.getScript("http://assets.annotateit.org/vendor/json2.min.js"),m.Node==null&&(m.Node={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12}),c.$=a,c.Delegator=d,c.Range=h,c.util=s,c.Util=i,c._instances=[],c.Highlight=f,c.Anchor=b,c._t=A,c.supported=function(){return function(){return!!this.getSelection}()},c.noConflict=function(){return s.getGlobal().Annotator=t,this},a.fn.annotator=function(b){var d;return d=Array.prototype.slice.call(arguments,1),this.each(function(){var e;return e=a.data(this,"annotator"),e?b&&e[b].apply(e,d):(e=new c(this,b),a.data(this,"annotator",e))})},this.Annotator=c,c.Widget=function(b){function d(b,e){d.__super__.constructor.apply(this,arguments),this.classes=a.extend({},c.Widget.prototype.classes,this.classes)}return D(d,b),d.prototype.classes={hide:"annotator-hide",invert:{x:"annotator-invert-x",y:"annotator-invert-y"}},d.prototype.destroy=function(){return this.removeEvents(),this.element.remove()},d.prototype.checkOrientation=function(){var b,c,d,e,f;return this.resetOrientation(),f=a(s.getGlobal()),e=this.element.children(":first"),c=e.offset(),d={top:f.scrollTop(),right:f.width()+f.scrollLeft()},b={top:c.top,right:c.left+e.width()},b.top-d.top<0&&this.invertY(),b.right-d.right>0&&this.invertX(),this},d.prototype.resetOrientation=function(){return this.element.removeClass(this.classes.invert.x).removeClass(this.classes.invert.y),this},d.prototype.invertX=function(){return this.element.addClass(this.classes.invert.x),this},d.prototype.invertY=function(){return this.element.addClass(this.classes.invert.y),this},d.prototype.isInvertedY=function(){return this.element.hasClass(this.classes.invert.y)},d.prototype
.isInvertedX=function(){return this.element.hasClass(this.classes.invert.x)},d}(d),c.Editor=function(b){function c(b){this.onCancelButtonMouseover=E(this.onCancelButtonMouseover,this),this.processKeypress=E(this.processKeypress,this),this.submit=E(this.submit,this),this.load=E(this.load,this),this.hide=E(this.hide,this),this.show=E(this.show,this),c.__super__.constructor.call(this,a(this.html)[0],b),this.fields=[],this.annotation={}}return D(c,b),c.prototype.events={"form submit":"submit",".annotator-save click":"submit",".annotator-cancel click":"hide",".annotator-cancel mouseover":"onCancelButtonMouseover","textarea keydown":"processKeypress"},c.prototype.classes={hide:"annotator-hide",focus:"annotator-focus"},c.prototype.html='<div class="annotator-outer annotator-editor">\n  <form class="annotator-widget">\n    <ul class="annotator-listing"></ul>\n    <div class="annotator-controls">\n      <a href="#cancel" class="annotator-cancel">'+A("Cancel")+'</a>\n<a href="#save" class="annotator-save annotator-focus">'+A("Save")+"</a>\n    </div>\n  </form>\n</div>",c.prototype.options={},c.prototype.show=function(a){return s.preventEventDefault(a),this.element.removeClass(this.classes.hide),this.element.find(".annotator-save").addClass(this.classes.focus),this.checkOrientation(),this.element.find(":input:first").focus(),this.setupDraggables(),this.publish("show")},c.prototype.hide=function(a){return s.preventEventDefault(a),this.element.addClass(this.classes.hide),this.publish("hide")},c.prototype.load=function(a){var b,c,d,e;this.annotation=a,this.publish("load",[this.annotation]),e=this.fields;for(c=0,d=e.length;c<d;c++)b=e[c],b.load(b.element,this.annotation);return this.show()},c.prototype.submit=function(a){var b,c,d,e;s.preventEventDefault(a),e=this.fields;for(c=0,d=e.length;c<d;c++)b=e[c],b.submit(b.element,this.annotation);return this.publish("save",[this.annotation]),this.hide()},c.prototype.addField=function(b){var c,d,e;d=a.extend({id:"annotator-field-"+s.uuid(),type:"input",label:"",load:function(){},submit:function(){}},b),e=null,c=a('<li class="annotator-item" />'),d.element=c[0];switch(d.type){case"textarea":e=a("<textarea />");break;case"input":case"checkbox":e=a("<input />");break;case"select":e=a("<select />")}return c.append(e),e.attr({id:d.id,placeholder:d.label}),d.type==="checkbox"&&(e[0].type="checkbox",c.addClass("annotator-checkbox"),c.append(a("<label />",{"for":d.id,html:d.label}))),this.element.find("ul:first").append(c),this.fields.push(d),d.element},c.prototype.checkOrientation=function(){var a,b;return c.__super__.checkOrientation.apply(this,arguments),b=this.element.find("ul"),a=this.element.find(".annotator-controls"),this.element.hasClass(this.classes.invert.y)?a.insertBefore(b):a.is(":first-child")&&a.insertAfter(b),this},c.prototype.processKeypress=function(a){if(a.keyCode===27)return this.hide();if(a.keyCode===13&&!a.shiftKey)return this.submit()},c.prototype.onCancelButtonMouseover=function(){return this.element.find("."+this.classes.focus).removeClass(this.classes.focus)},c.prototype.setupDraggables=function(){var b,c,d,e,f,g,h,i,j,k,l,m=this;return this.element.find(".annotator-resize").remove(),this.element.hasClass(this.classes.invert.y)?d=this.element.find(".annotator-item:last"):d=this.element.find(".annotator-item:first"),d&&a('<span class="annotator-resize"></span>').appendTo(d),f=null,b=this.classes,e=this.element,k=null,j=e.find(".annotator-resize"),c=e.find(".annotator-controls"),l=!1,g=function(b){if(b.target===this)return f={element:this,top:b.pageY,left:b.pageX},k=e.find("textarea:first"),a(window).bind({"mouseup.annotator-editor-resize":i,"mousemove.annotator-editor-resize":h}),b.preventDefault()},i=function(){return f=null,a(window).unbind(".annotator-editor-resize")},h=function(a){var d,g,h,i,m;if(f&&l===!1)return d={top:a.pageY-f.top,left:a.pageX-f.left},f.element===j[0]?(i=k.outerHeight(),m=k.outerWidth(),g=e.hasClass(b.invert.x)?-1:1,h=e.hasClass(b.invert.y)?1:-1,k.height(i+d.top*h),k.width(m+d.left*g),k.outerHeight()!==i&&(f.top=a.pageY),k.outerWidth()!==m&&(f.left=a.pageX)):f.element===c[0]&&(e.css({top:parseInt(e.css("top"),10)+d.top,left:parseInt(e.css("left"),10)+d.left}),f.top=a.pageY,f.left=a.pageX),l=!0,setTimeout(function(){return l=!1},1e3/60)},j.bind("mousedown",g),c.bind("mousedown",g)},c}(c.Widget),c.Viewer=function(b){function c(b){this.onDeleteClick=E(this.onDeleteClick,this),this.onEditClick=E(this.onEditClick,this),this.load=E(this.load,this),this.hide=E(this.hide,this),this.show=E(this.show,this),c.__super__.constructor.call(this,a(this.html.element)[0],b),this.item=a(this.html.item)[0],this.fields=[],this.annotations=[]}return D(c,b),c.prototype.events={".annotator-edit click":"onEditClick",".annotator-delete click":"onDeleteClick"},c.prototype.classes={hide:"annotator-hide",showControls:"annotator-visible"},c.prototype.html={element:'<div class="annotator-outer annotator-viewer">\n  <ul class="annotator-widget annotator-listing"></ul>\n</div>',item:'<li class="annotator-annotation annotator-item">\n  <span class="annotator-controls">\n    <a href="#" title="View as webpage" class="annotator-link">View as webpage</a>\n    <button title="Edit" class="annotator-edit">Edit</button>\n    <button title="Delete" class="annotator-delete">Delete</button>\n  </span>\n</li>'},c.prototype.options={readOnly:!1},c.prototype.show=function(a){var b,c=this;return s.preventEventDefault(a),b=this.element.find(".annotator-controls").addClass(this.classes.showControls),setTimeout(function(){return b.removeClass(c.classes.showControls)},500),this.element.removeClass(this.classes.hide),this.checkOrientation().publish("show")},c.prototype.isShown=function(){return!this.element.hasClass(this.classes.hide)},c.prototype.hide=function(a){return s.preventEventDefault(a),this.element.addClass(this.classes.hide),this.publish("hide")},c.prototype.load=function(b){var c,d,e,f,h,i,j,k,l,m,n,o,p,q,r,s,t;this.annotations=b||[],n=this.element.find("ul:first").empty(),s=this.annotations;for(o=0,q=s.length;o<q;o++){c=s[o],k=a(this.item).clone().appendTo(n).data("annotation",c),e=k.find(".annotator-controls"),l=e.find(".annotator-link"),h=e.find(".annotator-edit"),f=e.find(".annotator-delete"),m=(new g(c.links||[])).get("alternate",{type:"text/html"}),m.length===0||m[0].href==null?l.remove():l.attr("href",m[0].href),this.options.readOnly?(h.remove(),f.remove()):d={showEdit:function(){return h.removeAttr("disabled")},hideEdit:function(){return h.attr("disabled","disabled")},showDelete:function(){return f.removeAttr("disabled")},hideDelete:function(){return f.attr("disabled","disabled")}},t=this.fields;for(p=0,r=t.length;p<r;p++)j=t[p],i=a(j.element).clone().appendTo(k)[0],j.load(i,c,d)}return this.publish("load",[this.annotations]),this.show()},c.prototype.addField=function(b){var c;return c=a.extend({load:function(){}},b),c.element=a("<div />")[0],this.fields.push(c),c.element,this},c.prototype.onEditClick=function(a){return this.onButtonClick(a,"edit")},c.prototype.onDeleteClick=function(a){return this.onButtonClick(a,"delete")},c.prototype.onButtonClick=function(b,c){var d;return d=a(b.target).parents(".annotator-annotation"),this.publish(c,[d.data("annotation")])},c}(c.Widget),g=function(){function b(a){this.data=a}return b.prototype.get=function(b,c){var d,e,f,g,h,i,j,k,l;c==null&&(c={}),c=a.extend({},c,{rel:b}),f=function(){var a;a=[];for(e in c){if(!C.call(c,e))continue;h=c[e],a.push(e)}return a}(),k=this.data,l=[];for(i=0,j=k.length;i<j;i++){d=k[i],g=f.reduce(function(a,b){return a&&d[b]===c[b]},!0);if(!g)continue;l.push(d)}return l},b}(),c=c||{},c.Notification=function(b){function d(b){this.hide=E(this.hide,this),this.show=E(this.show,this),d.__super__.constructor.call(this,a(this.options.html).appendTo(document.body)[0],b)}return D(d,b),d.prototype.events={click:"hide"},d.prototype.options={html:"<div class='annotator-notice'></div>",classes:{show:"annotator-notice-show",info:"annotator-notice-info",success:"annotator-notice-success",error:"annotator-notice-error"}},d.prototype.show=function(b,d){return d==null&&(d=c.Notification.INFO),this.currentStatus=d,a(this.element).addClass(this.options.classes.show).addClass(this.options.classes[this.currentStatus]).html(i.escape(b||"")),setTimeout(this.hide,5e3),this},d.prototype.hide=function(){return this.currentStatus==null&&(this.currentStatus=c.Notification.INFO),a(this.element).removeClass(this.options.classes.show).removeClass(this.options.classes[this.currentStatus]),this},d}(d),c.Notification.INFO="show",c.Notification.SUCCESS="success",c.Notification.ERROR="error",a(function(){var a;return a=new c.Notification,c.showNotification=a.show,c.hideNotification=a.hide})}).call(this);
(function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c={}.hasOwnProperty,d=function(a,b){function e(){this.constructor=a}for(var d in b)c.call(b,d)&&(a[d]=b[d]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a},e=[].slice;a=Annotator.$,Annotator.Plugin.Bridge=function(c){function f(a,c){this.annotationsLoaded=b(this.annotationsLoaded,this),this.annotationDeleted=b(this.annotationDeleted,this),this.annotationUpdated=b(this.annotationUpdated,this),this.annotationCreated=b(this.annotationCreated,this),this.beforeAnnotationCreated=b(this.beforeAnnotationCreated,this),this._onMessage=b(this._onMessage,this);var d;c.window!=null?(d=c.window,delete c.window,f.__super__.constructor.call(this,a,c),this.options.window=d):f.__super__.constructor.apply(this,arguments),this.cache={},this.links=[],this.updating={}}return d(f,c),f.prototype.events={beforeAnnotationCreated:"beforeAnnotationCreated",annotationCreated:"annotationCreated",annotationUpdated:"annotationUpdated",annotationDeleted:"annotationDeleted",annotationsLoaded:"annotationsLoaded",enableAnnotating:"enableAnnotating"},f._mergeTarget=function(a,b,c){var d,e,f,g,h;f=[];for(g in a)h=a[g],b[g]==null&&(!!c||g!=="diffHTML"&&g!=="diffCaseOnly")&&f.push({field:g,value:h});e=[];for(g in a)h=a[g],b[g]!=null&&b[g]!==h&&(Array.isArray(h)||(!!c||g!=="quote")&&e.push({field:g,oldValue:h,newValue:b[g]}));d=[];for(g in b)h=b[g],a[g]==null&&d.push({field:g,val:h});f.length&&f.forEach(function(b){return delete a[b.field]}),e.length&&e.forEach(function(b){return a[b.field]=b.newValue});if(d.length)return d.forEach(function(b){return a[b.field]=b.val})},f._mergeTargets=function(a,b,c){var d,e,g,h;e=a.target;if(e&&e.length>b.length)c?"sidebar":"host frame";else if(e&&e.length===b.length)for(d=g=0,h=e.length;0<=h?g<h:g>h;d=0<=h?++g:--g)f._mergeTarget(e[d],b[d],c);else c?"sidebar":"host frame";return a.target=b},f.prototype.options={origin:"*",scope:"annotator:bridge",gateway:!1,onConnect:function(){return!0},formatter:function(a){return a},parser:function(a){return a},merge:function(a,b){var c,d;for(c in b)d=b[c],c==="target"?f._mergeTargets(a,d,this.gateway):a[c]=d;return a}},f.prototype.cache=null,f.prototype.links=null,f.prototype.updating=null,f.prototype.pluginInit=function(){return a(window).on("message",this._onMessage),this._beacon()},f.prototype.destroy=function(){return f.__super__.destroy.apply(this,arguments),a(window).off("message",this._onMessage)},f.prototype._tag=function(a,b){return a.$$tag?a:(b=b||window.btoa(Math.random()),Object.defineProperty(a,"$$tag",{value:b}),this.cache[b]=a,a)},f.prototype._parse=function(a){var b,c,d,e,f;return f=a.tag,d=a.msg,b=this.cache[f],e=this.options.parser(d),b!=null?c=this.options.merge(b,e):c=e,this._tag(c,f)},f.prototype._format=function(a){var b;return this._tag(a),b=this.options.formatter(a),{tag:a.$$tag,msg:b}},f.prototype._build=function(a){var b;if(a.origin.match(/^chrome-extension:\/\//)||a.origin.match(/^resource:\/\//))a.origin="*";return console.log("Bridge plugin connecting to "+a.origin),b=Channel.build(a).bind("setupAnnotation",function(a){return function(b,c){return a._format(a.annotator.setupAnnotation(a._parse(c)))}}(this)).bind("beforeCreateAnnotation",function(a){return function(b,c){return c=a._parse(c),delete a.cache[c.$$tag],a.annotator.publish("beforeAnnotationCreated",c),a.cache[c.$$tag]=c,a._format(c)}}(this)).bind("createAnnotation",function(a){return function(b,c){return c=a._parse(c),delete a.cache[c.$$tag],a.annotator.publish("annotationCreated",c),a.cache[c.$$tag]=c,a._format(c)}}(this)).bind("updateAnnotation",function(a){return function(b,c){return c=a._parse(c),delete a.cache[c.$$tag],c=a.annotator.updateAnnotation(c),a.cache[c.$$tag]=c,a._format(c)}}(this)).bind("deleteAnnotation",function(a){return function(b,c){var d;return c=a._parse(c),delete a.cache[c.$$tag],c=a.annotator.deleteAnnotation(c),d=a._format(c),delete a.cache[c.$$tag],d}}(this)).bind("loadAnnotations",function(a){return function(b,c){var d,e,f;f=function(){var a,b,e;e=[];for(a=0,b=c.length;a<b;a++)d=c[a],this.cache[d.tag]&&e.push(this._parse(d));return e}.call(a),f.length&&(a.selfPublish=!0,a.annotator.publish("annotationsLoaded",[f]),delete a.selfPublish),e=function(){var a,b,e;e=[];for(a=0,b=c.length;a<b;a++)d=c[a],this.cache[d.tag]||e.push(this._parse(d));return e}.call(a);if(e.length)return a.annotator.loadAnnotations(e)}}(this)).bind("showEditor",function(a){return function(b,c){return a.annotator.showEditor(a._parse(c))}}(this)).bind("enableAnnotating",function(a){return function(b,c){return a.annotator.enableAnnotating(c,!1)}}(this))},f.prototype._beacon=function(){var a,b,c,d;c=[window.top],d=[];while(c.length)b=c.shift(),b!==window&&(console.log(window.location.toString(),"sending beacon..."),b.postMessage("__annotator_dhcp_discovery",this.options.origin)),d.push(function(){var d,e,f,g;f=b.frames,g=[];for(d=0,e=f.length;d<e;d++)a=f[d],g.push(c.push(a));return g}());return d},f.prototype._call=function(b){var c,d;return d=function(a){return function(b){return function(c,d){var e;return b.destroy(),a.links=function(){var a,c,d,f;d=this.links,f=[];for(a=0,c=d.length;a<c;a++)e=d[a],e.channel!==b&&f.push(e);return f}.call(a)}}}(this),c=this.links.map(function(c){var e;return e=a.Deferred().fail(d(c.channel)),b=a.extend({},b,{success:function(a){return e.resolve(a)},error:function(a,c){return a!=="timeout_error"?(console.log("Error in call! Reason: "+c),console.log(a),console.log("Call was:",b),console.log("Destroying channel!"),e.reject(a,c)):e.resolve(null)},timeout:1e3}),c.channel.call(b),e.promise()}),a.when.apply(a,c).then(function(c){return function(){var d,f,g,h,i;g=1<=arguments.length?e.call(arguments,0):[],d={};for(h=0,i=g.length;h<i;h++)f=g[h],f!==null&&a.extend(d,c._parse(f));return typeof b.callback=="function"?b.callback(null,d):void 0}}(this)).fail(function(a){return function(a){return typeof b.callback=="function"?b.callback(a):void 0}}(this))},f.prototype._notify=function(a){var b,c,d,e,f;e=this.links,f=[];for(c=0,d=e.length;c<d;c++)b=e[c],f.push(b.channel.notify(a));return f},f.prototype._onMessage=function(b){var c,d,e,f,g,h,i,j;j=b.originalEvent,i=j.source,g=j.origin,d=j.data,e=typeof d.match=="function"?d.match(/^__annotator_dhcp_(discovery|ack|offer)(:\d+)?$/):void 0;if(!e)return;if(e[1]==="discovery"){if(!this.options.gateway){i.postMessage("__annotator_dhcp_ack",g);return}h=":"+(""+Math.random()).replace(/\D/g,""),i.postMessage("__annotator_dhcp_offer"+h,g)}else if(e[1]==="ack"){if(!this.options.gateway)return;h=":"+(""+Math.random()).replace(/\D/g,""),i.postMessage("__annotator_dhcp_offer"+h,g)}else if(e[1]==="offer"){if(this.options.gateway)return;h=e[2]}return h=this.options.scope+h,f=a.extend({},this.options,{window:i,origin:g,scope:h,onReady:function(a){return function(){var b,d,e;f.onConnect.call(a.annotator,i,g,h),d=function(){var a,c;a=this.cache,c=[];for(e in a)b=a[e],c.push(this._format(b));return c}.call(a);if(d.length)return c.notify({method:"loadAnnotations",params:d})}}(this)}),c=this._build(f),this.links.push({channel:c,window:i})},f.prototype.beforeAnnotationCreated=function(a){if(a.$$tag!=null)return;return this.beforeCreateAnnotation(a),this},f.prototype.annotationCreated=function(a){if(a.$$tag==null||!this.cache[a.$$tag])return;return this.createAnnotation(a),this},f.prototype.annotationUpdated=function(a){if(a.$$tag==null||!this.cache[a.$$tag])return;return this.updateAnnotation(a),this},f.prototype.annotationDeleted=function(a){if(a.$$tag==null||!this.cache[a.$$tag])return;return this.deleteAnnotation(a,function(b){return function(c){return c?b.annotator.setupAnnotation(a):delete b.cache[a.$$tag]}}(this)),this},f.prototype.annotationsLoaded=function(a){var b;if(this.selfPublish)return;if(!a.length){console.log("Useless call to 'annotationsLoaded()' with an empty list"),console.trace();return}return this._notify({method:"loadAnnotations",params:function(){var c,d,e;e=[];for(c=0,d=a.length;c<d;c++)b=a[c],e.push(this._format(b));return e}.call(this)}),this},f.prototype.beforeCreateAnnotation=function(a,b){return this._call({method:"beforeCreateAnnotation",params:this._format(a),callback:b}),a},f.prototype.setupAnnotation=function(a,b){return this._call({method:"setupAnnotation",params:this._format(a),callback:b}),a},f.prototype.createAnnotation=function(a,b){return this._call({method:"createAnnotation",params:this._format(a),callback:b}),a},f.prototype.updateAnnotation=function(a,b){return this._call({method:"updateAnnotation",params:this._format(a),callback:b}),a},f.prototype.deleteAnnotation=function(a,b){return this._call({method:"deleteAnnotation",params:this._format(a),callback:b}),a},f.prototype.showEditor=function(a){return this._notify({method:"showEditor",params:this._format(a)}),this},f.prototype.enableAnnotating=function(a){return this._notify({method:"enableAnnotating",params:a})},f}(Annotator.Plugin)}).call(this);
// Generated by CoffeeScript 1.6.3
/*
** Annotator 1.2.6-dev-5c36e53
** https://github.com/okfn/annotator/
**
** Copyright 2012 Aron Carroll, Rufus Pollock, and Nick Stenning.
** Dual licensed under the MIT and GPLv3 licenses.
** https://github.com/okfn/annotator/blob/master/LICENSE
**
** Built at: 2014-06-17 21:13:04Z
*//*
//
*/// Generated by CoffeeScript 1.6.3
(function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c={}.hasOwnProperty,d=function(a,b){function e(){this.constructor=a}for(var d in b)c.call(b,d)&&(a[d]=b[d]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a};Annotator.Plugin.Document=function(c){function f(){return this._getDocOwners=b(this._getDocOwners,this),this._getFavicon=b(this._getFavicon,this),this._getLinks=b(this._getLinks,this),this._getTitle=b(this._getTitle,this),this._getMetaTags=b(this._getMetaTags,this),this._getEprints=b(this._getEprints,this),this._getPrism=b(this._getPrism,this),this._getDublinCore=b(this._getDublinCore,this),this._getTwitter=b(this._getTwitter,this),this._getFacebook=b(this._getFacebook,this),this._getHighwire=b(this._getHighwire,this),this.getDocumentMetadata=b(this.getDocumentMetadata,this),this.beforeAnnotationCreated=b(this.beforeAnnotationCreated,this),this.uris=b(this.uris,this),this.uri=b(this.uri,this),a=f.__super__.constructor.apply(this,arguments),a}var e;return d(f,c),e=Annotator.$,f.prototype.events={beforeAnnotationCreated:"beforeAnnotationCreated"},f.prototype.pluginInit=function(){return this.getDocumentMetadata()},f.prototype.uri=function(){var a,b,c,d,e;b=decodeURIComponent(document.location.href),e=this.metadata.link;for(c=0,d=e.length;c<d;c++)a=e[c],a.rel==="canonical"&&(b=a.href);return b},f.prototype.uris=function(){var a,b,c,d,e,f;c={},f=this.metadata.link;for(d=0,e=f.length;d<e;d++)b=f[d],b.href&&(c[b.href]=!0);return function(){var b;b=[];for(a in c)b.push(a);return b}()},f.prototype.beforeAnnotationCreated=function(a){return a.document=this.metadata},f.prototype.getDocumentMetadata=function(){return this.metadata={},this._getHighwire(),this._getDublinCore(),this._getFacebook(),this._getEprints(),this._getPrism(),this._getTwitter(),this._getFavicon(),this._getDocOwners(),this._getTitle(),this._getLinks(),this.metadata},f.prototype._getHighwire=function(){return this.metadata.highwire=this._getMetaTags("citation","name","_")},f.prototype._getFacebook=function(){return this.metadata.facebook=this._getMetaTags("og","property",":")},f.prototype._getTwitter=function(){return this.metadata.twitter=this._getMetaTags("twitter","name",":")},f.prototype._getDublinCore=function(){return this.metadata.dc=this._getMetaTags("dc","name",".")},f.prototype._getPrism=function(){return this.metadata.prism=this._getMetaTags("prism","name",".")},f.prototype._getEprints=function(){return this.metadata.eprints=this._getMetaTags("eprints","name",".")},f.prototype._getMetaTags=function(a,b,c){var d,f,g,h,i,j,k,l,m;j={},m=e("meta");for(k=0,l=m.length;k<l;k++)g=m[k],i=e(g).attr(b),d=e(g).prop("content"),i&&(f=i.match(RegExp("^"+a+c+"(.+)$","i")),f&&(h=f[1],j[h]?j[h].push(d):j[h]=[d]));return j},f.prototype._getTitle=function(){return this.metadata.highwire.title?this.metadata.title=this.metadata.highwire.title[0]:this.metadata.eprints.title?this.metadata.title=this.metadata.eprints.title:this.metadata.prism.title?this.metadata.title=this.metadata.prism.title:this.metadata.facebook.title?this.metadata.title=this.metadata.facebook.title:this.metadata.twitter.title?this.metadata.title=this.metadata.twitter.title:this.metadata.dc.title?this.metadata.title=this.metadata.dc.title:this.metadata.title=e("head title").text()},f.prototype._getLinks=function(){var a,b,c,d,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;this.metadata.link=[{href:document.location.href}],r=e("link");for(l=0,o=r.length;l<o;l++)f=r[l],d=e(f),b=this._absoluteUrl(d.prop("href")),h=d.prop("rel"),i=d.prop("type"),(h==="alternate"||h==="canonical"||h==="bookmark")&&i!=="application/rss+xml"&&i!=="application/atom+xml"&&this.metadata.link.push({href:b,rel:h,type:i});s=this.metadata.highwire;for(g in s){k=s[g];if(g==="pdf_url")for(m=0,p=k.length;m<p;m++)j=k[m],this.metadata.link.push({href:this._absoluteUrl(j),type:"application/pdf"});if(g==="doi")for(n=0,q=k.length;n<q;n++)a=k[n],a.slice(0,4)!=="doi:"&&(a="doi:"+a),this.metadata.link.push({href:a})}t=this.metadata.dc,u=[];for(g in t)k=t[g],g==="identifier"?u.push(function(){var a,b,d;d=[];for(a=0,b=k.length;a<b;a++)c=k[a],c.slice(0,4)==="doi:"?d.push(this.metadata.link.push({href:c})):d.push(void 0);return d}.call(this)):u.push(void 0);return u},f.prototype._getFavicon=function(){var a,b,c,d,f,g;d=e("link"),g=[];for(b=0,c=d.length;b<c;b++)a=d[b],(f=e(a).prop("rel"))==="shortcut icon"||f==="icon"?g.push(this.metadata.favicon=this._absoluteUrl(a.href)):g.push(void 0);return g},f.prototype._getDocOwners=function(){var a,b,c,d,f;this.metadata.reply_to=[],d=e("a"),f=[];for(b=0,c=d.length;b<c;b++)a=d[b],a.rel==="reply-to"?a.href.toLowerCase().slice(0,7)==="mailto:"?f.push(this.metadata.reply_to.push(a.href.slice(7))):f.push(this.metadata.reply_to.push(a.href)):f.push(void 0);return f},f.prototype._absoluteUrl=function(a){var b;return b=document.createElement("a"),b.href=a,b.href},f}(Annotator.Plugin)}).call(this);
(function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c={}.hasOwnProperty,d=function(a,b){function e(){this.constructor=a}for(var d in b)c.call(b,d)&&(a[d]=b[d]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a},e=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};a=Annotator.$,Annotator.Plugin.Heatmap=function(c){function f(c,d){this.isLower=b(this.isLower,this),this.isUpper=b(this.isUpper,this),this._update=b(this._update,this),this._scheduleUpdate=b(this._scheduleUpdate,this),f.__super__.constructor.call(this,a(this.html),d),this.options.container!=null?a(this.options.container).append(this.element):a(c).append(this.element)}return d(f,c),f.prototype.BUCKET_THRESHOLD_PAD=30,f.prototype.BUCKET_SIZE=16,f.prototype.html='<div class="annotator-heatmap">\n  <svg xmlns="http://www.w3.org/2000/svg"\n       version="1.1">\n     <defs>\n       <linearGradient id="heatmap-gradient" x2="0" y2="100%">\n       </linearGradient>\n       <filter id="heatmap-blur">\n         <feGaussianBlur stdDeviation="0 2"></feGaussianBlur>\n       </filter>\n     </defs>\n     <rect x="0" y="0" width="100%" height="100%"\n           fill="url(\'#heatmap-gradient\')"\n           filter="url(\'#heatmap-blur\')" >\n     </rect>\n   </svg>\n</div>',f.prototype.options={gapSize:60},f.prototype.buckets=[],f.prototype.index=[],f.prototype.dynamicBucket=!0,f.prototype.pluginInit=function(){var b,c,d,f;if(typeof d3=="undefined"||d3===null)return;this._maybeRebaseUrls(),c=["annotationCreated","annotationUpdated","annotationDeleted","annotationsLoaded"];for(d=0,f=c.length;d<f;d++)b=c[d],b==="annotationCreated"?this.annotator.subscribe(b,function(a){return function(){return a._scheduleUpdate()}}(this)):this.annotator.subscribe(b,this._scheduleUpdate);return this.element.on("click",function(a){return function(b){return b.stopPropagation(),a.dynamicBucket=!0,a.annotator.showViewer("Screen",a._getDynamicBucket())}}(this)),this.element.on("mouseup",function(a){return function(a){return a.stopPropagation()}}(this)),a(window).on("resize scroll",this._update),a(document.body).on("resize scroll","*",this._update),this.annotator.subscribe("highlightsCreated",function(a){return function(b){var c,d,f,g;c=Array.isArray(b)?b[0].anchor:b.anchor,c.annotation.id!=null&&a._scheduleUpdate();if(a.pendingScroll!=null&&e.call(a.pendingScroll.anchors,c)>=0&&!--a.pendingScroll.count)return g=a.pendingScroll.page,d=a.pendingScroll.direction==="up"?1:-1,f=a.pendingScroll.anchors.reduce(function(a,b){var c,e;return e=a.start,f=a.next,c=b.highlight[g],f==null||c.getTop()*d>e*d?{start:c.getTop(),next:c}:a},{}).next,f.paddedScrollDownTo(),delete a.pendingScroll}}(this)),this.annotator.subscribe("highlightRemoved",function(a){return function(b){if(b.annotation.id!=null)return a._scheduleUpdate()}}(this)),addEventListener("docPageScrolling",function(a){return function(){return a._update()}}(this))},f.prototype._scheduleUpdate=function(){if(this._updatePending)return;return this._updatePending=!0,setTimeout(function(a){return function(){return delete a._updatePending,a._update()}}(this),200)},f.prototype._maybeRebaseUrls=function(){var a,b,c,d,e;if(!document.getElementsByTagName("base").length)return;return d=window.location,a=""+d.protocol+"//"+d.host+d.pathname+d.search,e=this.element.find("rect"),b=e.attr("fill"),c=e.attr("filter"),b=b.replace(/(#\w+)/,""+a+"$1"),c=c.replace(/(#\w+)/,""+a+"$1"),e.attr("fill",b),e.attr("filter",c)},f.prototype._collate=function(a,b){var c,d,e;for(c=d=0,e=a.length-1;0<=e?d<=e:d>=e;c=0<=e?++d:--d){if(a[c]<b[c])return-1;if(a[c]>b[c])return 1}return 0},f.prototype._colorize=function(a){var b;return b=d3.scale.pow().exponent(2).domain([0,1]).range(["#f7fbff","#08306b"]).interpolate(d3.interpolateHcl),b(a).toString()},f.prototype._collectVirtualAnnotations=function(b,c){var d,e,f,g,h;g=[];for(f=h=b;b<=c?h<=c:h>=c;f=b<=c?++h:--h)e=this.annotator.anchors[f],e!=null&&a.merge(g,function(){var a,b,c;c=[];for(a=0,b=e.length;a<b;a++)d=e[a],d.fullyRealized||c.push(d.annotation);return c}());return g},f.prototype._jumpMinMax=function(b,c){var d,e,f,g,h;if(c!=="up"&&c!=="down")throw"Direction is mandatory!";return e=c==="up"?1:-1,g=b.reduce(function(b,c){var d,f,h,i;return h=b.start,g=b.next,d=c.anchors[0],g==null||h.page*e<d.startPage*e?{start:{page:d.startPage,top:(i=d.highlight[d.startPage])!=null?i.getTop():void 0},next:[d]}:h.page===d.startPage?(f=d.highlight[h.page],f!=null?h.top*e<f.getTop()*e?{start:{page:h.page,top:f.getTop()},next:[d]}:b:{start:{page:h.page},next:a.merge(g,[d])}):b},{}).next,d=g[0],h=d.startPage,this.annotator.domMapper.isPageMapped(h)?(f=d.highlight[h],f.paddedScrollTo(c)):(this.pendingScroll={anchors:g,count:g.length,page:h,direction:c},this.annotator.domMapper.setPageIndex(h))},f.prototype._update=function(){var b,c,d,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;s=this.annotator.wrapper,j=this.annotator.getHighlights(),g=s[0].ownerDocument.defaultView,b=[],d=[],l=this.annotator.domMapper,i=0,f=l.getPageIndex(),k=l.getPageCount()-1,a.merge(b,this._collectVirtualAnnotations(0,f-1)),a.merge(d,this._collectVirtualAnnotations(f+1,k)),o=j.reduce(function(c){return function(f,h,i){var j,k,l;return j=h.annotation,l=h.getTop()-g.pageYOffset,k=h.getHeight(),l<=c.BUCKET_SIZE+c.BUCKET_THRESHOLD_PAD?e.call(b,j)<0&&b.push(j):l+k>=a(window).height()-c.BUCKET_SIZE?e.call(d,j)<0&&d.push(j):(f.push([l,1,j]),f.push([l+k,-1,j])),f}}(this),[]),v=o.sort(this._collate).reduce(function(a){return function(b,c,d,f){var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;i=b.buckets,l=b.index,j=b.carry,p=c[0],k=c[1],g=c[2],k>0?(m=j.annotations.indexOf(g))<0?(j.annotations.unshift(g),j.counts.unshift(1)):j.counts[m]++:(m=j.annotations.indexOf(g),--j.counts[m]===0&&(j.annotations.splice(m,1),j.counts.splice(m,1)));if(l.length===0||d===f.length-1||j.annotations.length===0||p-l[l.length-1]>a.options.gapSize)i.push(j.annotations.slice()),l.push(p);else{((u=i[i.length-2])!=null?u.length:void 0)?(n=i[i.length-2],o=i.pop(),l.pop()):(n=i[i.length-1],o=[]),v=j.annotations;for(q=0,s=v.length;q<s;q++)h=v[q],e.call(n,h)<0&&n.push(h);for(r=0,t=o.length;r<t;r++)h=o[r],e.call(n,h)<0&&n.push(h)}return{buckets:i,index:l,carry:j}}}(this),{buckets:[],index:[],carry:{annotations:[],counts:[],latest:0}}),this.buckets=v.buckets,this.index=v.index,this.buckets.unshift([],b,[]),this.index.unshift(0,this.BUCKET_THRESHOLD_PAD+6,this.BUCKET_THRESHOLD_PAD+this.BUCKET_SIZE+6),this.buckets.push([],d,[]),this.index.push(a(window).height()-this.BUCKET_SIZE-12,a(window).height()-this.BUCKET_SIZE-11,a(window).height()),m=0,w=this.buckets;for(t=0,u=w.length;t<u;t++)c=w[t],m=Math.max(m,c.length);return p=a.map(this.buckets,function(a){return function(b,c){var d,e,f,g,h,i,j,k,l,m,n,o;i=a.index[c+1]!=null?a.index[c+1]:s.height(),f=[a.index[c],i];if(b.length){g=((l=a.buckets[c-1])!=null?l.length:void 0)&&(a.buckets[c-1].length+b.length)/2||1e-6,e=((m=a.buckets[c+1])!=null?m.length:void 0)&&(a.buckets[c+1].length+b.length)/2||1e-6,d=d3.scale.pow().exponent(.1).domain([0,.5,1]).range([[f[0],c,0,g],[d3.mean(f),c,.5,b.length],[f[1],c,1,e]]).interpolate(d3.interpolateArray),n=d3.range(0,1,.05),o=[];for(j=0,k=n.length;j<k;j++)h=n[j],o.push(d(h));return o}return[[f[0],c,0,1e-6],[f[1],c,1,1e-6]]}}(this)),h=d3.select(this.element[0]),n=d3.scale.pow().domain([0,m]).range([.1,.6]).exponent(2),q=h.select("#heatmap-gradient").selectAll("stop").data(p,function(a){return function(a){return a}}(this)),q.enter().append("stop"),q.exit().remove(),q.order().attr("offset",function(b){return function(b){return b[0]/a(window).height()}}(this)).attr("stop-color",function(a){return function(b){return m===0?a._colorize(1e-6):a._colorize(b[3]/m)}}(this)).attr("stop-opacity",function(a){return m===0?.1:n(a[3])}),r=h.selectAll("div.heatmap-pointer").data(function(a){return function(){var b;return b=[],a.index.forEach(function(c,d){if(a.buckets[d].length>0||a.isUpper(d)||a.isLower(d))return b.push(d)}),a.bucketIndices=b,b}}(this)),r.enter().append("div").classed("heatmap-pointer",!0).on("mousemove",function(a){return function(b){var c,d,f,g,h;g=a.annotator.getHighlights();for(d=0,f=g.length;d<f;d++)c=g[d],(h=c.annotation,e.call(a.buckets[b],h)>=0)?c.setActive(!0,!0):c.isTemporary()||c.setActive(!1,!0);return a.annotator.publish("finalizeHighlights")}}(this)).on("mouseout",function(a){return function(){var b,c,d,e;e=a.annotator.getHighlights();for(c=0,d=e.length;c<d;c++)b=e[c],b.isTemporary()||b.setActive(!1,!0);return a.annotator.publish("finalizeHighlights")}}(this)).on("click",function(a){return function(b){var c,d;return d3.event.stopPropagation(),d=g.innerHeight*.2,a.isUpper(b)?(a.dynamicBucket=!0,a._jumpMinMax(a.buckets[b],"up")):a.isLower(b)?(a.dynamicBucket=!0,a._jumpMinMax(a.buckets[b],"down")):(d3.event.stopPropagation(),c=a.buckets[b].slice(),annotator.selectAnnotations(c,d3.event.ctrlKey||d3.event.metaKey,c.length===1))}}(this)),r.exit().remove(),r.style("margin-top",function(a){return function(b){return a.isUpper(b)||a.isLower(b)?"-9px":"-8px"}}(this)).style("top",function(a){return function(b){return""+(a.index[b]+a.index[b+1])/2+"px"}}(this)).html(function(a){return function(b){return"<div class='label'>"+a.buckets[b].length+"</div>"}}(this)).classed("upper",this.isUpper).classed("lower",this.isLower).style("display",function(a){return function(b){return a.buckets[b].length===0?"none":""}}(this)),this.dynamicBucket&&this.annotator.updateViewer("Screen",this._getDynamicBucket()),this.tabs=r},f.prototype._getDynamicBucket=function(){var b,c,d,f;return d=window.pageYOffset,c=d+a(window).innerHeight(),b=this.annotator.getHighlights(),f=b.reduce(function(a){return function(a,b){var f,g;return d<=(f=b.getTop())&&f<=c&&(g=b.annotation,e.call(a,g)<0)&&a.push(b.annotation),a}}(this),[])},f.prototype.isUpper=function(a){return a===1},f.prototype.isLower=function(a){return a===this.index.length-2},f}(Annotator.Plugin)}).call(this);
/**
 * Diff Match and Patch
 *
 * Copyright 2006 Google Inc.
 * http://code.google.com/p/google-diff-match-patch/
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @fileoverview Computes the difference between two texts to create a patch.
 * Applies the patch onto another text, allowing for errors.
 * @author fraser@google.com (Neil Fraser)
 *//**
 * Class containing the diff, match and patch methods.
 * @constructor
 */function diff_match_patch(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32}var DIFF_DELETE=-1,DIFF_INSERT=1,DIFF_EQUAL=0;diff_match_patch.Diff,diff_match_patch.prototype.diff_main=function(a,b,c,d){typeof d=="undefined"&&(this.Diff_Timeout<=0?d=Number.MAX_VALUE:d=(new Date).getTime()+this.Diff_Timeout*1e3);var e=d;if(a==null||b==null)throw new Error("Null input. (diff_main)");if(a==b)return a?[[DIFF_EQUAL,a]]:[];typeof c=="undefined"&&(c=!0);var f=c,g=this.diff_commonPrefix(a,b),h=a.substring(0,g);a=a.substring(g),b=b.substring(g),g=this.diff_commonSuffix(a,b);var i=a.substring(a.length-g);a=a.substring(0,a.length-g),b=b.substring(0,b.length-g);var j=this.diff_compute_(a,b,f,e);return h&&j.unshift([DIFF_EQUAL,h]),i&&j.push([DIFF_EQUAL,i]),this.diff_cleanupMerge(j),j},diff_match_patch.prototype.diff_compute_=function(a,b,c,d){var e;if(!a)return[[DIFF_INSERT,b]];if(!b)return[[DIFF_DELETE,a]];var f=a.length>b.length?a:b,g=a.length>b.length?b:a,h=f.indexOf(g);if(h!=-1)return e=[[DIFF_INSERT,f.substring(0,h)],[DIFF_EQUAL,g],[DIFF_INSERT,f.substring(h+g.length)]],a.length>b.length&&(e[0][0]=e[2][0]=DIFF_DELETE),e;if(g.length==1)return[[DIFF_DELETE,a],[DIFF_INSERT,b]];var i=this.diff_halfMatch_(a,b);if(i){var j=i[0],k=i[1],l=i[2],m=i[3],n=i[4],o=this.diff_main(j,l,c,d),p=this.diff_main(k,m,c,d);return o.concat([[DIFF_EQUAL,n]],p)}return c&&a.length>100&&b.length>100?this.diff_lineMode_(a,b,d):this.diff_bisect_(a,b,d)},diff_match_patch.prototype.diff_lineMode_=function(a,b,c){var d=this.diff_linesToChars_(a,b);a=d.chars1,b=d.chars2;var e=d.lineArray,f=this.diff_main(a,b,!1,c);this.diff_charsToLines_(f,e),this.diff_cleanupSemantic(f),f.push([DIFF_EQUAL,""]);var g=0,h=0,i=0,j="",k="";while(g<f.length){switch(f[g][0]){case DIFF_INSERT:i++,k+=f[g][1];break;case DIFF_DELETE:h++,j+=f[g][1];break;case DIFF_EQUAL:if(h>=1&&i>=1){f.splice(g-h-i,h+i),g=g-h-i;var d=this.diff_main(j,k,!1,c);for(var l=d.length-1;l>=0;l--)f.splice(g,0,d[l]);g+=d.length}i=0,h=0,j="",k=""}g++}return f.pop(),f},diff_match_patch.prototype.diff_bisect_=function(a,b,c){var d=a.length,e=b.length,f=Math.ceil((d+e)/2),g=f,h=2*f,i=new Array(h),j=new Array(h);for(var k=0;k<h;k++)i[k]=-1,j[k]=-1;i[g+1]=0,j[g+1]=0;var l=d-e,m=l%2!=0,n=0,o=0,p=0,q=0;for(var r=0;r<f;r++){if((new Date).getTime()>c)break;for(var s=-r+n;s<=r-o;s+=2){var t=g+s,u;s==-r||s!=r&&i[t-1]<i[t+1]?u=i[t+1]:u=i[t-1]+1;var v=u-s;while(u<d&&v<e&&a.charAt(u)==b.charAt(v))u++,v++;i[t]=u;if(u>d)o+=2;else if(v>e)n+=2;else if(m){var w=g+l-s;if(w>=0&&w<h&&j[w]!=-1){var x=d-j[w];if(u>=x)return this.diff_bisectSplit_(a,b,u,v,c)}}}for(var y=-r+p;y<=r-q;y+=2){var w=g+y,x;y==-r||y!=r&&j[w-1]<j[w+1]?x=j[w+1]:x=j[w-1]+1;var z=x-y;while(x<d&&z<e&&a.charAt(d-x-1)==b.charAt(e-z-1))x++,z++;j[w]=x;if(x>d)q+=2;else if(z>e)p+=2;else if(!m){var t=g+l-y;if(t>=0&&t<h&&i[t]!=-1){var u=i[t],v=g+u-t;x=d-x;if(u>=x)return this.diff_bisectSplit_(a,b,u,v,c)}}}}return[[DIFF_DELETE,a],[DIFF_INSERT,b]]},diff_match_patch.prototype.diff_bisectSplit_=function(a,b,c,d,e){var f=a.substring(0,c),g=b.substring(0,d),h=a.substring(c),i=b.substring(d),j=this.diff_main(f,g,!1,e),k=this.diff_main(h,i,!1,e);return j.concat(k)},diff_match_patch.prototype.diff_linesToChars_=function(a,b){function e(a){var b="",e=0,f=-1,g=c.length;while(f<a.length-1){f=a.indexOf("\n",e),f==-1&&(f=a.length-1);var h=a.substring(e,f+1);e=f+1,(d.hasOwnProperty?d.hasOwnProperty(h):d[h]!==undefined)?b+=String.fromCharCode(d[h]):(b+=String.fromCharCode(g),d[h]=g,c[g++]=h)}return b}var c=[],d={};c[0]="";var f=e(a),g=e(b);return{chars1:f,chars2:g,lineArray:c}},diff_match_patch.prototype.diff_charsToLines_=function(a,b){for(var c=0;c<a.length;c++){var d=a[c][1],e=[];for(var f=0;f<d.length;f++)e[f]=b[d.charCodeAt(f)];a[c][1]=e.join("")}},diff_match_patch.prototype.diff_commonPrefix=function(a,b){if(!a||!b||a.charAt(0)!=b.charAt(0))return 0;var c=0,d=Math.min(a.length,b.length),e=d,f=0;while(c<e)a.substring(f,e)==b.substring(f,e)?(c=e,f=c):d=e,e=Math.floor((d-c)/2+c);return e},diff_match_patch.prototype.diff_commonSuffix=function(a,b){if(!a||!b||a.charAt(a.length-1)!=b.charAt(b.length-1))return 0;var c=0,d=Math.min(a.length,b.length),e=d,f=0;while(c<e)a.substring(a.length-e,a.length-f)==b.substring(b.length-e,b.length-f)?(c=e,f=c):d=e,e=Math.floor((d-c)/2+c);return e},diff_match_patch.prototype.diff_commonOverlap_=function(a,b){var c=a.length,d=b.length;if(c==0||d==0)return 0;c>d?a=a.substring(c-d):c<d&&(b=b.substring(0,c));var e=Math.min(c,d);if(a==b)return e;var f=0,g=1;for(;;){var h=a.substring(e-g),i=b.indexOf(h);if(i==-1)return f;g+=i;if(i==0||a.substring(e-g)==b.substring(0,g))f=g,g++}},diff_match_patch.prototype.diff_halfMatch_=function(a,b){function f(a,b,c){var d=a.substring(c,c+Math.floor(a.length/4)),f=-1,g="",h,i,j,k;while((f=b.indexOf(d,f+1))!=-1){var l=e.diff_commonPrefix(a.substring(c),b.substring(f)),m=e.diff_commonSuffix(a.substring(0,c),b.substring(0,f));g.length<m+l&&(g=b.substring(f-m,f)+b.substring(f,f+l),h=a.substring(0,c-m),i=a.substring(c+l),j=b.substring(0,f-m),k=b.substring(f+l))}return g.length*2>=a.length?[h,i,j,k,g]:null}if(this.Diff_Timeout<=0)return null;var c=a.length>b.length?a:b,d=a.length>b.length?b:a;if(c.length<4||d.length*2<c.length)return null;var e=this,g=f(c,d,Math.ceil(c.length/4)),h=f(c,d,Math.ceil(c.length/2)),i;if(!g&&!h)return null;h?g?i=g[4].length>h[4].length?g:h:i=h:i=g;var j,k,l,m;a.length>b.length?(j=i[0],k=i[1],l=i[2],m=i[3]):(l=i[0],m=i[1],j=i[2],k=i[3]);var n=i[4];return[j,k,l,m,n]},diff_match_patch.prototype.diff_cleanupSemantic=function(a){var b=!1,c=[],d=0,e=null,f=0,g=0,h=0,i=0,j=0;while(f<a.length)a[f][0]==DIFF_EQUAL?(c[d++]=f,g=i,h=j,i=0,j=0,e=a[f][1]):(a[f][0]==DIFF_INSERT?i+=a[f][1].length:j+=a[f][1].length,e&&e.length<=Math.max(g,h)&&e.length<=Math.max(i,j)&&(a.splice(c[d-1],0,[DIFF_DELETE,e]),a[c[d-1]+1][0]=DIFF_INSERT,d--,d--,f=d>0?c[d-1]:-1,g=0,h=0,i=0,j=0,e=null,b=!0)),f++;b&&this.diff_cleanupMerge(a),this.diff_cleanupSemanticLossless(a),f=1;while(f<a.length){if(a[f-1][0]==DIFF_DELETE&&a[f][0]==DIFF_INSERT){var k=a[f-1][1],l=a[f][1],m=this.diff_commonOverlap_(k,l),n=this.diff_commonOverlap_(l,k);if(m>=n){if(m>=k.length/2||m>=l.length/2)a.splice(f,0,[DIFF_EQUAL,l.substring(0,m)]),a[f-1][1]=k.substring(0,k.length-m),a[f+1][1]=l.substring(m),f++}else if(n>=k.length/2||n>=l.length/2)a.splice(f,0,[DIFF_EQUAL,k.substring(0,n)]),a[f-1][0]=DIFF_INSERT,a[f-1][1]=l.substring(0,l.length-n),a[f+1][0]=DIFF_DELETE,a[f+1][1]=k.substring(n),f++;f++}f++}},diff_match_patch.prototype.diff_cleanupSemanticLossless=function(a){function b(a,b){if(!a||!b)return 6;var c=a.charAt(a.length-1),d=b.charAt(0),e=c.match(diff_match_patch.nonAlphaNumericRegex_),f=d.match(diff_match_patch.nonAlphaNumericRegex_),g=e&&c.match(diff_match_patch.whitespaceRegex_),h=f&&d.match(diff_match_patch.whitespaceRegex_),i=g&&c.match(diff_match_patch.linebreakRegex_),j=h&&d.match(diff_match_patch.linebreakRegex_),k=i&&a.match(diff_match_patch.blanklineEndRegex_),l=j&&b.match(diff_match_patch.blanklineStartRegex_);return k||l?5:i||j?4:e&&!g&&h?3:g||h?2:e||f?1:0}var c=1;while(c<a.length-1){if(a[c-1][0]==DIFF_EQUAL&&a[c+1][0]==DIFF_EQUAL){var d=a[c-1][1],e=a[c][1],f=a[c+1][1],g=this.diff_commonSuffix(d,e);if(g){var h=e.substring(e.length-g);d=d.substring(0,d.length-g),e=h+e.substring(0,e.length-g),f=h+f}var i=d,j=e,k=f,l=b(d,e)+b(e,f);while(e.charAt(0)===f.charAt(0)){d+=e.charAt(0),e=e.substring(1)+f.charAt(0),f=f.substring(1);var m=b(d,e)+b(e,f);m>=l&&(l=m,i=d,j=e,k=f)}a[c-1][1]!=i&&(i?a[c-1][1]=i:(a.splice(c-1,1),c--),a[c][1]=j,k?a[c+1][1]=k:(a.splice(c+1,1),c--))}c++}},diff_match_patch.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,diff_match_patch.whitespaceRegex_=/\s/,diff_match_patch.linebreakRegex_=/[\r\n]/,diff_match_patch.blanklineEndRegex_=/\n\r?\n$/,diff_match_patch.blanklineStartRegex_=/^\r?\n\r?\n/,diff_match_patch.prototype.diff_cleanupEfficiency=function(a){var b=!1,c=[],d=0,e=null,f=0,g=!1,h=!1,i=!1,j=!1;while(f<a.length)a[f][0]==DIFF_EQUAL?(a[f][1].length<this.Diff_EditCost&&(i||j)?(c[d++]=f,g=i,h=j,e=a[f][1]):(d=0,e=null),i=j=!1):(a[f][0]==DIFF_DELETE?j=!0:i=!0,e&&(g&&h&&i&&j||e.length<this.Diff_EditCost/2&&g+h+i+j==3)&&(a.splice(c[d-1],0,[DIFF_DELETE,e]),a[c[d-1]+1][0]=DIFF_INSERT,d--,e=null,g&&h?(i=j=!0,d=0):(d--,f=d>0?c[d-1]:-1,i=j=!1),b=!0)),f++;b&&this.diff_cleanupMerge(a)},diff_match_patch.prototype.diff_cleanupMerge=function(a){a.push([DIFF_EQUAL,""]);var b=0,c=0,d=0,e="",f="",g;while(b<a.length)switch(a[b][0]){case DIFF_INSERT:d++,f+=a[b][1],b++;break;case DIFF_DELETE:c++,e+=a[b][1],b++;break;case DIFF_EQUAL:c+d>1?(c!==0&&d!==0&&(g=this.diff_commonPrefix(f,e),g!==0&&(b-c-d>0&&a[b-c-d-1][0]==DIFF_EQUAL?a[b-c-d-1][1]+=f.substring(0,g):(a.splice(0,0,[DIFF_EQUAL,f.substring(0,g)]),b++),f=f.substring(g),e=e.substring(g)),g=this.diff_commonSuffix(f,e),g!==0&&(a[b][1]=f.substring(f.length-g)+a[b][1],f=f.substring(0,f.length-g),e=e.substring(0,e.length-g))),c===0?a.splice(b-d,c+d,[DIFF_INSERT,f]):d===0?a.splice(b-c,c+d,[DIFF_DELETE,e]):a.splice(b-c-d,c+d,[DIFF_DELETE,e],[DIFF_INSERT,f]),b=b-c-d+(c?1:0)+(d?1:0)+1):b!==0&&a[b-1][0]==DIFF_EQUAL?(a[b-1][1]+=a[b][1],a.splice(b,1)):b++,d=0,c=0,e="",f=""}a[a.length-1][1]===""&&a.pop();var h=!1;b=1;while(b<a.length-1)a[b-1][0]==DIFF_EQUAL&&a[b+1][0]==DIFF_EQUAL&&(a[b][1].substring(a[b][1].length-a[b-1][1].length)==a[b-1][1]?(a[b][1]=a[b-1][1]+a[b][1].substring(0,a[b][1].length-a[b-1][1].length),a[b+1][1]=a[b-1][1]+a[b+1][1],a.splice(b-1,1),h=!0):a[b][1].substring(0,a[b+1][1].length)==a[b+1][1]&&(a[b-1][1]+=a[b+1][1],a[b][1]=a[b][1].substring(a[b+1][1].length)+a[b+1][1],a.splice(b+1,1),h=!0)),b++;h&&this.diff_cleanupMerge(a)},diff_match_patch.prototype.diff_xIndex=function(a,b){var c=0,d=0,e=0,f=0,g;for(g=0;g<a.length;g++){a[g][0]!==DIFF_INSERT&&(c+=a[g][1].length),a[g][0]!==DIFF_DELETE&&(d+=a[g][1].length);if(c>b)break;e=c,f=d}return a.length!=g&&a[g][0]===DIFF_DELETE?f:f+(b-e)},diff_match_patch.prototype.diff_prettyHtml=function(a){var b=[],c=/&/g,d=/</g,e=/>/g,f=/\n/g;for(var g=0;g<a.length;g++){var h=a[g][0],i=a[g][1],j=i.replace(c,"&amp;").replace(d,"&lt;").replace(e,"&gt;").replace(f,"&para;<br>");switch(h){case DIFF_INSERT:b[g]='<ins style="background:#e6ffe6;">'+j+"</ins>";break;case DIFF_DELETE:b[g]='<del style="background:#ffe6e6;">'+j+"</del>";break;case DIFF_EQUAL:b[g]="<span>"+j+"</span>"}}return b.join("")},diff_match_patch.prototype.diff_text1=function(a){var b=[];for(var c=0;c<a.length;c++)a[c][0]!==DIFF_INSERT&&(b[c]=a[c][1]);return b.join("")},diff_match_patch.prototype.diff_text2=function(a){var b=[];for(var c=0;c<a.length;c++)a[c][0]!==DIFF_DELETE&&(b[c]=a[c][1]);return b.join("")},diff_match_patch.prototype.diff_levenshtein=function(a){var b=0,c=0,d=0;for(var e=0;e<a.length;e++){var f=a[e][0],g=a[e][1];switch(f){case DIFF_INSERT:c+=g.length;break;case DIFF_DELETE:d+=g.length;break;case DIFF_EQUAL:b+=Math.max(c,d),c=0,d=0}}return b+=Math.max(c,d),b},diff_match_patch.prototype.diff_toDelta=function(a){var b=[];for(var c=0;c<a.length;c++)switch(a[c][0]){case DIFF_INSERT:b[c]="+"+encodeURI(a[c][1]);break;case DIFF_DELETE:b[c]="-"+a[c][1].length;break;case DIFF_EQUAL:b[c]="="+a[c][1].length}return b.join("	").replace(/%20/g," ")},diff_match_patch.prototype.diff_fromDelta=function(a,b){var c=[],d=0,e=0,f=b.split(/\t/g);for(var g=0;g<f.length;g++){var h=f[g].substring(1);switch(f[g].charAt(0)){case"+":try{c[d++]=[DIFF_INSERT,decodeURI(h)]}catch(i){throw new Error("Illegal escape in diff_fromDelta: "+h)}break;case"-":case"=":var j=parseInt(h,10);if(isNaN(j)||j<0)throw new Error("Invalid number in diff_fromDelta: "+h);var k=a.substring(e,e+=j);f[g].charAt(0)=="="?c[d++]=[DIFF_EQUAL,k]:c[d++]=[DIFF_DELETE,k];break;default:if(f[g])throw new Error("Invalid diff operation in diff_fromDelta: "+f[g])}}if(e!=a.length)throw new Error("Delta length ("+e+") does not equal source text length ("+a.length+").");return c},diff_match_patch.prototype.match_main=function(a,b,c){if(a==null||b==null||c==null)throw new Error("Null input. (match_main)");return c=Math.max(0,Math.min(c,a.length)),a==b?{index:0,error:0}:a.length?a.substring(c,c+b.length)==b?{index:c,error:0}:this.match_bitap_(a,b,c):{index:-1}},diff_match_patch.prototype.match_bitap_=function(a,b,c){function f(a,d){var f=a/b.length,g=Math.abs(c-d);return e.Match_Distance?f+g/e.Match_Distance:g?1:f}if(b.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var d=this.match_alphabet_(b),e=this,g=this.Match_Threshold,h=a.indexOf(b,c);h!=-1&&(g=Math.min(f(0,h),g),h=a.lastIndexOf(b,c+b.length),h!=-1&&(g=Math.min(f(0,h),g)));var i=1<<b.length-1;h=-1;var j,k,l=b.length+a.length,m;for(var n=0;n<b.length;n++){j=0,k=l;while(j<k)f(n,c+k)<=g?j=k:l=k,k=Math.floor((l-j)/2+j);l=k;var o=Math.max(1,c-k+1),p=Math.min(c+k,a.length)+b.length;try{var q=Array(p+2)}catch(r){throw window.alert("Please update to Chrome 30 or better."),new Error("Failed to create array for "+(p+2)+" elements!")}q[p+1]=(1<<n)-1;for(var s=p;s>=o;s--){var t=d[a.charAt(s-1)];n===0?q[s]=(q[s+1]<<1|1)&t:q[s]=(q[s+1]<<1|1)&t|((m[s+1]|m[s])<<1|1)|m[s+1];if(q[s]&i){var u=f(n,s-1);if(u<=g){g=u,h=s-1;if(!(h>c))break;o=Math.max(1,2*c-h)}}}if(f(n+1,c)>g)break;m=q}return{index:h,error:g}},diff_match_patch.prototype.match_alphabet_=function(a){var b={};for(var c=0;c<a.length;c++)b[a.charAt(c)]=0;for(var c=0;c<a.length;c++)b[a.charAt(c)]|=1<<a.length-c-1;return b},diff_match_patch.prototype.patch_addContext_=function(a,b){if(b.length==0)return;var c=b.substring(a.start2,a.start2+a.length1),d=0;while(b.indexOf(c)!=b.lastIndexOf(c)&&c.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin)d+=this.Patch_Margin,c=b.substring(a.start2-d,a.start2+a.length1+d);d+=this.Patch_Margin;var e=b.substring(a.start2-d,a.start2);e&&a.diffs.unshift([DIFF_EQUAL,e]);var f=b.substring(a.start2+a.length1,a.start2+a.length1+d);f&&a.diffs.push([DIFF_EQUAL,f]),a.start1-=e.length,a.start2-=e.length,a.length1+=e.length+f.length,a.length2+=e.length+f.length},diff_match_patch.prototype.patch_make=function(a,b,c){var d,e;if(typeof a=="string"&&typeof b=="string"&&typeof c=="undefined")d=a,e=this.diff_main(d,b,!0),e.length>2&&(this.diff_cleanupSemantic(e),this.diff_cleanupEfficiency(e));else if(a&&typeof a=="object"&&typeof b=="undefined"&&typeof c=="undefined")e=a,d=this.diff_text1(e);else if(typeof a=="string"&&b&&typeof b=="object"&&typeof c=="undefined")d=a,e=b;else{if(typeof a!="string"||typeof b!="string"||!c||typeof c!="object")throw new Error("Unknown call format to patch_make.");d=a,e=c}if(e.length===0)return[];var f=[],g=new diff_match_patch.patch_obj,h=0,i=0,j=0,k=d,l=d;for(var m=0;m<e.length;m++){var n=e[m][0],o=e[m][1];!h&&n!==DIFF_EQUAL&&(g.start1=i,g.start2=j);switch(n){case DIFF_INSERT:g.diffs[h++]=e[m],g.length2+=o.length,l=l.substring(0,j)+o+l.substring(j);break;case DIFF_DELETE:g.length1+=o.length,g.diffs[h++]=e[m],l=l.substring(0,j)+l.substring(j+o.length);break;case DIFF_EQUAL:o.length<=2*this.Patch_Margin&&h&&e.length!=m+1?(g.diffs[h++]=e[m],g.length1+=o.length,g.length2+=o.length):o.length>=2*this.Patch_Margin&&h&&(this.patch_addContext_(g,k),f.push(g),g=new diff_match_patch.patch_obj,h=0,k=l,i=j)}n!==DIFF_INSERT&&(i+=o.length),n!==DIFF_DELETE&&(j+=o.length)}return h&&(this.patch_addContext_(g,k),f.push(g)),f},diff_match_patch.prototype.patch_deepCopy=function(a){var b=[];for(var c=0;c<a.length;c++){var d=a[c],e=new diff_match_patch.patch_obj;e.diffs=[];for(var f=0;f<d.diffs.length;f++)e.diffs[f]=d.diffs[f].slice();e.start1=d.start1,e.start2=d.start2,e.length1=d.length1,e.length2=d.length2,b[c]=e}return b},diff_match_patch.prototype.patch_apply=function(a,b){if(a.length==0)return[b,[]];a=this.patch_deepCopy(a);var c=this.patch_addPadding(a);b=c+b+c,this.patch_splitMax(a);var d=0,e=[];for(var f=0;f<a.length;f++){var g=a[f].start2+d,h=this.diff_text1(a[f].diffs),i,j=-1;if(h.length>this.Match_MaxBits){i=this.match_main(b,h.substring(0,this.Match_MaxBits),g);if(i!=-1){j=this.match_main(b,h.substring(h.length-this.Match_MaxBits),g+h.length-this.Match_MaxBits);if(j==-1||i>=j)i=-1}}else i=this.match_main(b,h,g);if(i==-1)e[f]=!1,d-=a[f].length2-a[f].length1;else{e[f]=!0,d=i-g;var k;j==-1?k=b.substring(i,i+h.length):k=b.substring(i,j+this.Match_MaxBits);if(h==k)b=b.substring(0,i)+this.diff_text2(a[f].diffs)+b.substring(i+h.length);else{var l=this.diff_main(h,k,!1);if(h.length>this.Match_MaxBits&&this.diff_levenshtein(l)/h.length>this.Patch_DeleteThreshold)e[f]=!1;else{this.diff_cleanupSemanticLossless(l);var m=0,n;for(var o=0;o<a[f].diffs.length;o++){var p=a[f].diffs[o];p[0]!==DIFF_EQUAL&&(n=this.diff_xIndex(l,m)),p[0]===DIFF_INSERT?b=b.substring(0,i+n)+p[1]+b.substring(i+n):p[0]===DIFF_DELETE&&(b=b.substring(0,i+n)+b.substring(i+this.diff_xIndex(l,m+p[1].length))),p[0]!==DIFF_DELETE&&(m+=p[1].length)}}}}}return b=b.substring(c.length,b.length-c.length),[b,e]},diff_match_patch.prototype.patch_addPadding=function(a){var b=this.Patch_Margin,c="";for(var d=1;d<=b;d++)c+=String.fromCharCode(d);for(var d=0;d<a.length;d++)a[d].start1+=b,a[d].start2+=b;var e=a[0],f=e.diffs;if(f.length==0||f[0][0]!=DIFF_EQUAL)f.unshift([DIFF_EQUAL,c]),e.start1-=b,e.start2-=b,e.length1+=b,e.length2+=b;else if(b>f[0][1].length){var g=b-f[0][1].length;f[0][1]=c.substring(f[0][1].length)+f[0][1],e.start1-=g,e.start2-=g,e.length1+=g,e.length2+=g}e=a[a.length-1],f=e.diffs;if(f.length==0||f[f.length-1][0]!=DIFF_EQUAL)f.push([DIFF_EQUAL,c]),e.length1+=b,e.length2+=b;else if(b>f[f.length-1][1].length){var g=b-f[f.length-1][1].length;f[f.length-1][1]+=c.substring(0,g),e.length1+=g,e.length2+=g}return c},diff_match_patch.prototype.patch_splitMax=function(a){var b=this.Match_MaxBits;for(var c=0;c<a.length;c++){if(a[c].length1<=b)continue;var d=a[c];a.splice(c--,1);var e=d.start1,f=d.start2,g="";while(d.diffs.length!==0){var h=new diff_match_patch.patch_obj,i=!0;h.start1=e-g.length,h.start2=f-g.length,g!==""&&(h.length1=h.length2=g.length,h.diffs.push([DIFF_EQUAL,g]));while(d.diffs.length!==0&&h.length1<b-this.Patch_Margin){var j=d.diffs[0][0],k=d.diffs[0][1];j===DIFF_INSERT?(h.length2+=k.length,f+=k.length,h.diffs.push(d.diffs.shift()),i=!1):j===DIFF_DELETE&&h.diffs.length==1&&h.diffs[0][0]==DIFF_EQUAL&&k.length>2*b?(h.length1+=k.length,e+=k.length,i=!1,h.diffs.push([j,k]),d.diffs.shift()):(k=k.substring(0,b-h.length1-this.Patch_Margin),h.length1+=k.length,e+=k.length,j===DIFF_EQUAL?(h.length2+=k.length,f+=k.length):i=!1,h.diffs.push([j,k]),k==d.diffs[0][1]?d.diffs.shift():d.diffs[0][1]=d.diffs[0][1].substring(k.length))}g=this.diff_text2(h.diffs),g=g.substring(g.length-this.Patch_Margin);var l=this.diff_text1(d.diffs).substring(0,this.Patch_Margin);l!==""&&(h.length1+=l.length,h.length2+=l.length,h.diffs.length!==0&&h.diffs[h.diffs.length-1][0]===DIFF_EQUAL?h.diffs[h.diffs.length-1][1]+=l:h.diffs.push([DIFF_EQUAL,l])),i||a.splice(++c,0,h)}}},diff_match_patch.prototype.patch_toText=function(a){var b=[];for(var c=0;c<a.length;c++)b[c]=a[c];return b.join("")},diff_match_patch.prototype.patch_fromText=function(a){var b=[];if(!a)return b;var c=a.split("\n"),d=0,e=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;while(d<c.length){var f=c[d].match(e);if(!f)throw new Error("Invalid patch string: "+c[d]);var g=new diff_match_patch.patch_obj;b.push(g),g.start1=parseInt(f[1],10),f[2]===""?(g.start1--,g.length1=1):f[2]=="0"?g.length1=0:(g.start1--,g.length1=parseInt(f[2],10)),g.start2=parseInt(f[3],10),f[4]===""?(g.start2--,g.length2=1):f[4]=="0"?g.length2=0:(g.start2--,g.length2=parseInt(f[4],10)),d++;while(d<c.length){var h=c[d].charAt(0);try{var i=decodeURI(c[d].substring(1))}catch(j){throw new Error("Illegal escape in patch_fromText: "+i)}if(h=="-")g.diffs.push([DIFF_DELETE,i]);else if(h=="+")g.diffs.push([DIFF_INSERT,i]);else if(h==" ")g.diffs.push([DIFF_EQUAL,i]);else{if(h=="@")break;if(h!=="")throw new Error('Invalid patch mode "'+h+'" in: '+i)}d++}}return b},diff_match_patch.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0},diff_match_patch.patch_obj.prototype.toString=function(){var a,b;this.length1===0?a=this.start1+",0":this.length1==1?a=this.start1+1:a=this.start1+1+","+this.length1,this.length2===0?b=this.start2+",0":this.length2==1?b=this.start2+1:b=this.start2+1+","+this.length2;var c=["@@ -"+a+" +"+b+" @@\n"],d;for(var e=0;e<this.diffs.length;e++){switch(this.diffs[e][0]){case DIFF_INSERT:d="+";break;case DIFF_DELETE:d="-";break;case DIFF_EQUAL:d=" "}c[e+1]=d+encodeURI(this.diffs[e][1])+"\n"}return c.join("").replace(/%20/g," ")},this.diff_match_patch=diff_match_patch,this.DIFF_DELETE=DIFF_DELETE,this.DIFF_INSERT=DIFF_INSERT,this.DIFF_EQUAL=DIFF_EQUAL,function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=[].slice,c=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};window.DomTextMapper=function(){function i(b){this.id=b,this._onChange=a(this._onChange,this),this.setRealRoot(),i.instances+=1,this.id==null&&(this.id="d-t-m #"+i.instances)}var d,e,f,g,h;return i.applicable=function(){return!0},g=!0,f=!0,e=["thead","tbody","tfoot","ol","a","caption","p","span","div","h1","h2","h3","h4","h5","h6","ul","li","form"],d=32,i.instances=0,i.prototype.log=function(){var a;return a=1<=arguments.length?b.call(arguments,0):[],console.log.apply(console,[this.id,": "].concat(b.call(a)))},i.prototype._onChange=function(a){return this.documentChanged(),this.performUpdateOnNode(a.target,!1,a.data),this.lastScanned=this.timestamp()},i.prototype._changeRootNode=function(a){var b;return(b=this.rootNode)!=null&&b.removeEventListener("domChange",this._onChange),this.rootNode=a,this.rootNode.addEventListener("domChange",this._onChange),a},i.prototype.setRootNode=function(a){return this.rootWin=window,this.pathStartNode=this._changeRootNode(a)},i.prototype.setRootId=function(a){return this.setRootNode(document.getElementById(a))},i.prototype.setRootIframe=function(a){var b;b=window.document.getElementById(a);if(b==null)throw new Error("Can't find iframe with specified ID!");this.rootWin=b.contentWindow;if(this.rootWin==null)throw new Error("Can't access contents of the specified iframe!");return this._changeRootNode(this.rootWin.document),this.pathStartNode=this.getBody()},i.prototype.getDefaultPath=function(){return this.getPathTo(this.pathStartNode)},i.prototype.setRealRoot=function(){return this.rootWin=window,this._changeRootNode(document),this.pathStartNode=this.getBody()},i.prototype.documentChanged=function(){return this.lastDOMChange=this.timestamp()},i.prototype.setExpectedContent=function(a){return this.expectedContent=a},i.prototype.scan=function(){var a,b,c,d,e;if(this.domStableSince(this.lastScanned))return;if(!this.pathStartNode.ownerDocument.body.contains(this.pathStartNode))return;return c=this.timestamp(),this.saveSelection(),this.path={},this.traverseSubTree(this.pathStartNode,this.getDefaultPath()),d=this.timestamp(),b=this.getPathTo(this.pathStartNode),a=this.path[b].node,this.collectPositions(a,b,null,0,0),this.restoreSelection(),this.lastScanned=this.timestamp(),this._corpus=this.path[b].content,e=this.timestamp(),null},i.prototype.selectPath=function(a,b){var c,d;b==null&&(b=!1),c=this.path[a];if(c==null)throw new Error("I have no info about a node at "+a);return d=c!=null?c.node:void 0,d||(d=this.lookUpNode(c.path)),this.selectNode(d,b)},i.prototype.performUpdateOnNode=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p;b==null&&(b=!1);if(a==null)throw new Error("Called performUpdate with a null node!");if(this.path==null)return;m=this.timestamp(),b||this.saveSelection(),i=this.getPathTo(a),j=this.path[i];if(j==null){this.performUpdateOnNode(a.parentNode,!0),b||this.restoreSelection();return}if(j.node===a&&j.content===this.getNodeContent(a,!1)){l=i+"/",k=e,k=[],p=this.path;for(e in p)c=p[e],this.stringStartsWith(e,l)&&k.push(e);for(n=0,o=k.length;n<o;n++)e=k[n],delete this.path[e];this.traverseSubTree(a,i);if(j.node===this.pathStartNode)this.collectPositions(a,i,null,0,0);else{g=this.parentPath(i),h=this.path[g];if(h==null)throw new Error("While performing update on node "+i+", no path info found for parent path: "+g);d=a===a.parentNode.firstChild?0:this.path[this.getPathTo(a.previousSibling)].end-h.start,this.collectPositions(a,i,h.content,h.start,d)}}else{if(j.node===this.pathStartNode)throw new Error("Can not keep up with the changes, since even the node configured as path start node was replaced.");f=a.parentNode!=null?a.parentNode:(g=this.parentPath(i),this.lookUpNode(g)),this.performUpdateOnNode(f,!0)}if(!b)return this.restoreSelection()},i.prototype.getInfoForPath=function(a){var b;if(this.path==null)throw new Error("Can't get info before running a scan() !");b=this.path[a];if(b==null)throw new Error("Found no info for path '"+a+"'!");return b},i.prototype.getStartPosForPath=function(a){var b,c;return b=this.getInfoForPath(a),(c=b.start)!=null?c:this.getFirstPosAfter(b.node)},i.prototype.getFirstPosAfter=function(a){var b,c,d;return a.nextSibling!=null?(a=a.nextSibling,c=this.getPathTo(a),b=this.path[c],(d=b.start)!=null?d:this.getFirstPosAfter(a)):this.getFirstPosAfter(a.parentNode)},i.prototype.getEndPosForPath=function(a){var b,c;return b=this.getInfoForPath(a),(c=b.end)!=null?c:this.getFirstPosBefore(b.node)},i.prototype.getFirstPosBefore=function(a){var b,c,d;return a.previousSibling!=null?(a=a.previousSibling,c=this.getPathTo(a),b=this.path[c],(d=b.end)!=null?d:this.getFirstPosBefore(a)):this.getFirstPosBefore(a.parentNode)},i.prototype.getInfoForNode=function(a){if(a==null)throw new Error("Called getInfoForNode(node) with null node!");return this.getInfoForPath(this.getPathTo(a))},i.prototype.getStartPosForNode=function(a){if(a==null)throw new Error("Called getStartInfoForNode(node) with null node!");return this.getStartPosForPath(this.getPathTo(a))},i.prototype.getEndPosForNode=function(a){if(a==null)throw new Error("Called getInfoForNode(node) with null node!");return this.getEndPosForPath(this.getPathTo(a))},i.prototype.getMappingsForCharRanges=function(a){var b,c,d,e;e=[];for(c=0,d=a.length;c<d;c++)b=a[c],e.push(this.getMappingsForCharRange(b.start,b.end));return e},i.prototype.getContentForPath=function(a){return a==null&&(a=null),a==null&&(a=this.getDefaultPath()),this.path[a].content},i.prototype.getLengthForPath=function(a){return a==null&&(a=null),a==null&&(a=this.getDefaultPath()),this.path[a].length},i.prototype.getDocLength=function(){return this._corpus.length},i.prototype.getCorpus=function(){return this._corpus},i.prototype.getContextForCharRange=function(a,b){var c,e,f;if(a<0)throw Error("Negative range start is invalid!");if(b>this._corpus.length)throw Error("Range end is after the end of corpus!");return e=Math.max(0,a-d),c=this._corpus.slice(e,a),f=this._corpus.slice(b,b+d),[c.trim(),f.trim()]},i.prototype.getMappingsForCharRange=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;if(a==null||b==null)throw new Error("start and end is required!");this.scan(),i=[],r=this.path;for(j in r)h=r[j],h.atomic&&this.regions_overlap(h.start,h.end,a,b)&&function(c){return function(d){var e,f;return f={element:d},e=a<=d.start&&d.end<=b,e?(f.full=!0,f.wanted=d.content,f.yields=d.content,f.startCorrected=0,f.endCorrected=0):d.node.nodeType===Node.TEXT_NODE?(a<=d.start?(f.end=b-d.start,f.wanted=d.content.substr(0,f.end)):d.end<=b?(f.start=a-d.start,f.wanted=d.content.substr(f.start)):(f.start=a-d.start,f.end=b-d.start,f.wanted=d.content.substr(f.start,f.end-f.start)),c.computeSourcePositions(f),f.yields=d.node.data.substr(f.startCorrected,f.endCorrected-f.startCorrected)):d.node.nodeType===Node.ELEMENT_NODE&&d.node.tagName.toLowerCase()==="img"?(c.log("Can not select a sub-string from the title of an image. Selecting all."),f.full=!0,f.wanted=d.content):(c.log("Warning: no idea how to handle partial mappings for node type "+d.node.nodeType),d.node.tagName!=null&&c.log("Tag: "+d.node.tagName),c.log("Selecting all."),f.full=!0,f.wanted=d.content),i.push(f)}}(this)(h);if(i.length===0)throw this.log("Collecting nodes for ["+a+":"+b+"]"),this.log("Should be: '"+this._corpus.slice(a,b)+"'."),new Error("No mappings found for ["+a+":"+b+"]!");return i=i.sort(function(a,b){return a.element.start-b.element.start}),k=this.rootWin.document.createRange(),n=i[0],o=n.element.node,q=n.element.path,p=n.startCorrected,n.full?(k.setStartBefore(o),m=q):(k.setStart(o,p),m=q+":"+p),d=i[i.length-1],e=d.element.node,g=d.element.path,f=d.endCorrected,d.full?(k.setEndAfter(e),c=g):(k.setEnd(e,f),c=g+":"+f),l={mappings:i,realRange:k,rangeInfo:{startPath:q,startOffset:p,startInfo:m,endPath:g,endOffset:f,endInfo:c},safeParent:k.commonAncestorContainer},{sections:[l]}},i.prototype.timestamp=function(){return(new Date).getTime()},i.prototype.stringStartsWith=function(a,b){if(!b)throw Error("Requires a non-empty prefix!");return a.slice(0,b.length)===b},i.prototype.stringEndsWith=function(a,b){if(!b)throw Error("Requires a non-empty suffix!");return a.slice(a.length-b.length,a.length)===b},i.prototype.parentPath=function(a){return a.substr(0,a.lastIndexOf("/"))},i.prototype.domChangedSince=function(a){return this.lastDOMChange!=null&&a!=null?this.lastDOMChange>a:!0},i.prototype.domStableSince=function(a){return!this.domChangedSince(a)},i.prototype.getProperNodeName=function(a){var b;b=a.nodeName;switch(b){case"#text":return"text()";case"#comment":return"comment()";case"#cdata-section":return"cdata-section()";default:return b}},i.prototype.getNodePosition=function(a){var b,c;b=0,c=a;while(c)c.nodeName===a.nodeName&&b++,c=c.previousSibling;return b},i.prototype.getPathSegment=function(a){var b,c;return b=this.getProperNodeName(a),c=this.getNodePosition(a),b+(c>1?"["+c+"]":"")},i.prototype.getPathTo=function(a){var b;b="";while(a!==this.rootNode){if(a==null)throw new Error("Called getPathTo on a node which was not a descendant of @rootNode. "+this.rootNode);b=this.getPathSegment(a)+"/"+b,a=a.parentNode}return b=(this.rootNode.ownerDocument!=null?"./":"/")+b,b=b.replace(/\/$/,""),b},i.prototype.traverseSubTree=function(a,b,c,d){var e,f,g,h,i,j;c==null&&(c=!1),d==null&&(d=!1),this.underTraverse=b,f=this.getNodeContent(a,!1),this.path[b]={path:b,content:f,length:f.length,node:a},f.length?(d&&this.log("Collected info about path "+b),c&&(this.log("Something seems to be wrong. I see visible content @ "+b+", while some of the ancestor nodes reported empty contents. Probably a new selection API bug...."),this.log("Anyway, text is '"+f+"'."))):(d&&this.log("Found no content at path "+b),c=!0);if(a.hasChildNodes()){j=a.childNodes;for(h=0,i=j.length;h<i;h++)e=j[h],g=b+"/"+this.getPathSegment(e),this.traverseSubTree(e,g,c,d)}return null},i.prototype.getBody=function(){return this.rootWin.document.getElementsByTagName("body")[0]},i.prototype.regions_overlap=function(a,b,c,d){return a<d&&c<b},i.prototype.lookUpNode=function(a){var b,c,d,e;return b=(e=this.rootNode.ownerDocument)!=null?e:this.rootNode,d=b.evaluate(a,this.rootNode,null,0,null),c=d.iterateNext()},i.prototype.saveSelection=function(){var a,b;if(this.savedSelection!=null)throw this.log("Selection saved at:"),this.log(this.selectionSaved),new Error("Selection already saved!");return b=this.rootWin.getSelection(),this.savedSelection=function(){var c,d,e;e=[];for(a=c=0,d=b.rangeCount;0<=d?c<d:c>d;a=0<=d?++c:--c)e.push(b.getRangeAt(a));return e}(),this.selectionSaved=(new Error("selection was saved here")).stack},i.prototype.restoreSelection=function(){var a,b,c,d,e;if(this.savedSelection==null)throw new Error("No selection to restore.");b=this.rootWin.getSelection(),b.removeAllRanges(),e=this.savedSelection;for(c=0,d=e.length;c<d;c++)a=e[c],b.addRange(a);return delete this.savedSelection},i.prototype.selectNode=function(a,b){var d,h,i,j,k,l;b==null&&(b=!1);if(a==null)throw new Error("Called selectNode with null node!"
);j=this.rootWin.getSelection(),j.removeAllRanges(),i=this.rootWin.document.createRange();if(a.nodeType===Node.ELEMENT_NODE&&a.hasChildNodes()&&(l=a.tagName.toLowerCase(),c.call(e,l)>=0))d=a.childNodes,i.setStartBefore(d[0]),i.setEndAfter(d[d.length-1]),j.addRange(i);else if(!g||a.nodeType!==Node.TEXT_NODE||a.parentNode.tagName.toLowerCase()!=="table")try{i.setStartBefore(a),i.setEndAfter(a),j.addRange(i)}catch(m){h=m;if(!f||!this.isWhitespace(a))this.log("Warning: failed to scan element @ "+this.underTraverse),this.log("Content is: "+a.innerHTML),this.log("We won't be able to properly anchor to any text inside this element.")}if(b){k=a;while(k!=null&&k.scrollIntoViewIfNeeded==null)k=k.parentNode;k!=null?k.scrollIntoViewIfNeeded():this.log("Failed to scroll to element. (Browser does not support scrollIntoViewIfNeeded?)")}return j},i.prototype.readSelectionText=function(a){return a||(a=this.rootWin.getSelection()),a.toString().trim().replace(/\n/g," ").replace(/\s{2,}/g," ")},i.prototype.getNodeSelectionText=function(a,b){var c,d;return b==null&&(b=!0),b&&this.saveSelection(),c=this.selectNode(a),d=this.readSelectionText(c),b&&this.restoreSelection(),d},i.prototype.computeSourcePositions=function(a){var b,c,d,e,f,g,h,i,j,k;k=a.element.node.data.replace(/\n/g," "),f=a.element.content,e=a.start!=null?a.start:0,c=a.end!=null?a.end:f.length;if(c===0){a.startCorrected=0,a.endCorrected=0;return}i=0,d=0;while(j==null||h==null)g=k[i],b=f[d],g===b&&(d===e&&(j=i),d++,d===c&&(h=i+1)),i++;return a.startCorrected=j,a.endCorrected=h,null},i.prototype.getNodeContent=function(a,b){return b==null&&(b=!0),a===this.pathStartNode&&this.expectedContent!=null?this.expectedContent:this.getNodeSelectionText(a,b)},i.prototype.collectPositions=function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s;c==null&&(c=null),d==null&&(d=0),e==null&&(e=0),p=this.path[b],j=p!=null?p.content:void 0;if(!j)return p.start=d+e,p.end=d+e,p.atomic=!1,e;r=c!=null?c.indexOf(j,e):e;if(r===-1)return this.log("Content of this not is not present in content of parent, at path "+b),this.log("(Content: '"+j+"'.)"),e;k=r+j.length,f=!a.hasChildNodes(),p.start=d+r,p.end=d+k,p.atomic=f;if(!f){i=a.childNodes,l=0,q=0,s=Object();while(l<i.length)g=i[l],n=this.getProperNodeName(g),o=s[n],m=o!=null?o+1:1,s[n]=m,h=b+"/"+n+(m>1?"["+m+"]":""),q=this.collectPositions(g,h,j,d+r,q),l++}return k},h=/^\s*$/,i.prototype.isWhitespace=function(a){var b,c,d;return d=function(){var d,e,f;switch(a.nodeType){case Node.TEXT_NODE:return h.test(a.data);case Node.ELEMENT_NODE:c=!0,f=a.childNodes;for(d=0,e=f.length;d<e;d++)b=f[d],c=c&&this.isWhitespace(b);return c;default:return!1}}.call(this),d},i.prototype._testMap=function(){var a,b,c,d,e,f;this.log("Verifying map info: was it all properly traversed?"),e=this.path;for(b in e)d=e[b],d.atomic==null&&this.log(b+" is missing data.");this.log("Verifying map info: do atomic elements match?"),f=this.path;for(b in f){d=f[b];if(!d.atomic)continue;a=this._corpus.slice(d.start,d.end),c=d.content===a,c||this.log("Mismatch on "+b+": content is '"+d.content+"', range in corpus is '"+a+"'."),c}return null},i.prototype.getPageIndex=function(){return 0},i.prototype.getPageCount=function(){return 1},i.prototype.getPageIndexForPos=function(){return 0},i.prototype.isPageMapped=function(){return!0},i}(),window.DomTextMatcher=function(){function a(a){this.corpus=a}return a.prototype.searchExact=function(a,b,c){return b==null&&(b=!0),c==null&&(c=!1),this.pm||(this.pm=new window.DTM_ExactMatcher),this.pm.setDistinct(b),this.pm.setCaseSensitive(c),this._search(this.pm,a)},a.prototype.searchRegex=function(a,b){return b==null&&(b=!1),this.rm||(this.rm=new window.DTM_RegexMatcher),this.rm.setCaseSensitive(b),this._search(this.rm,a)},a.prototype.searchFuzzy=function(a,b,c,d){var e,f;return c==null&&(c=!1),d==null&&(d={}),this.ensureDMP(),this.dmp.setMatchDistance((e=d.matchDistance)!=null?e:1e3),this.dmp.setMatchThreshold((f=d.matchThreshold)!=null?f:.5),this.dmp.setCaseSensitive(c),this._search(this.dmp,a,b,d)},a.prototype.searchFuzzyWithContext=function(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T;d==null&&(d=null),e==null&&(e=null),f==null&&(f=!1),g==null&&(g={}),this.ensureDMP();if(a==null||b==null)throw new Error("Can not do a context-based fuzzy search with missing context!");u=this.corpus().length,n=d!=null?(s=d-a.length,s<0?0:s):Math.floor(u/2),this.dmp.setMatchDistance((Q=g.contextMatchDistance)!=null?Q:u*2),this.dmp.setMatchThreshold((R=g.contextMatchThreshold)!=null?R:.5),C=this.dmp.search(this.corpus(),a,n);if(!C.length)return{matches:[]};D=C[0].start,z=C[0].end,y=c!=null?c.length:d!=null&&e!=null?e-d:64,E=this.corpus().substr(z),o=y,I=this.dmp.search(E,b,o);if(!I.length)return{matches:[]};J=z+I[0].start,F=z+I[0].end,m={start:z,end:J},w=(S=g.patternMatchThreshold)!=null?S:.5,j=this._analyzeMatch(c,m,!0);if(c!=null&&g.flexContext&&!j.exact){this.pm||(this.pm=new window.DTM_ExactMatcher),this.pm.setDistinct(!1),this.pm.setCaseSensitive(!1),q=this.pm.search(this.corpus().slice(D,+F+1||9e9),c),delete l,k=2;for(M=0,O=q.length;M<O;M++){p=q[M],r={start:D+p.start,end:D+p.end},B={start:D,end:r.start},h=this._analyzeMatch(a,B,!0),A=h.exact?0:h.comparison.errorLevel,H={start:r.end,end:F},i=this._analyzeMatch(b,H,!0),G=i.exact?0:i.comparison.errorLevel;if(h.exact||i.exact)K=A+G,K<k&&(l=r,k=K)}l!=null&&(console.log("flexContext adjustment: we found a better candidate!"),m=l,j=this._analyzeMatch(c,m,!0))}if(c==null||j.exact||j.comparison.errorLevel<=w){v={},T=[m,j];for(N=0,P=T.length;N<P;N++){x=T[N];for(t in x)L=x[t],v[t]=L}return{matches:[v]}}return{matches:[]}},a.prototype._normalizeString=function(a){return a.replace(/\s{2,}/g," ").trim()},a.prototype._search=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p;d==null&&(d={});if(b==null)throw new Error("Can't search for null pattern!");b=b.trim();if(b==null)throw new Error("Can't search an for empty pattern!");e=(p=d.withFuzzyComparison)!=null?p:!1,h=this.timestamp(),l=a.search(this.corpus(),b,c,d),i=this.timestamp(),f=[],m=function(a){return function(c){var d,g,h,i,j,k,l,m;d=a._analyzeMatch(b,c,e),h={},m=[c,d];for(k=0,l=m.length;k<l;k++){i=m[k];for(g in i)j=i[g],h[g]=j}return f.push(h),null}}(this);for(n=0,o=l.length;n<o;n++)k=l[n],m(k);return j=this.timestamp(),g={matches:f,time:{phase1_textMatching:i-h,phase2_matchMapping:j-i,total:j-h}},g},a.prototype.timestamp=function(){return(new Date).getTime()},a.prototype._analyzeMatch=function(a,b,c){var d,e,f;return c==null&&(c=!1),d=this._normalizeString(a),e=this._normalizeString(this.corpus().slice(b.start,+(b.end-1)+1||9e9)),f={found:e,exact:e===d},f.exact||(f.exactExceptCase=d.toLowerCase()===e.toLowerCase()),!f.exact&&c&&(this.ensureDMP(),f.comparison=this.dmp.compare(d,e)),f},a.prototype.ensureDMP=function(){if(this.dmp==null){if(window.DTM_DMPMatcher==null)throw new Error("DTM_DMPMatcher is not available. Have you loaded the text match engines?");return this.dmp=new window.DTM_DMPMatcher}},a}(),window.DTM_ExactMatcher=function(){function a(){this.distinct=!0,this.caseSensitive=!1}return a.prototype.setDistinct=function(a){return this.distinct=a},a.prototype.setCaseSensitive=function(a){return this.caseSensitive=a},a.prototype.search=function(a,b){var c,d,e,f;e=b.length,f=[],d=0,this.caseSensitive||(a=a.toLowerCase(),b=b.toLowerCase());while((c=a.indexOf(b))>-1)(function(b){return function(){return f.push({start:d+c,end:d+c+e}),b.distinct?(a=a.substr(c+e),d+=c+e):(a=a.substr(c+1),d+=c+1)}})(this)();return f},a}(),window.DTM_RegexMatcher=function(){function a(){this.caseSensitive=!1}return a.prototype.setCaseSensitive=function(a){return this.caseSensitive=a},a.prototype.search=function(a,b){var c,d,e;d=new RegExp(b,this.caseSensitive?"g":"gi"),e=[];while(c=d.exec(a))e.push({start:c.index,end:c.index+c[0].length});return e},a}(),window.DTM_DMPMatcher=function(){function a(){this.dmp=new diff_match_patch,this.dmp.Diff_Timeout=0,this.caseSensitive=!1}return a.prototype._reverse=function(a){return a.split("").reverse().join("")},a.prototype.getMaxPatternLength=function(){return this.dmp.Match_MaxBits},a.prototype.setMatchDistance=function(a){return this.dmp.Match_Distance=a},a.prototype.getMatchDistance=function(){return this.dmp.Match_Distance},a.prototype.setMatchThreshold=function(a){return this.dmp.Match_Threshold=a},a.prototype.getMatchThreshold=function(){return this.dmp.Match_Threshold},a.prototype.getCaseSensitive=function(){return caseSensitive},a.prototype.setCaseSensitive=function(a){return this.caseSensitive=a},a.prototype.search=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r;c==null&&(c=0),d==null&&(d={});if(c<0)throw new Error("Can't search at negative indices!");if(c!==Math.floor(c))throw new Error("Expected start location must be an integer.");this.caseSensitive||(a=a.toLowerCase(),b=b.toLowerCase()),m=b.length,l=this.getMaxPatternLength(),m<=l?n=this.searchForSlice(a,b,c):(r=b.substr(0,l),q=this.searchForSlice(a,r,c),q!=null&&(p=q.end-q.start,i=b.substr(m-l,l),g=q.start+m-l,h=this.searchForSlice(a,i,g),h!=null&&(f=h.end-h.start,k=h.end-q.start,o=q.start,e=h.end,m*.5<=k&&k<=m*1.5&&(n={start:o,end:h.end}))));if(n==null)return[];if(d.withLevenhstein||d.withDiff)j=a.substr(n.start,n.end-n.start),n.diff=this.dmp.diff_main(b,j),d.withLevenshstein&&(n.lev=this.dmp.diff_levenshtein(n.diff)),d.withDiff&&(this.dmp.diff_cleanupSemantic(n.diff),n.diffHTML=this.dmp.diff_prettyHtml(n.diff));return[n]},a.prototype.compare=function(a,b){var c;if(a==null||b==null)throw new Error("Can not compare non-existing strings!");return c={},c.diff=this.dmp.diff_main(a,b),c.lev=this.dmp.diff_levenshtein(c.diff),c.errorLevel=c.lev/a.length,this.dmp.diff_cleanupSemantic(c.diff),c.diffHTML=this.dmp.diff_prettyHtml(c.diff),c},a.prototype.searchForSlice=function(a,b,c){var d,e,f,g,h,i,j,k,l,m;return i=this.dmp.match_main(a,b,c),l=i.index,l===-1?null:(m=this._reverse(a),h=this._reverse(b),g=l+b.length,f=a.length-g,j=this.dmp.match_main(m,h,f),d=j.index,e=a.length-d,k={start:l,end:e})},a}()}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};Annotator.Plugin.DomTextMapper=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments),a}return c(d,b),d.prototype.pluginInit=function(){var a=this;if(this.options.skip){console.log("Not registering DOM-Text-Mapper.");return}return this.annotator.documentAccessStrategies.unshift({name:"DOM-Text-Mapper",mapper:window.DomTextMapper,init:function(){return a.annotator.domMapper.setRootNode(a.annotator.wrapper[0])}})},d}(Annotator.Plugin)}.call(this),function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c={}.hasOwnProperty,d=function(a,b){function e(){this.constructor=a}for(var d in b)c.call(b,d)&&(a[d]=b[d]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a};Annotator.Plugin.TextAnchors=function(c){function e(){return this.checkForEndSelection=b(this.checkForEndSelection,this),a=e.__super__.constructor.apply(this,arguments),a}return d(e,c),e.prototype.pluginInit=function(){var a=this;if(!this.annotator.plugins.TextHighlights)throw new Error("The TextAnchors Annotator plugin requires the TextHighlights plugin.");return this.Annotator=Annotator,this.$=Annotator.$,$(document).bind({mouseup:this.checkForEndSelection}),this.annotator.subscribe("enableAnnotating",function(b){if(b)return setTimeout(a.checkForEndSelection,500)}),null},e.prototype._getSelectedRanges=function(){var a,b,c,d,e,f,g,h,i;g=this.Annotator.util.getGlobal().getSelection(),e=[],f=[],g.isCollapsed||(e=function(){var e,h,i;i=[];for(b=e=0,h=g.rangeCount;0<=h?e<h:e>h;b=0<=h?++e:--e)d=g.getRangeAt(b),a=new this.Annotator.Range.BrowserRange(d),c=a.normalize().limit(this.annotator.wrapper[0]),c===null&&f.push(d),i.push(c);return i}.call(this),g.removeAllRanges());for(h=0,i=f.length;h<i;h++)d=f[h],g.addRange(d);return this.$.grep(e,function(a){return a&&g.addRange(a.toRange()),a})},e.prototype.checkForEndSelection=function(a){var b,c,d,e,f,g,h,i,j;a==null&&(a={}),this.annotator.mouseIsDown=!1;if(this.annotator.inAdderClick)return;f=this._getSelectedRanges();for(g=0,i=f.length;g<i;g++){e=f[g],b=e.commonAncestor,this.Annotator.TextHighlight.isInstance(b)&&(b=this.Annotator.TextHighlight.getIndependentParent(b));if(this.annotator.isAnnotator(b))return}if(f.length){a.segments=[];for(h=0,j=f.length;h<j;h++)d=f[h],a.segments.push({type:"text range",range:d});return a.pageX||(c=f[0].getEndCoords(),a.pageX=c.x,a.pageY=c.y),this.annotator.onSuccessfulSelection(a)}return this.annotator.onFailedSelection(a)},e}(Annotator.Plugin)}.call(this),function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c={}.hasOwnProperty,d=function(a,b){function e(){this.constructor=a}for(var d in b)c.call(b,d)&&(a[d]=b[d]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a};Annotator.Plugin.FuzzyTextAnchors=function(c){function e(){return this.fuzzyMatching=b(this.fuzzyMatching,this),this.twoPhaseFuzzyMatching=b(this.twoPhaseFuzzyMatching,this),a=e.__super__.constructor.apply(this,arguments),a}return d(e,c),e.prototype.pluginInit=function(){var a=this;if(!this.annotator.plugins.TextAnchors){console.warn("The FuzzyTextAnchors Annotator plugin requires the TextAnchors plugin. Skipping.");return}return this.Annotator=Annotator,this.textFinder=new DomTextMatcher(function(){return a.annotator.domMapper.getCorpus()}),this.annotator.anchoringStrategies.push({name:"two-phase fuzzy",code:this.twoPhaseFuzzyMatching}),this.annotator.anchoringStrategies.push({name:"one-phase fuzzy",code:this.fuzzyMatching})},e.prototype.twoPhaseFuzzyMatching=function(a,b){var c,d,e,f,g,h,i,j,k,l;if(this.annotator.domMapper.getInfoForNode==null)return;return j=this.annotator.findSelector(b.selector,"TextQuoteSelector"),h=j!=null?j.prefix:void 0,l=j!=null?j.suffix:void 0,i=j!=null?j.exact:void 0,h==null||l==null?null:(g=this.annotator.findSelector(b.selector,"TextPositionSelector"),d=g!=null?g.start:void 0,c=g!=null?g.end:void 0,f={contextMatchDistance:this.annotator.domMapper.getCorpus().length*2,contextMatchThreshold:.5,patternMatchThreshold:.5,flexContext:!0},k=this.textFinder.searchFuzzyWithContext(h,l,i,d,c,!1,f),k.matches.length?(e=k.matches[0],new this.Annotator.TextPositionAnchor(this.annotator,a,b,e.start,e.end,this.annotator.domMapper.getPageIndexForPos(e.start),this.annotator.domMapper.getPageIndexForPos(e.end),e.found,e.exact?void 0:e.comparison.diffHTML,e.exact?void 0:e.exactExceptCase)):null)},e.prototype.fuzzyMatching=function(a,b){var c,d,e,f,g,h,i,j;if(this.annotator.domMapper.getInfoForNode==null)return;i=this.annotator.findSelector(b.selector,"TextQuoteSelector"),h=i!=null?i.exact:void 0;if(h==null)return null;if(h.length>=32)return g=this.annotator.findSelector(b.selector,"TextPositionSelector"),c=g!=null?g.start:void 0,d=this.annotator.domMapper.getCorpus().length,c==null&&(c=Math.floor(d/2)),f={matchDistance:d*2,withFuzzyComparison:!0},j=this.textFinder.searchFuzzy(h,c,!1,f),j.matches.length?(e=j.matches[0],new this.Annotator.TextPositionAnchor(this.annotator,a,b,e.start,e.end,this.annotator.domMapper.getPageIndexForPos(e.start),this.annotator.domMapper.getPageIndexForPos(e.end),e.found,e.exact?void 0:e.comparison.diffHTML,e.exact?void 0:e.exactExceptCase)):null;return},e}(Annotator.Plugin)}.call(this);
// Generated by CoffeeScript 1.6.3
/*
** Annotator 1.2.6-dev-0d3b920
** https://github.com/okfn/annotator/
**
** Copyright 2012 Aron Carroll, Rufus Pollock, and Nick Stenning.
** Dual licensed under the MIT and GPLv3 licenses.
** https://github.com/okfn/annotator/blob/master/LICENSE
**
** Built at: 2014-08-19 23:59:28Z
*//*
//
*/// Generated by CoffeeScript 1.6.3
(function(){var a,b,c={}.hasOwnProperty,d=function(a,b){function e(){this.constructor=a}for(var d in b)c.call(b,d)&&(a[d]=b[d]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a},e=function(a,b){return function(){return a.apply(b,arguments)}};a=function(a){function b(a,c,d,e,f){this.range=e,b.__super__.constructor.call(this,a,c,d,0,0,f);if(this.range==null)throw new Error("range is required!");this.Annotator=b.Annotator}return d(b,a),b.Annotator=Annotator,b.prototype._createHighlight=function(){return new this.Annotator.TextHighlight(this,0,this.range)},b}(Annotator.Anchor),Annotator.Plugin.TextRange=function(c){function f(){return this.createFromRangeSelector=e(this.createFromRangeSelector,this),this._getRangeSelector=e(this._getRangeSelector,this),b=f.__super__.constructor.apply(this,arguments),b}return d(f,c),f.prototype.pluginInit=function(){return this.Annotator=Annotator,this.annotator.selectorCreators.push({name:"RangeSelector",describe:this._getRangeSelector}),this.annotator.anchoringStrategies.push({name:"range",code:this.createFromRangeSelector}),this.annotator.TextRangeAnchor=a},f.prototype._getRangeSelector=function(a){var b;return a.type!=="text range"?[]:(b=a.range.serialize(this.annotator.wrapper[0],"."+this.Annotator.TextHighlight.highlightClass),[{type:"RangeSelector",startContainer:b.startContainer,startOffset:b.startOffset,endContainer:b.endContainer,endOffset:b.endOffset}])},f.prototype.createFromRangeSelector=function(b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q;l=this.annotator.findSelector(c.selector,"RangeSelector");if(l==null)return null;try{i=this.Annotator.Range.sniff(l),h=i.normalize(this.annotator.wrapper[0])}catch(r){return g=r,null}if(this.annotator.domMapper.getInfoForNode!=null){m=this.annotator.domMapper.getInfoForNode(h.start);if(!m)return null;n=m.start,e=this.annotator.domMapper.getInfoForNode(h.end);if(!e)return null;f=e.end,j=this.annotator.domMapper.getCorpus().slice(n,+(f-1)+1||9e9).trim()}else j=h.text().trim();return d=this.annotator.normalizeString(j),k=typeof (o=this.annotator).getQuoteForTarget=="function"?o.getQuoteForTarget(c):void 0,k!=null&&d!==k?null:(m!=null?m.start:void 0)!=null&&(e!=null?e.end:void 0)!=null?new this.Annotator.TextPositionAnchor(this.annotator,b,c,m.start,e.end,(p=m.pageIndex)!=null?p:0,(q=e.pageIndex)!=null?q:0,d):new a(this.annotator,b,c,h,d)},f}(Annotator.Plugin)}).call(this);
// Generated by CoffeeScript 1.6.3
/*
** Annotator 1.2.6-dev-5c36e53
** https://github.com/okfn/annotator/
**
** Copyright 2012 Aron Carroll, Rufus Pollock, and Nick Stenning.
** Dual licensed under the MIT and GPLv3 licenses.
** https://github.com/okfn/annotator/blob/master/LICENSE
**
** Built at: 2014-06-17 21:13:16Z
*//*
//
*/// Generated by CoffeeScript 1.6.3
(function(){var a,b,c={}.hasOwnProperty,d=function(a,b){function e(){this.constructor=a}for(var d in b)c.call(b,d)&&(a[d]=b[d]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a},e=function(a,b){return function(){return a.apply(b,arguments)}};a=function(a){function b(a,c,d,e,f,g,h,i,j,k){this.start=e,this.end=f,b.__super__.constructor.call(this,a,c,d,g,h,i,j,k);if(this.start==null)throw new Error("start is required!");if(this.end==null)throw new Error("end is required!");this.Annotator=b.Annotator}return d(b,a),b.Annotator=Annotator,b.prototype._createHighlight=function(a){var b,c,d,e;return c=this.annotator.domMapper.getMappingsForCharRange(this.start,this.end,[a]),e=c.sections[a].realRange,b=new this.Annotator.Range.BrowserRange(e),d=b.normalize(this.annotator.wrapper[0]),new this.Annotator.TextHighlight(this,a,d)},b}(Annotator.Anchor),Annotator.Plugin.TextPosition=function(c){function f(){return this.createFromPositionSelector=e(this.createFromPositionSelector,this),this._getTextPositionSelector=e(this._getTextPositionSelector,this),b=f.__super__.constructor.apply(this,arguments),b}return d(f,c),f.prototype.pluginInit=function(){return this.Annotator=Annotator,this.annotator.selectorCreators.push({name:"TextPositionSelector",describe:this._getTextPositionSelector}),this.annotator.anchoringStrategies.push({name:"position",code:this.createFromPositionSelector}),this.Annotator.TextPositionAnchor=a},f.prototype._getTextPositionSelector=function(a){var b,c;return a.type!=="text range"?[]:this.annotator.domMapper.getStartPosForNode==null?[]:(c=this.annotator.domMapper.getStartPosForNode(a.range.start),b=this.annotator.domMapper.getEndPosForNode(a.range.end),c!=null&&b!=null?[{type:"TextPositionSelector",start:c,end:b}]:(c==null&&console.log("Warning: can't generate TextPosition selector, because",a.range.start,"does not have a valid start position."),b==null&&console.log("Warning: can't generate TextPosition selector, because",a.range.end,"does not have a valid end position."),[]))},f.prototype.createFromPositionSelector=function(b,c){var d,e,f,g,h;g=this.annotator.findSelector(c.selector,"TextPositionSelector");if(g==null)return;return g.start==null?(console.log("Warning: 'start' field is missing from TextPositionSelector. Skipping."),null):g.end==null?(console.log("Warning: 'end' field is missing from TextPositionSelector. Skipping."),null):(d=this.annotator.domMapper.getCorpus().slice(g.start,+(g.end-1)+1||9e9).trim(),e=this.annotator.normalizeString(d),f=typeof (h=this.annotator).getQuoteForTarget=="function"?h.getQuoteForTarget(c):void 0,f!=null&&e!==f?null:new a(this.annotator,b,c,g.start,g.end,this.annotator.domMapper.getPageIndexForPos(g.start),this.annotator.domMapper.getPageIndexForPos(g.end),e))},f}(Annotator.Plugin)}).call(this);
// Generated by CoffeeScript 1.6.3
/*
** Annotator 1.2.6-dev-5c36e53
** https://github.com/okfn/annotator/
**
** Copyright 2012 Aron Carroll, Rufus Pollock, and Nick Stenning.
** Dual licensed under the MIT and GPLv3 licenses.
** https://github.com/okfn/annotator/blob/master/LICENSE
**
** Built at: 2014-06-17 21:13:17Z
*//*
//
*/// Generated by CoffeeScript 1.6.3
(function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c={}.hasOwnProperty,d=function(a,b){function e(){this.constructor=a}for(var d in b)c.call(b,d)&&(a[d]=b[d]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a};Annotator.Plugin.TextQuote=function(c){function e(){return this._getTextQuoteSelector=b(this._getTextQuoteSelector,this),a=e.__super__.constructor.apply(this,arguments),a}return d(e,c),e.Annotator=Annotator,e.$=Annotator.$,e.prototype.pluginInit=function(){var a=this;return this.annotator.selectorCreators.push({name:"TextQuoteSelector",describe:this._getTextQuoteSelector}),this.annotator.getQuoteForTarget=function(b){var c;return c=a.annotator.findSelector(b.selector,"TextQuoteSelector"),c!=null?a.annotator.normalizeString(c.exact):null}},e.prototype._getTextQuoteSelector=function(a){var b,c,d,e,f,g,h,i;if(a.type!=="text range")return[];if(a.range==null)throw new Error("Called getTextQuoteSelector() with null range!");f=a.range.start;if(f==null)throw new Error("Called getTextQuoteSelector() on a range with no valid start.");e=a.range.end;if(e==null)throw new Error("Called getTextQuoteSelector() on a range with no valid end.");return this.annotator.domMapper.getStartPosForNode!=null?(g=this.annotator.domMapper.getStartPosForNode(f),b=this.annotator.domMapper.getEndPosForNode(e),g!=null&&b!=null?(d=this.annotator.domMapper.getCorpus().slice(g,+(b-1)+1||9e9).trim(),i=this.annotator.domMapper.getContextForCharRange(g,b),c=i[0],h=i[1],[{type:"TextQuoteSelector",exact:d,prefix:c,suffix:h}]):(console.log("Warning: can't generate TextQuote selector.",g,b),[])):[{type:"TextQuoteSelector",exact:a.range.text().trim()}]},e}(Annotator.Plugin)}).call(this);
// Generated by CoffeeScript 1.6.3
/*
** Annotator 1.2.6-dev-5c36e53
** https://github.com/okfn/annotator/
**
** Copyright 2012 Aron Carroll, Rufus Pollock, and Nick Stenning.
** Dual licensed under the MIT and GPLv3 licenses.
** https://github.com/okfn/annotator/blob/master/LICENSE
**
** Built at: 2014-06-17 21:13:13Z
*//*
//
*/// Generated by CoffeeScript 1.6.3
(function(){var a,b,c={}.hasOwnProperty,d=function(a,b){function e(){this.constructor=a}for(var d in b)c.call(b,d)&&(a[d]=b[d]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a},e=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};a=function(a){function b(a,c,d){b.__super__.constructor.call(this,a,c),b._init(this.annotator),this.$=b.$,this.Annotator=b.Annotator,this._highlights=this._highlightRange(d),this.$(this._highlights).data("annotation",this.annotation)}return d(b,a),b.highlightClass="annotator-hl",b.Annotator=Annotator,b.$=Annotator.$,b.highlightType="TextHighlight",b.isInstance=function(a){return this.$(a).hasClass("annotator-hl")},b.getIndependentParent=function(a){return this.$(a).parents(":not([class^=annotator-hl])")[0]},b._inited=[],b.getAnnotations=function(a){return b.$(a.target).parents(".annotator-hl").andSelf().map(function(){return b.$(this).data("annotation")}).toArray()},b._init=function(a){var b=this;if(e.call(this._inited,a)>=0)return;return a.element.delegate(".annotator-hl","mouseover",this,function(b){return a.onAnchorMouseover(b)}),a.element.delegate(".annotator-hl","mouseout",this,function(b){return a.onAnchorMouseout(b)}),a.element.delegate(".annotator-hl","mousedown",this,function(b){return a.onAnchorMousedown(b)}),a.element.delegate(".annotator-hl","click",this,function(b){return a.onAnchorClick(b)}),this._inited.push(a)},b.prototype._highlightRange=function(a,b){var c,d,e,f,g,h,i,j;b==null&&(b="annotator-hl"),h=/^\s*$/,d=this.$("<span class='"+b+"'></span>"),f=this.$(a.textNodes()).filter(function(a){return!h.test(this.nodeValue)}),g=f.wrap(d).parent().show().toArray();for(i=0,j=f.length;i<j;i++)e=f[i],c=document.createEvent("UIEvents"),c.initUIEvent("domChange",!0,!1,window,0),c.reason="created hilite",e.dispatchEvent(c);return g},b.prototype._highlightRanges=function(a,b){var c,d,e,f;b==null&&(b="annotator-hl"),c=[];for(e=0,f=a.length;e<f;e++)d=a[e],this.$.merge(c,this._highlightRange(d,b));return c},b.prototype.isTemporary=function(){return this._temporary},b.prototype.setTemporary=function(a){return this._temporary=a,a?this.$(this._highlights).addClass("annotator-hl-temporary"):this.$(this._highlights).removeClass("annotator-hl-temporary")},b.prototype.setActive=function(a){return a?this.$(this._highlights).addClass("annotator-hl-active"):this.$(this._highlights).removeClass("annotator-hl-active")},b.prototype.setFocused=function(a){return a?this.$(this._highlights).addClass("annotator-hl-focused"):this.$(this._highlights).removeClass("annotator-hl-focused")},b.prototype.removeFromDocument=function(){var a,b,c,d,e,f,g;f=this._highlights,g=[];for(d=0,e=f.length;d<e;d++)c=f[d],c.parentNode!=null&&this.annotator.domMapper.isPageMapped(this.pageIndex)?(a=c.childNodes[0],this.$(c).replaceWith(c.childNodes),b=document.createEvent("UIEvents"),b.initUIEvent("domChange",!0,!1,window,0),b.reason="removed hilite (annotation deleted)",g.push(a.parentNode.dispatchEvent(b))):g.push(void 0);return g},b.prototype._getDOMElements=function(){return this._highlights},b}(Annotator.Highlight),Annotator.Plugin.TextHighlights=function(c){function e(){return b=e.__super__.constructor.apply(this,arguments),b}return d(e,c),e.prototype.pluginInit=function(){return Annotator.TextHighlight=a},e}(Annotator.Plugin)}).call(this);
(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};window.PageTextMapperCore=function(){function b(){this._onPageRendered=a(this._onPageRendered,this)}return b.prototype.CONTEXT_LEN=32,b.prototype.getPageIndexForPos=function(a){var b,c,d,e;e=this.pageInfo;for(c=0,d=e.length;c<d;c++){b=e[c];if(b.start<=a&&a<b.end)return b.index}return-1},b.prototype._onPageRendered=function(a){if(!this._isPageRendered(a)||!this.pageInfo[a]){setTimeout(function(b){return function(){return b._onPageRendered(a)}}(this),1e3);return}return this._mapPage(this.pageInfo[a])},b.prototype.isPageMapped=function(a){var b;return((b=this.pageInfo[a])!=null?b.domMapper:void 0)!=null},b.prototype._mapPage=function(a){var b;return a.node=this.getRootNodeForPage(a.index),a.domMapper=new DomTextMapper("d-t-m for page #"+a.index),a.domMapper.setRootNode(a.node),a.domMapper.documentChanged(),this.requiresSmartStringPadding&&a.domMapper.setExpectedContent(a.content),a.domMapper.scan(),b=a.domMapper.getCorpus(),b!==a.content&&(console.log("Oops. Mismatch between rendered and extracted text, while mapping page #"+a.index+"!"),console.trace(),console.log("Rendered: "+b),console.log("Extracted: "+a.content)),setTimeout(function(){var b;return b=document.createEvent("UIEvents"),b.initUIEvent("docPageMapped",!1,!1,window,0),b.pageIndex=a.index,window.dispatchEvent(b)})},b.prototype._updateMap=function(a){return a.domMapper.documentChanged(),a.domMapper.scan()},b.prototype._unmapPage=function(a){var b;return delete a.domMapper,b=document.createEvent("UIEvents"),b.initUIEvent("docPageUnmapped",!1,!1,window,0),b.pageIndex=a.index,window.dispatchEvent(b)},b.prototype._onScroll=function(){var a;return a=document.createEvent("UIEvents"),a.initUIEvent("docPageScrolling",!1,!1,window,0),window.dispatchEvent(a)},b.prototype.getInfoForNode=function(a){var b,c,d,e,f;e=this.getPageForNode(a);if(!e.domMapper)return null;d=e.domMapper.getInfoForNode(a),b={};for(c in d)f=d[c],b[c]=f;return b.start+=e.start,b.end+=e.start,b.pageIndex=e.index,b},b.prototype.getStartPosForNode=function(a){var b,c;return c=this.getPageForNode(a),b=c.domMapper.getStartPosForNode(a),c.start+b},b.prototype.getEndPosForNode=function(a){var b,c;return c=this.getPageForNode(a),b=c.domMapper.getEndPosForNode(a),c.start+b},b.prototype.getMappingsForCharRange=function(a,b,c){var d,e,f,g,h,i,j,k,l,m;h=this.getPageIndexForPos(a),d=this.getPageIndexForPos(b),e=function(c){return function(d){var e,f,g,h;return e=c.pageInfo[d],h=Math.max(e.start,a)-e.start,g=Math.min(e.end,b)-e.start,f=e.domMapper.getMappingsForCharRange(h,g),f.sections[0]}}(this),g={},l=c!=null?c:function(){m=[];for(var a=h;h<=d?a<=d:a>=d;h<=d?a++:a--)m.push(a);return m}.apply(this);for(i=0,k=l.length;i<k;i++)f=l[i],g[f]=e(f);return{sections:g}},b.prototype.getCorpus=function(){if(!this._corpus)throw new Error("Hey! Called getCorpus() before corpus defined!");return this._corpus},b.prototype.getContextForCharRange=function(a,b){var c,d,e,f;return e=Math.max(0,a-this.CONTEXT_LEN),d=a-e,c=this._corpus.substr(e,d),f=this._corpus.substr(b,this.CONTEXT_LEN),[c.trim(),f.trim()]},b.prototype._onHavePageContents=function(){var a,b;return this._corpus=function(){var b,c,d,e;d=this.pageInfo,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(a.content);return e}.call(this).join(" "),b=0,this.pageInfo.forEach(function(a){return function(a,c){return a.len=a.content.length,a.start=b,a.end=b+=a.len+1}}(this))},b.prototype._onAfterScan=function(){return this.pageInfo.forEach(function(a){return function(b,c){if(a._isPageRendered(c))return a._mapPage(b)}}(this))},b}()}).call(this),function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c={}.hasOwnProperty,d=function(a,b){function e(){this.constructor=a}for(var d in b)c.call(b,d)&&(a[d]=b[d]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a};window.PDFTextMapper=function(a){function c(){this._finishScan=b(this._finishScan,this),this._parseExtractedText=b(this._parseExtractedText,this),this.setEvents()}return d(c,a),c.applicable=function(){var a;return(a=typeof PDFView!=="undefined"&&PDFView!==null?PDFView.initialized:void 0)!=null?a:!1},c.prototype.requiresSmartStringPadding=!0,c.prototype.getPageCount=function(){return PDFView.pages.length},c.prototype.getPageIndex=function(){return PDFView.page-1},c.prototype.setPageIndex=function(a){return PDFView.page=a+1},c.prototype._isPageRendered=function(a){var b,c;return(b=PDFView.pages[a])!=null?(c=b.textLayer)!=null?c.renderingDone:void 0:void 0},c.prototype.getRootNodeForPage=function(a){return PDFView.pages[a].textLayer.textLayerDiv},c.prototype.setEvents=function(){var a,b=this;return addEventListener("pagerender",function(a){var c;if(b.pageInfo==null)return;return c=a.detail.pageNumber-1,b._onPageRendered(c)}),addEventListener("DOMNodeRemoved",function(a){var c,d;d=a.target;if(d.nodeType===Node.ELEMENT_NODE&&d.nodeName.toLowerCase()==="div"&&d.className==="textLayer")return c=parseInt(d.parentNode.id.substr(13)-1),b._unmapPage(b.pageInfo[c])}),a=document.getElementById("viewer"),a.addEventListener("domChange",function(a){var c,d,e,f,g;e=(g=a.srcElement)!=null?g:a.target,c=a.data;if("viewer"===(typeof e.getAttribute=="function"?e.getAttribute("id"):void 0)){console.log("Detected cross-page change event.");if(c.start!=null&&c.end!=null)return f=b.getPageForNode(c.start),b._updateMap(b.pageInfo[f.index]),d=b.getPageForNode(c.end),b._updateMap(b.pageInfo[d.index])}}),$(PDFView.container).on("scroll",function(){return b._onScroll()})},c.prototype._extractionPattern=/[ ]+/g,c.prototype._parseExtractedText=function(a){return a.replace(this._extractionPattern," ")},c.prototype._waitForInit=function(){var a;return a=function(b){var c=this;return PDFView.documentFingerprint?b():setTimeout(function(){return console.log("OK, let's try again"),a(b)},100)},new Promise(function(b,c){return a(b)})},c.prototype.scan=function(){var a=this;return new Promise(function(b,c){return a._pendingScanResolve=b,a._waitForInit().then(function(){return PDFView.getPage(1).then(function(){return console.log("Scanning document for text..."),a.pageInfo=[],a._extractPageText(0)})})})},c.prototype._extractPageText=function(a){var b,c=this;b=PDFFindController.pdfPageSource.pages[a];if((b!=null?b.pdfPage:void 0)==null){setTimeout(function(){return c._extractPageText(a)},100);return}return b.getTextContent().then(function(b){var d,e,f,g,h,i;return g=(h=(i=b.bidiTexts)!=null?i:b.items)!=null?h:b,e=function(){var a,b,c;c=[];for(a=0,b=g.length;a<b;a++)f=g[a],c.push(f.str);return c}().join(" "),d=c._parseExtractedText(e),c.pageInfo[a]={index:a,content:d},a===PDFView.pages.length-1?c._finishScan():c._extractPageText(a+1)})},c.prototype._finishScan=function(){return this._onHavePageContents(),this._pendingScanResolve(),this._onAfterScan()},c.prototype.getPageForNode=function(a){var b,c;b=a;while(b.nodeType!==Node.ELEMENT_NODE||b.getAttribute("class")==null||b.getAttribute("class")!=="textLayer")b=b.parentNode;return c=parseInt(b.parentNode.id.substr(13)-1),this.pageInfo[c]},c}(window.PageTextMapperCore),Annotator.Plugin.PDF=function(b){function c(){return a=c.__super__.constructor.apply(this,arguments),a}return d(c,b),c.prototype.pluginInit=function(){if(!this.annotator.plugins.DomTextMapper){console.warn("The PDF Annotator plugin requires the DomTextMapper plugin. Skipping.");return}return this.annotator.documentAccessStrategies.unshift({name:"PDF.js",mapper:PDFTextMapper})},c}(Annotator.Plugin)}.call(this);
(function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};a=Annotator.$,Annotator.Plugin.Toolbar=function(b){function d(){return d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.events={".annotator-toolbar mouseenter":"show",".annotator-toolbar mouseleave":"hide",setTool:"onSetTool",setVisibleHighlights:"onSetVisibleHighlights"},d.prototype.html='<div class="annotator-toolbar annotator-hide"></div>',d.prototype.options={items:[{title:"Toggle Sidebar","class":"icon-comment",click:function(a){var b;return a.preventDefault(),a.stopPropagation(),b=window.annotator.frame.hasClass("annotator-collapsed"),b?window.annotator.showFrame():window.annotator.hideFrame()}},{title:"Show Annotations","class":"icon-visible",click:function(a){var b;return a.preventDefault(),a.stopPropagation(),b=!window.annotator.visibleHighlights,window.annotator.setVisibleHighlights(b)}},{title:"Highlighting Mode","class":"icon-highlighter2",click:function(a){var b,c;return a.preventDefault(),a.stopPropagation(),b=window.annotator.tool!=="highlight",c=b?"highlight":"comment",window.annotator.setTool(c)}},{title:"New Comment","class":"icon-plus",click:function(a){return a.preventDefault(),a.stopPropagation(),window.annotator.addComment()}}]},d.prototype.pluginInit=function(){var b;return this.annotator.toolbar=this.toolbar=a(this.html),this.options.container!=null?a(this.options.container).append(this.toolbar):a(this.element).append(this.toolbar),this.buttons=this.options.items.reduce(function(b){return function(b,c){var d,e;return d=a("<a></a>").attr("href","").attr("title",c.title).on("click",c.click).addClass(c["class"]),e=a("<li></li>").append(d),b.add(e)}}(this),a()),b=a("<ul></ul>"),this.buttons.appendTo(b),this.toolbar.append(b)},d.prototype.show=function(){return this.toolbar.removeClass("annotator-hide")},d.prototype.hide=function(){return this.toolbar.addClass("annotator-hide")},d.prototype.onSetTool=function(b){return b==="highlight"?a(this.buttons[2]).addClass("pushed"):a(this.buttons[2]).removeClass("pushed"),this._updateStickyButtons()},d.prototype.onSetVisibleHighlights=function(b){return b?a(this.buttons[1]).addClass("pushed"):a(this.buttons[1]).removeClass("pushed"),this._updateStickyButtons()},d.prototype._updateStickyButtons=function(){var b,c,d,e;return b=a(this.buttons).filter(function(){return a(this).hasClass("pushed")}).length,b?(c=(b+1)*35,this.toolbar.css("min-height",""+c+"px")):(c=35,this.toolbar.css("min-height","")),(d=this.annotator.plugins.Heatmap)!=null&&(d.BUCKET_THRESHOLD_PAD=c),(e=this.annotator.plugins.Heatmap)!=null?e._update():void 0},d}(Annotator.Plugin)}).call(this);
(function(){var a,b,c=function(a,b){return function(){return a.apply(b,arguments)}},d={}.hasOwnProperty,e=function(a,b){function e(){this.constructor=a}for(var c in b)d.call(b,c)&&(a[c]=b[c]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a},f=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};b=this.Annotator,a=b.$,b.Guest=function(g){function h(b,e,f){var g,i,j;f==null&&(f={}),this.onSetVisibleHighlights=c(this.onSetVisibleHighlights,this),this.onAdderClick=c(this.onAdderClick,this),this.addToken=c(this.addToken,this),this.onAnchorClick=c(this.onAnchorClick,this),this.selectAnnotations=c(this.selectAnnotations,this),this.onAnchorMousedown=c(this.onAnchorMousedown,this),this.checkForStartSelection=c(this.checkForStartSelection,this),this.removeEmphasis=c(this.removeEmphasis,this),this.addEmphasis=c(this.addEmphasis,this),this.showEditor=c(this.showEditor,this),this.updateViewer=c(this.updateViewer,this),this.toggleViewerSelection=c(this.toggleViewerSelection,this),this.showViewer=c(this.showViewer,this),this.scanDocument=c(this.scanDocument,this),e.noScan=!0,h.__super__.constructor.apply(this,arguments),delete this.options.noScan,this.comments=[],this.focusedAnnotations=[],this.frame=a("<div></div>").appendTo(this.wrapper).addClass("annotator-frame annotator-outer annotator-collapsed"),delete this.options.app,this.addPlugin("Bridge",{formatter:function(a){return function(b){var c,d,e,f;c={},b.document!=null&&(c.uri=a.plugins.Document.uri());for(d in b)e=b[d],d!=="anchors"&&(c[d]=e);if((f=c.document)!=null?f.title:void 0)c.document.title=c.document.title.slice();return c}}(this),onConnect:function(a){return function(b,c,d){return a.publish("enableAnnotating",a.canAnnotate),a.panel=a._setupXDM({window:b,origin:c,scope:""+d+":provider",onReady:function(){return console.log("Guest functions are ready for "+c),setTimeout(function(){var b;return b=document.createEvent("UIEvents"),b.initUIEvent("annotatorReady",!1,!1,window,0),b.annotator=a,window.dispatchEvent(b)})}})}}(this)}),j=this.options;for(g in j){if(!d.call(j,g))continue;i=j[g],this.plugins[g]||this.addPlugin(g,i)}f.dontScan||this.scanDocument("Guest initialized"),this.subscribe("annotationDeleted",function(a){return function(b){var c,d;if(a.isComment(b)){c=a.comments.indexOf(b);if(c!==-1)return[].splice.apply(a.comments,[c,c-c+1].concat(d=[])),d,a.plugins.Heatmap._update()}}}(this)),this.subscribe("highlightsCreated",function(a){return function(b){var c,d;return Array.isArray(b)||(b=[b]),b.forEach(function(a){var b,c,d,e;return d=a.anchor.highlight,e=Object.keys(d).map(function(a){return parseInt(a)}),c=e.sort()[0],b=d[c],a.anchor.target.pos={top:a.getTop(),height:a.getHeight()}}),c=function(){var a,c,e;e=[];for(a=0,c=b.length;a<c;a++)d=b[a],e.push(d.annotation);return e}(),a.publish("annotationsLoaded",[c])}}(this)),this.subscribe("highlightRemoved",function(a){return function(b){var c,d,e,f;return e=b.anchor.highlight,f=Object.keys(e).map(function(a){return parseInt(a)}),f.length?(console.log("We still have something left"),d=f.sort()[0],c=e[d],b.anchor.target.pos={top:b.getTop(),heigth:b.getHeight()}):(console.log("No pos left"),delete b.anchor.target.pos),a.publish("annotationsLoaded",[[b.annotation]])}}(this))}return e(h,g),h.prototype.events={".annotator-adder button click":"onAdderClick",".annotator-adder button mousedown":"onAdderMousedown",setTool:"onSetTool",setVisibleHighlights:"onSetVisibleHighlights"},h.prototype.options={TextHighlights:{},DomTextMapper:{},TextAnchors:{},TextRange:{},TextPosition:{},TextQuote:{},FuzzyTextAnchors:{},PDF:{},Document:{}},h.prototype.comments=null,h.prototype.tool="comment",h.prototype.visibleHighlights=!1,h.prototype.noBack=!1,h.prototype._setupXDM=function(a){var b;if(a.origin.match(/^chrome-extension:\/\//)||a.origin.match(/^resource:\/\//))a.origin="*";return b=Channel.build(a),b.bind("onEditorHide",this.onEditorHide).bind("onEditorSubmit",this.onEditorSubmit).bind("setDynamicBucketMode",function(a){return function(b,c){if(!a.plugins.Heatmap)return;a.plugins.Heatmap.dynamicBucket=c;if(c)return a.plugins.Heatmap._update()}}(this)).bind("setActiveHighlights",function(a){return function(b,c){var d,e,g,h,i;c==null&&(c=[]),h=a.getHighlights();for(e=0,g=h.length;e<g;e++)d=h[e],(i=d.annotation.$$tag,f.call(c,i)>=0)?d.setActive(!0,!0):d.isTemporary()||d.setActive(!1,!0);return a.publish("finalizeHighlights")}}(this)).bind("setFocusedHighlights",function(a){return function(b,c){var d,e,g,h,i,j;c==null&&(c=[]),a.focusedAnnotations=[],i=a.getHighlights();for(g=0,h=i.length;g<h;g++)e=i[g],d=e.annotation,(j=d.$$tag,f.call(c,j)>=0)?(a.focusedAnnotations.push(d),e.setFocused(!0,!0)):e.setFocused(!1,!0);return a.publish("finalizeHighlights")}}(this)).bind("scrollTo",function(a){return function(b,c){var d,e,f,g;g=a.getHighlights();for(e=0,f=g.length;e<f;e++){d=g[e];if(d.annotation.$$tag===c){d.scrollTo();return}}}}(this)).bind("adderClick",function(a){return function(){return a.selectedTargets=a.forcedLoginTargets,a.onAdderClick(a.forcedLoginEvent),delete a.forcedLoginTargets,delete a.forcedLoginEvent}}(this)).bind("getDocumentInfo",function(a){return function(){return{uri:a.plugins.Document.uri(),metadata:a.plugins.Document.metadata}}}(this)).bind("showAll",function(a){return function(){var b,c,d,e,g,h,i,j;a.plugins.Heatmap&&(a.plugins.Heatmap.dynamicBucket=!1),d=[],i=a.anchors;for(e in i){c=i[e];for(g=0,h=c.length;g<h;g++)b=c[g],(j=b.annotation,f.call(d,j)<0)&&d.push(b.annotation)}return a.updateViewer("Document",d)}}(this)).bind("setTool",function(a){return function(b,c){return a.tool=c,a.publish("setTool",c)}}(this)).bind("setVisibleHighlights",function(a){return function(b,c){return a.setVisibleHighlights(c,!1),a.publish("setVisibleHighlights",c)}}(this)).bind("updateHeatmap",function(a){return function(){return a.plugins.Heatmap._scheduleUpdate()}}(this))},h.prototype.scanDocument=function(a){var b;a==null&&(a="something happened");try{return console.log("Analyzing host frame, because "+a+"..."),this._scan()}catch(c){return b=c,console.log(b.message),console.log(b.stack)}},h.prototype._setupWrapper=function(){return this.wrapper=this.element.on("click",function(a){return function(){return a.canAnnotate&&!a.noBack&&!a.creatingHL&&setTimeout(function(){var b;if((b=a.selectedTargets)!=null?!b.length:!void 0)return a.hideFrame()}),delete a.creatingHL}}(this)),this},h.prototype._setupViewer=function(){return this},h.prototype._setupEditor=function(){return this},h.prototype.destroy=function(){var b,c,d;a(document).unbind({mouseup:this.checkForEndSelection,mousedown:this.checkForStartSelection}),a("#annotator-dynamic-style").remove(),this.adder.remove(),this.frame.remove(),this.wrapper.find(".annotator-hl").each(function(){return a(this).contents().insertBefore(this),a(this).remove()}),this.element.data("annotator",null),d=this.plugins;for(b in d)c=d[b],this.plugins[b].destroy();return this.removeEvents()},h.prototype.showViewer=function(a,b,c){var d,e;return c==null&&(c=!1),(e=this.panel)!=null?e.notify({method:"showViewer",params:{view:a,ids:function(){var a,c,e;e=[];for(a=0,c=b.length;a<c;a++)d=b[a],d.id&&e.push(d.id);return e}(),focused:c}}):void 0},h.prototype.toggleViewerSelection=function(a,b){var c,d;return b==null&&(b=!1),(d=this.panel)!=null?d.notify({method:"toggleViewerSelection",params:{ids:function(){var b,d,e;e=[];for(b=0,d=a.length;b<d;b++)c=a[b],e.push(c.id);return e}(),focused:b}}):void 0},h.prototype.updateViewer=function(a,b,c){var d,e;return c==null&&(c=!1),(e=this.panel)!=null?e.notify({method:"updateViewer",params:{view:a,ids:function(){var a,c,e;e=[];for(a=0,c=b.length;a<c;a++)d=b[a],d.id&&e.push(d.id);return e}(),focused:c}}):void 0},h.prototype.showEditor=function(a){return this.plugins.Bridge.showEditor(a)},h.prototype.addEmphasis=function(a){var b,c;return(c=this.panel)!=null?c.notify({method:"addEmphasis",params:function(){var c,d,e;e=[];for(c=0,d=a.length;c<d;c++)b=a[c],b.id&&e.push(b.id);return e}()}):void 0},h.prototype.removeEmphasis=function(a){var b,c;return(c=this.panel)!=null?c.notify({method:"removeEmphasis",params:function(){var c,d,e;e=[];for(c=0,d=a.length;c<d;c++)b=a[c],b.id&&e.push(b.id);return e}()}):void 0},h.prototype.checkForStartSelection=function(a){if(!a||!this.isAnnotator(a.target))return this.mouseIsDown=!0},h.prototype.confirmSelection=function(){var a;return this.selectedTargets.length!==1?!0:(a=this.getQuoteForTarget(this.selectedTargets[0]),a.length>2?!0:confirm("You have selected a very short piece of text: only "+length+" chars. Are you sure you want to highlight this?"))},h.prototype.onSuccessfulSelection=function(a,b){var c,d;return this.tool==="highlight"?(this.selectedTargets=function(){var b,c,e,f;e=a.segments,f=[];for(b=0,c=e.length;b<c;b++)d=e[b],f.push(this._getTargetFromSelection(d));return f}.call(this),this.canAnnotate?this.confirmSelection()?(this.creatingHL=!0,c={inject:!0},this.publish("beforeAnnotationCreated",c),c=this.setupAnnotation(c),this.publish("annotationCreated",c)):!1:!1):h.__super__.onSuccessfulSelection.apply(this,arguments)},h.prototype._getImpactedAnnotations=function(a){var b,c,d,e,g;c=a.data.getAnnotations(a);if(this.tool==="highlight"||this.visibleHighlights)return c;g=[];for(d=0,e=c.length;d<e;d++)b=c[d],f.call(this.focusedAnnotations,b)>=0&&g.push(b);return g},h.prototype.onAnchorMouseover=function(a){return this.addEmphasis(this._getImpactedAnnotations(a))},h.prototype.onAnchorMouseout=function(a){return this.removeEmphasis(this._getImpactedAnnotations(a))},h.prototype.onAnchorMousedown=function(a){if(this._getImpactedAnnotations(a).length)return this.noBack=!0},h.prototype.selectAnnotations=function(a,b,c){return this.plugins.Heatmap.dynamicBucket=!1,b?this.toggleViewerSelection(a,c):this.showViewer("Selection",a,c)},h.prototype.onAnchorClick=function(a){var b;b=this._getImpactedAnnotations(a);if(!b.length||!this.noBack)return;return this.selectAnnotations(b,a.metaKey||a.ctrlKey,!0),this.noBack=!1},h.prototype.setTool=function(a){var b;return(b=this.panel)!=null?b.notify({method:"setTool",params:a}):void 0},h.prototype.setVisibleHighlights=function(a,b){var c,d;return a==null&&(a=!0),b==null&&(b=!0),b?(d=this.panel)!=null?d.notify({method:"setVisibleHighlights",params:a}):void 0:(c="annotator-highlights-always-on",a||this.tool==="highlight"?this.element.addClass(c):this.element.removeClass(c))},h.prototype.addComment=function(){var a;return a=this.selectedTargets,this.selectedTargets=[],this.onAdderClick(),this.selectedTargets=a},h.prototype.isComment=function(a){var b,c;return!(a.inject||((b=a.references)!=null?b.length:void 0)||((c=a.target)!=null?c.length:void 0))},h.prototype.setupAnnotation=function(a){return a=h.__super__.setupAnnotation.apply(this,arguments),this.isComment(a)&&this.comments.push(a),a},h.prototype.showFrame=function(){var a;return(a=this.panel)!=null?a.notify({method:"open"}):void 0},h.prototype.hideFrame=function(){var a;return(a=this.panel)!=null?a.notify({method:"back"}):void 0},h.prototype.addToken=function(a){return this.api.notify({method:"addToken",params:a})},h.prototype.onAdderClick=function(a){"Differs from upstream in a few ways:\n- Don't fire annotationCreated events: that's the job of the sidebar\n- Save the event for retriggering if login interrupts the flow";var c,d,e,f,g,h,i,j,k;a!=null&&a.preventDefault(),this.forcedLoginEvent=a,this.forcedLoginTargets=this.selectedTargets,this.adder.hide(),this.inAdderClick=!1,g=this.adder.position(),c=this.setupAnnotation(this.createAnnotation()),k=this.getHighlights([c]);for(i=0,j=k.length;i<j;i++)f=k[i],f.setTemporary(!0);return h=function(a){return function(){var b,d,g,h;e(),g=a.getHighlights([c]),h=[];for(b=0,d=g.length;b<d;b++)f=g[b],h.push(f.setTemporary(!1));return h}}(this),d=function(a){return function(){return e(),a.deleteAnnotation(c)}}(this),e=function(a){return function(){return a.unsubscribe("annotationEditorHidden",d),a.unsubscribe("annotationEditorSubmit",h)}}(this),this.subscribe("annotationEditorHidden",d),this.subscribe("annotationEditorSubmit",h),this.showEditor(c,g),b.util.getGlobal().getSelection().removeAllRanges()},h.prototype.onSetTool=function(a){switch(a){case"comment":return this.setVisibleHighlights(this.visibleHighlights,!1);case"highlight":return this.setVisibleHighlights(!0,!1)}},h.prototype.onSetVisibleHighlights=function(a){return this.visibleHighlights=a,this.setVisibleHighlights(a,!1)},h.prototype.deleteAnnotation=function(a){if(a.deleted)return;return a.deleted=!0,h.__super__.deleteAnnotation.apply(this,arguments)},h}(b),b=this.Annotator,a=b.$,b.Host=function(b){function d(b,e){this._dragRefresh=c(this._dragRefresh,this),this._dragUpdate=c(this._dragUpdate,this);var f,g;document.baseURI&&window.PDFView!=null?g="*":(g=window.location.origin,g==null&&(g=window.location.protocol+"//"+window.location.host)),f=a("<iframe></iframe>").attr("name","hyp_sidebar_frame").attr("seamless","").attr("src",""+e.app+"#/?xdm="+encodeURIComponent(g)),d.__super__.constructor.call(this,b,e,{dontScan:!0}),f.appendTo(this.frame),this.plugins.Heatmap!=null&&(this._setupDragEvents(),this.plugins.Heatmap.element.on("click",function(a){return function(b){if(a.frame.hasClass("annotator-collapsed"))return a.showFrame()}}(this))),this.scanDocument("Host initialized")}return e(d,b),d.prototype.drag={delta:0,enabled:!1,last:null,tick:!1},d.prototype._setupXDM=function(b){var c;return c=d.__super__._setupXDM.apply(this,arguments),c.bind("showFrame",function(a){return function(b,c){a.drag.enabled||a.frame.css({"margin-left":""+ -1*a.frame.width()+"px"}),a.frame.removeClass("annotator-no-transition"),a.frame.removeClass("annotator-collapsed");switch(c){case"editor":return a.publish("annotationEditorShown");case"viewer":return a.publish("annotationViewerShown")}}}(this)).bind("hideFrame",function(a){return function(b,c){a.frame.css({"margin-left":""}),a.frame.removeClass("annotator-no-transition"),a.frame.addClass("annotator-collapsed");switch(c){case"editor":return a.publish("annotationEditorHidden");case"viewer":return a.publish("annotationViewerHidden")}}}(this)).bind("dragFrame",function(a){return function(b,c){return a._dragUpdate(c)}}(this)).bind("getMaxBottom",function(b){return function(){var b,c,d,e,f,g,h,i,j;return f="*"+function(){var a,b,c,d;c=["adder","outer","notice","filter","frame"],d=[];for(a=0,b=c.length;a<b;a++)h=c[a],d.push(":not(.annotator-"+h+")");return d}().join(""),b=function(){var b,h,k,l,m;k=a(document.body).find(f),m=[];for(b=0,h=k.length;b<h;b++){d=k[b],e=a(d).css("position"),g=a(d).offset().top,j=a(d).css("z-index");if(i=(l=/\d+/.exec(a(d).css("top")))!=null?l[0]:void 0)g=Math.min(Number(i,g));e!=="absolute"&&e!=="fixed"||g!==0||j==="auto"?m.push(0):(c=a(d).outerHeight(!1),c>80?m.push(0):m.push(c))}return m}(),Math.max.apply(Math,b)}}(this))},d.prototype._setupDragEvents=function(){var a,b,c,d,e,f,g;c=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),c.width=c.height=1,this.element.append(c),b=function(a){return function(b){var d;return b.dataTransfer.dropEffect="none",b.dataTransfer.effectAllowed="none",b.dataTransfer.setData("text/plain",""),b.dataTransfer.setDragImage(c,0,0),a.drag.enabled=!0,a.drag.last=b.screenX,d=parseInt(getComputedStyle(a.frame[0]).marginLeft),a.frame.css({"margin-left":""+d+"px"}),a.showFrame()}}(this),a=function(a){return function(b){return a.drag.enabled=!1,a.drag.last=null}}(this),g=[this.plugins.Heatmap.element[0],this.plugins.Toolbar.buttons[0]];for(e=0,f=g.length;e<f;e++)d=g[e],d.draggable=!0,d.addEventListener("dragstart",b),d.addEventListener("dragend",a);return document.addEventListener("dragover",function(a){return function(b){return a._dragUpdate(b.screenX)}}(this))},d.prototype._dragUpdate=function(a){if(!this.drag.enabled)return;this.drag.last!=null&&(this.drag.delta+=a-this.drag.last),this.drag.last=a;if(!this.drag.tick)return this.drag.tick=!0,window.requestAnimationFrame(this._dragRefresh)},d.prototype._dragRefresh=function(){var a,b,c;return a=this.drag.delta,this.drag.delta=0,this.drag.tick=!1,b=parseInt(getComputedStyle(this.frame[0]).marginLeft),c=-1*b,b+=a,c-=a,this.frame.addClass("annotator-no-transition"),this.frame.css({"margin-left":""+b+"px",width:""+c+"px"})},d}(b.Guest)}).call(this);